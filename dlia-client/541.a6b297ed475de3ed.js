(self.webpackChunkDLIA_client=self.webpackChunkDLIA_client||[]).push([[541],{6089:(Le,Ae,bt)=>{"use strict";var ae=bt(9095),Zt=bt(4703),Ct="value",c="\n  ",p={};function Tt(pe){var lt=Array.isArray(pe);return function(Ut){var Dt=mt(p.plainArray,Ut);if(Dt)return Dt;if(lt&&Ut.length!==pe.length)return"an array with "+pe.length+" items";for(var Qt=0;Qt<Ut.length;Qt++)if(Dt=mt(lt?pe[Qt]:pe,Ut[Qt]))return[Qt].concat(Dt)}}function mt(pe,lt){if(null!=lt||pe.hasOwnProperty("__required")){var qt=pe(lt);if(qt)return Array.isArray(qt)?qt:[qt]}}function St(pe,lt){var qt=pe.length,Mt=pe[qt-1],Ut=pe.slice(0,qt-1);return 0===Ut.length&&(Ut=[Ct]),lt=Zt(lt,{path:Ut}),"function"==typeof Mt?Mt(lt):Ce(lt,function de(pe){return"must be "+function Fe(pe){return/^an? /.test(pe)?pe:/^[aeiou]/i.test(pe)?"an "+pe:/^[a-z]/i.test(pe)?"a "+pe:pe}(pe)+"."}(Mt))}function Ce(pe,lt){return(Re(pe.path)?"Item at position ":"")+pe.path.join(".")+" "+lt}function Re(pe){return"number"==typeof pe[pe.length-1]||"number"==typeof pe[0]}p.assert=function(pe,lt){return lt=lt||{},function(qt){var Mt=mt(pe,qt);if(Mt){var Ut=St(Mt,lt);throw lt.apiName&&(Ut=lt.apiName+": "+Ut),new Error(Ut)}}},p.shape=function(lt){var qt=function ye(pe){return Object.keys(pe||{}).map(function(lt){return{key:lt,value:pe[lt]}})}(lt);return function(Ut){var Dt=mt(p.plainObject,Ut);if(Dt)return Dt;for(var Qt,le=[],ze=0;ze<qt.length;ze++)(Dt=mt(qt[ze].value,Ut[Qt=qt[ze].key]))&&le.push([Qt].concat(Dt));return le.length<2?le[0]:function(Qe){le=le.map(function(Je){return"- "+Je[0]+": "+St(Je,Qe).split("\n").join(c)});var Gi=Qe.path.join(".");return"The following properties"+(Gi===Ct?"":" of "+Gi)+" have invalid values:"+c+le.join(c)}}},p.strictShape=function(lt){var qt=p.shape(lt);return function(Ut){var Dt=qt(Ut);if(Dt)return Dt;var Qt=Object.keys(Ut).reduce(function(Jt,le){return void 0===lt[le]&&Jt.push(le),Jt},[]);return 0!==Qt.length?function(){return"The following keys are invalid: "+Qt.join(", ")}:void 0}},p.arrayOf=function(lt){return Tt(lt)},p.tuple=function(){return Tt(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments))},p.required=function(lt){function qt(Mt){return null==Mt?function(Ut){return Ce(Ut,Re(Ut.path)?"cannot be undefined/null.":"is required.")}:lt.apply(this,arguments)}return qt.__required=!0,qt},p.oneOfType=function(){var lt=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(Mt){var Ut=lt.map(function(Dt){return mt(Dt,Mt)}).filter(Boolean);if(Ut.length===lt.length)return Ut.every(function(Dt){return 1===Dt.length&&"string"==typeof Dt[0]})?function zt(pe){return pe.length<2?pe[0]:2===pe.length?pe.join(" or "):pe.slice(0,-1).join(", ")+", or "+pe.slice(-1)}(Ut.map(function(Dt){return Dt[0]})):Ut.reduce(function(Dt,Qt){return Qt.length>Dt.length?Qt:Dt})}},p.equal=function(lt){return function(Mt){if(Mt!==lt)return JSON.stringify(lt)}},p.oneOf=function(){var qt=(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments)).map(function(Mt){return p.equal(Mt)});return p.oneOfType.apply(this,qt)},p.range=function(lt){var qt=lt[0],Mt=lt[1];return function(Dt){if(mt(p.number,Dt)||Dt<qt||Dt>Mt)return"number between "+qt+" & "+Mt+" (inclusive)"}},p.any=function(){},p.boolean=function(lt){if("boolean"!=typeof lt)return"boolean"},p.number=function(lt){if("number"!=typeof lt)return"number"},p.plainArray=function(lt){if(!Array.isArray(lt))return"array"},p.plainObject=function(lt){if(!ae(lt))return"object"},p.string=function(lt){if("string"!=typeof lt)return"string"},p.func=function(lt){if("function"!=typeof lt)return"function"},p.validate=mt,p.processMessage=St,Le.exports=p},9095:Le=>{"use strict";var Ae=Object.prototype.toString;Le.exports=function(bt){var ae;return"[object Object]"===Ae.call(bt)&&(null===(ae=Object.getPrototypeOf(bt))||ae===Object.getPrototypeOf({}))}},2564:(Le,Ae,bt)=>{"use strict";var ae=bt(9652).x0;function Zt(Ct){this.origin=Ct.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=Ct.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=Ct,this.send=this.send.bind(this),this.countries=Ct.countries?Ct.countries.split(","):null,this.types=Ct.types?Ct.types.split(","):null,this.bbox=Ct.bbox?Ct.bbox:null,this.language=Ct.language?Ct.language.split(","):null,this.limit=Ct.limit?+Ct.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(Ct),this.eventQueue=new Array,this.flushInterval=Ct.flushInterval||1e3,this.maxQueueSize=Ct.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}Zt.prototype={select:function(Ct,c){var p=this.getSelectedIndex(Ct,c),Tt=this.getEventPayload("search.select",c);if(Tt.resultIndex=p,Tt.resultPlaceName=Ct.place_name,Tt.resultId=Ct.id,(p!==this.lastSentIndex||Tt.queryString!==this.lastSentInput)&&-1!=p&&(this.lastSentIndex=p,this.lastSentInput=Tt.queryString,Tt.queryString))return this.push(Tt)},start:function(Ct){var c=this.getEventPayload("search.start",Ct);if(c.queryString)return this.push(c)},keyevent:function(Ct,c){if(Ct.key&&!Ct.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(Ct.keyCode)){var p=this.getEventPayload("search.keystroke",c);if(p.lastAction=Ct.key,p.queryString)return this.push(p)}},send:function(Ct,c){if(!this.enableEventLogging)return c?c():void 0;var p=this.getRequestOptions(Ct);this.request(p,function(Tt){return Tt?this.handleError(Tt,c):c?c():void 0}.bind(this))},getRequestOptions:function(Ct){return Array.isArray(Ct)||(Ct=[Ct]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(Ct)}},getEventPayload:function(Ct,c){var p;p=c.options.proximity?"object"==typeof c.options.proximity?[c.options.proximity.longitude,c.options.proximity.latitude]:"ip"===c.options.proximity?[999,999]:c.options.proximity:null;var Tt=c._map?c._map.getZoom():void 0,mt={event:Ct,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:c.options.autocomplete,fuzzyMatch:c.options.fuzzyMatch,proximity:p,limit:c.options.limit,routing:c.options.routing,worldview:c.options.worldview,mapZoom:Tt,keyboardLocale:this.locale};return mt.queryString="search.select"===Ct?c.inputString:"search.select"!=Ct&&c._inputEl?c._inputEl.value:c.inputString,mt},request:function(Ct,c){var p=new XMLHttpRequest;for(var Tt in p.onreadystatechange=function(){if(4==this.readyState)return c(204==this.status?null:this.statusText)},p.open(Ct.method,Ct.host+"/"+Ct.path,!0),Ct.headers)p.setRequestHeader(Tt,Ct.headers[Tt]);p.send(Ct.body)},handleError:function(Ct,c){if(c)return c(Ct)},generateSessionID:function(){return ae()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(Ct,c){if(c._typeahead){var Tt=Ct.id;return c._typeahead.data.map(function(zt){return zt.id}).indexOf(Tt)}},shouldEnableLogging:function(Ct){return!(!1===Ct.enableEventLogging||Ct.origin&&"https://api.mapbox.com"!==Ct.origin||Ct.localGeocoder||Ct.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(Ct,c){this.eventQueue.push(Ct),(this.eventQueue.length>=this.maxQueueSize||c)&&this.flush()},remove:function(){this.flush()}},Le.exports=Zt},3424:Le=>{Le.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},3569:Le=>{function Ae(){}Ae.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const bt={enableHighAccuracy:!0};return new Promise(function(ae,Zt){window.navigator.geolocation.getCurrentPosition(ae,Zt,bt)})}},Le.exports=Ae},8545:(Le,Ae,bt)=>{"use strict";var ae=bt(5562),Zt=bt(3082),Ct=bt(4703),c=bt(9069).EventEmitter,p=bt(3424),Tt=bt(9471),mt=bt(7075),St=bt(2564),zt=bt(1753),de=bt(6775),Fe=bt(3569),Ce=bt(2777);function pe(lt){this._eventEmitter=new c,this.options=Ct({},this.options,lt),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Fe}pe.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(lt){return lt.place_name},render:function(lt){var qt=lt.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+qt[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+qt.splice(1,qt.length).join(",")+"</div></div>"}},addTo:function(lt){function qt(Mt,Ut){if(!document.body.contains(Ut))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const Dt=Mt.onAdd();Ut.appendChild(Dt)}if(lt._controlContainer)lt.addControl(this);else if(lt instanceof HTMLElement)qt(this,lt);else{if("string"!=typeof lt)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");{const Mt=document.querySelectorAll(lt);if(0===Mt.length)throw new Error("Element ",lt,"not found.");if(Mt.length>1)throw new Error("Geocoder can only be added to a single html element");qt(this,Mt[0])}}},onAdd:function(lt){if(lt&&"string"!=typeof lt&&(this._map=lt),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=mt(Tt({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new St(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var qt=this.container=document.createElement("div");qt.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var Mt=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Zt(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(Qe){this.eventManager.keyevent(Qe,this)}.bind(this));var Ut=document.createElement("div");Ut.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var Dt=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(Dt),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),Ut.appendChild(this._clearEl),Ut.appendChild(this._loadingEl),qt.appendChild(Mt),qt.appendChild(this._inputEl),qt.appendChild(Ut),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var Qt=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(Qt),Ut.appendChild(this._geolocateEl),this._showGeolocateButton()}var Jt=this._typeahead=new ae(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),Jt.getItemValue=this.options.getItemValue;var le=Jt.list.draw,ze=this._footerNode=function ye(){var lt=document.createElement("div");return lt.className="mapboxgl-ctrl-geocoder--powered-by",lt.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',lt}();return Jt.list.draw=function(){le.call(this),ze.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),ze.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(ze)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),qt},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(lt){this._hideLoadingIcon();const qt={geometry:{type:"Point",coordinates:[lt.coords.longitude,lt.coords.latitude]}};this._handleMarker(qt),this._fly(qt),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(qt),this._showClearButton(),this.fresh=!1;const Mt={limit:1,language:[this.options.language],query:qt.geometry.coordinates,types:["address"]};this.options.localGeocoderOnly?(this._setInputValue(qt.geometry.coordinates[0]+","+qt.geometry.coordinates[1]),this._eventEmitter.emit("result",{result:qt})):this.geocoderService.reverseGeocode(Mt).send().then(function(Ut){const Dt=Ut.body.features[0];if(Dt){const Qt=Ce.transformFeatureToGeolocationText(Dt,this.options.addressAccuracy);this._setInputValue(Qt),Dt.user_coordinates=qt.geometry.coordinates,this._eventEmitter.emit("result",{result:Dt})}else this._eventEmitter.emit("result",{result:{user_coordinates:qt.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(lt){1===lt.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(lt,qt){var Mt=document.createElementNS("http://www.w3.org/2000/svg","svg");return Mt.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+lt),Mt.setAttribute("viewBox","0 0 18 18"),Mt.setAttribute("xml:space","preserve"),Mt.setAttribute("width",18),Mt.setAttribute("height",18),Mt.innerHTML=qt,Mt},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(lt){this._inputEl.value=lt,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(lt){var qt=(lt.clipboardData||window.clipboardData).getData("text");qt.length>=this.options.minLength&&this._geocode(qt)},_onKeyDown:function(lt){var qt=27,Mt=9;if(lt.keyCode===qt&&this.options.clearAndBlurOnEsc)return this._clear(lt),this._inputEl.blur();var Ut=lt.target&&lt.target.shadowRoot?lt.target.shadowRoot.activeElement:lt.target;if(!Ut||!Ut.value)return this.fresh=!0,lt.keyCode!==Mt&&this.clear(lt),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!lt.metaKey&&-1===[Mt,qt,37,39,13,38,40].indexOf(lt.keyCode)&&Ut.value.length>=this.options.minLength&&this._geocode(Ut.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(lt){this.options.clearOnBlur&&this._clearOnBlur(lt),this.options.collapsed&&this._collapse()},_onChange:function(){var lt=this._typeahead.selected;lt&&JSON.stringify(lt)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(lt),this.options.marker&&this._mapboxgl&&this._handleMarker(lt),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(lt),this._eventEmitter.emit("result",{result:lt}),this.eventManager.select(lt,this))},_fly:function(lt){var qt;if(lt.properties&&p[lt.properties.short_code])qt=Ct({},this.options.flyTo),this._map&&this._map.fitBounds(p[lt.properties.short_code].bbox,qt);else if(lt.bbox){var Mt=lt.bbox;qt=Ct({},this.options.flyTo),this._map&&this._map.fitBounds([[Mt[0],Mt[1]],[Mt[2],Mt[3]]],qt)}else qt=Ct({},{zoom:this.options.zoom},this.options.flyTo),lt.center?qt.center=lt.center:lt.geometry&&lt.geometry.type&&"Point"===lt.geometry.type&&lt.geometry.coordinates&&(qt.center=lt.geometry.coordinates),this._map&&this._map.flyTo(qt)},_requestType:function(lt,qt){return lt.localGeocoderOnly?1:lt.reverseGeocode&&Ce.REVERSE_GEOCODE_COORD_RGX.test(qt)?2:0},_setupConfig:function(lt,qt){const Ut=/[\s,]+/;var Dt=this,Qt=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(le,ze){return null==Dt.options[ze]||(le[ze]=["countries","types","language"].indexOf(ze)>-1?Dt.options[ze].split(Ut):Dt.options[ze],"proximity"===ze&&"number"==typeof Dt.options[ze].longitude&&"number"==typeof Dt.options[ze].latitude&&(le[ze]=[Dt.options[ze].longitude,Dt.options[ze].latitude])),le},{});switch(lt){case 2:var Jt=qt.split(Ut).map(function(le){return parseFloat(le,10)});Dt.options.flipCoordinates||Jt.reverse(),Qt=Ct(Qt,{query:Jt,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(le){le in Qt&&delete Qt[le]});break;case 0:{const le=qt.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(le)&&(qt=qt.replace(/,/g," ")),Qt=Ct(Qt,{query:qt})}}return Qt},_geocode:function(lt){this.inputString=lt,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:lt});const qt=this._requestType(this.options,lt),Mt=this._setupConfig(qt,lt);var Ut;switch(qt){case 1:Ut=Promise.resolve();break;case 0:Ut=this.geocoderService.forwardGeocode(Mt).send();break;case 2:Ut=this.geocoderService.reverseGeocode(Mt).send()}var Dt=this.options.localGeocoder&&this.options.localGeocoder(lt)||[],Qt=[],Jt=null;return Ut.catch(function(le){Jt=le}.bind(this)).then(function(le){this._hideLoadingIcon();var ze={};return le?"200"==le.statusCode&&((ze=le.body).request=le.request,ze.headers=le.headers):ze={type:"FeatureCollection",features:[]},ze.config=Mt,this.fresh&&(this.eventManager.start(this),this.fresh=!1),ze.features=ze.features?Dt.concat(ze.features):Dt,this.options.externalGeocoder?(Qt=this.options.externalGeocoder(lt,ze.features)||Promise.resolve([])).then(function(Qe){return ze.features=ze.features?Qe.concat(ze.features):Qe,ze},function(){return ze}):ze}.bind(this)).then(function(le){if(Jt)throw Jt;this.options.filter&&le.features.length&&(le.features=le.features.filter(this.options.filter)),le.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",le),this._typeahead.update(le.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",le))}.bind(this)).catch(function(le){this._hideLoadingIcon(),this._hideAttribution(),Dt.length&&this.options.localGeocoder||Qt.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(Dt)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:Dt}),this._eventEmitter.emit("error",{error:le})}.bind(this)),Ut},_clear:function(lt){lt&&lt.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(lt){this._clear(lt),this._inputEl.focus()},_clearOnBlur:function(lt){lt.relatedTarget&&this._clear(lt)},_onQueryResult:function(lt){var qt=lt.body;if(qt.features.length){var Mt=qt.features[0];this._typeahead.selected=Mt,this._inputEl.value=Mt.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var lt=this._map.getCenter().wrap();this.setProximity({longitude:lt.lng,latitude:lt.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(lt){return this._geocode(lt).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(lt){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(lt)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var lt=this.options.language.split(",")[0],qt=de.language(lt),Mt=zt.placeholder[qt];if(Mt)return Mt}return"Search"},setInput:function(lt){return this._inputEl.value=lt,this._typeahead.selected=null,this._typeahead.clear(),lt.length>=this.options.minLength&&this._geocode(lt),this},setProximity:function(lt,qt=!0){return this.options.proximity=lt,qt&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(lt){return lt&&"function"==typeof lt&&(this._typeahead.render=lt),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(lt){var qt=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=lt||this.options.language||qt,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(lt){return this.options.zoom=lt,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(lt){return this.options.flyTo=lt,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(lt){return this.placeholder=lt||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(lt){return this.options.bbox=lt,this},getCountries:function(){return this.options.countries},setCountries:function(lt){return this.options.countries=lt,this},getTypes:function(){return this.options.types},setTypes:function(lt){return this.options.types=lt,this},getMinLength:function(){return this.options.minLength},setMinLength:function(lt){return this.options.minLength=lt,this._typeahead&&(this._typeahead.options.minLength=lt),this},getLimit:function(){return this.options.limit},setLimit:function(lt){return this.options.limit=lt,this._typeahead&&(this._typeahead.options.limit=lt),this},getFilter:function(){return this.options.filter},setFilter:function(lt){return this.options.filter=lt,this},setOrigin:function(lt){return this.options.origin=lt,this.geocoderService=mt(Tt({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(lt){return this.options.accessToken=lt,this.geocoderService=mt(Tt({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(lt){return this.options.autocomplete=lt,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(lt){return this.options.fuzzyMatch=lt,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(lt){return this.options.routing=lt,this},getRouting:function(){return this.options.routing},setWorldview:function(lt){return this.options.worldview=lt,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(lt){if(this._map){this._removeMarker();var Mt=Ct({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(Mt),lt.center?this.mapMarker.setLngLat(lt.center).addTo(this._map):lt.geometry&&lt.geometry.type&&"Point"===lt.geometry.type&&lt.geometry.coordinates&&this.mapMarker.setLngLat(lt.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(lt,qt){return this._eventEmitter.on(lt,qt),this},off:function(lt,qt){return this._eventEmitter.removeListener(lt,qt),this.eventManager.remove(),this}},Le.exports=pe},1753:Le=>{"use strict";Le.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05dc\u05d7\u05e4\u05e9",ja:"\u30b5\u30fc\u30c1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041f\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641c\u7d22",cs:"Vyhled\xe1v\xe1n\xed",hu:"Keres\xe9s",ka:"\u10eb\u10d8\u10d4\u10d1\u10d0",nb:"S\xf8ke",sk:"Vyh\u013ead\xe1vanie",th:"\u0e04\u0e49\u0e19\u0e2b\u0e32",fi:"Hae",is:"Leita",ko:"\uc218\uc0c9",pl:"Szukaj",sl:"Iskanje",fa:"\u062c\u0633\u062a\u062c\u0648",ru:"\u041f\u043e\u0438\u0441\u043a"}}},2777:Le=>{function bt(Zt){const Ct=Zt.address||"",c=Zt.text||"",p=Zt.place_name||"",mt={address:p.split(",")[0],houseNumber:Ct,street:c,placeName:p};return Zt.context.forEach(function(St){const zt=St.id.split(".")[0];mt[zt]=St.text}),mt}Le.exports={transformFeatureToGeolocationText:function Ae(Zt,Ct){const c=bt(Zt),p=["address","street","place","country"];if("function"==typeof Ct)return Ct(c);const mt=p.indexOf(Ct);return(-1===mt?p:p.slice(mt)).reduce(function(St,zt){return c[zt]?(""!==St&&(St+=", "),St+c[zt]):St},"")},getAddressInfo:bt,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/}},9471:(Le,Ae,bt)=>{"use strict";var ae=bt(7454);Le.exports=ae},7454:(Le,Ae,bt)=>{"use strict";var ae=bt(753),Zt=bt(4176);function Ct(p){Zt.call(this,p)}(Ct.prototype=Object.create(Zt.prototype)).constructor=Ct,Ct.prototype.sendRequest=ae.browserSend,Ct.prototype.abortRequest=ae.browserAbort,Le.exports=function c(p){return new Ct(p)}},753:(Le,Ae,bt)=>{"use strict";var ae=bt(4332),Zt=bt(6158),Ct=bt(9719),c=bt(8829),p={};function St(Ce){var Re=Ce.total,ye=Ce.loaded;return{total:Re,transferred:ye,percent:100*ye/Re}}function zt(Ce,Re){return new Promise(function(ye,pe){Re.onprogress=function(Mt){Ce.emitter.emit(Ct.EVENT_PROGRESS_DOWNLOAD,St(Mt))};var lt=Ce.file;lt&&(Re.upload.onprogress=function(Mt){Ce.emitter.emit(Ct.EVENT_PROGRESS_UPLOAD,St(Mt))}),Re.onerror=function(Mt){pe(Mt)},Re.onabort=function(){var Mt=new Zt({request:Ce,type:Ct.ERROR_REQUEST_ABORTED});pe(Mt)},Re.onload=function(){if(delete p[Ce.id],Re.status<200||Re.status>=400){var Mt=new Zt({request:Ce,body:Re.response,statusCode:Re.status});pe(Mt)}else ye(Re)};var qt=Ce.body;"string"==typeof qt?Re.send(qt):qt?Re.send(JSON.stringify(qt)):lt?Re.send(lt):Re.send(),p[Ce.id]=Re}).then(function(ye){return function mt(Ce,Re){return new ae(Ce,{body:Re.response,headers:c(Re.getAllResponseHeaders()),statusCode:Re.status})}(Ce,ye)})}function de(Ce,Re){var ye=Ce.url(Re),pe=new window.XMLHttpRequest;return pe.open(Ce.method,ye),Object.keys(Ce.headers).forEach(function(lt){pe.setRequestHeader(lt,Ce.headers[lt])}),pe}Le.exports={browserAbort:function Tt(Ce){var Re=p[Ce.id];Re&&(Re.abort(),delete p[Ce.id])},sendRequestXhr:zt,browserSend:function Fe(Ce){return Promise.resolve().then(function(){var Re=de(Ce,Ce.client.accessToken);return zt(Ce,Re)})},createRequestXhr:de}},4176:(Le,Ae,bt)=>{"use strict";var ae=bt(8129),Zt=bt(4538),Ct=bt(9719);function c(p){if(!p||!p.accessToken)throw new Error("Cannot create a client without an access token");ae(p.accessToken),this.accessToken=p.accessToken,this.origin=p.origin||Ct.API_ORIGIN}c.prototype.createRequest=function(Tt){return new Zt(this,Tt)},Le.exports=c},6158:(Le,Ae,bt)=>{"use strict";var ae=bt(9719);Le.exports=function Zt(Ct){var p,c=Ct.type||ae.ERROR_HTTP;if(Ct.body)try{p=JSON.parse(Ct.body)}catch{p=Ct.body}else p=null;var Tt=Ct.message||null;Tt||("string"==typeof p?Tt=p:p&&"string"==typeof p.message?Tt=p.message:c===ae.ERROR_REQUEST_ABORTED&&(Tt="Request aborted")),this.message=Tt,this.type=c,this.statusCode=Ct.statusCode||null,this.request=Ct.request,this.body=p}},4538:(Le,Ae,bt)=>{"use strict";var ae=bt(8129),Zt=bt(4703),Ct=bt(6661),c=bt(3449),p=bt(9719),Tt=1;function mt(St,zt){if(!St)throw new Error("MapiRequest requires a client");if(!zt||!zt.path||!zt.method)throw new Error("MapiRequest requires an options object with path and method properties");var de={};zt.body&&(de["content-type"]="application/json");var Fe=Zt(de,zt.headers),Ce=Object.keys(Fe).reduce(function(Re,ye){return Re[ye.toLowerCase()]=Fe[ye],Re},{});this.id=Tt++,this._options=zt,this.emitter=new Ct,this.client=St,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=zt.path,this.method=zt.method,this.origin=zt.origin||St.origin,this.query=zt.query||{},this.params=zt.params||{},this.body=zt.body||null,this.file=zt.file||null,this.encoding=zt.encoding||"utf8",this.sendFileAs=zt.sendFileAs||null,this.headers=Ce}mt.prototype.url=function(zt){var de=c.prependOrigin(this.path,this.origin);de=c.appendQueryObject(de,this.query);var Fe=this.params,Ce=zt??this.client.accessToken;if(Ce){de=c.appendQueryParam(de,"access_token",Ce);var Re=ae(Ce).user;Fe=Zt({ownerId:Re},Fe)}return c.interpolateRouteParams(de,Fe)},mt.prototype.send=function(){var zt=this;if(zt.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return zt.sent=!0,zt.client.sendRequest(zt).then(function(de){return zt.response=de,zt.emitter.emit(p.EVENT_RESPONSE,de),de},function(de){throw zt.error=de,zt.emitter.emit(p.EVENT_ERROR,de),de})},mt.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},mt.prototype.eachPage=function(zt){var de=this;function Fe(ye){zt(null,ye,function pe(){delete de._nextPageRequest;var lt=ye.nextPage();lt&&(de._nextPageRequest=lt,Re(lt))})}function Ce(ye){zt(ye,null,function(){})}function Re(ye){ye.send().then(Fe,Ce)}Re(this)},mt.prototype.clone=function(){return this._extend()},mt.prototype._extend=function(zt){var de=Zt(this._options,zt);return new mt(this.client,de)},Le.exports=mt},4332:(Le,Ae,bt)=>{"use strict";var ae=bt(5699);function Zt(Ct,c){this.request=Ct,this.headers=c.headers,this.rawBody=c.body,this.statusCode=c.statusCode;try{this.body=JSON.parse(c.body||"{}")}catch{this.body=c.body}this.links=ae(this.headers.link)}Zt.prototype.hasNextPage=function(){return!!this.links.next},Zt.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},Le.exports=Zt},9719:Le=>{"use strict";Le.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},8829:Le=>{"use strict";Le.exports=function bt(ae){var Zt={};return ae&&ae.trim().split(/[\r|\n]+/).forEach(function(Ct){var c=function Ae(ae){var Zt=ae.indexOf(":");return{name:ae.substring(0,Zt).trim().toLowerCase(),value:ae.substring(Zt+1).trim()}}(Ct);Zt[c.name]=c.value}),Zt}},5699:Le=>{"use strict";Le.exports=function ae(Zt){return Zt?Zt.split(/,\s*</).reduce(function(Ct,c){var p=function bt(Zt){var Ct=Zt.match(/<?([^>]*)>(.*)/);if(!Ct)return null;var c=Ct[1],p=Ct[2].split(";"),Tt=null,mt=p.reduce(function(St,zt){var de=function Ae(Zt){var Ct=Zt.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return Ct?{key:Ct[1],value:Ct[2]}:null}(zt);return de?"rel"===de.key?(Tt||(Tt=de.value),St):(St[de.key]=de.value,St):St},{});return Tt?{url:c,rel:Tt,params:mt}:null}(c);return p?(p.rel.split(/\s+/).forEach(function(mt){Ct[mt]||(Ct[mt]={url:p.url,params:p.params})}),Ct):Ct},{}):{}}},3449:Le=>{"use strict";function bt(p){return Array.isArray(p)?function Ae(p){return p.map(encodeURIComponent).join(",")}(p):encodeURIComponent(String(p))}function ae(p,Tt,mt){if(!1===mt||null===mt)return p;var St=/\?/.test(p)?"&":"?",zt=encodeURIComponent(Tt);return void 0!==mt&&""!==mt&&!0!==mt&&(zt+="="+bt(mt)),""+p+St+zt}Le.exports={appendQueryObject:function Zt(p,Tt){if(!Tt)return p;var mt=p;return Object.keys(Tt).forEach(function(St){var zt=Tt[St];void 0!==zt&&(Array.isArray(zt)&&(zt=zt.filter(function(de){return null!=de}).join(",")),mt=ae(mt,St,zt))}),mt},appendQueryParam:ae,prependOrigin:function Ct(p,Tt){if(!Tt||"http"===p.slice(0,4))return p;var mt="/"===p[0]?"":"/";return""+Tt.replace(/\/$/,"")+mt+p},interpolateRouteParams:function c(p,Tt){return Tt?p.replace(/\/:([a-zA-Z0-9]+)/g,function(mt,St){var zt=Tt[St];if(void 0===zt)throw new Error("Unspecified route parameter "+St);return"/"+bt(zt)}):p}}},6661:Le=>{"use strict";var Ae=Object.prototype.hasOwnProperty,bt="~";function ae(){}function Zt(Tt,mt,St){this.fn=Tt,this.context=mt,this.once=St||!1}function Ct(Tt,mt,St,zt,de){if("function"!=typeof St)throw new TypeError("The listener must be a function");var Fe=new Zt(St,zt||Tt,de),Ce=bt?bt+mt:mt;return Tt._events[Ce]?Tt._events[Ce].fn?Tt._events[Ce]=[Tt._events[Ce],Fe]:Tt._events[Ce].push(Fe):(Tt._events[Ce]=Fe,Tt._eventsCount++),Tt}function c(Tt,mt){0==--Tt._eventsCount?Tt._events=new ae:delete Tt._events[mt]}function p(){this._events=new ae,this._eventsCount=0}Object.create&&(ae.prototype=Object.create(null),(new ae).__proto__||(bt=!1)),p.prototype.eventNames=function(){var St,zt,mt=[];if(0===this._eventsCount)return mt;for(zt in St=this._events)Ae.call(St,zt)&&mt.push(bt?zt.slice(1):zt);return Object.getOwnPropertySymbols?mt.concat(Object.getOwnPropertySymbols(St)):mt},p.prototype.listeners=function(mt){var zt=this._events[bt?bt+mt:mt];if(!zt)return[];if(zt.fn)return[zt.fn];for(var de=0,Fe=zt.length,Ce=new Array(Fe);de<Fe;de++)Ce[de]=zt[de].fn;return Ce},p.prototype.listenerCount=function(mt){var zt=this._events[bt?bt+mt:mt];return zt?zt.fn?1:zt.length:0},p.prototype.emit=function(mt,St,zt,de,Fe,Ce){var Re=bt?bt+mt:mt;if(!this._events[Re])return!1;var lt,qt,ye=this._events[Re],pe=arguments.length;if(ye.fn){switch(ye.once&&this.removeListener(mt,ye.fn,void 0,!0),pe){case 1:return ye.fn.call(ye.context),!0;case 2:return ye.fn.call(ye.context,St),!0;case 3:return ye.fn.call(ye.context,St,zt),!0;case 4:return ye.fn.call(ye.context,St,zt,de),!0;case 5:return ye.fn.call(ye.context,St,zt,de,Fe),!0;case 6:return ye.fn.call(ye.context,St,zt,de,Fe,Ce),!0}for(qt=1,lt=new Array(pe-1);qt<pe;qt++)lt[qt-1]=arguments[qt];ye.fn.apply(ye.context,lt)}else{var Ut,Mt=ye.length;for(qt=0;qt<Mt;qt++)switch(ye[qt].once&&this.removeListener(mt,ye[qt].fn,void 0,!0),pe){case 1:ye[qt].fn.call(ye[qt].context);break;case 2:ye[qt].fn.call(ye[qt].context,St);break;case 3:ye[qt].fn.call(ye[qt].context,St,zt);break;case 4:ye[qt].fn.call(ye[qt].context,St,zt,de);break;default:if(!lt)for(Ut=1,lt=new Array(pe-1);Ut<pe;Ut++)lt[Ut-1]=arguments[Ut];ye[qt].fn.apply(ye[qt].context,lt)}}return!0},p.prototype.on=function(mt,St,zt){return Ct(this,mt,St,zt,!1)},p.prototype.once=function(mt,St,zt){return Ct(this,mt,St,zt,!0)},p.prototype.removeListener=function(mt,St,zt,de){var Fe=bt?bt+mt:mt;if(!this._events[Fe])return this;if(!St)return c(this,Fe),this;var Ce=this._events[Fe];if(Ce.fn)Ce.fn===St&&(!de||Ce.once)&&(!zt||Ce.context===zt)&&c(this,Fe);else{for(var Re=0,ye=[],pe=Ce.length;Re<pe;Re++)(Ce[Re].fn!==St||de&&!Ce[Re].once||zt&&Ce[Re].context!==zt)&&ye.push(Ce[Re]);ye.length?this._events[Fe]=1===ye.length?ye[0]:ye:c(this,Fe)}return this},p.prototype.removeAllListeners=function(mt){var St;return mt?this._events[St=bt?bt+mt:mt]&&c(this,St):(this._events=new ae,this._eventsCount=0),this},p.prototype.off=p.prototype.removeListener,p.prototype.addListener=p.prototype.on,p.prefixed=bt,p.EventEmitter=p,Le.exports=p},7075:(Le,Ae,bt)=>{"use strict";var ae=bt(4703),Zt=bt(9801),Ct=bt(4313),c=bt(1836),p=bt(497),Tt={},mt=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Tt.forwardGeocode=function(St){Zt.assertShape({query:Zt.required(Zt.string),mode:Zt.oneOf("mapbox.places","mapbox.places-permanent"),countries:Zt.arrayOf(Zt.string),proximity:Zt.oneOf(Zt.coordinates,"ip"),types:Zt.arrayOf(Zt.oneOf(mt)),autocomplete:Zt.boolean,bbox:Zt.arrayOf(Zt.number),limit:Zt.number,language:Zt.arrayOf(Zt.string),routing:Zt.boolean,fuzzyMatch:Zt.boolean,worldview:Zt.string})(St),St.mode=St.mode||"mapbox.places";var zt=c(ae({country:St.countries},Ct(St,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Ct(St,["mode","query"]),query:zt})},Tt.reverseGeocode=function(St){Zt.assertShape({query:Zt.required(Zt.coordinates),mode:Zt.oneOf("mapbox.places","mapbox.places-permanent"),countries:Zt.arrayOf(Zt.string),types:Zt.arrayOf(Zt.oneOf(mt)),bbox:Zt.arrayOf(Zt.number),limit:Zt.number,language:Zt.arrayOf(Zt.string),reverseMode:Zt.oneOf("distance","score"),routing:Zt.boolean,worldview:Zt.string})(St),St.mode=St.mode||"mapbox.places";var zt=c(ae({country:St.countries},Ct(St,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Ct(St,["mode","query"]),query:zt})},Le.exports=p(Tt)},497:(Le,Ae,bt)=>{"use strict";var ae=bt(4176),Zt=bt(7454);Le.exports=function Ct(c){return function(p){var Tt;Tt=ae.prototype.isPrototypeOf(p)?p:Zt(p);var mt=Object.create(c);return mt.client=Tt,mt}}},5621:Le=>{"use strict";Le.exports=function Ae(bt,ae){return Object.keys(bt).reduce(function(Zt,Ct){return Zt[Ct]=ae(Ct,bt[Ct]),Zt},{})}},4313:Le=>{"use strict";Le.exports=function Ae(bt,ae){var Zt=function(Ct,c){return-1!==ae.indexOf(Ct)&&void 0!==c};return"function"==typeof ae&&(Zt=ae),Object.keys(bt).filter(function(Ct){return Zt(Ct,bt[Ct])}).reduce(function(Ct,c){return Ct[c]=bt[c],Ct},{})}},1836:(Le,Ae,bt)=>{"use strict";var ae=bt(5621);Le.exports=function Zt(Ct){return ae(Ct,function(c,p){return"boolean"==typeof p?JSON.stringify(p):p})}},9801:(Le,Ae,bt)=>{"use strict";var ae=bt(4703),Zt=bt(6089);Le.exports=ae(Zt,{file:function Ct(mt){return typeof window<"u"?mt instanceof global.Blob||mt instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof mt&&void 0===mt.pipe?"Filename or Readable stream":void 0},date:function p(mt){var St="date";if("boolean"==typeof mt)return St;try{var zt=new Date(mt);if(zt.getTime&&isNaN(zt.getTime()))return St}catch{return St}},coordinates:function Tt(mt){return Zt.tuple(Zt.number,Zt.number)(mt)},assertShape:function c(mt,St){return Zt.assert(Zt.strictShape(mt),St)}})},8129:(Le,Ae,bt)=>{"use strict";var ae=bt(2049),Zt={};function p(Tt,mt){return Object.prototype.hasOwnProperty.call(Tt,mt)}Le.exports=function Ct(Tt){if(Zt[Tt])return Zt[Tt];var mt=Tt.split("."),St=mt[0],zt=mt[1];if(!zt)throw new Error("Invalid token");var de=function c(Tt){try{return JSON.parse(ae.decode(Tt))}catch{throw new Error("Invalid token")}}(zt),Fe={usage:St,user:de.u};return p(de,"a")&&(Fe.authorization=de.a),p(de,"exp")&&(Fe.expires=1e3*de.exp),p(de,"iat")&&(Fe.created=1e3*de.iat),p(de,"scopes")&&(Fe.scopes=de.scopes),p(de,"client")&&(Fe.client=de.client),p(de,"ll")&&(Fe.lastLogin=de.ll),p(de,"iu")&&(Fe.impersonator=de.iu),Zt[Tt]=Fe,Fe}},3541:(Le,Ae,bt)=>{"use strict";bt.r(Ae),bt.d(Ae,{ExploreComponent:()=>Fg});var ae=bt(2340),Zt=bt(3353),Ct=bt(4098),c=bt(6895),p=bt(4650),Tt=bt(3238),mt=bt(7340);let Gn=(()=>{class l{}return l.\u0275fac=function(i){return new(i||l)},l.\u0275mod=p.oAB({type:l}),l.\u0275inj=p.cJS({imports:[[c.ez,Tt.BQ,Zt.ud,Ct.ZD],Ct.ZD,Tt.BQ]}),l})();var cn=bt(7392),vn=bt(4859),_i=bt(1281),ni=bt(7579),On=bt(2722),Is=bt(8675),Bn=bt(2687),Pn=bt(5017),In=bt(9521),Me=bt(4006);let xs=(()=>{class l{}return l.\u0275fac=function(i){return new(i||l)},l.\u0275mod=p.oAB({type:l}),l.\u0275inj=p.cJS({imports:[[Tt.BQ],Tt.BQ]}),l})(),Wo=(()=>{class l{}return l.\u0275fac=function(i){return new(i||l)},l.\u0275mod=p.oAB({type:l}),l.\u0275inj=p.cJS({imports:[[Tt.uc,Tt.si,Tt.BQ,Tt.us,c.ez],Tt.uc,Tt.BQ,Tt.us,xs]}),l})();var bs=bt(727),Ia=bt(4986),$r=bt(5963),fr=bt(6406),Xr=bt(9751),To=bt(6451),qs=bt(4004),So=bt(5698),Sl=bt(8505),Cl=bt(3900),mr=bt(445);function Co(l,r,i){for(let o in r)if(r.hasOwnProperty(o)){const d=r[o];d?l.setProperty(o,d,i?.has(o)?"important":""):l.removeProperty(o)}return l}function Ln(l,r){const i=r?"":"none";Co(l.style,{"touch-action":r?"":"none","-webkit-user-drag":r?"":"none","-webkit-tap-highlight-color":r?"":"transparent","user-select":i,"-ms-user-select":i,"-webkit-user-select":i,"-moz-user-select":i})}function Mo(l,r,i){Co(l.style,{position:r?"":"fixed",top:r?"":"0",opacity:r?"":"0",left:r?"":"-999em"},i)}function gr(l,r){return r&&"none"!=r?l+" "+r:l}function Xo(l){const r=l.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(l)*r}function N(l,r){return l.getPropertyValue(r).split(",").map(o=>o.trim())}function Z(l){const r=l.getBoundingClientRect();return{top:r.top,right:r.right,bottom:r.bottom,left:r.left,width:r.width,height:r.height,x:r.x,y:r.y}}function Q(l,r,i){const{top:o,bottom:d,left:_,right:x}=l;return i>=o&&i<=d&&r>=_&&r<=x}function ot(l,r,i){l.top+=r,l.bottom=l.top+l.height,l.left+=i,l.right=l.left+l.width}function yt(l,r,i,o){const{top:d,right:_,bottom:x,left:T,width:C,height:D}=l,R=C*r,V=D*r;return o>d-V&&o<x+V&&i>T-R&&i<_+R}class kt{constructor(r){this._document=r,this.positions=new Map}clear(){this.positions.clear()}cache(r){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),r.forEach(i=>{this.positions.set(i,{scrollPosition:{top:i.scrollTop,left:i.scrollLeft},clientRect:Z(i)})})}handleScroll(r){const i=(0,Zt.sA)(r),o=this.positions.get(i);if(!o)return null;const d=o.scrollPosition;let _,x;if(i===this._document){const D=this.getViewportScrollPosition();_=D.top,x=D.left}else _=i.scrollTop,x=i.scrollLeft;const T=d.top-_,C=d.left-x;return this.positions.forEach((D,R)=>{D.clientRect&&i!==R&&i.contains(R)&&ot(D.clientRect,T,C)}),d.top=_,d.left=x,{top:T,left:C}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}}function At(l){const r=l.cloneNode(!0),i=r.querySelectorAll("[id]"),o=l.nodeName.toLowerCase();r.removeAttribute("id");for(let d=0;d<i.length;d++)i[d].removeAttribute("id");return"canvas"===o?we(l,r):("input"===o||"select"===o||"textarea"===o)&&ie(l,r),vt("canvas",l,r,we),vt("input, textarea, select",l,r,ie),r}function vt(l,r,i,o){const d=r.querySelectorAll(l);if(d.length){const _=i.querySelectorAll(l);for(let x=0;x<d.length;x++)o(d[x],_[x])}}let It=0;function ie(l,r){"file"!==r.type&&(r.value=l.value),"radio"===r.type&&r.name&&(r.name=`mat-clone-${r.name}-${It++}`)}function we(l,r){const i=r.getContext("2d");if(i)try{i.drawImage(l,0,0)}catch{}}const re=(0,Zt.i$)({passive:!0}),Ze=(0,Zt.i$)({passive:!1}),Ne=new Set(["position"]);class We{constructor(r,i,o,d,_,x){this._config=i,this._document=o,this._ngZone=d,this._viewportRuler=_,this._dragDropRegistry=x,this._passiveTransform={x:0,y:0},this._activeTransform={x:0,y:0},this._hasStartedDragging=!1,this._moveEvents=new ni.x,this._pointerMoveSubscription=bs.w0.EMPTY,this._pointerUpSubscription=bs.w0.EMPTY,this._scrollSubscription=bs.w0.EMPTY,this._resizeSubscription=bs.w0.EMPTY,this._boundaryElement=null,this._nativeInteractionsEnabled=!0,this._handles=[],this._disabledHandles=new Set,this._direction="ltr",this.dragStartDelay=0,this._disabled=!1,this.beforeStarted=new ni.x,this.started=new ni.x,this.released=new ni.x,this.ended=new ni.x,this.entered=new ni.x,this.exited=new ni.x,this.dropped=new ni.x,this.moved=this._moveEvents,this._pointerDown=T=>{if(this.beforeStarted.next(),this._handles.length){const C=this._getTargetHandle(T);C&&!this._disabledHandles.has(C)&&!this.disabled&&this._initializeDragSequence(C,T)}else this.disabled||this._initializeDragSequence(this._rootElement,T)},this._pointerMove=T=>{const C=this._getPointerPositionOnPage(T);if(!this._hasStartedDragging){if(Math.abs(C.x-this._pickupPositionOnPage.x)+Math.abs(C.y-this._pickupPositionOnPage.y)>=this._config.dragStartThreshold){const K=Date.now()>=this._dragStartTime+this._getDragStartDelay(T),ct=this._dropContainer;if(!K)return void this._endDragSequence(T);(!ct||!ct.isDragging()&&!ct.isReceiving())&&(T.preventDefault(),this._hasStartedDragging=!0,this._ngZone.run(()=>this._startDragSequence(T)))}return}T.preventDefault();const D=this._getConstrainedPointerPosition(C);if(this._hasMoved=!0,this._lastKnownPointerPosition=C,this._updatePointerDirectionDelta(D),this._dropContainer)this._updateActiveDropContainer(D,C);else{const R=this._activeTransform;R.x=D.x-this._pickupPositionOnPage.x+this._passiveTransform.x,R.y=D.y-this._pickupPositionOnPage.y+this._passiveTransform.y,this._applyRootElementTransform(R.x,R.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:D,event:T,distance:this._getDragDistance(D),delta:this._pointerDirectionDelta})})},this._pointerUp=T=>{this._endDragSequence(T)},this._nativeDragStart=T=>{if(this._handles.length){const C=this._getTargetHandle(T);C&&!this._disabledHandles.has(C)&&!this.disabled&&T.preventDefault()}else this.disabled||T.preventDefault()},this.withRootElement(r).withParent(i.parentDragRef||null),this._parentPositions=new kt(o),x.registerDragItem(this)}get disabled(){return this._disabled||!(!this._dropContainer||!this._dropContainer.disabled)}set disabled(r){const i=(0,_i.Ig)(r);i!==this._disabled&&(this._disabled=i,this._toggleNativeDragInteractions(),this._handles.forEach(o=>Ln(o,i)))}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(r){this._handles=r.map(o=>(0,_i.fI)(o)),this._handles.forEach(o=>Ln(o,this.disabled)),this._toggleNativeDragInteractions();const i=new Set;return this._disabledHandles.forEach(o=>{this._handles.indexOf(o)>-1&&i.add(o)}),this._disabledHandles=i,this}withPreviewTemplate(r){return this._previewTemplate=r,this}withPlaceholderTemplate(r){return this._placeholderTemplate=r,this}withRootElement(r){const i=(0,_i.fI)(r);return i!==this._rootElement&&(this._rootElement&&this._removeRootElementListeners(this._rootElement),this._ngZone.runOutsideAngular(()=>{i.addEventListener("mousedown",this._pointerDown,Ze),i.addEventListener("touchstart",this._pointerDown,re),i.addEventListener("dragstart",this._nativeDragStart,Ze)}),this._initialTransform=void 0,this._rootElement=i),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(r){return this._boundaryElement=r?(0,_i.fI)(r):null,this._resizeSubscription.unsubscribe(),r&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(r){return this._parentDragRef=r,this}dispose(){this._removeRootElementListeners(this._rootElement),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeSubscriptions(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(r){!this._disabledHandles.has(r)&&this._handles.indexOf(r)>-1&&(this._disabledHandles.add(r),Ln(r,!0))}enableHandle(r){this._disabledHandles.has(r)&&(this._disabledHandles.delete(r),Ln(r,this.disabled))}withDirection(r){return this._direction=r,this}_withDropContainer(r){this._dropContainer=r}getFreeDragPosition(){const r=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:r.x,y:r.y}}setFreeDragPosition(r){return this._activeTransform={x:0,y:0},this._passiveTransform.x=r.x,this._passiveTransform.y=r.y,this._dropContainer||this._applyRootElementTransform(r.x,r.y),this}withPreviewContainer(r){return this._previewContainer=r,this}_sortFromLastPointerPosition(){const r=this._lastKnownPointerPosition;r&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(r),r)}_removeSubscriptions(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe()}_destroyPreview(){this._preview?.remove(),this._previewRef?.destroy(),this._preview=this._previewRef=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_endDragSequence(r){if(this._dragDropRegistry.isDragging(this)&&(this._removeSubscriptions(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),this._hasStartedDragging))if(this.released.next({source:this}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(r),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;const i=this._getPointerPositionOnPage(r);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(i),dropPoint:i})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(r){He(r)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();const i=this._dropContainer;if(i){const o=this._rootElement,d=o.parentNode,_=this._placeholder=this._createPlaceholderElement(),x=this._anchor=this._anchor||this._document.createComment(""),T=this._getShadowRoot();d.insertBefore(x,o),this._initialTransform=o.style.transform||"",this._preview=this._createPreviewElement(),Mo(o,!1,Ne),this._document.body.appendChild(d.replaceChild(_,o)),this._getPreviewInsertionPoint(d,T).appendChild(this._preview),this.started.next({source:this}),i.start(),this._initialContainer=i,this._initialIndex=i.getItemIndex(this)}else this.started.next({source:this}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(i?i.getScrollableParents():[])}_initializeDragSequence(r,i){this._parentDragRef&&i.stopPropagation();const o=this.isDragging(),d=He(i),_=!d&&0!==i.button,x=this._rootElement,T=(0,Zt.sA)(i),C=!d&&this._lastTouchEventTime&&this._lastTouchEventTime+800>Date.now(),D=d?(0,Bn.yG)(i):(0,Bn.X6)(i);if(T&&T.draggable&&"mousedown"===i.type&&i.preventDefault(),o||_||C||D)return;if(this._handles.length){const H=x.style;this._rootElementTapHighlight=H.webkitTapHighlightColor||"",H.webkitTapHighlightColor="transparent"}this._hasStartedDragging=this._hasMoved=!1,this._removeSubscriptions(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(H=>this._updateOnScroll(H)),this._boundaryElement&&(this._boundaryRect=Z(this._boundaryElement));const R=this._previewTemplate;this._pickupPositionInElement=R&&R.template&&!R.matchSize?{x:0,y:0}:this._getPointerPositionInElement(r,i);const V=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(i);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:V.x,y:V.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,i)}_cleanupDragArtifacts(r){Mo(this._rootElement,!0,Ne),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{const i=this._dropContainer,o=i.getItemIndex(this),d=this._getPointerPositionOnPage(r),_=this._getDragDistance(d),x=i._isOverContainer(d.x,d.y);this.ended.next({source:this,distance:_,dropPoint:d}),this.dropped.next({item:this,currentIndex:o,previousIndex:this._initialIndex,container:i,previousContainer:this._initialContainer,isPointerOverContainer:x,distance:_,dropPoint:d}),i.drop(this,o,this._initialIndex,this._initialContainer,x,_,d),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:r,y:i},{x:o,y:d}){let _=this._initialContainer._getSiblingContainerFromPosition(this,r,i);!_&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(r,i)&&(_=this._initialContainer),_&&_!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=_,this._dropContainer.enter(this,r,i,_===this._initialContainer&&_.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:_,currentIndex:_.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(o,d),this._dropContainer._sortItem(this,r,i,this._pointerDirectionDelta),this._applyPreviewTransform(r-this._pickupPositionInElement.x,i-this._pickupPositionInElement.y))}_createPreviewElement(){const r=this._previewTemplate,i=this.previewClass,o=r?r.template:null;let d;if(o&&r){const _=r.matchSize?this._rootElement.getBoundingClientRect():null,x=r.viewContainer.createEmbeddedView(o,r.context);x.detectChanges(),d=Pi(x,this._document),this._previewRef=x,r.matchSize?Ii(d,_):d.style.transform=ei(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else{const _=this._rootElement;d=At(_),Ii(d,_.getBoundingClientRect()),this._initialTransform&&(d.style.transform=this._initialTransform)}return Co(d.style,{"pointer-events":"none",margin:"0",position:"fixed",top:"0",left:"0","z-index":`${this._config.zIndex||1e3}`},Ne),Ln(d,!1),d.classList.add("cdk-drag-preview"),d.setAttribute("dir",this._direction),i&&(Array.isArray(i)?i.forEach(_=>d.classList.add(_)):d.classList.add(i)),d}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();const r=this._placeholder.getBoundingClientRect();this._preview.classList.add("cdk-drag-animating"),this._applyPreviewTransform(r.left,r.top);const i=function et(l){const r=getComputedStyle(l),i=N(r,"transition-property"),o=i.find(T=>"transform"===T||"all"===T);if(!o)return 0;const d=i.indexOf(o),_=N(r,"transition-duration"),x=N(r,"transition-delay");return Xo(_[d])+Xo(x[d])}(this._preview);return 0===i?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(o=>{const d=x=>{(!x||(0,Zt.sA)(x)===this._preview&&"transform"===x.propertyName)&&(this._preview?.removeEventListener("transitionend",d),o(),clearTimeout(_))},_=setTimeout(d,1.5*i);this._preview.addEventListener("transitionend",d)}))}_createPlaceholderElement(){const r=this._placeholderTemplate,i=r?r.template:null;let o;return i?(this._placeholderRef=r.viewContainer.createEmbeddedView(i,r.context),this._placeholderRef.detectChanges(),o=Pi(this._placeholderRef,this._document)):o=At(this._rootElement),o.style.pointerEvents="none",o.classList.add("cdk-drag-placeholder"),o}_getPointerPositionInElement(r,i){const o=this._rootElement.getBoundingClientRect(),d=r===this._rootElement?null:r,_=d?d.getBoundingClientRect():o,x=He(i)?i.targetTouches[0]:i,T=this._getViewportScrollPosition();return{x:_.left-o.left+(x.pageX-_.left-T.left),y:_.top-o.top+(x.pageY-_.top-T.top)}}_getPointerPositionOnPage(r){const i=this._getViewportScrollPosition(),o=He(r)?r.touches[0]||r.changedTouches[0]||{pageX:0,pageY:0}:r,d=o.pageX-i.left,_=o.pageY-i.top;if(this._ownerSVGElement){const x=this._ownerSVGElement.getScreenCTM();if(x){const T=this._ownerSVGElement.createSVGPoint();return T.x=d,T.y=_,T.matrixTransform(x.inverse())}}return{x:d,y:_}}_getConstrainedPointerPosition(r){const i=this._dropContainer?this._dropContainer.lockAxis:null;let{x:o,y:d}=this.constrainPosition?this.constrainPosition(r,this):r;if("x"===this.lockAxis||"x"===i?d=this._pickupPositionOnPage.y:("y"===this.lockAxis||"y"===i)&&(o=this._pickupPositionOnPage.x),this._boundaryRect){const{x:_,y:x}=this._pickupPositionInElement,T=this._boundaryRect,{width:C,height:D}=this._getPreviewRect(),R=T.top+x,V=T.bottom-(D-x);o=bi(o,T.left+_,T.right-(C-_)),d=bi(d,R,V)}return{x:o,y:d}}_updatePointerDirectionDelta(r){const{x:i,y:o}=r,d=this._pointerDirectionDelta,_=this._pointerPositionAtLastDirectionChange,x=Math.abs(i-_.x),T=Math.abs(o-_.y);return x>this._config.pointerDirectionChangeThreshold&&(d.x=i>_.x?1:-1,_.x=i),T>this._config.pointerDirectionChangeThreshold&&(d.y=o>_.y?1:-1,_.y=o),d}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;const r=this._handles.length>0||!this.isDragging();r!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=r,Ln(this._rootElement,r))}_removeRootElementListeners(r){r.removeEventListener("mousedown",this._pointerDown,Ze),r.removeEventListener("touchstart",this._pointerDown,re),r.removeEventListener("dragstart",this._nativeDragStart,Ze)}_applyRootElementTransform(r,i){const o=ei(r,i),d=this._rootElement.style;null==this._initialTransform&&(this._initialTransform=d.transform&&"none"!=d.transform?d.transform:""),d.transform=gr(o,this._initialTransform)}_applyPreviewTransform(r,i){const o=this._previewTemplate?.template?void 0:this._initialTransform,d=ei(r,i);this._preview.style.transform=gr(d,o)}_getDragDistance(r){const i=this._pickupPositionOnPage;return i?{x:r.x-i.x,y:r.y-i.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:r,y:i}=this._passiveTransform;if(0===r&&0===i||this.isDragging()||!this._boundaryElement)return;const o=this._boundaryElement.getBoundingClientRect(),d=this._rootElement.getBoundingClientRect();if(0===o.width&&0===o.height||0===d.width&&0===d.height)return;const _=o.left-d.left,x=d.right-o.right,T=o.top-d.top,C=d.bottom-o.bottom;o.width>d.width?(_>0&&(r+=_),x>0&&(r-=x)):r=0,o.height>d.height?(T>0&&(i+=T),C>0&&(i-=C)):i=0,(r!==this._passiveTransform.x||i!==this._passiveTransform.y)&&this.setFreeDragPosition({y:i,x:r})}_getDragStartDelay(r){const i=this.dragStartDelay;return"number"==typeof i?i:He(r)?i.touch:i?i.mouse:0}_updateOnScroll(r){const i=this._parentPositions.handleScroll(r);if(i){const o=(0,Zt.sA)(r);this._boundaryRect&&o!==this._boundaryElement&&o.contains(this._boundaryElement)&&ot(this._boundaryRect,i.top,i.left),this._pickupPositionOnPage.x+=i.left,this._pickupPositionOnPage.y+=i.top,this._dropContainer||(this._activeTransform.x-=i.left,this._activeTransform.y-=i.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return void 0===this._cachedShadowRoot&&(this._cachedShadowRoot=(0,Zt.kV)(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(r,i){const o=this._previewContainer||"global";if("parent"===o)return r;if("global"===o){const d=this._document;return i||d.fullscreenElement||d.webkitFullscreenElement||d.mozFullScreenElement||d.msFullscreenElement||d.body}return(0,_i.fI)(o)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=(this._preview||this._rootElement).getBoundingClientRect()),this._previewRect}_getTargetHandle(r){return this._handles.find(i=>r.target&&(r.target===i||i.contains(r.target)))}}function ei(l,r){return`translate3d(${Math.round(l)}px, ${Math.round(r)}px, 0)`}function bi(l,r,i){return Math.max(r,Math.min(i,l))}function He(l){return"t"===l.type[0]}function Pi(l,r){const i=l.rootNodes;if(1===i.length&&i[0].nodeType===r.ELEMENT_NODE)return i[0];const o=r.createElement("div");return i.forEach(d=>o.appendChild(d)),o}function Ii(l,r){l.style.width=`${r.width}px`,l.style.height=`${r.height}px`,l.style.transform=ei(r.left,r.top)}function ws(l,r){return Math.max(0,Math.min(r,l))}const Eo=.05;class Jh{constructor(r,i,o,d,_){this._dragDropRegistry=i,this._ngZone=d,this._viewportRuler=_,this.disabled=!1,this.sortingDisabled=!1,this.autoScrollDisabled=!1,this.autoScrollStep=2,this.enterPredicate=()=>!0,this.sortPredicate=()=>!0,this.beforeStarted=new ni.x,this.entered=new ni.x,this.exited=new ni.x,this.dropped=new ni.x,this.sorted=new ni.x,this._isDragging=!1,this._itemPositions=[],this._previousSwap={drag:null,delta:0,overlaps:!1},this._draggables=[],this._siblings=[],this._orientation="vertical",this._activeSiblings=new Set,this._direction="ltr",this._viewportScrollSubscription=bs.w0.EMPTY,this._verticalScrollDirection=0,this._horizontalScrollDirection=0,this._stopScrollTimers=new ni.x,this._cachedShadowRoot=null,this._startScrollInterval=()=>{this._stopScrolling(),function Wr(l=0,r=Ia.z){return l<0&&(l=0),(0,$r.H)(l,l,r)}(0,fr.Z).pipe((0,On.R)(this._stopScrollTimers)).subscribe(()=>{const x=this._scrollNode,T=this.autoScrollStep;1===this._verticalScrollDirection?x.scrollBy(0,-T):2===this._verticalScrollDirection&&x.scrollBy(0,T),1===this._horizontalScrollDirection?x.scrollBy(-T,0):2===this._horizontalScrollDirection&&x.scrollBy(T,0)})},this.element=(0,_i.fI)(r),this._document=o,this.withScrollableParents([this.element]),i.registerDropContainer(this),this._parentPositions=new kt(o)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(r,i,o,d){let _;this._draggingStarted(),null==d?(_=this.sortingDisabled?this._draggables.indexOf(r):-1,-1===_&&(_=this._getItemIndexFromPointerPosition(r,i,o))):_=d;const x=this._activeDraggables,T=x.indexOf(r),C=r.getPlaceholderElement();let D=x[_];if(D===r&&(D=x[_+1]),!D&&(null==_||-1===_||_<x.length-1)&&this._shouldEnterAsFirstChild(i,o)&&(D=x[0]),T>-1&&x.splice(T,1),D&&!this._dragDropRegistry.isDragging(D)){const R=D.getRootElement();R.parentElement.insertBefore(C,R),x.splice(_,0,r)}else(0,_i.fI)(this.element).appendChild(C),x.push(r);C.style.transform="",this._cacheItemPositions(),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:r,container:this,currentIndex:this.getItemIndex(r)})}exit(r){this._reset(),this.exited.next({item:r,container:this})}drop(r,i,o,d,_,x,T){this._reset(),this.dropped.next({item:r,currentIndex:i,previousIndex:o,container:this,previousContainer:d,isPointerOverContainer:_,distance:x,dropPoint:T})}withItems(r){const i=this._draggables;return this._draggables=r,r.forEach(o=>o._withDropContainer(this)),this.isDragging()&&(i.filter(d=>d.isDragging()).every(d=>-1===r.indexOf(d))?this._reset():this._cacheItems()),this}withDirection(r){return this._direction=r,this}connectedTo(r){return this._siblings=r.slice(),this}withOrientation(r){return this._orientation=r,this}withScrollableParents(r){const i=(0,_i.fI)(this.element);return this._scrollableElements=-1===r.indexOf(i)?[i,...r]:r.slice(),this}getScrollableParents(){return this._scrollableElements}getItemIndex(r){return this._isDragging?("horizontal"===this._orientation&&"rtl"===this._direction?this._itemPositions.slice().reverse():this._itemPositions).findIndex(o=>o.drag===r):this._draggables.indexOf(r)}isReceiving(){return this._activeSiblings.size>0}_sortItem(r,i,o,d){if(this.sortingDisabled||!this._clientRect||!yt(this._clientRect,.05,i,o))return;const _=this._itemPositions,x=this._getItemIndexFromPointerPosition(r,i,o,d);if(-1===x&&_.length>0)return;const T="horizontal"===this._orientation,C=_.findIndex(_t=>_t.drag===r),D=_[x],V=D.clientRect,H=C>x?1:-1,K=this._getItemOffsetPx(_[C].clientRect,V,H),ct=this._getSiblingOffsetPx(C,_,H),gt=_.slice();(function Yo(l,r,i){const o=ws(r,l.length-1),d=ws(i,l.length-1);if(o===d)return;const _=l[o],x=d<o?-1:1;for(let T=o;T!==d;T+=x)l[T]=l[T+x];l[d]=_})(_,C,x),this.sorted.next({previousIndex:C,currentIndex:x,container:this,item:r}),_.forEach((_t,Xt)=>{if(gt[Xt]===_t)return;const $t=_t.drag===r,me=$t?K:ct,ge=$t?r.getPlaceholderElement():_t.drag.getRootElement();_t.offset+=me,T?(ge.style.transform=gr(`translate3d(${Math.round(_t.offset)}px, 0, 0)`,_t.initialTransform),ot(_t.clientRect,0,me)):(ge.style.transform=gr(`translate3d(0, ${Math.round(_t.offset)}px, 0)`,_t.initialTransform),ot(_t.clientRect,me,0))}),this._previousSwap.overlaps=Q(V,i,o),this._previousSwap.drag=D.drag,this._previousSwap.delta=T?d.x:d.y}_startScrollingIfNecessary(r,i){if(this.autoScrollDisabled)return;let o,d=0,_=0;if(this._parentPositions.positions.forEach((x,T)=>{T===this._document||!x.clientRect||o||yt(x.clientRect,.05,r,i)&&([d,_]=function Kh(l,r,i,o){const d=Hs(r,o),_=_r(r,i);let x=0,T=0;if(d){const C=l.scrollTop;1===d?C>0&&(x=1):l.scrollHeight-C>l.clientHeight&&(x=2)}if(_){const C=l.scrollLeft;1===_?C>0&&(T=1):l.scrollWidth-C>l.clientWidth&&(T=2)}return[x,T]}(T,x.clientRect,r,i),(d||_)&&(o=T))}),!d&&!_){const{width:x,height:T}=this._viewportRuler.getViewportSize(),C={width:x,height:T,top:0,right:x,bottom:T,left:0};d=Hs(C,i),_=_r(C,r),o=window}o&&(d!==this._verticalScrollDirection||_!==this._horizontalScrollDirection||o!==this._scrollNode)&&(this._verticalScrollDirection=d,this._horizontalScrollDirection=_,this._scrollNode=o,(d||_)&&o?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){const r=(0,_i.fI)(this.element).style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=r.msScrollSnapType||r.scrollSnapType||"",r.scrollSnapType=r.msScrollSnapType="none",this._cacheItems(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){const r=(0,_i.fI)(this.element);this._parentPositions.cache(this._scrollableElements),this._clientRect=this._parentPositions.positions.get(r).clientRect}_cacheItemPositions(){const r="horizontal"===this._orientation;this._itemPositions=this._activeDraggables.map(i=>{const o=i.getVisibleElement();return{drag:i,offset:0,initialTransform:o.style.transform||"",clientRect:Z(o)}}).sort((i,o)=>r?i.clientRect.left-o.clientRect.left:i.clientRect.top-o.clientRect.top)}_reset(){this._isDragging=!1;const r=(0,_i.fI)(this.element).style;r.scrollSnapType=r.msScrollSnapType=this._initialScrollSnap,this._activeDraggables.forEach(i=>{const o=i.getRootElement();if(o){const d=this._itemPositions.find(_=>_.drag===i)?.initialTransform;o.style.transform=d||""}}),this._siblings.forEach(i=>i._stopReceiving(this)),this._activeDraggables=[],this._itemPositions=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1,this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_getSiblingOffsetPx(r,i,o){const d="horizontal"===this._orientation,_=i[r].clientRect,x=i[r+-1*o];let T=_[d?"width":"height"]*o;if(x){const C=d?"left":"top",D=d?"right":"bottom";-1===o?T-=x.clientRect[C]-_[D]:T+=_[C]-x.clientRect[D]}return T}_getItemOffsetPx(r,i,o){const d="horizontal"===this._orientation;let _=d?i.left-r.left:i.top-r.top;return-1===o&&(_+=d?i.width-r.width:i.height-r.height),_}_shouldEnterAsFirstChild(r,i){if(!this._activeDraggables.length)return!1;const o=this._itemPositions,d="horizontal"===this._orientation;if(o[0].drag!==this._activeDraggables[0]){const x=o[o.length-1].clientRect;return d?r>=x.right:i>=x.bottom}{const x=o[0].clientRect;return d?r<=x.left:i<=x.top}}_getItemIndexFromPointerPosition(r,i,o,d){const _="horizontal"===this._orientation,x=this._itemPositions.findIndex(({drag:T,clientRect:C})=>T!==r&&((!d||T!==this._previousSwap.drag||!this._previousSwap.overlaps||(_?d.x:d.y)!==this._previousSwap.delta)&&(_?i>=Math.floor(C.left)&&i<Math.floor(C.right):o>=Math.floor(C.top)&&o<Math.floor(C.bottom))));return-1!==x&&this.sortPredicate(x,r,this)?x:-1}_cacheItems(){this._activeDraggables=this._draggables.slice(),this._cacheItemPositions(),this._cacheParentPositions()}_isOverContainer(r,i){return null!=this._clientRect&&Q(this._clientRect,r,i)}_getSiblingContainerFromPosition(r,i,o){return this._siblings.find(d=>d._canReceive(r,i,o))}_canReceive(r,i,o){if(!this._clientRect||!Q(this._clientRect,i,o)||!this.enterPredicate(r,this))return!1;const d=this._getShadowRoot().elementFromPoint(i,o);if(!d)return!1;const _=(0,_i.fI)(this.element);return d===_||_.contains(d)}_startReceiving(r,i){const o=this._activeSiblings;!o.has(r)&&i.every(d=>this.enterPredicate(d,this)||this._draggables.indexOf(d)>-1)&&(o.add(r),this._cacheParentPositions(),this._listenToScrollEvents())}_stopReceiving(r){this._activeSiblings.delete(r),this._viewportScrollSubscription.unsubscribe()}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(r=>{if(this.isDragging()){const i=this._parentPositions.handleScroll(r);i&&(this._itemPositions.forEach(({clientRect:o})=>{ot(o,i.top,i.left)}),this._itemPositions.forEach(({drag:o})=>{this._dragDropRegistry.isDragging(o)&&o._sortFromLastPointerPosition()}))}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){const r=(0,Zt.kV)((0,_i.fI)(this.element));this._cachedShadowRoot=r||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){const r=this._activeDraggables.filter(i=>i.isDragging());this._siblings.forEach(i=>i._startReceiving(this,r))}}function Hs(l,r){const{top:i,bottom:o,height:d}=l,_=d*Eo;return r>=i-_&&r<=i+_?1:r>=o-_&&r<=o+_?2:0}function _r(l,r){const{left:i,right:o,width:d}=l,_=d*Eo;return r>=i-_&&r<=i+_?1:r>=o-_&&r<=o+_?2:0}const Ao=(0,Zt.i$)({passive:!1,capture:!0});let xe=(()=>{class l{constructor(i,o){this._ngZone=i,this._dropInstances=new Set,this._dragInstances=new Set,this._activeDragInstances=[],this._globalListeners=new Map,this._draggingPredicate=d=>d.isDragging(),this.pointerMove=new ni.x,this.pointerUp=new ni.x,this.scroll=new ni.x,this._preventDefaultWhileDragging=d=>{this._activeDragInstances.length>0&&d.preventDefault()},this._persistentTouchmoveListener=d=>{this._activeDragInstances.length>0&&(this._activeDragInstances.some(this._draggingPredicate)&&d.preventDefault(),this.pointerMove.next(d))},this._document=o}registerDropContainer(i){this._dropInstances.has(i)||this._dropInstances.add(i)}registerDragItem(i){this._dragInstances.add(i),1===this._dragInstances.size&&this._ngZone.runOutsideAngular(()=>{this._document.addEventListener("touchmove",this._persistentTouchmoveListener,Ao)})}removeDropContainer(i){this._dropInstances.delete(i)}removeDragItem(i){this._dragInstances.delete(i),this.stopDragging(i),0===this._dragInstances.size&&this._document.removeEventListener("touchmove",this._persistentTouchmoveListener,Ao)}startDragging(i,o){if(!(this._activeDragInstances.indexOf(i)>-1)&&(this._activeDragInstances.push(i),1===this._activeDragInstances.length)){const d=o.type.startsWith("touch");this._globalListeners.set(d?"touchend":"mouseup",{handler:_=>this.pointerUp.next(_),options:!0}).set("scroll",{handler:_=>this.scroll.next(_),options:!0}).set("selectstart",{handler:this._preventDefaultWhileDragging,options:Ao}),d||this._globalListeners.set("mousemove",{handler:_=>this.pointerMove.next(_),options:Ao}),this._ngZone.runOutsideAngular(()=>{this._globalListeners.forEach((_,x)=>{this._document.addEventListener(x,_.handler,_.options)})})}}stopDragging(i){const o=this._activeDragInstances.indexOf(i);o>-1&&(this._activeDragInstances.splice(o,1),0===this._activeDragInstances.length&&this._clearGlobalListeners())}isDragging(i){return this._activeDragInstances.indexOf(i)>-1}scrolled(i){const o=[this.scroll];return i&&i!==this._document&&o.push(new Xr.y(d=>this._ngZone.runOutsideAngular(()=>{const x=T=>{this._activeDragInstances.length&&d.next(T)};return i.addEventListener("scroll",x,!0),()=>{i.removeEventListener("scroll",x,!0)}}))),(0,To.T)(...o)}ngOnDestroy(){this._dragInstances.forEach(i=>this.removeDragItem(i)),this._dropInstances.forEach(i=>this.removeDropContainer(i)),this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_clearGlobalListeners(){this._globalListeners.forEach((i,o)=>{this._document.removeEventListener(o,i.handler,i.options)}),this._globalListeners.clear()}}return l.\u0275fac=function(i){return new(i||l)(p.LFG(p.R0b),p.LFG(c.K0))},l.\u0275prov=p.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})();const hi={dragStartThreshold:5,pointerDirectionChangeThreshold:5};let si=(()=>{class l{constructor(i,o,d,_){this._document=i,this._ngZone=o,this._viewportRuler=d,this._dragDropRegistry=_}createDrag(i,o=hi){return new We(i,o,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry)}createDropList(i){return new Jh(i,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}}return l.\u0275fac=function(i){return new(i||l)(p.LFG(c.K0),p.LFG(p.R0b),p.LFG(Ct.rL),p.LFG(xe))},l.\u0275prov=p.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})();const $s=new p.OlP("CDK_DRAG_PARENT"),Ko=new p.OlP("CdkDropListGroup"),Yr=new p.OlP("CDK_DRAG_CONFIG");let Jr=0;const qn=new p.OlP("CdkDropList");let Ui=(()=>{class l{constructor(i,o,d,_,x,T,C){this.element=i,this._changeDetectorRef=d,this._scrollDispatcher=_,this._dir=x,this._group=T,this._destroyed=new ni.x,this.connectedTo=[],this.id="cdk-drop-list-"+Jr++,this.enterPredicate=()=>!0,this.sortPredicate=()=>!0,this.dropped=new p.vpe,this.entered=new p.vpe,this.exited=new p.vpe,this.sorted=new p.vpe,this._unsortedItems=new Set,this._dropListRef=o.createDropList(i),this._dropListRef.data=this,C&&this._assignDefaults(C),this._dropListRef.enterPredicate=(D,R)=>this.enterPredicate(D.data,R.data),this._dropListRef.sortPredicate=(D,R,V)=>this.sortPredicate(D,R.data,V.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),l._dropLists.push(this),T&&T._items.add(this)}get disabled(){return this._disabled||!!this._group&&this._group.disabled}set disabled(i){this._dropListRef.disabled=this._disabled=(0,_i.Ig)(i)}addItem(i){this._unsortedItems.add(i),this._dropListRef.isDragging()&&this._syncItemsWithRef()}removeItem(i){this._unsortedItems.delete(i),this._dropListRef.isDragging()&&this._syncItemsWithRef()}getSortedItems(){return Array.from(this._unsortedItems).sort((i,o)=>i._dragRef.getVisibleElement().compareDocumentPosition(o._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)}ngOnDestroy(){const i=l._dropLists.indexOf(this);i>-1&&l._dropLists.splice(i,1),this._group&&this._group._items.delete(this),this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete()}_setupInputSyncSubscription(i){this._dir&&this._dir.change.pipe((0,Is.O)(this._dir.value),(0,On.R)(this._destroyed)).subscribe(o=>i.withDirection(o)),i.beforeStarted.subscribe(()=>{const o=(0,_i.Eq)(this.connectedTo).map(d=>"string"==typeof d?l._dropLists.find(x=>x.id===d):d);if(this._group&&this._group._items.forEach(d=>{-1===o.indexOf(d)&&o.push(d)}),!this._scrollableParentsResolved){const d=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(_=>_.getElementRef().nativeElement);this._dropListRef.withScrollableParents(d),this._scrollableParentsResolved=!0}i.disabled=this.disabled,i.lockAxis=this.lockAxis,i.sortingDisabled=(0,_i.Ig)(this.sortingDisabled),i.autoScrollDisabled=(0,_i.Ig)(this.autoScrollDisabled),i.autoScrollStep=(0,_i.su)(this.autoScrollStep,2),i.connectedTo(o.filter(d=>d&&d!==this).map(d=>d._dropListRef)).withOrientation(this.orientation)})}_handleEvents(i){i.beforeStarted.subscribe(()=>{this._syncItemsWithRef(),this._changeDetectorRef.markForCheck()}),i.entered.subscribe(o=>{this.entered.emit({container:this,item:o.item.data,currentIndex:o.currentIndex})}),i.exited.subscribe(o=>{this.exited.emit({container:this,item:o.item.data}),this._changeDetectorRef.markForCheck()}),i.sorted.subscribe(o=>{this.sorted.emit({previousIndex:o.previousIndex,currentIndex:o.currentIndex,container:this,item:o.item.data})}),i.dropped.subscribe(o=>{this.dropped.emit({previousIndex:o.previousIndex,currentIndex:o.currentIndex,previousContainer:o.previousContainer.data,container:o.container.data,item:o.item.data,isPointerOverContainer:o.isPointerOverContainer,distance:o.distance,dropPoint:o.dropPoint}),this._changeDetectorRef.markForCheck()})}_assignDefaults(i){const{lockAxis:o,draggingDisabled:d,sortingDisabled:_,listAutoScrollDisabled:x,listOrientation:T}=i;this.disabled=d??!1,this.sortingDisabled=_??!1,this.autoScrollDisabled=x??!1,this.orientation=T||"vertical",o&&(this.lockAxis=o)}_syncItemsWithRef(){this._dropListRef.withItems(this.getSortedItems().map(i=>i._dragRef))}}return l._dropLists=[],l.\u0275fac=function(i){return new(i||l)(p.Y36(p.SBq),p.Y36(si),p.Y36(p.sBO),p.Y36(Ct.mF),p.Y36(mr.Is,8),p.Y36(Ko,12),p.Y36(Yr,8))},l.\u0275dir=p.lG2({type:l,selectors:[["","cdkDropList",""],["cdk-drop-list"]],hostAttrs:[1,"cdk-drop-list"],hostVars:7,hostBindings:function(i,o){2&i&&(p.uIk("id",o.id),p.ekj("cdk-drop-list-disabled",o.disabled)("cdk-drop-list-dragging",o._dropListRef.isDragging())("cdk-drop-list-receiving",o._dropListRef.isReceiving()))},inputs:{connectedTo:["cdkDropListConnectedTo","connectedTo"],data:["cdkDropListData","data"],orientation:["cdkDropListOrientation","orientation"],id:"id",lockAxis:["cdkDropListLockAxis","lockAxis"],disabled:["cdkDropListDisabled","disabled"],sortingDisabled:["cdkDropListSortingDisabled","sortingDisabled"],enterPredicate:["cdkDropListEnterPredicate","enterPredicate"],sortPredicate:["cdkDropListSortPredicate","sortPredicate"],autoScrollDisabled:["cdkDropListAutoScrollDisabled","autoScrollDisabled"],autoScrollStep:["cdkDropListAutoScrollStep","autoScrollStep"]},outputs:{dropped:"cdkDropListDropped",entered:"cdkDropListEntered",exited:"cdkDropListExited",sorted:"cdkDropListSorted"},exportAs:["cdkDropList"],features:[p._Bn([{provide:Ko,useValue:void 0},{provide:qn,useExisting:l}])]}),l})();const Tc=new p.OlP("CdkDragHandle"),Sc=new p.OlP("CdkDragPlaceholder"),Cc=new p.OlP("CdkDragPreview");let yr=(()=>{class l{constructor(i,o,d,_,x,T,C,D,R,V,H){this.element=i,this.dropContainer=o,this._ngZone=_,this._viewContainerRef=x,this._dir=C,this._changeDetectorRef=R,this._selfHandle=V,this._parentDrag=H,this._destroyed=new ni.x,this.started=new p.vpe,this.released=new p.vpe,this.ended=new p.vpe,this.entered=new p.vpe,this.exited=new p.vpe,this.dropped=new p.vpe,this.moved=new Xr.y(K=>{const ct=this._dragRef.moved.pipe((0,qs.U)(gt=>({source:this,pointerPosition:gt.pointerPosition,event:gt.event,delta:gt.delta,distance:gt.distance}))).subscribe(K);return()=>{ct.unsubscribe()}}),this._dragRef=D.createDrag(i,{dragStartThreshold:T&&null!=T.dragStartThreshold?T.dragStartThreshold:5,pointerDirectionChangeThreshold:T&&null!=T.pointerDirectionChangeThreshold?T.pointerDirectionChangeThreshold:5,zIndex:T?.zIndex}),this._dragRef.data=this,l._dragInstances.push(this),T&&this._assignDefaults(T),o&&(this._dragRef._withDropContainer(o._dropListRef),o.addItem(this)),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}get disabled(){return this._disabled||this.dropContainer&&this.dropContainer.disabled}set disabled(i){this._disabled=(0,_i.Ig)(i),this._dragRef.disabled=this._disabled}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe((0,So.q)(1),(0,On.R)(this._destroyed)).subscribe(()=>{this._updateRootElement(),this._setupHandlesListener(),this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)})})}ngOnChanges(i){const o=i.rootElementSelector,d=i.freeDragPosition;o&&!o.firstChange&&this._updateRootElement(),d&&!d.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this);const i=l._dragInstances.indexOf(this);i>-1&&l._dragInstances.splice(i,1),this._ngZone.runOutsideAngular(()=>{this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_updateRootElement(){const i=this.element.nativeElement;let o=i;this.rootElementSelector&&(o=void 0!==i.closest?i.closest(this.rootElementSelector):i.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(o||i)}_getBoundaryElement(){const i=this.boundaryElement;return i?"string"==typeof i?this.element.nativeElement.closest(i):(0,_i.fI)(i):null}_syncInputs(i){i.beforeStarted.subscribe(()=>{if(!i.isDragging()){const o=this._dir,d=this.dragStartDelay,_=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,x=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;i.disabled=this.disabled,i.lockAxis=this.lockAxis,i.dragStartDelay="object"==typeof d&&d?d:(0,_i.su)(d),i.constrainPosition=this.constrainPosition,i.previewClass=this.previewClass,i.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(_).withPreviewTemplate(x).withPreviewContainer(this.previewContainer||"global"),o&&i.withDirection(o.value)}}),i.beforeStarted.pipe((0,So.q)(1)).subscribe(()=>{if(this._parentDrag)return void i.withParent(this._parentDrag._dragRef);let o=this.element.nativeElement.parentElement;for(;o;){if(o.classList.contains("cdk-drag")){i.withParent(l._dragInstances.find(d=>d.element.nativeElement===o)?._dragRef||null);break}o=o.parentElement}})}_handleEvents(i){i.started.subscribe(()=>{this.started.emit({source:this}),this._changeDetectorRef.markForCheck()}),i.released.subscribe(()=>{this.released.emit({source:this})}),i.ended.subscribe(o=>{this.ended.emit({source:this,distance:o.distance,dropPoint:o.dropPoint}),this._changeDetectorRef.markForCheck()}),i.entered.subscribe(o=>{this.entered.emit({container:o.container.data,item:this,currentIndex:o.currentIndex})}),i.exited.subscribe(o=>{this.exited.emit({container:o.container.data,item:this})}),i.dropped.subscribe(o=>{this.dropped.emit({previousIndex:o.previousIndex,currentIndex:o.currentIndex,previousContainer:o.previousContainer.data,container:o.container.data,isPointerOverContainer:o.isPointerOverContainer,item:this,distance:o.distance,dropPoint:o.dropPoint})})}_assignDefaults(i){const{lockAxis:o,dragStartDelay:d,constrainPosition:_,previewClass:x,boundaryElement:T,draggingDisabled:C,rootElementSelector:D,previewContainer:R}=i;this.disabled=C??!1,this.dragStartDelay=d||0,o&&(this.lockAxis=o),_&&(this.constrainPosition=_),x&&(this.previewClass=x),T&&(this.boundaryElement=T),D&&(this.rootElementSelector=D),R&&(this.previewContainer=R)}_setupHandlesListener(){this._handles.changes.pipe((0,Is.O)(this._handles),(0,Sl.b)(i=>{const o=i.filter(d=>d._parentDrag===this).map(d=>d.element);this._selfHandle&&this.rootElementSelector&&o.push(this.element),this._dragRef.withHandles(o)}),(0,Cl.w)(i=>(0,To.T)(...i.map(o=>o._stateChanges.pipe((0,Is.O)(o))))),(0,On.R)(this._destroyed)).subscribe(i=>{const o=this._dragRef,d=i.element.nativeElement;i.disabled?o.disableHandle(d):o.enableHandle(d)})}}return l._dragInstances=[],l.\u0275fac=function(i){return new(i||l)(p.Y36(p.SBq),p.Y36(qn,12),p.Y36(c.K0),p.Y36(p.R0b),p.Y36(p.s_b),p.Y36(Yr,8),p.Y36(mr.Is,8),p.Y36(si),p.Y36(p.sBO),p.Y36(Tc,10),p.Y36($s,12))},l.\u0275dir=p.lG2({type:l,selectors:[["","cdkDrag",""]],contentQueries:function(i,o,d){if(1&i&&(p.Suo(d,Cc,5),p.Suo(d,Sc,5),p.Suo(d,Tc,5)),2&i){let _;p.iGM(_=p.CRH())&&(o._previewTemplate=_.first),p.iGM(_=p.CRH())&&(o._placeholderTemplate=_.first),p.iGM(_=p.CRH())&&(o._handles=_)}},hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(i,o){2&i&&p.ekj("cdk-drag-disabled",o.disabled)("cdk-drag-dragging",o._dragRef.isDragging())},inputs:{data:["cdkDragData","data"],lockAxis:["cdkDragLockAxis","lockAxis"],rootElementSelector:["cdkDragRootElement","rootElementSelector"],boundaryElement:["cdkDragBoundary","boundaryElement"],dragStartDelay:["cdkDragStartDelay","dragStartDelay"],freeDragPosition:["cdkDragFreeDragPosition","freeDragPosition"],disabled:["cdkDragDisabled","disabled"],constrainPosition:["cdkDragConstrainPosition","constrainPosition"],previewClass:["cdkDragPreviewClass","previewClass"],previewContainer:["cdkDragPreviewContainer","previewContainer"]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[p._Bn([{provide:$s,useExisting:l}]),p.TTD]}),l})(),Qr=(()=>{class l{}return l.\u0275fac=function(i){return new(i||l)},l.\u0275mod=p.oAB({type:l}),l.\u0275inj=p.cJS({providers:[si],imports:[Ct.ZD]}),l})();var ls=bt(9898),cs=bt(8545),pn=bt(2510);const ta=new p.OlP("CdkAccordion");let Jn=0,Qh=(()=>{class l{constructor(i,o,d){this.accordion=i,this._changeDetectorRef=o,this._expansionDispatcher=d,this._openCloseAllSubscription=bs.w0.EMPTY,this.closed=new p.vpe,this.opened=new p.vpe,this.destroyed=new p.vpe,this.expandedChange=new p.vpe,this.id="cdk-accordion-child-"+Jn++,this._expanded=!1,this._disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=d.listen((_,x)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===x&&this.id!==_&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}get expanded(){return this._expanded}set expanded(i){i=(0,_i.Ig)(i),this._expanded!==i&&(this._expanded=i,this.expandedChange.emit(i),i?(this.opened.emit(),this._expansionDispatcher.notify(this.id,this.accordion?this.accordion.id:this.id)):this.closed.emit(),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(i){this._disabled=(0,_i.Ig)(i)}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(i=>{this.disabled||(this.expanded=i)})}}return l.\u0275fac=function(i){return new(i||l)(p.Y36(ta,12),p.Y36(p.sBO),p.Y36(Pn.A8))},l.\u0275dir=p.lG2({type:l,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:"expanded",disabled:"disabled"},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],features:[p._Bn([{provide:ta,useValue:void 0}])]}),l})(),Ml=(()=>{class l{}return l.\u0275fac=function(i){return new(i||l)},l.\u0275mod=p.oAB({type:l}),l.\u0275inj=p.cJS({}),l})();var _n=bt(4080),za=bt(1884),ea=bt(9300),Oa=bt(515);const Fn=["body"];function El(l,r){}const ia=[[["mat-expansion-panel-header"]],"*",[["mat-action-row"]]],ko=["mat-expansion-panel-header","*","mat-action-row"];function Ba(l,r){if(1&l&&p._UZ(0,"span",2),2&l){const i=p.oxw();p.Q6J("@indicatorRotate",i._getExpandedState())}}const Al=[[["mat-panel-title"]],[["mat-panel-description"]],"*"],fd=["mat-panel-title","mat-panel-description","*"],kl=new p.OlP("MAT_ACCORDION"),xr="225ms cubic-bezier(0.4,0.0,0.2,1)",Ac={indicatorRotate:(0,mt.X$)("indicatorRotate",[(0,mt.SB)("collapsed, void",(0,mt.oB)({transform:"rotate(0deg)"})),(0,mt.SB)("expanded",(0,mt.oB)({transform:"rotate(180deg)"})),(0,mt.eR)("expanded <=> collapsed, void => collapsed",(0,mt.jt)(xr))]),bodyExpansion:(0,mt.X$)("bodyExpansion",[(0,mt.SB)("collapsed, void",(0,mt.oB)({height:"0px",visibility:"hidden"})),(0,mt.SB)("expanded",(0,mt.oB)({height:"*",visibility:"visible"})),(0,mt.eR)("expanded <=> collapsed, void => collapsed",(0,mt.jt)(xr))])};let Fa=(()=>{class l{constructor(i){this._template=i}}return l.\u0275fac=function(i){return new(i||l)(p.Y36(p.Rgc))},l.\u0275dir=p.lG2({type:l,selectors:[["ng-template","matExpansionPanelContent",""]]}),l})(),na=0;const Do=new p.OlP("MAT_EXPANSION_PANEL_DEFAULT_OPTIONS");let sa=(()=>{class l extends Qh{constructor(i,o,d,_,x,T,C){super(i,o,d),this._viewContainerRef=_,this._animationMode=T,this._hideToggle=!1,this.afterExpand=new p.vpe,this.afterCollapse=new p.vpe,this._inputChanges=new ni.x,this._headerId="mat-expansion-panel-header-"+na++,this._bodyAnimationDone=new ni.x,this.accordion=i,this._document=x,this._bodyAnimationDone.pipe((0,za.x)((D,R)=>D.fromState===R.fromState&&D.toState===R.toState)).subscribe(D=>{"void"!==D.fromState&&("expanded"===D.toState?this.afterExpand.emit():"collapsed"===D.toState&&this.afterCollapse.emit())}),C&&(this.hideToggle=C.hideToggle)}get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(i){this._hideToggle=(0,_i.Ig)(i)}get togglePosition(){return this._togglePosition||this.accordion&&this.accordion.togglePosition}set togglePosition(i){this._togglePosition=i}_hasSpacing(){return!!this.accordion&&this.expanded&&"default"===this.accordion.displayMode}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this.opened.pipe((0,Is.O)(null),(0,ea.h)(()=>this.expanded&&!this._portal),(0,So.q)(1)).subscribe(()=>{this._portal=new _n.UE(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(i){this._inputChanges.next(i)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){const i=this._document.activeElement,o=this._body.nativeElement;return i===o||o.contains(i)}return!1}}return l.\u0275fac=function(i){return new(i||l)(p.Y36(kl,12),p.Y36(p.sBO),p.Y36(Pn.A8),p.Y36(p.s_b),p.Y36(c.K0),p.Y36(p.QbO,8),p.Y36(Do,8))},l.\u0275cmp=p.Xpm({type:l,selectors:[["mat-expansion-panel"]],contentQueries:function(i,o,d){if(1&i&&p.Suo(d,Fa,5),2&i){let _;p.iGM(_=p.CRH())&&(o._lazyContent=_.first)}},viewQuery:function(i,o){if(1&i&&p.Gf(Fn,5),2&i){let d;p.iGM(d=p.CRH())&&(o._body=d.first)}},hostAttrs:[1,"mat-expansion-panel"],hostVars:6,hostBindings:function(i,o){2&i&&p.ekj("mat-expanded",o.expanded)("_mat-animation-noopable","NoopAnimations"===o._animationMode)("mat-expansion-panel-spacing",o._hasSpacing())},inputs:{disabled:"disabled",expanded:"expanded",hideToggle:"hideToggle",togglePosition:"togglePosition"},outputs:{opened:"opened",closed:"closed",expandedChange:"expandedChange",afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["matExpansionPanel"],features:[p._Bn([{provide:kl,useValue:void 0}]),p.qOj,p.TTD],ngContentSelectors:ko,decls:7,vars:4,consts:[["role","region",1,"mat-expansion-panel-content",3,"id"],["body",""],[1,"mat-expansion-panel-body"],[3,"cdkPortalOutlet"]],template:function(i,o){1&i&&(p.F$t(ia),p.Hsn(0),p.TgZ(1,"div",0,1),p.NdJ("@bodyExpansion.done",function(_){return o._bodyAnimationDone.next(_)}),p.TgZ(3,"div",2),p.Hsn(4,1),p.YNc(5,El,0,0,"ng-template",3),p.qZA(),p.Hsn(6,2),p.qZA()),2&i&&(p.xp6(1),p.Q6J("@bodyExpansion",o._getExpandedState())("id",o.id),p.uIk("aria-labelledby",o._headerId),p.xp6(4),p.Q6J("cdkPortalOutlet",o._portal))},dependencies:[_n.Pl],styles:[".mat-expansion-panel{box-sizing:content-box;display:block;margin:0;border-radius:4px;overflow:hidden;transition:margin 225ms cubic-bezier(0.4, 0, 0.2, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);position:relative}.mat-accordion .mat-expansion-panel:not(.mat-expanded),.mat-accordion .mat-expansion-panel:not(.mat-expansion-panel-spacing){border-radius:0}.mat-accordion .mat-expansion-panel:first-of-type{border-top-right-radius:4px;border-top-left-radius:4px}.mat-accordion .mat-expansion-panel:last-of-type{border-bottom-right-radius:4px;border-bottom-left-radius:4px}.cdk-high-contrast-active .mat-expansion-panel{outline:solid 1px}.mat-expansion-panel.ng-animate-disabled,.ng-animate-disabled .mat-expansion-panel,.mat-expansion-panel._mat-animation-noopable{transition:none}.mat-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.mat-expansion-panel-body{padding:0 24px 16px}.mat-expansion-panel-spacing{margin:16px 0}.mat-accordion>.mat-expansion-panel-spacing:first-child,.mat-accordion>*:first-child:not(.mat-expansion-panel) .mat-expansion-panel-spacing{margin-top:0}.mat-accordion>.mat-expansion-panel-spacing:last-child,.mat-accordion>*:last-child:not(.mat-expansion-panel) .mat-expansion-panel-spacing{margin-bottom:0}.mat-action-row{border-top-style:solid;border-top-width:1px;display:flex;flex-direction:row;justify-content:flex-end;padding:16px 8px 16px 24px}.mat-action-row button.mat-button-base,.mat-action-row button.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-action-row button.mat-button-base,[dir=rtl] .mat-action-row button.mat-mdc-button-base{margin-left:0;margin-right:8px}\n"],encapsulation:2,data:{animation:[Ac.bodyExpansion]},changeDetection:0}),l})();class Ls{}const Ua=(0,Tt.sb)(Ls);let kc=(()=>{class l extends Ua{constructor(i,o,d,_,x,T,C){super(),this.panel=i,this._element=o,this._focusMonitor=d,this._changeDetectorRef=_,this._animationMode=T,this._parentChangeSubscription=bs.w0.EMPTY;const D=i.accordion?i.accordion._stateChanges.pipe((0,ea.h)(R=>!(!R.hideToggle&&!R.togglePosition))):Oa.E;this.tabIndex=parseInt(C||"")||0,this._parentChangeSubscription=(0,To.T)(i.opened,i.closed,D,i._inputChanges.pipe((0,ea.h)(R=>!!(R.hideToggle||R.disabled||R.togglePosition)))).subscribe(()=>this._changeDetectorRef.markForCheck()),i.closed.pipe((0,ea.h)(()=>i._containsFocus())).subscribe(()=>d.focusVia(o,"program")),x&&(this.expandedHeight=x.expandedHeight,this.collapsedHeight=x.collapsedHeight)}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_getTogglePosition(){return this.panel.togglePosition}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_getHeaderHeight(){const i=this._isExpanded();return i&&this.expandedHeight?this.expandedHeight:!i&&this.collapsedHeight?this.collapsedHeight:null}_keydown(i){switch(i.keyCode){case In.L_:case In.K5:(0,In.Vb)(i)||(i.preventDefault(),this._toggle());break;default:return void(this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(i))}}focus(i,o){i?this._focusMonitor.focusVia(this._element,i,o):this._element.nativeElement.focus(o)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(i=>{i&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}}return l.\u0275fac=function(i){return new(i||l)(p.Y36(sa,1),p.Y36(p.SBq),p.Y36(Bn.tE),p.Y36(p.sBO),p.Y36(Do,8),p.Y36(p.QbO,8),p.$8M("tabindex"))},l.\u0275cmp=p.Xpm({type:l,selectors:[["mat-expansion-panel-header"]],hostAttrs:["role","button",1,"mat-expansion-panel-header","mat-focus-indicator"],hostVars:15,hostBindings:function(i,o){1&i&&p.NdJ("click",function(){return o._toggle()})("keydown",function(_){return o._keydown(_)}),2&i&&(p.uIk("id",o.panel._headerId)("tabindex",o.tabIndex)("aria-controls",o._getPanelId())("aria-expanded",o._isExpanded())("aria-disabled",o.panel.disabled),p.Udp("height",o._getHeaderHeight()),p.ekj("mat-expanded",o._isExpanded())("mat-expansion-toggle-indicator-after","after"===o._getTogglePosition())("mat-expansion-toggle-indicator-before","before"===o._getTogglePosition())("_mat-animation-noopable","NoopAnimations"===o._animationMode))},inputs:{tabIndex:"tabIndex",expandedHeight:"expandedHeight",collapsedHeight:"collapsedHeight"},features:[p.qOj],ngContentSelectors:fd,decls:5,vars:1,consts:[[1,"mat-content"],["class","mat-expansion-indicator",4,"ngIf"],[1,"mat-expansion-indicator"]],template:function(i,o){1&i&&(p.F$t(Al),p.TgZ(0,"span",0),p.Hsn(1),p.Hsn(2,1),p.Hsn(3,2),p.qZA(),p.YNc(4,Ba,1,1,"span",1)),2&i&&(p.xp6(4),p.Q6J("ngIf",o._showToggle()))},dependencies:[c.O5],styles:['.mat-expansion-panel-header{display:flex;flex-direction:row;align-items:center;padding:0 24px;border-radius:inherit;transition:height 225ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-expansion-panel-header._mat-animation-noopable{transition:none}.mat-expansion-panel-header:focus,.mat-expansion-panel-header:hover{outline:none}.mat-expansion-panel-header.mat-expanded:focus,.mat-expansion-panel-header.mat-expanded:hover{background:inherit}.mat-expansion-panel-header:not([aria-disabled=true]){cursor:pointer}.mat-expansion-panel-header.mat-expansion-toggle-indicator-before{flex-direction:row-reverse}.mat-expansion-panel-header.mat-expansion-toggle-indicator-before .mat-expansion-indicator{margin:0 16px 0 0}[dir=rtl] .mat-expansion-panel-header.mat-expansion-toggle-indicator-before .mat-expansion-indicator{margin:0 0 0 16px}.mat-content{display:flex;flex:1;flex-direction:row;overflow:hidden}.mat-expansion-panel-header-title,.mat-expansion-panel-header-description{display:flex;flex-grow:1;margin-right:16px}[dir=rtl] .mat-expansion-panel-header-title,[dir=rtl] .mat-expansion-panel-header-description{margin-right:0;margin-left:16px}.mat-expansion-panel-header-description{flex-grow:2}.mat-expansion-indicator::after{border-style:solid;border-width:0 2px 2px 0;content:"";display:inline-block;padding:3px;transform:rotate(45deg);vertical-align:middle}.cdk-high-contrast-active .mat-expansion-panel .mat-expansion-panel-header.cdk-keyboard-focused:not([aria-disabled=true])::before,.cdk-high-contrast-active .mat-expansion-panel .mat-expansion-panel-header.cdk-program-focused:not([aria-disabled=true])::before,.cdk-high-contrast-active .mat-expansion-panel:not(.mat-expanded) .mat-expansion-panel-header:hover:not([aria-disabled=true])::before{top:0;left:0;right:0;bottom:0;position:absolute;box-sizing:border-box;pointer-events:none;border:3px solid;border-radius:4px;content:""}.cdk-high-contrast-active .mat-expansion-panel-content{border-top:1px solid;border-top-left-radius:0;border-top-right-radius:0}\n'],encapsulation:2,data:{animation:[Ac.indicatorRotate]},changeDetection:0}),l})(),Na=(()=>{class l{}return l.\u0275fac=function(i){return new(i||l)},l.\u0275dir=p.lG2({type:l,selectors:[["mat-panel-title"]],hostAttrs:[1,"mat-expansion-panel-header-title"]}),l})(),Dl=(()=>{class l{}return l.\u0275fac=function(i){return new(i||l)},l.\u0275mod=p.oAB({type:l}),l.\u0275inj=p.cJS({imports:[[c.ez,Tt.BQ,Ml,_n.eL]]}),l})();var Po=bt(5938),Rn=bt(9549),br=bt(4144);function Pl(l,r){1&l&&(p.TgZ(0,"mat-error"),p._uU(1,"Name is required"),p.qZA())}let oa=(()=>{class l{constructor(i){this.dialogRef=i}ngOnInit(){this.savelocation=new Me.cw({name:new Me.NI("",Me.kI.required),description:new Me.NI("")})}onCancel(){this.dialogRef.close()}submitSaveLocationForm(){this.dialogRef.close(this.savelocation.getRawValue())}}return l.\u0275fac=function(i){return new(i||l)(p.Y36(Po.so))},l.\u0275cmp=p.Xpm({type:l,selectors:[["app-save-location"]],standalone:!0,features:[p.jDz],decls:17,vars:6,consts:[[1,"text-3xl","font-medium",2,"color","#335579"],[1,"flex","flex-col","mt-3",3,"formGroup","submit"],["appearance","outline"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["matInput","","formControlName","description"],[1,"flex","justify-end","space-x-2"],["mat-button","","type","button",1,"bg-gray-300","text-gray-800","py-2","px-4","rounded",3,"click"],["mat-raised-button","","color","primary","type","submit","mat-raised-button","",1,"text-white","py-2","px-4","rounded",2,"background","#335579","color","#fff",3,"disabled"]],template:function(i,o){1&i&&(p.TgZ(0,"span",0),p._uU(1,"Save location"),p.qZA(),p.TgZ(2,"form",1),p.NdJ("submit",function(){return o.submitSaveLocationForm()}),p.TgZ(3,"mat-form-field",2)(4,"mat-label"),p._uU(5,"Name"),p.qZA(),p._UZ(6,"input",3),p.YNc(7,Pl,2,0,"mat-error",4),p.qZA(),p.TgZ(8,"mat-form-field",2)(9,"mat-label"),p._uU(10,"Description"),p.qZA(),p._UZ(11,"textarea",5),p.qZA(),p.TgZ(12,"div",6)(13,"button",7),p.NdJ("click",function(){return o.onCancel()}),p._uU(14," Cancel "),p.qZA(),p.TgZ(15,"button",8),p._uU(16," Save "),p.qZA()()()),2&i&&(p.xp6(2),p.Q6J("formGroup",o.savelocation),p.xp6(5),p.Q6J("ngIf",null==o.savelocation.get("name").errors?null:o.savelocation.get("name").errors.required),p.xp6(8),p.Akn(o.savelocation.valid?"background-color:#335579;color:white;":"background-color:rgba(224,224,224,1);"),p.Q6J("disabled",o.savelocation.invalid)("disabled",!o.savelocation.valid))},dependencies:[c.ez,c.O5,Me.u5,Me._Y,Me.Fj,Me.JJ,Me.JL,Me.Q7,Me.UX,Me.sg,Me.u,br.c,Rn.TO,Rn.KE,Rn.hX,br.Nt,vn.ot,vn.lW,Rn.lN]}),l})();var Qo=bt(1572),Cs=bt(7009);let Si=(()=>{class l{constructor(){this.score=0,this.animate=!1}get size(){return 5*this.score+50}}return l.\u0275fac=function(i){return new(i||l)},l.\u0275cmp=p.Xpm({type:l,selectors:[["app-circular-score"]],inputs:{score:"score",animate:"animate"},standalone:!0,features:[p.jDz],decls:29,vars:20,consts:[[1,"w-full","flex","justify-center","items-center","flex-col"],[1,"rounded-full","bg-gradient-to-r","from-blue-400","to-blue-500","flex","items-center","justify-center","text-white","font-bold","text-xl","transition-all","duration-500"],[1,"relative","mt-2","w-full"],[1,"overflow-hidden","h-2","mb-4","text-xs","flex","rounded","bg-gray-200"],[1,"bg-gradient-to-r","from-teal-400","to-blue-500","transition-all","duration-500"],[1,"shadow-none","flex","flex-col","text-center","whitespace-nowrap","text-white","justify-center"],[1,"flex","justify-between","text-xs","text-gray-500"],[1,"relative"],[1,"absolute","top-0","left-1/2","transform","-translate-x-1/2","-translate-y-full",2,"width","0","height","0","border-left","5px solid transparent","border-right","5px solid transparent","border-bottom","5px solid currentColor"]],template:function(i,o){1&i&&(p.TgZ(0,"div",0)(1,"div",1),p._uU(2),p.ALo(3,"number"),p.qZA(),p.TgZ(4,"div",2)(5,"div",3)(6,"div",4),p._UZ(7,"div",5),p.qZA()(),p.TgZ(8,"div",6)(9,"span",7)(10,"span"),p._uU(11,"Low"),p.qZA(),p._UZ(12,"span",8),p.qZA(),p.TgZ(13,"span",7)(14,"span"),p._uU(15,"Below average"),p.qZA(),p._UZ(16,"span",8),p.qZA(),p.TgZ(17,"span",7)(18,"span"),p._uU(19,"Average"),p.qZA(),p._UZ(20,"span",8),p.qZA(),p.TgZ(21,"span",7)(22,"span"),p._uU(23,"Above average"),p.qZA(),p._UZ(24,"span",8),p.qZA(),p.TgZ(25,"span",7)(26,"span"),p._uU(27,"High"),p.qZA(),p._UZ(28,"span",8),p.qZA()()()()),2&i&&(p.xp6(1),p.Udp("width",o.animate?o.size:50,"px")("height",o.animate?o.size:50,"px"),p.xp6(1),p.hij(" ",p.xi3(3,17,o.score,"1.2-2")," "),p.xp6(4),p.Udp("width",o.animate?10*o.score:0,"%"),p.xp6(4),p.ekj("text-blue-500",o.score>=1&&o.score<3),p.xp6(4),p.ekj("text-blue-500",o.score>=3&&o.score<5),p.xp6(4),p.ekj("text-blue-500",o.score>=5&&o.score<7),p.xp6(4),p.ekj("text-blue-500",o.score>=7&&o.score<9),p.xp6(4),p.ekj("text-blue-500",o.score>=9&&o.score<=10))},dependencies:[c.ez,c.JJ],styles:[".circular-score[_ngcontent-%COMP%]{position:relative}.circular-score[_ngcontent-%COMP%]   .score-background[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;border-radius:50%;background-color:#f3f4f6;box-shadow:0 0 .5rem #0000001a;transition:box-shadow .3s ease-in-out}.circular-score[_ngcontent-%COMP%]   .score-section[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:2.5rem;height:2.5rem;border-radius:50%;background-image:linear-gradient(to right,#4facfe 0%,#00f2fe 100%);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.5rem;color:#fff;transition:all .3s ease-in-out;background-clip:padding-box;background-origin:border-box;background-size:200% 200%;background-position:center center}.circular-score[_ngcontent-%COMP%]   .score-section[_ngcontent-%COMP%]:hover, .circular-score[_ngcontent-%COMP%]   .score-section.continued[_ngcontent-%COMP%]{width:3rem;height:3rem;box-shadow:0 0 .5rem #0000004d;animation:_ngcontent-%COMP%_pulse 1s ease-in-out infinite alternate}.continued[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1s ease-in-out infinite alternate}@keyframes _ngcontent-%COMP%_pulse{0%{transform:scale(1)}to{transform:scale(1.2)}}.circular-score[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{display:flex}.circular-score[_ngcontent-%COMP%]   .justify-center[_ngcontent-%COMP%]{justify-content:center}.circular-score[_ngcontent-%COMP%]   .items-center[_ngcontent-%COMP%]{align-items:center}.circular-score[_ngcontent-%COMP%]   .mr-1[_ngcontent-%COMP%]{margin-right:.25rem}.circular-score[_ngcontent-%COMP%]   .mr-2[_ngcontent-%COMP%]{margin-right:.5rem}.circular-score[_ngcontent-%COMP%]   .mb-1[_ngcontent-%COMP%]{margin-bottom:.25rem}.circular-score[_ngcontent-%COMP%]   .text-xs[_ngcontent-%COMP%]{font-size:.75rem}.circular-score[_ngcontent-%COMP%]   .font-bold[_ngcontent-%COMP%]{font-weight:700}.circular-score[_ngcontent-%COMP%]   .text-gray-500[_ngcontent-%COMP%]{color:#718096}.circular-score[_ngcontent-%COMP%]   .bg-red-500[_ngcontent-%COMP%]{background-color:#f56565;box-shadow:0 0 .5rem #f5656580}.circular-score[_ngcontent-%COMP%]   .bg-yellow-500[_ngcontent-%COMP%]{background-color:#f6e05e;box-shadow:0 0 .5rem #f6e05e80}.circular-score[_ngcontent-%COMP%]   .bg-green-500[_ngcontent-%COMP%]{background-color:#48bb78;box-shadow:0 0 .5rem #48bb7880}.circular-score[_ngcontent-%COMP%]   .bg-blue-500[_ngcontent-%COMP%]{background-color:#4299e1;box-shadow:0 0 .5rem #4299e180}.circular-score[_ngcontent-%COMP%]   .bg-purple-500[_ngcontent-%COMP%]{background-color:#9f7aea;box-shadow:0 0 .5rem #9f7aea80}.circular-score[_ngcontent-%COMP%]   .score-section.low[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#f56565 0%,#f6e05e 100%)}.circular-score[_ngcontent-%COMP%]   .score-section.below-average[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#f6e05e 0%,#48bb78 100%)}.circular-score[_ngcontent-%COMP%]   .score-section.average[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#48bb78 0%,#4299e1 100%)}.circular-score[_ngcontent-%COMP%]   .score-section.above-average[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#4299e1 0%,#9f7aea 100%)}.circular-score[_ngcontent-%COMP%]   .score-section.high[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#9f7aea 0%,#9f7aea 100%)}"]}),l})();var ro=bt(266),ke=bt(6656);function ao(l){return l+.5|0}const Ms=(l,r,i)=>Math.max(Math.min(l,i),r);function tr(l){return Ms(ao(2.55*l),0,255)}function lo(l){return Ms(ao(255*l),0,255)}function Rs(l){return Ms(ao(l/2.55)/100,0,1)}function Il(l){return Ms(ao(100*l),0,100)}const An={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Io=[..."0123456789ABCDEF"],Ll=l=>Io[15&l],Pc=l=>Io[(240&l)>>4]+Io[15&l],ui=l=>(240&l)>>4==(15&l),Lc=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Rl(l,r,i){const o=r*Math.min(i,1-i),d=(_,x=(_+l/30)%12)=>i-o*Math.max(Math.min(x-3,9-x,1),-1);return[d(0),d(8),d(4)]}function iu(l,r,i){const o=(d,_=(d+l/60)%6)=>i-i*r*Math.max(Math.min(_,4-_,1),0);return[o(5),o(3),o(1)]}function _d(l,r,i){const o=Rl(l,1,.5);let d;for(r+i>1&&(d=1/(r+i),r*=d,i*=d),d=0;d<3;d++)o[d]*=1-r-i,o[d]+=r;return o}function ja(l){const i=l.r/255,o=l.g/255,d=l.b/255,_=Math.max(i,o,d),x=Math.min(i,o,d),T=(_+x)/2;let C,D,R;return _!==x&&(R=_-x,D=T>.5?R/(2-_-x):R/(_+x),C=function zl(l,r,i,o,d){return l===d?(r-i)/o+(r<i?6:0):r===d?(i-l)/o+2:(l-r)/o+4}(i,o,d,R,_),C=60*C+.5),[0|C,D||0,T]}function ra(l,r,i,o){return(Array.isArray(r)?l(r[0],r[1],r[2]):l(r,i,o)).map(lo)}function aa(l,r,i){return ra(Rl,l,r,i)}function ou(l){return(l%360+360)%360}const la={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Ol={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let ca;const Bl=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,zc=l=>l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055,er=l=>l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4);function ir(l,r,i){if(l){let o=ja(l);o[r]=Math.max(0,Math.min(o[r]+o[r]*i,0===r?360:1)),o=aa(o),l.r=o[0],l.g=o[1],l.b=o[2]}}function Oc(l,r){return l&&Object.assign(r||{},l)}function Ul(l){var r={r:0,g:0,b:0,a:255};return Array.isArray(l)?l.length>=3&&(r={r:l[0],g:l[1],b:l[2],a:255},l.length>3&&(r.a=lo(l[3]))):(r=Oc(l,{r:0,g:0,b:0,a:1})).a=lo(r.a),r}function yd(l){return"r"===l.charAt(0)?function Rc(l){const r=Bl.exec(l);let o,d,_,i=255;if(r){if(r[7]!==o){const x=+r[7];i=r[8]?tr(x):Ms(255*x,0,255)}return o=+r[1],d=+r[3],_=+r[5],o=255&(r[2]?tr(o):Ms(o,0,255)),d=255&(r[4]?tr(d):Ms(d,0,255)),_=255&(r[6]?tr(_):Ms(_,0,255)),{r:o,g:d,b:_,a:i}}}(l):function Za(l){const r=Lc.exec(l);let o,i=255;if(!r)return;r[5]!==o&&(i=r[6]?tr(+r[5]):lo(+r[5]));const d=ou(+r[2]),_=+r[3]/100,x=+r[4]/100;return o="hwb"===r[1]?function nu(l,r,i){return ra(_d,l,r,i)}(d,_,x):"hsv"===r[1]?function su(l,r,i){return ra(iu,l,r,i)}(d,_,x):aa(d,_,x),{r:o[0],g:o[1],b:o[2],a:i}}(l)}class nr{constructor(r){if(r instanceof nr)return r;const i=typeof r;let o;"object"===i?o=Ul(r):"string"===i&&(o=function tu(l){var i,r=l.length;return"#"===l[0]&&(4===r||5===r?i={r:255&17*An[l[1]],g:255&17*An[l[2]],b:255&17*An[l[3]],a:5===r?17*An[l[4]]:255}:(7===r||9===r)&&(i={r:An[l[1]]<<4|An[l[2]],g:An[l[3]]<<4|An[l[4]],b:An[l[5]]<<4|An[l[6]],a:9===r?An[l[7]]<<4|An[l[8]]:255})),i}(r)||function au(l){ca||(ca=function co(){const l={},r=Object.keys(Ol),i=Object.keys(la);let o,d,_,x,T;for(o=0;o<r.length;o++){for(x=T=r[o],d=0;d<i.length;d++)_=i[d],T=T.replace(_,la[_]);_=parseInt(Ol[x],16),l[T]=[_>>16&255,_>>8&255,255&_]}return l}(),ca.transparent=[0,0,0,0]);const r=ca[l.toLowerCase()];return r&&{r:r[0],g:r[1],b:r[2],a:4===r.length?r[3]:255}}(r)||yd(r)),this._rgb=o,this._valid=!!o}get valid(){return this._valid}get rgb(){var r=Oc(this._rgb);return r&&(r.a=Rs(r.a)),r}set rgb(r){this._rgb=Ul(r)}rgbString(){return this._valid?function Fl(l){return l&&(l.a<255?`rgba(${l.r}, ${l.g}, ${l.b}, ${Rs(l.a)})`:`rgb(${l.r}, ${l.g}, ${l.b})`)}(this._rgb):void 0}hexString(){return this._valid?function Ic(l){var r=(l=>ui(l.r)&&ui(l.g)&&ui(l.b)&&ui(l.a))(l)?Ll:Pc;return l?"#"+r(l.r)+r(l.g)+r(l.b)+((l,r)=>l<255?r(l):"")(l.a,r):void 0}(this._rgb):void 0}hslString(){return this._valid?function ru(l){if(!l)return;const r=ja(l),i=r[0],o=Il(r[1]),d=Il(r[2]);return l.a<255?`hsla(${i}, ${o}%, ${d}%, ${Rs(l.a)})`:`hsl(${i}, ${o}%, ${d}%)`}(this._rgb):void 0}mix(r,i){if(r){const o=this.rgb,d=r.rgb;let _;const x=i===_?.5:i,T=2*x-1,C=o.a-d.a,D=((T*C==-1?T:(T+C)/(1+T*C))+1)/2;_=1-D,o.r=255&D*o.r+_*d.r+.5,o.g=255&D*o.g+_*d.g+.5,o.b=255&D*o.b+_*d.b+.5,o.a=x*o.a+(1-x)*d.a,this.rgb=o}return this}interpolate(r,i){return r&&(this._rgb=function lu(l,r,i){const o=er(Rs(l.r)),d=er(Rs(l.g)),_=er(Rs(l.b));return{r:lo(zc(o+i*(er(Rs(r.r))-o))),g:lo(zc(d+i*(er(Rs(r.g))-d))),b:lo(zc(_+i*(er(Rs(r.b))-_))),a:l.a+i*(r.a-l.a)}}(this._rgb,r._rgb,i)),this}clone(){return new nr(this.rgb)}alpha(r){return this._rgb.a=lo(r),this}clearer(r){return this._rgb.a*=1-r,this}greyscale(){const r=this._rgb,i=ao(.3*r.r+.59*r.g+.11*r.b);return r.r=r.g=r.b=i,this}opaquer(r){return this._rgb.a*=1+r,this}negate(){const r=this._rgb;return r.r=255-r.r,r.g=255-r.g,r.b=255-r.b,this}lighten(r){return ir(this._rgb,2,r),this}darken(r){return ir(this._rgb,2,-r),this}saturate(r){return ir(this._rgb,1,r),this}desaturate(r){return ir(this._rgb,1,-r),this}rotate(r){return function Ga(l,r){var i=ja(l);i[0]=ou(i[0]+r),i=aa(i),l.r=i[0],l.g=i[1],l.b=i[2]}(this._rgb,r),this}}function Kn(){}const cu=(()=>{let l=0;return()=>l++})();function Ci(l){return null===l||typeof l>"u"}function Ji(l){if(Array.isArray&&Array.isArray(l))return!0;const r=Object.prototype.toString.call(l);return"[object"===r.slice(0,7)&&"Array]"===r.slice(-6)}function di(l){return null!==l&&"[object Object]"===Object.prototype.toString.call(l)}function yn(l){return("number"==typeof l||l instanceof Number)&&isFinite(+l)}function hs(l,r){return yn(l)?l:r}function oi(l,r){return typeof l>"u"?r:l}const Nl=(l,r)=>"string"==typeof l&&l.endsWith("%")?parseFloat(l)/100*r:+l;function Ki(l,r,i){if(l&&"function"==typeof l.call)return l.apply(i,r)}function Li(l,r,i,o){let d,_,x;if(Ji(l))if(_=l.length,o)for(d=_-1;d>=0;d--)r.call(i,l[d],d);else for(d=0;d<_;d++)r.call(i,l[d],d);else if(di(l))for(x=Object.keys(l),_=x.length,d=0;d<_;d++)r.call(i,l[x[d]],x[d])}function ha(l,r){let i,o,d,_;if(!l||!r||l.length!==r.length)return!1;for(i=0,o=l.length;i<o;++i)if(d=l[i],_=r[i],d.datasetIndex!==_.datasetIndex||d.index!==_.index)return!1;return!0}function qa(l){if(Ji(l))return l.map(qa);if(di(l)){const r=Object.create(null),i=Object.keys(l),o=i.length;let d=0;for(;d<o;++d)r[i[d]]=qa(l[i[d]]);return r}return l}function Bc(l){return-1===["__proto__","prototype","constructor"].indexOf(l)}function uu(l,r,i,o){if(!Bc(l))return;const d=r[l],_=i[l];di(d)&&di(_)?wr(d,_,o):r[l]=qa(_)}function wr(l,r,i){const o=Ji(r)?r:[r],d=o.length;if(!di(l))return l;const _=(i=i||{}).merger||uu;let x;for(let T=0;T<d;++T){if(x=o[T],!di(x))continue;const C=Object.keys(x);for(let D=0,R=C.length;D<R;++D)_(C[D],l,x,i)}return l}function zs(l,r){return wr(l,r,{merger:ua})}function ua(l,r,i){if(!Bc(l))return;const o=r[l],d=i[l];di(o)&&di(d)?zs(o,d):Object.prototype.hasOwnProperty.call(r,l)||(r[l]=qa(d))}const Tr={"":l=>l,x:l=>l.x,y:l=>l.y};function Ws(l,r){return(Tr[r]||(Tr[r]=function Lo(l){const r=function da(l){const r=l.split("."),i=[];let o="";for(const d of r)o+=d,o.endsWith("\\")?o=o.slice(0,-1)+".":(i.push(o),o="");return i}(l);return i=>{for(const o of r){if(""===o)break;i=i&&i[o]}return i}}(r)))(l)}function pi(l){return l.charAt(0).toUpperCase()+l.slice(1)}const sr=l=>typeof l<"u",or=l=>"function"==typeof l,jl=(l,r)=>{if(l.size!==r.size)return!1;for(const i of l)if(!r.has(i))return!1;return!0},Qi=Math.PI,tn=2*Qi,Zl=tn+Qi,$a=Number.POSITIVE_INFINITY,Gl=Qi/180,$i=Qi/2,Os=Qi/4,Wa=2*Qi/3,us=Math.log10,Hn=Math.sign;function Ro(l,r,i){return Math.abs(l-r)<i}function pa(l){const r=Math.round(l);l=Ro(l,r,l/1e3)?r:l;const i=Math.pow(10,Math.floor(us(l))),o=l/i;return(o<=1?1:o<=2?2:o<=5?5:10)*i}function Un(l){return!isNaN(parseFloat(l))&&isFinite(l)}function ql(l,r,i){let o,d,_;for(o=0,d=l.length;o<d;o++)_=l[o][i],isNaN(_)||(r.min=Math.min(r.min,_),r.max=Math.max(r.max,_))}function Qn(l){return l*(Qi/180)}function rr(l){return l*(180/Qi)}function Fc(l){if(!yn(l))return;let r=1,i=0;for(;Math.round(l*r)/r!==l;)r*=10,i++;return i}function Xa(l,r){const i=r.x-l.x,o=r.y-l.y,d=Math.sqrt(i*i+o*o);let _=Math.atan2(o,i);return _<-.5*Qi&&(_+=tn),{angle:_,distance:d}}function Ya(l,r){return Math.sqrt(Math.pow(r.x-l.x,2)+Math.pow(r.y-l.y,2))}function Hl(l,r){return(l-r+Zl)%tn-Qi}function Nn(l){return(l%tn+tn)%tn}function zo(l,r,i,o){const d=Nn(l),_=Nn(r),x=Nn(i),T=Nn(_-d),C=Nn(x-d),D=Nn(d-_),R=Nn(d-x);return d===_||d===x||o&&_===x||T>C&&D<R}function Mi(l,r,i){return Math.max(r,Math.min(i,l))}function Oo(l,r,i,o=1e-6){return l>=Math.min(r,i)-o&&l<=Math.max(r,i)+o}function Wl(l,r,i){i=i||(x=>l[x]<r);let _,o=l.length-1,d=0;for(;o-d>1;)_=d+o>>1,i(_)?d=_:o=_;return{lo:d,hi:o}}const Bs=(l,r,i,o)=>Wl(l,i,o?d=>{const _=l[d][r];return _<i||_===i&&l[d+1][r]===i}:d=>l[d][r]<i),Uc=(l,r,i)=>Wl(l,i,o=>l[o][r]>=i),Nc=["push","pop","shift","splice","unshift"];function Yl(l,r){const i=l._chartjs;if(!i)return;const o=i.listeners,d=o.indexOf(r);-1!==d&&o.splice(d,1),!(o.length>0)&&(Nc.forEach(_=>{delete l[_]}),delete l._chartjs)}function Vc(l){const r=new Set(l);return r.size===l.length?l:Array.from(r)}const Zc=typeof window>"u"?function(l){return l()}:window.requestAnimationFrame;function Jl(l,r){let i=[],o=!1;return function(...d){i=d,o||(o=!0,Zc.call(window,()=>{o=!1,l.apply(r,i)}))}}const ar=l=>"start"===l?"left":"end"===l?"right":"center",kn=(l,r,i)=>"start"===l?r:"end"===l?i:(r+i)/2;function qc(l,r,i){const o=r.length;let d=0,_=o;if(l._sorted){const{iScale:x,_parsed:T}=l,C=x.axis,{min:D,max:R,minDefined:V,maxDefined:H}=x.getUserBounds();V&&(d=Mi(Math.min(Bs(T,x.axis,D).lo,i?o:Bs(r,C,x.getPixelForValue(D)).lo),0,o-1)),_=H?Mi(Math.max(Bs(T,x.axis,R,!0).hi+1,i?0:Bs(r,C,x.getPixelForValue(R),!0).hi+1),d,o)-d:o-d}return{start:d,count:_}}function Hc(l){const{xScale:r,yScale:i,_scaleRanges:o}=l,d={xmin:r.min,xmax:r.max,ymin:i.min,ymax:i.max};if(!o)return l._scaleRanges=d,!0;const _=o.xmin!==r.min||o.xmax!==r.max||o.ymin!==i.min||o.ymax!==i.max;return Object.assign(o,d),_}const ma=l=>0===l||1===l,$c=(l,r,i)=>-Math.pow(2,10*(l-=1))*Math.sin((l-r)*tn/i),Ka=(l,r,i)=>Math.pow(2,-10*l)*Math.sin((l-r)*tn/i)+1,Cn={linear:l=>l,easeInQuad:l=>l*l,easeOutQuad:l=>-l*(l-2),easeInOutQuad:l=>(l/=.5)<1?.5*l*l:-.5*(--l*(l-2)-1),easeInCubic:l=>l*l*l,easeOutCubic:l=>(l-=1)*l*l+1,easeInOutCubic:l=>(l/=.5)<1?.5*l*l*l:.5*((l-=2)*l*l+2),easeInQuart:l=>l*l*l*l,easeOutQuart:l=>-((l-=1)*l*l*l-1),easeInOutQuart:l=>(l/=.5)<1?.5*l*l*l*l:-.5*((l-=2)*l*l*l-2),easeInQuint:l=>l*l*l*l*l,easeOutQuint:l=>(l-=1)*l*l*l*l+1,easeInOutQuint:l=>(l/=.5)<1?.5*l*l*l*l*l:.5*((l-=2)*l*l*l*l+2),easeInSine:l=>1-Math.cos(l*$i),easeOutSine:l=>Math.sin(l*$i),easeInOutSine:l=>-.5*(Math.cos(Qi*l)-1),easeInExpo:l=>0===l?0:Math.pow(2,10*(l-1)),easeOutExpo:l=>1===l?1:1-Math.pow(2,-10*l),easeInOutExpo:l=>ma(l)?l:l<.5?.5*Math.pow(2,10*(2*l-1)):.5*(2-Math.pow(2,-10*(2*l-1))),easeInCirc:l=>l>=1?l:-(Math.sqrt(1-l*l)-1),easeOutCirc:l=>Math.sqrt(1-(l-=1)*l),easeInOutCirc:l=>(l/=.5)<1?-.5*(Math.sqrt(1-l*l)-1):.5*(Math.sqrt(1-(l-=2)*l)+1),easeInElastic:l=>ma(l)?l:$c(l,.075,.3),easeOutElastic:l=>ma(l)?l:Ka(l,.075,.3),easeInOutElastic:l=>ma(l)?l:l<.5?.5*$c(2*l,.1125,.45):.5+.5*Ka(2*l-1,.1125,.45),easeInBack:l=>l*l*(2.70158*l-1.70158),easeOutBack:l=>(l-=1)*l*(2.70158*l+1.70158)+1,easeInOutBack(l){let r=1.70158;return(l/=.5)<1?l*l*((1+(r*=1.525))*l-r)*.5:.5*((l-=2)*l*((1+(r*=1.525))*l+r)+2)},easeInBounce:l=>1-Cn.easeOutBounce(1-l),easeOutBounce:l=>l<1/2.75?7.5625*l*l:l<2/2.75?7.5625*(l-=1.5/2.75)*l+.75:l<2.5/2.75?7.5625*(l-=2.25/2.75)*l+.9375:7.5625*(l-=2.625/2.75)*l+.984375,easeInOutBounce:l=>l<.5?.5*Cn.easeInBounce(2*l):.5*Cn.easeOutBounce(2*l-1)+.5};function Wc(l){if(l&&"object"==typeof l){const r=l.toString();return"[object CanvasPattern]"===r||"[object CanvasGradient]"===r}return!1}function Xc(l){return Wc(l)?l:new nr(l)}function Yc(l){return Wc(l)?l:new nr(l).saturate(.5).darken(.1).hexString()}const pu=["x","y","borderWidth","radius","tension"],Bo=["color","borderColor","backgroundColor"],Xs=new Map;function De(l,r,i){return function Kl(l,r){r=r||{};const i=l+JSON.stringify(r);let o=Xs.get(i);return o||(o=new Intl.NumberFormat(l,r),Xs.set(i,o)),o}(r,i).format(l)}const Jc={values:l=>Ji(l)?l:""+l,numeric(l,r,i){if(0===l)return"0";const o=this.chart.options.locale;let d,_=l;if(i.length>1){const D=Math.max(Math.abs(i[0].value),Math.abs(i[i.length-1].value));(D<1e-4||D>1e15)&&(d="scientific"),_=function Qa(l,r){let i=r.length>3?r[2].value-r[1].value:r[1].value-r[0].value;return Math.abs(i)>=1&&l!==Math.floor(l)&&(i=l-Math.floor(l)),i}(l,i)}const x=us(Math.abs(_)),T=isNaN(x)?1:Math.max(Math.min(-1*Math.floor(x),20),0),C={notation:d,minimumFractionDigits:T,maximumFractionDigits:T};return Object.assign(C,this.options.ticks.format),De(l,o,C)},logarithmic(l,r,i){if(0===l)return"0";const o=i[r].significand||l/Math.pow(10,Math.floor(us(l)));return[1,2,3,5,10,15].includes(o)||r>.8*i.length?Jc.numeric.call(this,l,r,i):""}};var lr={formatters:Jc};const Ys=Object.create(null),Ql=Object.create(null);function Sr(l,r){if(!r)return l;const i=r.split(".");for(let o=0,d=i.length;o<d;++o){const _=i[o];l=l[_]||(l[_]=Object.create(null))}return l}function tc(l,r,i){return"string"==typeof r?wr(Sr(l,r),i):wr(Sr(l,""),r)}class Kc{constructor(r,i){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=o=>o.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(o,d)=>Yc(d.backgroundColor),this.hoverBorderColor=(o,d)=>Yc(d.borderColor),this.hoverColor=(o,d)=>Yc(d.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(r),this.apply(i)}set(r,i){return tc(this,r,i)}get(r){return Sr(this,r)}describe(r,i){return tc(Ql,r,i)}override(r,i){return tc(Ys,r,i)}route(r,i,o,d){const _=Sr(this,r),x=Sr(this,o),T="_"+i;Object.defineProperties(_,{[T]:{value:_[i],writable:!0},[i]:{enumerable:!0,get(){const C=this[T],D=x[d];return di(C)?Object.assign({},D,C):oi(C,D)},set(C){this[T]=C}}})}apply(r){r.forEach(i=>i(this))}}var hn=new Kc({_scriptable:l=>!l.startsWith("on"),_indexable:l=>"events"!==l,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function fu(l){l.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),l.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:r=>"onProgress"!==r&&"onComplete"!==r&&"fn"!==r}),l.set("animations",{colors:{type:"color",properties:Bo},numbers:{type:"number",properties:pu}}),l.describe("animations",{_fallback:"animation"}),l.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:r=>0|r}}}})},function ga(l){l.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function tl(l){l.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(r,i)=>i.lineWidth,tickColor:(r,i)=>i.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:lr.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),l.route("scale.ticks","color","","color"),l.route("scale.grid","color","","borderColor"),l.route("scale.border","color","","borderColor"),l.route("scale.title","color","","color"),l.describe("scale",{_fallback:!1,_scriptable:r=>!r.startsWith("before")&&!r.startsWith("after")&&"callback"!==r&&"parser"!==r,_indexable:r=>"borderDash"!==r&&"tickBorderDash"!==r&&"dash"!==r}),l.describe("scales",{_fallback:"scale"}),l.describe("scale.ticks",{_scriptable:r=>"backdropPadding"!==r&&"callback"!==r,_indexable:r=>"backdropPadding"!==r})}]);function Cr(l,r,i,o,d){let _=r[d];return _||(_=r[d]=l.measureText(d).width,i.push(d)),_>o&&(o=_),o}function _a(l,r,i,o){let d=(o=o||{}).data=o.data||{},_=o.garbageCollect=o.garbageCollect||[];o.font!==r&&(d=o.data={},_=o.garbageCollect=[],o.font=r),l.save(),l.font=r;let x=0;const T=i.length;let C,D,R,V,H;for(C=0;C<T;C++)if(V=i[C],null==V||Ji(V)){if(Ji(V))for(D=0,R=V.length;D<R;D++)H=V[D],null!=H&&!Ji(H)&&(x=Cr(l,d,_,x,H))}else x=Cr(l,d,_,x,V);l.restore();const K=_.length/2;if(K>i.length){for(C=0;C<K;C++)delete d[_[C]];_.splice(0,K)}return x}function ho(l,r,i){const o=l.currentDevicePixelRatio,d=0!==i?Math.max(i/2,.5):0;return Math.round((r-d)*o)/o+d}function Qc(l,r){(r=r||l.getContext("2d")).save(),r.resetTransform(),r.clearRect(0,0,l.width,l.height),r.restore()}function ec(l,r,i,o){ic(l,r,i,o,null)}function ic(l,r,i,o,d){let _,x,T,C,D,R,V,H;const K=r.pointStyle,ct=r.rotation,gt=r.radius;let _t=(ct||0)*Gl;if(K&&"object"==typeof K&&(_=K.toString(),"[object HTMLImageElement]"===_||"[object HTMLCanvasElement]"===_))return l.save(),l.translate(i,o),l.rotate(_t),l.drawImage(K,-K.width/2,-K.height/2,K.width,K.height),void l.restore();if(!(isNaN(gt)||gt<=0)){switch(l.beginPath(),K){default:d?l.ellipse(i,o,d/2,gt,0,0,tn):l.arc(i,o,gt,0,tn),l.closePath();break;case"triangle":R=d?d/2:gt,l.moveTo(i+Math.sin(_t)*R,o-Math.cos(_t)*gt),_t+=Wa,l.lineTo(i+Math.sin(_t)*R,o-Math.cos(_t)*gt),_t+=Wa,l.lineTo(i+Math.sin(_t)*R,o-Math.cos(_t)*gt),l.closePath();break;case"rectRounded":D=.516*gt,C=gt-D,x=Math.cos(_t+Os)*C,V=Math.cos(_t+Os)*(d?d/2-D:C),T=Math.sin(_t+Os)*C,H=Math.sin(_t+Os)*(d?d/2-D:C),l.arc(i-V,o-T,D,_t-Qi,_t-$i),l.arc(i+H,o-x,D,_t-$i,_t),l.arc(i+V,o+T,D,_t,_t+$i),l.arc(i-H,o+x,D,_t+$i,_t+Qi),l.closePath();break;case"rect":if(!ct){C=Math.SQRT1_2*gt,R=d?d/2:C,l.rect(i-R,o-C,2*R,2*C);break}_t+=Os;case"rectRot":V=Math.cos(_t)*(d?d/2:gt),x=Math.cos(_t)*gt,T=Math.sin(_t)*gt,H=Math.sin(_t)*(d?d/2:gt),l.moveTo(i-V,o-T),l.lineTo(i+H,o-x),l.lineTo(i+V,o+T),l.lineTo(i-H,o+x),l.closePath();break;case"crossRot":_t+=Os;case"cross":V=Math.cos(_t)*(d?d/2:gt),x=Math.cos(_t)*gt,T=Math.sin(_t)*gt,H=Math.sin(_t)*(d?d/2:gt),l.moveTo(i-V,o-T),l.lineTo(i+V,o+T),l.moveTo(i+H,o-x),l.lineTo(i-H,o+x);break;case"star":V=Math.cos(_t)*(d?d/2:gt),x=Math.cos(_t)*gt,T=Math.sin(_t)*gt,H=Math.sin(_t)*(d?d/2:gt),l.moveTo(i-V,o-T),l.lineTo(i+V,o+T),l.moveTo(i+H,o-x),l.lineTo(i-H,o+x),_t+=Os,V=Math.cos(_t)*(d?d/2:gt),x=Math.cos(_t)*gt,T=Math.sin(_t)*gt,H=Math.sin(_t)*(d?d/2:gt),l.moveTo(i-V,o-T),l.lineTo(i+V,o+T),l.moveTo(i+H,o-x),l.lineTo(i-H,o+x);break;case"line":x=d?d/2:Math.cos(_t)*gt,T=Math.sin(_t)*gt,l.moveTo(i-x,o-T),l.lineTo(i+x,o+T);break;case"dash":l.moveTo(i,o),l.lineTo(i+Math.cos(_t)*(d?d/2:gt),o+Math.sin(_t)*gt);break;case!1:l.closePath()}l.fill(),r.borderWidth>0&&l.stroke()}}function uo(l,r,i){return i=i||.5,!r||l&&l.x>r.left-i&&l.x<r.right+i&&l.y>r.top-i&&l.y<r.bottom+i}function il(l,r){l.save(),l.beginPath(),l.rect(r.left,r.top,r.right-r.left,r.bottom-r.top),l.clip()}function nl(l){l.restore()}function th(l,r,i,o,d){if(!r)return l.lineTo(i.x,i.y);if("middle"===d){const _=(r.x+i.x)/2;l.lineTo(_,r.y),l.lineTo(_,i.y)}else"after"===d!=!!o?l.lineTo(r.x,i.y):l.lineTo(i.x,r.y);l.lineTo(i.x,i.y)}function mu(l,r,i,o){if(!r)return l.lineTo(i.x,i.y);l.bezierCurveTo(o?r.cp1x:r.cp2x,o?r.cp1y:r.cp2y,o?i.cp2x:i.cp1x,o?i.cp2y:i.cp1y,i.x,i.y)}function _u(l,r,i,o,d){if(d.strikethrough||d.underline){const _=l.measureText(o),x=r-_.actualBoundingBoxLeft,T=r+_.actualBoundingBoxRight,D=i+_.actualBoundingBoxDescent,R=d.strikethrough?(i-_.actualBoundingBoxAscent+D)/2:D;l.strokeStyle=l.fillStyle,l.beginPath(),l.lineWidth=d.decorationWidth||2,l.moveTo(x,R),l.lineTo(T,R),l.stroke()}}function yu(l,r){const i=l.fillStyle;l.fillStyle=r.color,l.fillRect(r.left,r.top,r.width,r.height),l.fillStyle=i}function po(l,r,i,o,d,_={}){const x=Ji(r)?r:[r],T=_.strokeWidth>0&&""!==_.strokeColor;let C,D;for(l.save(),l.font=d.string,function gu(l,r){r.translation&&l.translate(r.translation[0],r.translation[1]),Ci(r.rotation)||l.rotate(r.rotation),r.color&&(l.fillStyle=r.color),r.textAlign&&(l.textAlign=r.textAlign),r.textBaseline&&(l.textBaseline=r.textBaseline)}(l,_),C=0;C<x.length;++C)D=x[C],_.backdrop&&yu(l,_.backdrop),T&&(_.strokeColor&&(l.strokeStyle=_.strokeColor),Ci(_.strokeWidth)||(l.lineWidth=_.strokeWidth),l.strokeText(D,i,o,_.maxWidth)),l.fillText(D,i,o,_.maxWidth),_u(l,i,o,D,_),o+=Number(d.lineHeight);l.restore()}function Fo(l,r){const{x:i,y:o,w:d,h:_,radius:x}=r;l.arc(i+x.topLeft,o+x.topLeft,x.topLeft,-$i,Qi,!0),l.lineTo(i,o+_-x.bottomLeft),l.arc(i+x.bottomLeft,o+_-x.bottomLeft,x.bottomLeft,Qi,$i,!0),l.lineTo(i+d-x.bottomRight,o+_),l.arc(i+d-x.bottomRight,o+_-x.bottomRight,x.bottomRight,$i,0,!0),l.lineTo(i+d,o+x.topRight),l.arc(i+d-x.topRight,o+x.topRight,x.topRight,0,-$i,!0),l.lineTo(i+x.topLeft,o)}const f=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,s=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function h(l,r){const i=(""+l).match(f);if(!i||"normal"===i[1])return 1.2*r;switch(l=+i[2],i[3]){case"px":return l;case"%":l/=100}return r*l}const g=l=>+l||0;function v(l,r){const i={},o=di(r),d=o?Object.keys(r):r,_=di(l)?o?x=>oi(l[x],l[r[x]]):x=>l[x]:()=>l;for(const x of d)i[x]=g(_(x));return i}function w(l){return v(l,{top:"y",right:"x",bottom:"y",left:"x"})}function E(l){return v(l,["topLeft","topRight","bottomLeft","bottomRight"])}function A(l){const r=w(l);return r.width=r.left+r.right,r.height=r.top+r.bottom,r}function P(l,r){let i=oi((l=l||{}).size,(r=r||hn.font).size);"string"==typeof i&&(i=parseInt(i,10));let o=oi(l.style,r.style);o&&!(""+o).match(s)&&(console.warn('Invalid font style specified: "'+o+'"'),o=void 0);const d={family:oi(l.family,r.family),lineHeight:h(oi(l.lineHeight,r.lineHeight),i),size:i,style:o,weight:oi(l.weight,r.weight),string:""};return d.string=function el(l){return!l||Ci(l.size)||Ci(l.family)?null:(l.style?l.style+" ":"")+(l.weight?l.weight+" ":"")+l.size+"px "+l.family}(d),d}function z(l,r,i,o){let _,x,T,d=!0;for(_=0,x=l.length;_<x;++_)if(T=l[_],void 0!==T&&(void 0!==r&&"function"==typeof T&&(T=T(r),d=!1),void 0!==i&&Ji(T)&&(T=T[i%T.length],d=!1),void 0!==T))return o&&!d&&(o.cacheable=!1),T}function U(l,r){return Object.assign(Object.create(l),r)}function q(l,r=[""],i,o,d=(()=>l[0])){const _=i||l;typeof o>"u"&&(o=Pt("_fallback",l));const x={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:l,_rootScopes:_,_fallback:o,_getTarget:d,override:T=>q([T,...l],r,_,o)};return new Proxy(x,{deleteProperty:(T,C)=>(delete T[C],delete T._keys,delete l[0][C],!0),get:(T,C)=>G(T,C,()=>function fe(l,r,i,o){let d;for(const _ of r)if(d=Pt(Y(_,l),i),typeof d<"u")return J(l,d)?Et(i,o,l,d):d}(C,r,l,T)),getOwnPropertyDescriptor:(T,C)=>Reflect.getOwnPropertyDescriptor(T._scopes[0],C),getPrototypeOf:()=>Reflect.getPrototypeOf(l[0]),has:(T,C)=>Yt(T).includes(C),ownKeys:T=>Yt(T),set(T,C,D){const R=T._storage||(T._storage=d());return T[C]=R[C]=D,delete T._keys,!0}})}function W(l,r,i,o){const d={_cacheable:!1,_proxy:l,_context:r,_subProxy:i,_stack:new Set,_descriptors:X(l,o),setContext:_=>W(l,_,i,o),override:_=>W(l.override(_),r,i,o)};return new Proxy(d,{deleteProperty:(_,x)=>(delete _[x],delete l[x],!0),get:(_,x,T)=>G(_,x,()=>function st(l,r,i){const{_proxy:o,_context:d,_subProxy:_,_descriptors:x}=l;let T=o[r];return or(T)&&x.isScriptable(r)&&(T=function it(l,r,i,o){const{_proxy:d,_context:_,_subProxy:x,_stack:T}=i;if(T.has(l))throw new Error("Recursion detected: "+Array.from(T).join("->")+"->"+l);T.add(l);let C=r(_,x||o);return T.delete(l),J(l,C)&&(C=Et(d._scopes,d,l,C)),C}(r,T,l,i)),Ji(T)&&T.length&&(T=function rt(l,r,i,o){const{_proxy:d,_context:_,_subProxy:x,_descriptors:T}=i;if(typeof _.index<"u"&&o(l))return r[_.index%r.length];if(di(r[0])){const C=r,D=d._scopes.filter(R=>R!==C);r=[];for(const R of C){const V=Et(D,d,l,R);r.push(W(V,_,x&&x[l],T))}}return r}(r,T,l,x.isIndexable)),J(r,T)&&(T=W(T,d,_&&_[r],x)),T}(_,x,T)),getOwnPropertyDescriptor:(_,x)=>_._descriptors.allKeys?Reflect.has(l,x)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(l,x),getPrototypeOf:()=>Reflect.getPrototypeOf(l),has:(_,x)=>Reflect.has(l,x),ownKeys:()=>Reflect.ownKeys(l),set:(_,x,T)=>(l[x]=T,delete _[x],!0)})}function X(l,r={scriptable:!0,indexable:!0}){const{_scriptable:i=r.scriptable,_indexable:o=r.indexable,_allKeys:d=r.allKeys}=l;return{allKeys:d,scriptable:i,indexable:o,isScriptable:or(i)?i:()=>i,isIndexable:or(o)?o:()=>o}}const Y=(l,r)=>l?l+pi(r):r,J=(l,r)=>di(r)&&"adapters"!==l&&(null===Object.getPrototypeOf(r)||r.constructor===Object);function G(l,r,i){if(Object.prototype.hasOwnProperty.call(l,r))return l[r];const o=i();return l[r]=o,o}function pt(l,r,i){return or(l)?l(r,i):l}const dt=(l,r)=>!0===l?r:"string"==typeof l?Ws(r,l):void 0;function xt(l,r,i,o,d){for(const _ of r){const x=dt(i,_);if(x){l.add(x);const T=pt(x._fallback,i,d);if(typeof T<"u"&&T!==i&&T!==o)return T}else if(!1===x&&typeof o<"u"&&i!==o)return null}return!1}function Et(l,r,i,o){const d=r._rootScopes,_=pt(r._fallback,i,o),x=[...l,...d],T=new Set;T.add(o);let C=Lt(T,x,i,_||i,o);return!(null===C||typeof _<"u"&&_!==i&&(C=Lt(T,x,_,C,o),null===C))&&q(Array.from(T),[""],d,_,()=>function Bt(l,r,i){const o=l._getTarget();r in o||(o[r]={});const d=o[r];return Ji(d)&&di(i)?i:d||{}}(r,i,o))}function Lt(l,r,i,o,d){for(;i;)i=xt(l,r,i,o,d);return i}function Pt(l,r){for(const i of r){if(!i)continue;const o=i[l];if(typeof o<"u")return o}}function Yt(l){let r=l._keys;return r||(r=l._keys=function Vt(l){const r=new Set;for(const i of l)for(const o of Object.keys(i).filter(d=>!d.startsWith("_")))r.add(o);return Array.from(r)}(l._scopes)),r}function ne(l,r,i,o){const{iScale:d}=l,{key:_="r"}=this._parsing,x=new Array(o);let T,C,D,R;for(T=0,C=o;T<C;++T)D=T+i,R=r[D],x[T]={r:d.parse(Ws(R,_),D)};return x}const Ot=Number.EPSILON||1e-14,wt=(l,r)=>r<l.length&&!l[r].skip&&l[r],Nt=l=>"x"===l?"y":"x";function ee(l,r,i,o){const d=l.skip?r:l,_=r,x=i.skip?r:i,T=Ya(_,d),C=Ya(x,_);let D=T/(T+C),R=C/(T+C);D=isNaN(D)?0:D,R=isNaN(R)?0:R;const V=o*D,H=o*R;return{previous:{x:_.x-V*(x.x-d.x),y:_.y-V*(x.y-d.y)},next:{x:_.x+H*(x.x-d.x),y:_.y+H*(x.y-d.y)}}}function Ie(l,r,i){return Math.max(Math.min(l,i),r)}function Ue(l,r,i,o,d){let _,x,T,C;if(r.spanGaps&&(l=l.filter(D=>!D.skip)),"monotone"===r.cubicInterpolationMode)!function ii(l,r="x"){const i=Nt(r),o=l.length,d=Array(o).fill(0),_=Array(o);let x,T,C,D=wt(l,0);for(x=0;x<o;++x)if(T=C,C=D,D=wt(l,x+1),C){if(D){const R=D[r]-C[r];d[x]=0!==R?(D[i]-C[i])/R:0}_[x]=T?D?Hn(d[x-1])!==Hn(d[x])?0:(d[x-1]+d[x])/2:d[x-1]:d[x]}(function se(l,r,i){const o=l.length;let d,_,x,T,C,D=wt(l,0);for(let R=0;R<o-1;++R)if(C=D,D=wt(l,R+1),C&&D){if(Ro(r[R],0,Ot)){i[R]=i[R+1]=0;continue}d=i[R]/r[R],_=i[R+1]/r[R],T=Math.pow(d,2)+Math.pow(_,2),!(T<=9)&&(x=3/Math.sqrt(T),i[R]=d*x*r[R],i[R+1]=_*x*r[R])}})(l,d,_),function Be(l,r,i="x"){const o=Nt(i),d=l.length;let _,x,T,C=wt(l,0);for(let D=0;D<d;++D){if(x=T,T=C,C=wt(l,D+1),!T)continue;const R=T[i],V=T[o];x&&(_=(R-x[i])/3,T[`cp1${i}`]=R-_,T[`cp1${o}`]=V-_*r[D]),C&&(_=(C[i]-R)/3,T[`cp2${i}`]=R+_,T[`cp2${o}`]=V+_*r[D])}}(l,_,r)}(l,d);else{let D=o?l[l.length-1]:l[0];for(_=0,x=l.length;_<x;++_)T=l[_],C=ee(D,T,l[Math.min(_+1,x-(o?0:1))%x],r.tension),T.cp1x=C.previous.x,T.cp1y=C.previous.y,T.cp2x=C.next.x,T.cp2y=C.next.y,D=T}r.capBezierPoints&&function Ee(l,r){let i,o,d,_,x,T=uo(l[0],r);for(i=0,o=l.length;i<o;++i)x=_,_=T,T=i<o-1&&uo(l[i+1],r),_&&(d=l[i],x&&(d.cp1x=Ie(d.cp1x,r.left,r.right),d.cp1y=Ie(d.cp1y,r.top,r.bottom)),T&&(d.cp2x=Ie(d.cp2x,r.left,r.right),d.cp2y=Ie(d.cp2y,r.top,r.bottom)))}(l,i)}function ri(){return typeof window<"u"&&typeof document<"u"}function je(l){let r=l.parentNode;return r&&"[object ShadowRoot]"===r.toString()&&(r=r.host),r}function xi(l,r,i){let o;return"string"==typeof l?(o=parseInt(l,10),-1!==l.indexOf("%")&&(o=o/100*r.parentNode[i])):o=l,o}const Ei=l=>l.ownerDocument.defaultView.getComputedStyle(l,null),zi=["top","right","bottom","left"];function Wi(l,r,i){const o={};i=i?"-"+i:"";for(let d=0;d<4;d++){const _=zi[d];o[_]=parseFloat(l[r+"-"+_+i])||0}return o.width=o.left+o.right,o.height=o.top+o.bottom,o}const ds=(l,r,i)=>(l>0||r>0)&&(!i||!i.shadowRoot);function ts(l,r){if("native"in l)return l;const{canvas:i,currentDevicePixelRatio:o}=r,d=Ei(i),_="border-box"===d.boxSizing,x=Wi(d,"padding"),T=Wi(d,"border","width"),{x:C,y:D,box:R}=function Js(l,r){const i=l.touches,o=i&&i.length?i[0]:l,{offsetX:d,offsetY:_}=o;let T,C,x=!1;if(ds(d,_,l.target))T=d,C=_;else{const D=r.getBoundingClientRect();T=o.clientX-D.left,C=o.clientY-D.top,x=!0}return{x:T,y:C,box:x}}(l,i),V=x.left+(R&&T.left),H=x.top+(R&&T.top);let{width:K,height:ct}=r;return _&&(K-=x.width+T.width,ct-=x.height+T.height),{x:Math.round((C-V)/K*i.width/o),y:Math.round((D-H)/ct*i.height/o)}}const Di=l=>Math.round(10*l)/10;function un(l,r,i){const o=r||1,d=Math.floor(l.height*o),_=Math.floor(l.width*o);l.height=Math.floor(l.height),l.width=Math.floor(l.width);const x=l.canvas;return x.style&&(i||!x.style.height&&!x.style.width)&&(x.style.height=`${l.height}px`,x.style.width=`${l.width}px`),(l.currentDevicePixelRatio!==o||x.height!==d||x.width!==_)&&(l.currentDevicePixelRatio=o,x.height=d,x.width=_,l.ctx.setTransform(o,0,0,o,0,0),!0)}const $n=function(){let l=!1;try{const r={get passive(){return l=!0,!1}};window.addEventListener("test",null,r),window.removeEventListener("test",null,r)}catch{}return l}();function Vi(l,r){const i=function Ni(l,r){return Ei(l).getPropertyValue(r)}(l,r),o=i&&i.match(/^(\d+)(\.\d+)?px$/);return o?+o[1]:void 0}function xn(l,r,i,o){return{x:l.x+i*(r.x-l.x),y:l.y+i*(r.y-l.y)}}function Wn(l,r,i,o){return{x:l.x+i*(r.x-l.x),y:"middle"===o?i<.5?l.y:r.y:"after"===o?i<1?l.y:r.y:i>0?r.y:l.y}}function cr(l,r,i,o){const d={x:l.cp2x,y:l.cp2y},_={x:r.cp1x,y:r.cp1y},x=xn(l,d,i),T=xn(d,_,i),C=xn(_,r,i),D=xn(x,T,i),R=xn(T,C,i);return xn(D,R,i)}const ya=function(l,r){return{x:i=>l+l+r-i,setWidth(i){r=i},textAlign:i=>"center"===i?i:"right"===i?"left":"right",xPlus:(i,o)=>i-o,leftForLtr:(i,o)=>i-o}},Es=function(){return{x:l=>l,setWidth(l){},textAlign:l=>l,xPlus:(l,r)=>l+r,leftForLtr:(l,r)=>l}};function Vn(l,r,i){return l?ya(r,i):Es()}function fo(l,r){let i,o;("ltr"===r||"rtl"===r)&&(i=l.canvas.style,o=[i.getPropertyValue("direction"),i.getPropertyPriority("direction")],i.setProperty("direction",r,"important"),l.prevTextDirection=o)}function Uo(l,r){void 0!==r&&(delete l.prevTextDirection,l.canvas.style.setProperty("direction",r[0],r[1]))}function No(l){return"angle"===l?{between:zo,compare:Hl,normalize:Nn}:{between:Oo,compare:(r,i)=>r-i,normalize:r=>r}}function Mr({start:l,end:r,count:i,loop:o,style:d}){return{start:l%i,end:r%i,loop:o&&(r-l+1)%i==0,style:d}}function xu(l,r,i){if(!i)return[l];const{property:o,start:d,end:_}=i,x=r.length,{compare:T,between:C,normalize:D}=No(o),{start:R,end:V,loop:H,style:K}=function Cp(l,r,i){const{property:o,start:d,end:_}=i,{between:x,normalize:T}=No(o),C=r.length;let H,K,{start:D,end:R,loop:V}=l;if(V){for(D+=C,R+=C,H=0,K=C;H<K&&x(T(r[D%C][o]),d,_);++H)D--,R--;D%=C,R%=C}return R<D&&(R+=C),{start:D,end:R,loop:V,style:l.style}}(l,r,i),ct=[];let Xt,$t,me,gt=!1,_t=null;for(let Pe=R,qe=R;Pe<=V;++Pe)$t=r[Pe%x],!$t.skip&&(Xt=D($t[o]),Xt!==me&&(gt=C(Xt,d,_),null===_t&&(gt||C(d,me,Xt)&&0!==T(d,me))&&(_t=0===T(Xt,d)?Pe:qe),null!==_t&&(!gt||0===T(_,Xt)||C(_,me,Xt))&&(ct.push(Mr({start:_t,end:Pe,loop:H,count:x,style:K})),_t=null),qe=Pe,me=Xt));return null!==_t&&ct.push(Mr({start:_t,end:V,loop:H,count:x,style:K})),ct}function xd(l,r){const i=[],o=l.segments;for(let d=0;d<o.length;d++){const _=xu(o[d],l.points,r);_.length&&i.push(..._)}return i}function bd(l){return{backgroundColor:l.backgroundColor,borderCapStyle:l.borderCapStyle,borderDash:l.borderDash,borderDashOffset:l.borderDashOffset,borderJoinStyle:l.borderJoinStyle,borderWidth:l.borderWidth,borderColor:l.borderColor}}function Dp(l,r){if(!r)return!1;const i=[],o=function(d,_){return Wc(_)?(i.includes(_)||i.push(_),i.indexOf(_)):_};return JSON.stringify(l,o)!==JSON.stringify(r,o)}class Pp{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(r,i,o,d){const x=i.duration;i.listeners[d].forEach(T=>T({chart:r,initial:i.initial,numSteps:x,currentStep:Math.min(o-i.start,x)}))}_refresh(){this._request||(this._running=!0,this._request=Zc.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(r=Date.now()){let i=0;this._charts.forEach((o,d)=>{if(!o.running||!o.items.length)return;const _=o.items;let C,x=_.length-1,T=!1;for(;x>=0;--x)C=_[x],C._active?(C._total>o.duration&&(o.duration=C._total),C.tick(r),T=!0):(_[x]=_[_.length-1],_.pop());T&&(d.draw(),this._notify(d,o,r,"progress")),_.length||(o.running=!1,this._notify(d,o,r,"complete"),o.initial=!1),i+=_.length}),this._lastDate=r,0===i&&(this._running=!1)}_getAnims(r){const i=this._charts;let o=i.get(r);return o||(o={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},i.set(r,o)),o}listen(r,i,o){this._getAnims(r).listeners[i].push(o)}add(r,i){!i||!i.length||this._getAnims(r).items.push(...i)}has(r){return this._getAnims(r).items.length>0}start(r){const i=this._charts.get(r);i&&(i.running=!0,i.start=Date.now(),i.duration=i.items.reduce((o,d)=>Math.max(o,d._duration),0),this._refresh())}running(r){if(!this._running)return!1;const i=this._charts.get(r);return!(!i||!i.running||!i.items.length)}stop(r){const i=this._charts.get(r);if(!i||!i.items.length)return;const o=i.items;let d=o.length-1;for(;d>=0;--d)o[d].cancel();i.items=[],this._notify(r,i,Date.now(),"complete")}remove(r){return this._charts.delete(r)}}var Er=new Pp;const Ip="transparent",sl={boolean:(l,r,i)=>i>.5?r:l,color(l,r,i){const o=Xc(l||Ip),d=o.valid&&Xc(r||Ip);return d&&d.valid?d.mix(o,i).hexString():r},number:(l,r,i)=>l+(r-l)*i};class fm{constructor(r,i,o,d){const _=i[o];d=z([r.to,d,_,r.from]);const x=z([r.from,_,d]);this._active=!0,this._fn=r.fn||sl[r.type||typeof x],this._easing=Cn[r.easing]||Cn.linear,this._start=Math.floor(Date.now()+(r.delay||0)),this._duration=this._total=Math.floor(r.duration),this._loop=!!r.loop,this._target=i,this._prop=o,this._from=x,this._to=d,this._promises=void 0}active(){return this._active}update(r,i,o){if(this._active){this._notify(!1);const d=this._target[this._prop],_=o-this._start,x=this._duration-_;this._start=o,this._duration=Math.floor(Math.max(x,r.duration)),this._total+=_,this._loop=!!r.loop,this._to=z([r.to,i,d,r.from]),this._from=z([r.from,d,i])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(r){const i=r-this._start,o=this._duration,d=this._prop,_=this._from,x=this._loop,T=this._to;let C;if(this._active=_!==T&&(x||i<o),!this._active)return this._target[d]=T,void this._notify(!0);i<0?this._target[d]=_:(C=i/o%2,C=x&&C>1?2-C:C,C=this._easing(Math.min(1,Math.max(0,C))),this._target[d]=this._fn(_,T,C))}wait(){const r=this._promises||(this._promises=[]);return new Promise((i,o)=>{r.push({res:i,rej:o})})}_notify(r){const i=r?"res":"rej",o=this._promises||[];for(let d=0;d<o.length;d++)o[d][i]()}}class vu{constructor(r,i){this._chart=r,this._properties=new Map,this.configure(i)}configure(r){if(!di(r))return;const i=Object.keys(hn.animation),o=this._properties;Object.getOwnPropertyNames(r).forEach(d=>{const _=r[d];if(!di(_))return;const x={};for(const T of i)x[T]=_[T];(Ji(_.properties)&&_.properties||[d]).forEach(T=>{(T===d||!o.has(T))&&o.set(T,x)})})}_animateOptions(r,i){const o=i.options,d=function Lp(l,r){if(!r)return;let i=l.options;if(i)return i.$shared&&(l.options=i=Object.assign({},i,{$shared:!1,$animations:{}})),i;l.options=r}(r,o);if(!d)return[];const _=this._createAnimations(d,o);return o.$shared&&function wd(l,r){const i=[],o=Object.keys(r);for(let d=0;d<o.length;d++){const _=l[o[d]];_&&_.active()&&i.push(_.wait())}return Promise.all(i)}(r.options.$animations,o).then(()=>{r.options=o},()=>{}),_}_createAnimations(r,i){const o=this._properties,d=[],_=r.$animations||(r.$animations={}),x=Object.keys(i),T=Date.now();let C;for(C=x.length-1;C>=0;--C){const D=x[C];if("$"===D.charAt(0))continue;if("options"===D){d.push(...this._animateOptions(r,i));continue}const R=i[D];let V=_[D];const H=o.get(D);if(V){if(H&&V.active()){V.update(H,R,T);continue}V.cancel()}H&&H.duration?(_[D]=V=new fm(H,r,D,R),d.push(V)):r[D]=R}return d}update(r,i){if(0===this._properties.size)return void Object.assign(r,i);const o=this._createAnimations(r,i);return o.length?(Er.add(this._chart,o),!0):void 0}}function Rp(l,r){const i=l&&l.options||{},o=i.reverse,d=void 0===i.min?r:0,_=void 0===i.max?r:0;return{start:o?_:d,end:o?d:_}}function wu(l,r){const i=[],o=l._getSortedDatasetMetas(r);let d,_;for(d=0,_=o.length;d<_;++d)i.push(o[d].index);return i}function eh(l,r,i,o={}){const d=l.keys,_="single"===o.mode;let x,T,C,D;if(null!==r){for(x=0,T=d.length;x<T;++x){if(C=+d[x],C===i){if(o.all)continue;break}D=l.values[C],yn(D)&&(_||0===r||Hn(r)===Hn(D))&&(r+=D)}return r}}function ih(l,r){const i=l&&l.options.stacked;return i||void 0===i&&void 0!==r.stack}function mm(l,r,i){const o=l[r]||(l[r]={});return o[i]||(o[i]={})}function Fp(l,r,i,o){for(const d of r.getMatchingVisibleMetas(o).reverse()){const _=l[d.index];if(i&&_>0||!i&&_<0)return d.index}return null}function Up(l,r){const{chart:i,_cachedMeta:o}=l,d=i._stacks||(i._stacks={}),{iScale:_,vScale:x,index:T}=o,C=_.axis,D=x.axis,R=function Op(l,r,i){return`${l.id}.${r.id}.${i.stack||i.type}`}(_,x,o),V=r.length;let H;for(let K=0;K<V;++K){const ct=r[K],{[C]:gt,[D]:_t}=ct;H=(ct._stacks||(ct._stacks={}))[D]=mm(d,R,gt),H[T]=_t,H._top=Fp(H,x,!0,o.type),H._bottom=Fp(H,x,!1,o.type),(H._visualValues||(H._visualValues={}))[T]=_t}}function nh(l,r){const i=l.scales;return Object.keys(i).filter(o=>i[o].axis===r).shift()}function Ks(l,r){const i=l.controller.index,o=l.vScale&&l.vScale.axis;if(o){r=r||l._parsed;for(const d of r){const _=d._stacks;if(!_||void 0===_[o]||void 0===_[o][i])return;delete _[o][i],void 0!==_[o]._visualValues&&void 0!==_[o]._visualValues[i]&&delete _[o]._visualValues[i]}}}const Qs=l=>"reset"===l||"none"===l,kr=(l,r)=>r?l:Object.assign({},l);let Fs=(()=>{class l{constructor(i,o){this.chart=i,this._ctx=i.ctx,this.index=o,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const i=this._cachedMeta;this.configure(),this.linkScales(),i._stacked=ih(i.vScale,i),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(i){this.index!==i&&Ks(this._cachedMeta),this.index=i}linkScales(){const i=this.chart,o=this._cachedMeta,d=this.getDataset(),_=(H,K,ct,gt)=>"x"===H?K:"r"===H?gt:ct,x=o.xAxisID=oi(d.xAxisID,nh(i,"x")),T=o.yAxisID=oi(d.yAxisID,nh(i,"y")),C=o.rAxisID=oi(d.rAxisID,nh(i,"r")),D=o.indexAxis,R=o.iAxisID=_(D,x,T,C),V=o.vAxisID=_(D,T,x,C);o.xScale=this.getScaleForId(x),o.yScale=this.getScaleForId(T),o.rScale=this.getScaleForId(C),o.iScale=this.getScaleForId(R),o.vScale=this.getScaleForId(V)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(i){return this.chart.scales[i]}_getOtherScale(i){const o=this._cachedMeta;return i===o.iScale?o.vScale:o.iScale}reset(){this._update("reset")}_destroy(){const i=this._cachedMeta;this._data&&Yl(this._data,this),i._stacked&&Ks(i)}_dataCheck(){const i=this.getDataset(),o=i.data||(i.data=[]),d=this._data;if(di(o))this._data=function Ar(l){const r=Object.keys(l),i=new Array(r.length);let o,d,_;for(o=0,d=r.length;o<d;++o)_=r[o],i[o]={x:_,y:l[_]};return i}(o);else if(d!==o){if(d){Yl(d,this);const _=this._cachedMeta;Ks(_),_._parsed=[]}o&&Object.isExtensible(o)&&function fa(l,r){l._chartjs?l._chartjs.listeners.push(r):(Object.defineProperty(l,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[r]}}),Nc.forEach(i=>{const o="_onData"+pi(i),d=l[i];Object.defineProperty(l,i,{configurable:!0,enumerable:!1,value(..._){const x=d.apply(this,_);return l._chartjs.listeners.forEach(T=>{"function"==typeof T[o]&&T[o](..._)}),x}})}))}(o,this),this._syncList=[],this._data=o}}addElements(){const i=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(i.dataset=new this.datasetElementType)}buildOrUpdateElements(i){const o=this._cachedMeta,d=this.getDataset();let _=!1;this._dataCheck();const x=o._stacked;o._stacked=ih(o.vScale,o),o.stack!==d.stack&&(_=!0,Ks(o),o.stack=d.stack),this._resyncElements(i),(_||x!==o._stacked)&&Up(this,o._parsed)}configure(){const i=this.chart.config,o=i.datasetScopeKeys(this._type),d=i.getOptionScopes(this.getDataset(),o,!0);this.options=i.createResolver(d,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(i,o){const{_cachedMeta:d,_data:_}=this,{iScale:x,_stacked:T}=d,C=x.axis;let V,H,K,D=0===i&&o===_.length||d._sorted,R=i>0&&d._parsed[i-1];if(!1===this._parsing)d._parsed=_,d._sorted=!0,K=_;else{K=Ji(_[i])?this.parseArrayData(d,_,i,o):di(_[i])?this.parseObjectData(d,_,i,o):this.parsePrimitiveData(d,_,i,o);const ct=()=>null===H[C]||R&&H[C]<R[C];for(V=0;V<o;++V)d._parsed[V+i]=H=K[V],D&&(ct()&&(D=!1),R=H);d._sorted=D}T&&Up(this,K)}parsePrimitiveData(i,o,d,_){const{iScale:x,vScale:T}=i,C=x.axis,D=T.axis,R=x.getLabels(),V=x===T,H=new Array(_);let K,ct,gt;for(K=0,ct=_;K<ct;++K)gt=K+d,H[K]={[C]:V||x.parse(R[gt],gt),[D]:T.parse(o[gt],gt)};return H}parseArrayData(i,o,d,_){const{xScale:x,yScale:T}=i,C=new Array(_);let D,R,V,H;for(D=0,R=_;D<R;++D)V=D+d,H=o[V],C[D]={x:x.parse(H[0],V),y:T.parse(H[1],V)};return C}parseObjectData(i,o,d,_){const{xScale:x,yScale:T}=i,{xAxisKey:C="x",yAxisKey:D="y"}=this._parsing,R=new Array(_);let V,H,K,ct;for(V=0,H=_;V<H;++V)K=V+d,ct=o[K],R[V]={x:x.parse(Ws(ct,C),K),y:T.parse(Ws(ct,D),K)};return R}getParsed(i){return this._cachedMeta._parsed[i]}getDataElement(i){return this._cachedMeta.data[i]}applyStack(i,o,d){const x=this._cachedMeta,T=o[i.axis];return eh({keys:wu(this.chart,!0),values:o._stacks[i.axis]._visualValues},T,x.index,{mode:d})}updateRangeFromParsed(i,o,d,_){const x=d[o.axis];let T=null===x?NaN:x;const C=_&&d._stacks[o.axis];_&&C&&(_.values=C,T=eh(_,x,this._cachedMeta.index)),i.min=Math.min(i.min,T),i.max=Math.max(i.max,T)}getMinMax(i,o){const d=this._cachedMeta,_=d._parsed,x=d._sorted&&i===d.iScale,T=_.length,C=this._getOtherScale(i),D=((l,r,i)=>l&&!r.hidden&&r._stacked&&{keys:wu(this.chart,!0),values:null})(o,d),R={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:V,max:H}=function Bp(l){const{min:r,max:i,minDefined:o,maxDefined:d}=l.getUserBounds();return{min:o?r:Number.NEGATIVE_INFINITY,max:d?i:Number.POSITIVE_INFINITY}}(C);let K,ct;function gt(){ct=_[K];const _t=ct[C.axis];return!yn(ct[i.axis])||V>_t||H<_t}for(K=0;K<T&&(gt()||(this.updateRangeFromParsed(R,i,ct,D),!x));++K);if(x)for(K=T-1;K>=0;--K)if(!gt()){this.updateRangeFromParsed(R,i,ct,D);break}return R}getAllParsedValues(i){const o=this._cachedMeta._parsed,d=[];let _,x,T;for(_=0,x=o.length;_<x;++_)T=o[_][i.axis],yn(T)&&d.push(T);return d}getMaxOverflow(){return!1}getLabelAndValue(i){const o=this._cachedMeta,d=o.iScale,_=o.vScale,x=this.getParsed(i);return{label:d?""+d.getLabelForValue(x[d.axis]):"",value:_?""+_.getLabelForValue(x[_.axis]):""}}_update(i){const o=this._cachedMeta;this.update(i||"default"),o._clip=function zp(l){let r,i,o,d;return di(l)?(r=l.top,i=l.right,o=l.bottom,d=l.left):r=i=o=d=l,{top:r,right:i,bottom:o,left:d,disabled:!1===l}}(oi(this.options.clip,function bu(l,r,i){if(!1===i)return!1;const o=Rp(l,i),d=Rp(r,i);return{top:d.end,right:o.end,bottom:d.start,left:o.start}}(o.xScale,o.yScale,this.getMaxOverflow())))}update(i){}draw(){const i=this._ctx,d=this._cachedMeta,_=d.data||[],x=this.chart.chartArea,T=[],C=this._drawStart||0,D=this._drawCount||_.length-C,R=this.options.drawActiveElementsOnTop;let V;for(d.dataset&&d.dataset.draw(i,x,C,D),V=C;V<C+D;++V){const H=_[V];H.hidden||(H.active&&R?T.push(H):H.draw(i,x))}for(V=0;V<T.length;++V)T[V].draw(i,x)}getStyle(i,o){const d=o?"active":"default";return void 0===i&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(d):this.resolveDataElementOptions(i||0,d)}getContext(i,o,d){const _=this.getDataset();let x;if(i>=0&&i<this._cachedMeta.data.length){const T=this._cachedMeta.data[i];x=T.$context||(T.$context=function nc(l,r,i){return U(l,{active:!1,dataIndex:r,parsed:void 0,raw:void 0,element:i,index:r,mode:"default",type:"data"})}(this.getContext(),i,T)),x.parsed=this.getParsed(i),x.raw=_.data[i],x.index=x.dataIndex=i}else x=this.$context||(this.$context=function sh(l,r){return U(l,{active:!1,dataset:void 0,datasetIndex:r,index:r,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),x.dataset=_,x.index=x.datasetIndex=this.index;return x.active=!!o,x.mode=d,x}resolveDatasetElementOptions(i){return this._resolveElementOptions(this.datasetElementType.id,i)}resolveDataElementOptions(i,o){return this._resolveElementOptions(this.dataElementType.id,o,i)}_resolveElementOptions(i,o="default",d){const _="active"===o,x=this._cachedDataOpts,T=i+"-"+o,C=x[T],D=this.enableOptionSharing&&sr(d);if(C)return kr(C,D);const R=this.chart.config,V=R.datasetElementScopeKeys(this._type,i),H=_?[`${i}Hover`,"hover",i,""]:[i,""],K=R.getOptionScopes(this.getDataset(),V),ct=Object.keys(hn.elements[i]),_t=R.resolveNamedOptions(K,ct,()=>this.getContext(d,_,o),H);return _t.$shared&&(_t.$shared=D,x[T]=Object.freeze(kr(_t,D))),_t}_resolveAnimations(i,o,d){const _=this.chart,x=this._cachedDataOpts,T=`animation-${o}`,C=x[T];if(C)return C;let D;if(!1!==_.options.animation){const V=this.chart.config,H=V.datasetAnimationScopeKeys(this._type,o),K=V.getOptionScopes(this.getDataset(),H);D=V.createResolver(K,this.getContext(i,d,o))}const R=new vu(_,D&&D.animations);return D&&D._cacheable&&(x[T]=Object.freeze(R)),R}getSharedOptions(i){if(i.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},i))}includeOptions(i,o){return!o||Qs(i)||this.chart._animationsDisabled}_getSharedOptions(i,o){const d=this.resolveDataElementOptions(i,o),_=this._sharedOptions,x=this.getSharedOptions(d),T=this.includeOptions(o,x)||x!==_;return this.updateSharedOptions(x,o,d),{sharedOptions:x,includeOptions:T}}updateElement(i,o,d,_){Qs(_)?Object.assign(i,d):this._resolveAnimations(o,_).update(i,d)}updateSharedOptions(i,o,d){i&&!Qs(o)&&this._resolveAnimations(void 0,o).update(i,d)}_setStyle(i,o,d,_){i.active=_;const x=this.getStyle(o,_);this._resolveAnimations(o,d,_).update(i,{options:!_&&this.getSharedOptions(x)||x})}removeHoverStyle(i,o,d){this._setStyle(i,d,"active",!1)}setHoverStyle(i,o,d){this._setStyle(i,d,"active",!0)}_removeDatasetHoverStyle(){const i=this._cachedMeta.dataset;i&&this._setStyle(i,void 0,"active",!1)}_setDatasetHoverStyle(){const i=this._cachedMeta.dataset;i&&this._setStyle(i,void 0,"active",!0)}_resyncElements(i){const o=this._data,d=this._cachedMeta.data;for(const[C,D,R]of this._syncList)this[C](D,R);this._syncList=[];const _=d.length,x=o.length,T=Math.min(x,_);T&&this.parse(0,T),x>_?this._insertElements(_,x-_,i):x<_&&this._removeElements(x,_-x)}_insertElements(i,o,d=!0){const _=this._cachedMeta,x=_.data,T=i+o;let C;const D=R=>{for(R.length+=o,C=R.length-1;C>=T;C--)R[C]=R[C-o]};for(D(x),C=i;C<T;++C)x[C]=new this.dataElementType;this._parsing&&D(_._parsed),this.parse(i,o),d&&this.updateElements(x,i,o,"reset")}updateElements(i,o,d,_){}_removeElements(i,o){const d=this._cachedMeta;if(this._parsing){const _=d._parsed.splice(i,o);d._stacked&&Ks(d,_)}d.data.splice(i,o)}_sync(i){if(this._parsing)this._syncList.push(i);else{const[o,d,_]=i;this[o](d,_)}this.chart._dataChanges.push([this.index,...i])}_onDataPush(){const i=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-i,i])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(i,o){o&&this._sync(["_removeElements",i,o]);const d=arguments.length-2;d&&this._sync(["_insertElements",i,d])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return(0,ke.Z)(l,"defaults",{}),(0,ke.Z)(l,"datasetElementType",null),(0,ke.Z)(l,"dataElementType",null),l})();function _m(l){const r=l.iScale,i=function gm(l,r){if(!l._cache.$bar){const i=l.getMatchingVisibleMetas(r);let o=[];for(let d=0,_=i.length;d<_;d++)o=o.concat(i[d].controller.getAllParsedValues(l));l._cache.$bar=Vc(o.sort((d,_)=>d-_))}return l._cache.$bar}(r,l.type);let d,_,x,T,o=r._length;const C=()=>{32767===x||-32768===x||(sr(T)&&(o=Math.min(o,Math.abs(x-T)||o)),T=x)};for(d=0,_=i.length;d<_;++d)x=r.getPixelForValue(i[d]),C();for(T=void 0,d=0,_=r.ticks.length;d<_;++d)x=r.getPixelForTick(d),C();return o}function oh(l,r,i,o){return Ji(l)?function Np(l,r,i,o){const d=i.parse(l[0],o),_=i.parse(l[1],o),x=Math.min(d,_),T=Math.max(d,_);let C=x,D=T;Math.abs(x)>Math.abs(T)&&(C=T,D=x),r[i.axis]=D,r._custom={barStart:C,barEnd:D,start:d,end:_,min:x,max:T}}(l,r,i,o):r[i.axis]=i.parse(l,o),r}function mo(l,r,i,o){const d=l.iScale,_=l.vScale,x=d.getLabels(),T=d===_,C=[];let D,R,V,H;for(D=i,R=i+o;D<R;++D)H=r[D],V={},V[d.axis]=T||d.parse(x[D],D),C.push(oh(H,V,_,D));return C}function Td(l){return l&&void 0!==l.barStart&&void 0!==l.barEnd}function Xe(l,r,i,o){let d=r.borderSkipped;const _={};if(!d)return void(l.borderSkipped=_);if(!0===d)return void(l.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:x,end:T,reverse:C,top:D,bottom:R}=function bn(l){let r,i,o,d,_;return l.horizontal?(r=l.base>l.x,i="left",o="right"):(r=l.base<l.y,i="bottom",o="top"),r?(d="end",_="start"):(d="start",_="end"),{start:i,end:o,reverse:r,top:d,bottom:_}}(l);"middle"===d&&i&&(l.enableBorderRadius=!0,(i._top||0)===o?d=D:(i._bottom||0)===o?d=R:(_[Dr(R,x,T,C)]=!0,d=D)),_[Dr(d,x,T,C)]=!0,l.borderSkipped=_}function Dr(l,r,i,o){return o?(l=function Tu(l,r,i){return l===r?i:l===i?r:l}(l,r,i),l=As(l,i,r)):l=As(l,r,i),l}function As(l,r,i){return"start"===l?r:"end"===l?i:l}function Vp(l,{inflateAmount:r},i){l.inflateAmount="auto"===r?1===i?.33:0:r}let jp=(()=>{class l extends Fs{parsePrimitiveData(i,o,d,_){return mo(i,o,d,_)}parseArrayData(i,o,d,_){return mo(i,o,d,_)}parseObjectData(i,o,d,_){const{iScale:x,vScale:T}=i,{xAxisKey:C="x",yAxisKey:D="y"}=this._parsing,R="x"===x.axis?C:D,V="x"===T.axis?C:D,H=[];let K,ct,gt,_t;for(K=d,ct=d+_;K<ct;++K)_t=o[K],gt={},gt[x.axis]=x.parse(Ws(_t,R),K),H.push(oh(Ws(_t,V),gt,T,K));return H}updateRangeFromParsed(i,o,d,_){super.updateRangeFromParsed(i,o,d,_);const x=d._custom;x&&o===this._cachedMeta.vScale&&(i.min=Math.min(i.min,x.min),i.max=Math.max(i.max,x.max))}getMaxOverflow(){return 0}getLabelAndValue(i){const o=this._cachedMeta,{iScale:d,vScale:_}=o,x=this.getParsed(i),T=x._custom,C=Td(T)?"["+T.start+", "+T.end+"]":""+_.getLabelForValue(x[_.axis]);return{label:""+d.getLabelForValue(x[d.axis]),value:C}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(i){const o=this._cachedMeta;this.updateElements(o.data,0,o.data.length,i)}updateElements(i,o,d,_){const x="reset"===_,{index:T,_cachedMeta:{vScale:C}}=this,D=C.getBasePixel(),R=C.isHorizontal(),V=this._getRuler(),{sharedOptions:H,includeOptions:K}=this._getSharedOptions(o,_);for(let ct=o;ct<o+d;ct++){const gt=this.getParsed(ct),_t=x||Ci(gt[C.axis])?{base:D,head:D}:this._calculateBarValuePixels(ct),Xt=this._calculateBarIndexPixels(ct,V),$t=(gt._stacks||{})[C.axis],me={horizontal:R,base:_t.base,enableBorderRadius:!$t||Td(gt._custom)||T===$t._top||T===$t._bottom,x:R?_t.head:Xt.center,y:R?Xt.center:_t.head,height:R?Xt.size:Math.abs(_t.size),width:R?Math.abs(_t.size):Xt.size};K&&(me.options=H||this.resolveDataElementOptions(ct,i[ct].active?"active":_));const ge=me.options||i[ct].options;Xe(me,ge,$t,T),Vp(me,ge,V.ratio),this.updateElement(i[ct],ct,me,_)}}_getStacks(i,o){const{iScale:d}=this._cachedMeta,_=d.getMatchingVisibleMetas(this._type).filter(D=>D.controller.options.grouped),x=d.options.stacked,T=[],C=D=>{const R=D.controller.getParsed(o),V=R&&R[D.vScale.axis];if(Ci(V)||isNaN(V))return!0};for(const D of _)if((void 0===o||!C(D))&&((!1===x||-1===T.indexOf(D.stack)||void 0===x&&void 0===D.stack)&&T.push(D.stack),D.index===i))break;return T.length||T.push(void 0),T}_getStackCount(i){return this._getStacks(void 0,i).length}_getStackIndex(i,o,d){const _=this._getStacks(i,d),x=void 0!==o?_.indexOf(o):-1;return-1===x?_.length-1:x}_getRuler(){const i=this.options,o=this._cachedMeta,d=o.iScale,_=[];let x,T;for(x=0,T=o.data.length;x<T;++x)_.push(d.getPixelForValue(this.getParsed(x)[d.axis],x));const C=i.barThickness;return{min:C||_m(o),pixels:_,start:d._startPixel,end:d._endPixel,stackCount:this._getStackCount(),scale:d,grouped:i.grouped,ratio:C?1:i.categoryPercentage*i.barPercentage}}_calculateBarValuePixels(i){const{_cachedMeta:{vScale:o,_stacked:d,index:_},options:{base:x,minBarLength:T}}=this,C=x||0,D=this.getParsed(i),R=D._custom,V=Td(R);let gt,_t,H=D[o.axis],K=0,ct=d?this.applyStack(o,D,d):H;ct!==H&&(K=ct-H,ct=H),V&&(H=R.barStart,ct=R.barEnd-R.barStart,0!==H&&Hn(H)!==Hn(R.barEnd)&&(K=0),K+=H);const Xt=Ci(x)||V?K:x;let $t=o.getPixelForValue(Xt);if(gt=this.chart.getDataVisibility(i)?o.getPixelForValue(K+ct):$t,_t=gt-$t,Math.abs(_t)<T){_t=function vm(l,r,i){return 0!==l?Hn(l):(r.isHorizontal()?1:-1)*(r.min>=i?1:-1)}(_t,o,C)*T,H===C&&($t-=_t/2);const me=o.getPixelForDecimal(0),ge=o.getPixelForDecimal(1),ce=Math.min(me,ge),_e=Math.max(me,ge);$t=Math.max(Math.min($t,_e),ce),gt=$t+_t,d&&!V&&(D._stacks[o.axis]._visualValues[_]=o.getValueForPixel(gt)-o.getValueForPixel($t))}if($t===o.getPixelForValue(C)){const me=Hn(_t)*o.getLineWidthForValue(C)/2;$t+=me,_t-=me}return{size:_t,base:$t,head:gt,center:gt+_t/2}}_calculateBarIndexPixels(i,o){const d=o.scale,_=this.options,x=_.skipNull,T=oi(_.maxBarThickness,1/0);let C,D;if(o.grouped){const R=x?this._getStackCount(i):o.stackCount,V="flex"===_.barThickness?function xm(l,r,i,o){const d=r.pixels,_=d[l];let x=l>0?d[l-1]:null,T=l<d.length-1?d[l+1]:null;const C=i.categoryPercentage;null===x&&(x=_-(null===T?r.end-r.start:T-_)),null===T&&(T=_+_-x);const D=_-(_-Math.min(x,T))/2*C;return{chunk:Math.abs(T-x)/2*C/o,ratio:i.barPercentage,start:D}}(i,o,_,R):function ym(l,r,i,o){const d=i.barThickness;let _,x;return Ci(d)?(_=r.min*i.categoryPercentage,x=i.barPercentage):(_=d*o,x=1),{chunk:_/o,ratio:x,start:r.pixels[l]-_/2}}(i,o,_,R),H=this._getStackIndex(this.index,this._cachedMeta.stack,x?i:void 0);C=V.start+V.chunk*H+V.chunk/2,D=Math.min(T,V.chunk*V.ratio)}else C=d.getPixelForValue(this.getParsed(i)[d.axis],i),D=Math.min(T,o.min*o.ratio);return{base:C-D/2,head:C+D/2,center:C,size:D}}draw(){const i=this._cachedMeta,o=i.vScale,d=i.data,_=d.length;let x=0;for(;x<_;++x)null!==this.getParsed(x)[o.axis]&&d[x].draw(this._ctx)}}return(0,ke.Z)(l,"id","bar"),(0,ke.Z)(l,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),(0,ke.Z)(l,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}}),l})(),Vo=(()=>{class l extends Fs{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(i,o,d,_){const x=super.parsePrimitiveData(i,o,d,_);for(let T=0;T<x.length;T++)x[T]._custom=this.resolveDataElementOptions(T+d).radius;return x}parseArrayData(i,o,d,_){const x=super.parseArrayData(i,o,d,_);for(let T=0;T<x.length;T++)x[T]._custom=oi(o[d+T][2],this.resolveDataElementOptions(T+d).radius);return x}parseObjectData(i,o,d,_){const x=super.parseObjectData(i,o,d,_);for(let T=0;T<x.length;T++){const C=o[d+T];x[T]._custom=oi(C&&C.r&&+C.r,this.resolveDataElementOptions(T+d).radius)}return x}getMaxOverflow(){const i=this._cachedMeta.data;let o=0;for(let d=i.length-1;d>=0;--d)o=Math.max(o,i[d].size(this.resolveDataElementOptions(d))/2);return o>0&&o}getLabelAndValue(i){const o=this._cachedMeta,d=this.chart.data.labels||[],{xScale:_,yScale:x}=o,T=this.getParsed(i),C=_.getLabelForValue(T.x),D=x.getLabelForValue(T.y),R=T._custom;return{label:d[i]||"",value:"("+C+", "+D+(R?", "+R:"")+")"}}update(i){const o=this._cachedMeta.data;this.updateElements(o,0,o.length,i)}updateElements(i,o,d,_){const x="reset"===_,{iScale:T,vScale:C}=this._cachedMeta,{sharedOptions:D,includeOptions:R}=this._getSharedOptions(o,_),V=T.axis,H=C.axis;for(let K=o;K<o+d;K++){const ct=i[K],gt=!x&&this.getParsed(K),_t={},Xt=_t[V]=x?T.getPixelForDecimal(.5):T.getPixelForValue(gt[V]),$t=_t[H]=x?C.getBasePixel():C.getPixelForValue(gt[H]);_t.skip=isNaN(Xt)||isNaN($t),R&&(_t.options=D||this.resolveDataElementOptions(K,ct.active?"active":_),x&&(_t.options.radius=0)),this.updateElement(ct,K,_t,_)}}resolveDataElementOptions(i,o){const d=this.getParsed(i);let _=super.resolveDataElementOptions(i,o);_.$shared&&(_=Object.assign({},_,{$shared:!1}));const x=_.radius;return"active"!==o&&(_.radius=0),_.radius+=oi(d&&d._custom,x),_}}return(0,ke.Z)(l,"id","bubble"),(0,ke.Z)(l,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),(0,ke.Z)(l,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}}),l})(),Pr=(()=>{class l extends Fs{constructor(i,o){super(i,o),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(i,o){const d=this.getDataset().data,_=this._cachedMeta;if(!1===this._parsing)_._parsed=d;else{let T,C,x=D=>+d[D];if(di(d[i])){const{key:D="value"}=this._parsing;x=R=>+Ws(d[R],D)}for(T=i,C=i+o;T<C;++T)_._parsed[T]=x(T)}}_getRotation(){return Qn(this.options.rotation-90)}_getCircumference(){return Qn(this.options.circumference)}_getRotationExtents(){let i=tn,o=-tn;for(let d=0;d<this.chart.data.datasets.length;++d)if(this.chart.isDatasetVisible(d)&&this.chart.getDatasetMeta(d).type===this._type){const _=this.chart.getDatasetMeta(d).controller,x=_._getRotation(),T=_._getCircumference();i=Math.min(i,x),o=Math.max(o,x+T)}return{rotation:i,circumference:o-i}}update(i){const o=this.chart,{chartArea:d}=o,_=this._cachedMeta,x=_.data,T=this.getMaxBorderWidth()+this.getMaxOffset(x)+this.options.spacing,C=Math.max((Math.min(d.width,d.height)-T)/2,0),D=Math.min(((l,r)=>"string"==typeof l&&l.endsWith("%")?parseFloat(l)/100:+l/r)(this.options.cutout,C),1),R=this._getRingWeight(this.index),{circumference:V,rotation:H}=this._getRotationExtents(),{ratioX:K,ratioY:ct,offsetX:gt,offsetY:_t}=function Sd(l,r,i){let o=1,d=1,_=0,x=0;if(r<tn){const T=l,C=T+r,D=Math.cos(T),R=Math.sin(T),V=Math.cos(C),H=Math.sin(C),K=(me,ge,ce)=>zo(me,T,C,!0)?1:Math.max(ge,ge*i,ce,ce*i),ct=(me,ge,ce)=>zo(me,T,C,!0)?-1:Math.min(ge,ge*i,ce,ce*i),gt=K(0,D,V),_t=K($i,R,H),Xt=ct(Qi,D,V),$t=ct(Qi+$i,R,H);o=(gt-Xt)/2,d=(_t-$t)/2,_=-(gt+Xt)/2,x=-(_t+$t)/2}return{ratioX:o,ratioY:d,offsetX:_,offsetY:x}}(H,V,D),me=Math.max(Math.min((d.width-T)/K,(d.height-T)/ct)/2,0),ge=Nl(this.options.radius,me),_e=(ge-Math.max(ge*D,0))/this._getVisibleDatasetWeightTotal();this.offsetX=gt*ge,this.offsetY=_t*ge,_.total=this.calculateTotal(),this.outerRadius=ge-_e*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-_e*R,0),this.updateElements(x,0,x.length,i)}_circumference(i,o){const d=this.options,_=this._cachedMeta,x=this._getCircumference();return o&&d.animation.animateRotate||!this.chart.getDataVisibility(i)||null===_._parsed[i]||_.data[i].hidden?0:this.calculateCircumference(_._parsed[i]*x/tn)}updateElements(i,o,d,_){const x="reset"===_,T=this.chart,C=T.chartArea,V=(C.left+C.right)/2,H=(C.top+C.bottom)/2,K=x&&T.options.animation.animateScale,ct=K?0:this.innerRadius,gt=K?0:this.outerRadius,{sharedOptions:_t,includeOptions:Xt}=this._getSharedOptions(o,_);let me,$t=this._getRotation();for(me=0;me<o;++me)$t+=this._circumference(me,x);for(me=o;me<o+d;++me){const ge=this._circumference(me,x),ce=i[me],_e={x:V+this.offsetX,y:H+this.offsetY,startAngle:$t,endAngle:$t+ge,circumference:ge,outerRadius:gt,innerRadius:ct};Xt&&(_e.options=_t||this.resolveDataElementOptions(me,ce.active?"active":_)),$t+=ge,this.updateElement(ce,me,_e,_)}}calculateTotal(){const i=this._cachedMeta,o=i.data;let _,d=0;for(_=0;_<o.length;_++){const x=i._parsed[_];null!==x&&!isNaN(x)&&this.chart.getDataVisibility(_)&&!o[_].hidden&&(d+=Math.abs(x))}return d}calculateCircumference(i){const o=this._cachedMeta.total;return o>0&&!isNaN(i)?tn*(Math.abs(i)/o):0}getLabelAndValue(i){const d=this.chart,_=d.data.labels||[],x=De(this._cachedMeta._parsed[i],d.options.locale);return{label:_[i]||"",value:x}}getMaxBorderWidth(i){let o=0;const d=this.chart;let _,x,T,C,D;if(!i)for(_=0,x=d.data.datasets.length;_<x;++_)if(d.isDatasetVisible(_)){T=d.getDatasetMeta(_),i=T.data,C=T.controller;break}if(!i)return 0;for(_=0,x=i.length;_<x;++_)D=C.resolveDataElementOptions(_),"inner"!==D.borderAlign&&(o=Math.max(o,D.borderWidth||0,D.hoverBorderWidth||0));return o}getMaxOffset(i){let o=0;for(let d=0,_=i.length;d<_;++d){const x=this.resolveDataElementOptions(d);o=Math.max(o,x.offset||0,x.hoverOffset||0)}return o}_getRingWeightOffset(i){let o=0;for(let d=0;d<i;++d)this.chart.isDatasetVisible(d)&&(o+=this._getRingWeight(d));return o}_getRingWeight(i){return Math.max(oi(this.chart.data.datasets[i].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return(0,ke.Z)(l,"id","doughnut"),(0,ke.Z)(l,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),(0,ke.Z)(l,"descriptors",{_scriptable:r=>"spacing"!==r,_indexable:r=>"spacing"!==r&&!r.startsWith("borderDash")&&!r.startsWith("hoverBorderDash")}),(0,ke.Z)(l,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(r){const i=r.data;if(i.labels.length&&i.datasets.length){const{labels:{pointStyle:o,color:d}}=r.legend.options;return i.labels.map((_,x)=>{const C=r.getDatasetMeta(0).controller.getStyle(x);return{text:_,fillStyle:C.backgroundColor,strokeStyle:C.borderColor,fontColor:d,lineWidth:C.borderWidth,pointStyle:o,hidden:!r.getDataVisibility(x),index:x}})}return[]}},onClick(r,i,o){o.chart.toggleDataVisibility(i.index),o.chart.update()}}}}),l})(),rh=(()=>{class l extends Fs{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(i){const o=this._cachedMeta,{dataset:d,data:_=[],_dataset:x}=o,T=this.chart._animationsDisabled;let{start:C,count:D}=qc(o,_,T);this._drawStart=C,this._drawCount=D,Hc(o)&&(C=0,D=_.length),d._chart=this.chart,d._datasetIndex=this.index,d._decimated=!!x._decimated,d.points=_;const R=this.resolveDatasetElementOptions(i);this.options.showLine||(R.borderWidth=0),R.segment=this.options.segment,this.updateElement(d,void 0,{animated:!T,options:R},i),this.updateElements(_,C,D,i)}updateElements(i,o,d,_){const x="reset"===_,{iScale:T,vScale:C,_stacked:D,_dataset:R}=this._cachedMeta,{sharedOptions:V,includeOptions:H}=this._getSharedOptions(o,_),K=T.axis,ct=C.axis,{spanGaps:gt,segment:_t}=this.options,Xt=Un(gt)?gt:Number.POSITIVE_INFINITY,$t=this.chart._animationsDisabled||x||"none"===_,me=o+d,ge=i.length;let ce=o>0&&this.getParsed(o-1);for(let _e=0;_e<ge;++_e){const Ve=i[_e],Pe=$t?Ve:{};if(_e<o||_e>=me){Pe.skip=!0;continue}const qe=this.getParsed(_e),yi=Ci(qe[ct]),li=Pe[K]=T.getPixelForValue(qe[K],_e),Ai=Pe[ct]=x||yi?C.getBasePixel():C.getPixelForValue(D?this.applyStack(C,qe,D):qe[ct],_e);Pe.skip=isNaN(li)||isNaN(Ai)||yi,Pe.stop=_e>0&&Math.abs(qe[K]-ce[K])>Xt,_t&&(Pe.parsed=qe,Pe.raw=R.data[_e]),H&&(Pe.options=V||this.resolveDataElementOptions(_e,Ve.active?"active":_)),$t||this.updateElement(Ve,_e,Pe,_),ce=qe}}getMaxOverflow(){const i=this._cachedMeta,o=i.dataset,d=o.options&&o.options.borderWidth||0,_=i.data||[];if(!_.length)return d;const x=_[0].size(this.resolveDataElementOptions(0)),T=_[_.length-1].size(this.resolveDataElementOptions(_.length-1));return Math.max(d,x,T)/2}draw(){const i=this._cachedMeta;i.dataset.updateControlPoints(this.chart.chartArea,i.iScale.axis),super.draw()}}return(0,ke.Z)(l,"id","line"),(0,ke.Z)(l,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),(0,ke.Z)(l,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}}),l})(),va=(()=>{class l extends Fs{constructor(i,o){super(i,o),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(i){const d=this.chart,_=d.data.labels||[],x=De(this._cachedMeta._parsed[i].r,d.options.locale);return{label:_[i]||"",value:x}}parseObjectData(i,o,d,_){return ne.bind(this)(i,o,d,_)}update(i){const o=this._cachedMeta.data;this._updateRadius(),this.updateElements(o,0,o.length,i)}getMinMax(){const o={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return this._cachedMeta.data.forEach((d,_)=>{const x=this.getParsed(_).r;!isNaN(x)&&this.chart.getDataVisibility(_)&&(x<o.min&&(o.min=x),x>o.max&&(o.max=x))}),o}_updateRadius(){const i=this.chart,o=i.chartArea,d=i.options,_=Math.min(o.right-o.left,o.bottom-o.top),x=Math.max(_/2,0),C=(x-Math.max(d.cutoutPercentage?x/100*d.cutoutPercentage:1,0))/i.getVisibleDatasetCount();this.outerRadius=x-C*this.index,this.innerRadius=this.outerRadius-C}updateElements(i,o,d,_){const x="reset"===_,T=this.chart,D=T.options.animation,R=this._cachedMeta.rScale,V=R.xCenter,H=R.yCenter,K=R.getIndexAngle(0)-.5*Qi;let gt,ct=K;const _t=360/this.countVisibleElements();for(gt=0;gt<o;++gt)ct+=this._computeAngle(gt,_,_t);for(gt=o;gt<o+d;gt++){const Xt=i[gt];let $t=ct,me=ct+this._computeAngle(gt,_,_t),ge=T.getDataVisibility(gt)?R.getDistanceFromCenterForValue(this.getParsed(gt).r):0;ct=me,x&&(D.animateScale&&(ge=0),D.animateRotate&&($t=me=K));const ce={x:V,y:H,innerRadius:0,outerRadius:ge,startAngle:$t,endAngle:me,options:this.resolveDataElementOptions(gt,Xt.active?"active":_)};this.updateElement(Xt,gt,ce,_)}}countVisibleElements(){let o=0;return this._cachedMeta.data.forEach((d,_)=>{!isNaN(this.getParsed(_).r)&&this.chart.getDataVisibility(_)&&o++}),o}_computeAngle(i,o,d){return this.chart.getDataVisibility(i)?Qn(this.resolveDataElementOptions(i,o).angle||d):0}}return(0,ke.Z)(l,"id","polarArea"),(0,ke.Z)(l,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),(0,ke.Z)(l,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(r){const i=r.data;if(i.labels.length&&i.datasets.length){const{labels:{pointStyle:o,color:d}}=r.legend.options;return i.labels.map((_,x)=>{const C=r.getDatasetMeta(0).controller.getStyle(x);return{text:_,fillStyle:C.backgroundColor,strokeStyle:C.borderColor,fontColor:d,lineWidth:C.borderWidth,pointStyle:o,hidden:!r.getDataVisibility(x),index:x}})}return[]}},onClick(r,i,o){o.chart.toggleDataVisibility(i.index),o.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}}),l})();var Gp=Object.freeze({__proto__:null,BarController:jp,BubbleController:Vo,DoughnutController:Pr,LineController:rh,PieController:(()=>{class l extends Pr{}return(0,ke.Z)(l,"id","pie"),(0,ke.Z)(l,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"}),l})(),PolarAreaController:va,RadarController:(()=>{class l extends Fs{getLabelAndValue(i){const o=this._cachedMeta.vScale,d=this.getParsed(i);return{label:o.getLabels()[i],value:""+o.getLabelForValue(d[o.axis])}}parseObjectData(i,o,d,_){return ne.bind(this)(i,o,d,_)}update(i){const o=this._cachedMeta,d=o.dataset,_=o.data||[],x=o.iScale.getLabels();if(d.points=_,"resize"!==i){const T=this.resolveDatasetElementOptions(i);this.options.showLine||(T.borderWidth=0),this.updateElement(d,void 0,{_loop:!0,_fullLoop:x.length===_.length,options:T},i)}this.updateElements(_,0,_.length,i)}updateElements(i,o,d,_){const x=this._cachedMeta.rScale,T="reset"===_;for(let C=o;C<o+d;C++){const D=i[C],R=this.resolveDataElementOptions(C,D.active?"active":_),V=x.getPointPositionForValue(C,this.getParsed(C).r),H=T?x.xCenter:V.x,K=T?x.yCenter:V.y,ct={x:H,y:K,angle:V.angle,skip:isNaN(H)||isNaN(K),options:R};this.updateElement(D,C,ct,_)}}}return(0,ke.Z)(l,"id","radar"),(0,ke.Z)(l,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),(0,ke.Z)(l,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}}),l})(),ScatterController:(()=>{class l extends Fs{getLabelAndValue(i){const o=this._cachedMeta,d=this.chart.data.labels||[],{xScale:_,yScale:x}=o,T=this.getParsed(i),C=_.getLabelForValue(T.x),D=x.getLabelForValue(T.y);return{label:d[i]||"",value:"("+C+", "+D+")"}}update(i){const o=this._cachedMeta,{data:d=[]}=o,_=this.chart._animationsDisabled;let{start:x,count:T}=qc(o,d,_);if(this._drawStart=x,this._drawCount=T,Hc(o)&&(x=0,T=d.length),this.options.showLine){const{dataset:C,_dataset:D}=o;C._chart=this.chart,C._datasetIndex=this.index,C._decimated=!!D._decimated,C.points=d;const R=this.resolveDatasetElementOptions(i);R.segment=this.options.segment,this.updateElement(C,void 0,{animated:!_,options:R},i)}this.updateElements(d,x,T,i)}addElements(){const{showLine:i}=this.options;!this.datasetElementType&&i&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(i,o,d,_){const x="reset"===_,{iScale:T,vScale:C,_stacked:D,_dataset:R}=this._cachedMeta,V=this.resolveDataElementOptions(o,_),H=this.getSharedOptions(V),K=this.includeOptions(_,H),ct=T.axis,gt=C.axis,{spanGaps:_t,segment:Xt}=this.options,$t=Un(_t)?_t:Number.POSITIVE_INFINITY,me=this.chart._animationsDisabled||x||"none"===_;let ge=o>0&&this.getParsed(o-1);for(let ce=o;ce<o+d;++ce){const _e=i[ce],Ve=this.getParsed(ce),Pe=me?_e:{},qe=Ci(Ve[gt]),yi=Pe[ct]=T.getPixelForValue(Ve[ct],ce),li=Pe[gt]=x||qe?C.getBasePixel():C.getPixelForValue(D?this.applyStack(C,Ve,D):Ve[gt],ce);Pe.skip=isNaN(yi)||isNaN(li)||qe,Pe.stop=ce>0&&Math.abs(Ve[ct]-ge[ct])>$t,Xt&&(Pe.parsed=Ve,Pe.raw=R.data[ce]),K&&(Pe.options=H||this.resolveDataElementOptions(ce,_e.active?"active":_)),me||this.updateElement(_e,ce,Pe,_),ge=Ve}this.updateSharedOptions(H,_,V)}getMaxOverflow(){const i=this._cachedMeta,o=i.data||[];if(!this.options.showLine){let C=0;for(let D=o.length-1;D>=0;--D)C=Math.max(C,o[D].size(this.resolveDataElementOptions(D))/2);return C>0&&C}const d=i.dataset,_=d.options&&d.options.borderWidth||0;if(!o.length)return _;const x=o[0].size(this.resolveDataElementOptions(0)),T=o[o.length-1].size(this.resolveDataElementOptions(o.length-1));return Math.max(_,x,T)/2}}return(0,ke.Z)(l,"id","scatter"),(0,ke.Z)(l,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),(0,ke.Z)(l,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}}),l})()});function ol(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class ah{static override(r){Object.assign(ah.prototype,r)}constructor(r){(0,ke.Z)(this,"options",void 0),this.options=r||{}}init(){}formats(){return ol()}parse(){return ol()}format(){return ol()}add(){return ol()}diff(){return ol()}startOf(){return ol()}endOf(){return ol()}}var qp__date=ah;function lh(l,r,i,o){const{controller:d,data:_,_sorted:x}=l,T=d._cachedMeta.iScale;if(T&&r===T.axis&&"r"!==r&&x&&_.length){const C=T._reversePixels?Uc:Bs;if(!o)return C(_,r,i);if(d._sharedOptions){const D=_[0],R="function"==typeof D.getRange&&D.getRange(r);if(R){const V=C(_,r,i-R),H=C(_,r,i+R);return{lo:V.lo,hi:H.hi}}}}return{lo:0,hi:_.length-1}}function hr(l,r,i,o,d){const _=l.getSortedVisibleDatasetMetas(),x=i[r];for(let T=0,C=_.length;T<C;++T){const{index:D,data:R}=_[T],{lo:V,hi:H}=lh(_[T],r,x,d);for(let K=V;K<=H;++K){const ct=R[K];ct.skip||o(ct,D,K)}}}function ch(l,r,i,o,d){const _=[];return!d&&!l.isPointInArea(r)||hr(l,i,r,function(T,C,D){!d&&!uo(T,l.chartArea,0)||T.inRange(r.x,r.y,o)&&_.push({element:T,datasetIndex:C,index:D})},!0),_}function rl(l,r,i,o,d,_){return _||l.isPointInArea(r)?"r"!==i||o?function hh(l,r,i,o,d,_){let x=[];const T=function Ir(l){const r=-1!==l.indexOf("x"),i=-1!==l.indexOf("y");return function(o,d){const _=r?Math.abs(o.x-d.x):0,x=i?Math.abs(o.y-d.y):0;return Math.sqrt(Math.pow(_,2)+Math.pow(x,2))}}(i);let C=Number.POSITIVE_INFINITY;return hr(l,i,r,function D(R,V,H){const K=R.inRange(r.x,r.y,d);if(o&&!K)return;const ct=R.getCenterPoint(d);if(!_&&!l.isPointInArea(ct)&&!K)return;const _t=T(r,ct);_t<C?(x=[{element:R,datasetIndex:V,index:H}],C=_t):_t===C&&x.push({element:R,datasetIndex:V,index:H})}),x}(l,r,i,o,d,_):function Hp(l,r,i,o){let d=[];return hr(l,i,r,function _(x,T,C){const{startAngle:D,endAngle:R}=x.getProps(["startAngle","endAngle"],o),{angle:V}=Xa(x,{x:r.x,y:r.y});zo(V,D,R)&&d.push({element:x,datasetIndex:T,index:C})}),d}(l,r,i,d):[]}function Us(l,r,i,o,d){const _=[],x="x"===i?"inXRange":"inYRange";let T=!1;return hr(l,i,r,(C,D,R)=>{C[x](r[i],d)&&(_.push({element:C,datasetIndex:D,index:R}),T=T||C.inRange(r.x,r.y,d))}),o&&!T?[]:_}var uh={evaluateInteractionItems:hr,modes:{index(l,r,i,o){const d=ts(r,l),_=i.axis||"x",x=i.includeInvisible||!1,T=i.intersect?ch(l,d,_,o,x):rl(l,d,_,!1,o,x),C=[];return T.length?(l.getSortedVisibleDatasetMetas().forEach(D=>{const R=T[0].index,V=D.data[R];V&&!V.skip&&C.push({element:V,datasetIndex:D.index,index:R})}),C):[]},dataset(l,r,i,o){const d=ts(r,l),_=i.axis||"xy",x=i.includeInvisible||!1;let T=i.intersect?ch(l,d,_,o,x):rl(l,d,_,!1,o,x);if(T.length>0){const C=T[0].datasetIndex,D=l.getDatasetMeta(C).data;T=[];for(let R=0;R<D.length;++R)T.push({element:D[R],datasetIndex:C,index:R})}return T},point:(l,r,i,o)=>ch(l,ts(r,l),i.axis||"xy",o,i.includeInvisible||!1),nearest:(l,r,i,o)=>rl(l,ts(r,l),i.axis||"xy",i.intersect,o,i.includeInvisible||!1),x:(l,r,i,o)=>Us(l,ts(r,l),"x",i.intersect,o),y:(l,r,i,o)=>Us(l,ts(r,l),"y",i.intersect,o)}};const es=["left","top","right","bottom"];function ps(l,r){return l.filter(i=>i.pos===r)}function Su(l,r){return l.filter(i=>-1===es.indexOf(i.pos)&&i.box.axis===r)}function en(l,r){return l.sort((i,o)=>{const d=r?o:i,_=r?i:o;return d.weight===_.weight?d.index-_.index:d.weight-_.weight})}function Wp(l,r,i,o){return Math.max(l[i],r[i])+Math.max(l[o],r[o])}function Md(l,r){l.top=Math.max(l.top,r.top),l.left=Math.max(l.left,r.left),l.bottom=Math.max(l.bottom,r.bottom),l.right=Math.max(l.right,r.right)}function Xp(l,r,i,o){const{pos:d,box:_}=i,x=l.maxPadding;if(!di(d)){i.size&&(l[d]-=i.size);const V=o[i.stack]||{size:0,count:1};V.size=Math.max(V.size,i.horizontal?_.height:_.width),i.size=V.size/V.count,l[d]+=i.size}_.getPadding&&Md(x,_.getPadding());const T=Math.max(0,r.outerWidth-Wp(x,l,"left","right")),C=Math.max(0,r.outerHeight-Wp(x,l,"top","bottom")),D=T!==l.w,R=C!==l.h;return l.w=T,l.h=C,i.horizontal?{same:D,other:R}:{same:R,other:D}}function Yp(l,r){const i=r.maxPadding;return function o(d){const _={left:0,top:0,right:0,bottom:0};return d.forEach(x=>{_[x]=Math.max(r[x],i[x])}),_}(l?["left","right"]:["top","bottom"])}function sc(l,r,i,o){const d=[];let _,x,T,C,D,R;for(_=0,x=l.length,D=0;_<x;++_){T=l[_],C=T.box,C.update(T.width||r.w,T.height||r.h,Yp(T.horizontal,r));const{same:V,other:H}=Xp(r,i,T,o);D|=V&&d.length,R=R||H,C.fullSize||d.push(T)}return D&&sc(d,r,i,o)||R}function ph(l,r,i,o,d){l.top=i,l.left=r,l.right=r+o,l.bottom=i+d,l.width=o,l.height=d}function Ed(l,r,i,o){const d=i.padding;let{x:_,y:x}=r;for(const T of l){const C=T.box,D=o[T.stack]||{count:1,placed:0,weight:1},R=T.stackWeight/D.weight||1;if(T.horizontal){const V=r.w*R,H=D.size||C.height;sr(D.start)&&(x=D.start),C.fullSize?ph(C,d.left,x,i.outerWidth-d.right-d.left,H):ph(C,r.left+D.placed,x,V,H),D.start=x,D.placed+=V,x=C.bottom}else{const V=r.h*R,H=D.size||C.width;sr(D.start)&&(_=D.start),C.fullSize?ph(C,_,d.top,H,i.outerHeight-d.bottom-d.top):ph(C,_,r.top+D.placed,H,V),D.start=_,D.placed+=V,_=C.right}}r.x=_,r.y=x}var fs={addBox(l,r){l.boxes||(l.boxes=[]),r.fullSize=r.fullSize||!1,r.position=r.position||"top",r.weight=r.weight||0,r._layers=r._layers||function(){return[{z:0,draw(i){r.draw(i)}}]},l.boxes.push(r)},removeBox(l,r){const i=l.boxes?l.boxes.indexOf(r):-1;-1!==i&&l.boxes.splice(i,1)},configure(l,r,i){r.fullSize=i.fullSize,r.position=i.position,r.weight=i.weight},update(l,r,i,o){if(!l)return;const d=A(l.options.layout.padding),_=Math.max(r-d.width,0),x=Math.max(i-d.height,0),T=function wm(l){const r=function $p(l){const r=[];let i,o,d,_,x,T;for(i=0,o=(l||[]).length;i<o;++i)d=l[i],({position:_,options:{stack:x,stackWeight:T=1}}=d),r.push({index:i,box:d,pos:_,horizontal:d.isHorizontal(),weight:d.weight,stack:x&&_+x,stackWeight:T});return r}(l),i=en(r.filter(D=>D.box.fullSize),!0),o=en(ps(r,"left"),!0),d=en(ps(r,"right")),_=en(ps(r,"top"),!0),x=en(ps(r,"bottom")),T=Su(r,"x"),C=Su(r,"y");return{fullSize:i,leftAndTop:o.concat(_),rightAndBottom:d.concat(C).concat(x).concat(T),chartArea:ps(r,"chartArea"),vertical:o.concat(d).concat(C),horizontal:_.concat(x).concat(T)}}(l.boxes),C=T.vertical,D=T.horizontal;Li(l.boxes,gt=>{"function"==typeof gt.beforeLayout&&gt.beforeLayout()});const R=C.reduce((gt,_t)=>_t.box.options&&!1===_t.box.options.display?gt:gt+1,0)||1,V=Object.freeze({outerWidth:r,outerHeight:i,padding:d,availableWidth:_,availableHeight:x,vBoxMaxWidth:_/2/R,hBoxMaxHeight:x/2}),H=Object.assign({},d);Md(H,A(o));const K=Object.assign({maxPadding:H,w:_,h:x,x:d.left,y:d.top},d),ct=function jo(l,r){const i=function dh(l){const r={};for(const i of l){const{stack:o,pos:d,stackWeight:_}=i;if(!o||!es.includes(d))continue;const x=r[o]||(r[o]={count:0,placed:0,weight:0,size:0});x.count++,x.weight+=_}return r}(l),{vBoxMaxWidth:o,hBoxMaxHeight:d}=r;let _,x,T;for(_=0,x=l.length;_<x;++_){T=l[_];const{fullSize:C}=T.box,D=i[T.stack],R=D&&T.stackWeight/D.weight;T.horizontal?(T.width=R?R*o:C&&r.availableWidth,T.height=d):(T.width=o,T.height=R?R*d:C&&r.availableHeight)}return i}(C.concat(D),V);sc(T.fullSize,K,V,ct),sc(C,K,V,ct),sc(D,K,V,ct)&&sc(C,K,V,ct),function al(l){const r=l.maxPadding;function i(o){const d=Math.max(r[o]-l[o],0);return l[o]+=d,d}l.y+=i("top"),l.x+=i("left"),i("right"),i("bottom")}(K),Ed(T.leftAndTop,K,V,ct),K.x+=K.w,K.y+=K.h,Ed(T.rightAndBottom,K,V,ct),l.chartArea={left:K.left,top:K.top,right:K.left+K.w,bottom:K.top+K.h,height:K.h,width:K.w},Li(T.chartArea,gt=>{const _t=gt.box;Object.assign(_t,l.chartArea),_t.update(K.w,K.h,{left:0,top:0,right:0,bottom:0})})}};class Jp{acquireContext(r,i){}releaseContext(r){return!1}addEventListener(r,i,o){}removeEventListener(r,i,o){}getDevicePixelRatio(){return 1}getMaximumSize(r,i,o,d){return i=Math.max(0,i||r.width),o=o||r.height,{width:i,height:Math.max(0,d?Math.floor(i/d):o)}}isAttached(r){return!0}updateConfig(r){}}class Kp extends Jp{acquireContext(r){return r&&r.getContext&&r.getContext("2d")||null}updateConfig(r){r.options.animation=!1}}const fh="$chartjs",mh={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Cu=l=>null===l||""===l,Mu=!!$n&&{passive:!0};function ur(l,r,i){l.canvas.removeEventListener(r,i,Mu)}function ba(l,r){for(const i of l)if(i===r||i.contains(r))return!0}function go(l,r,i){const o=l.canvas,d=new MutationObserver(_=>{let x=!1;for(const T of _)x=x||ba(T.addedNodes,o),x=x&&!ba(T.removedNodes,o);x&&i()});return d.observe(document,{childList:!0,subtree:!0}),d}function _o(l,r,i){const o=l.canvas,d=new MutationObserver(_=>{let x=!1;for(const T of _)x=x||ba(T.removedNodes,o),x=x&&!ba(T.addedNodes,o);x&&i()});return d.observe(document,{childList:!0,subtree:!0}),d}const gh=new Map;let _h=0;function kd(){const l=window.devicePixelRatio;l!==_h&&(_h=l,gh.forEach((r,i)=>{i.currentDevicePixelRatio!==l&&r()}))}function dr(l,r,i){const o=l.canvas,d=o&&je(o);if(!d)return;const _=Jl((T,C)=>{const D=d.clientWidth;i(T,C),D<d.clientWidth&&i()},window),x=new ResizeObserver(T=>{const C=T[0],D=C.contentRect.width,R=C.contentRect.height;0===D&&0===R||_(D,R)});return x.observe(d),function Tm(l,r){gh.size||window.addEventListener("resize",kd),gh.set(l,r)}(l,_),x}function Lr(l,r,i){i&&i.disconnect(),"resize"===r&&function Dd(l){gh.delete(l),gh.size||window.removeEventListener("resize",kd)}(l)}function Qp(l,r,i){const o=l.canvas,d=Jl(_=>{null!==l.ctx&&i(function ll(l,r){const i=mh[l.type]||l.type,{x:o,y:d}=ts(l,r);return{type:i,chart:r,native:l,x:void 0!==o?o:null,y:void 0!==d?d:null}}(_,l))},l);return function ms(l,r,i){l.addEventListener(r,i,Mu)}(o,r,d),d}class tf extends Jp{acquireContext(r,i){const o=r&&r.getContext&&r.getContext("2d");return o&&o.canvas===r?(function Ad(l,r){const i=l.style,o=l.getAttribute("height"),d=l.getAttribute("width");if(l[fh]={initial:{height:o,width:d,style:{display:i.display,height:i.height,width:i.width}}},i.display=i.display||"block",i.boxSizing=i.boxSizing||"border-box",Cu(d)){const _=Vi(l,"width");void 0!==_&&(l.width=_)}if(Cu(o))if(""===l.style.height)l.height=l.width/(r||2);else{const _=Vi(l,"height");void 0!==_&&(l.height=_)}}(r,i),o):null}releaseContext(r){const i=r.canvas;if(!i[fh])return!1;const o=i[fh].initial;["height","width"].forEach(_=>{const x=o[_];Ci(x)?i.removeAttribute(_):i.setAttribute(_,x)});const d=o.style||{};return Object.keys(d).forEach(_=>{i.style[_]=d[_]}),i.width=i.width,delete i[fh],!0}addEventListener(r,i,o){this.removeEventListener(r,i),(r.$proxies||(r.$proxies={}))[i]=({attach:go,detach:_o,resize:dr}[i]||Qp)(r,i,o)}removeEventListener(r,i){const o=r.$proxies||(r.$proxies={}),d=o[i];d&&(({attach:Lr,detach:Lr,resize:Lr}[i]||ur)(r,i,d),o[i]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(r,i,o,d){return function wi(l,r,i,o){const d=Ei(l),_=Wi(d,"margin"),x=xi(d.maxWidth,l,"clientWidth")||$a,T=xi(d.maxHeight,l,"clientHeight")||$a,C=function Xi(l,r,i){let o,d;if(void 0===r||void 0===i){const _=je(l);if(_){const x=_.getBoundingClientRect(),T=Ei(_),C=Wi(T,"border","width"),D=Wi(T,"padding");r=x.width-D.width-C.width,i=x.height-D.height-C.height,o=xi(T.maxWidth,_,"clientWidth"),d=xi(T.maxHeight,_,"clientHeight")}else r=l.clientWidth,i=l.clientHeight}return{width:r,height:i,maxWidth:o||$a,maxHeight:d||$a}}(l,r,i);let{width:D,height:R}=C;if("content-box"===d.boxSizing){const H=Wi(d,"border","width"),K=Wi(d,"padding");D-=K.width+H.width,R-=K.height+H.height}return D=Math.max(0,D-_.width),R=Math.max(0,o?D/o:R-_.height),D=Di(Math.min(D,x,C.maxWidth)),R=Di(Math.min(R,T,C.maxHeight)),D&&!R&&(R=Di(D/2)),(void 0!==r||void 0!==i)&&o&&C.height&&R>C.height&&(R=C.height,D=Di(Math.floor(R*o))),{width:D,height:R}}(r,i,o,d)}isAttached(r){const i=je(r);return!(!i||!i.isConnected)}}class Ns{constructor(){(0,ke.Z)(this,"x",void 0),(0,ke.Z)(this,"y",void 0),(0,ke.Z)(this,"active",!1),(0,ke.Z)(this,"options",void 0),(0,ke.Z)(this,"$animations",void 0)}tooltipPosition(r){const{x:i,y:o}=this.getProps(["x","y"],r);return{x:i,y:o}}hasValue(){return Un(this.x)&&Un(this.y)}getProps(r,i){const o=this.$animations;if(!i||!o)return this;const d={};return r.forEach(_=>{d[_]=o[_]&&o[_].active()?o[_]._to:this[_]}),d}}function xh(l,r,i,o,d){const _=oi(o,0),x=Math.min(oi(d,l.length),l.length);let C,D,R,T=0;for(i=Math.ceil(i),d&&(C=d-o,i=C/Math.floor(C/i)),R=_;R<0;)T++,R=Math.round(_+T*i);for(D=Math.max(_,0);D<x;D++)D===R&&(r.push(l[D]),T++,R=Math.round(_+T*i))}(0,ke.Z)(Ns,"defaults",{}),(0,ke.Z)(Ns,"defaultRoutes",void 0);const Id=l=>"left"===l?"right":"right"===l?"left":l,Ld=(l,r,i)=>"top"===r||"left"===r?l[r]+i:l[r]-i,cl=(l,r)=>Math.min(r||l,l);function Rd(l,r){const i=[],o=l.length/r,d=l.length;let _=0;for(;_<d;_+=o)i.push(l[Math.floor(_)]);return i}function zd(l,r,i){const o=l.ticks.length,d=Math.min(r,o-1),_=l._startPixel,x=l._endPixel,T=1e-6;let D,C=l.getPixelForTick(d);if(!(i&&(D=1===o?Math.max(C-_,x-C):0===r?(l.getPixelForTick(1)-C)/2:(C-l.getPixelForTick(d-1))/2,C+=d<r?D:-D,C<_-T||C>x+T)))return C}function bh(l){return l.drawTicks?l.tickLength:0}function nf(l,r){if(!l.display)return 0;const i=P(l.font,r),o=A(l.padding);return(Ji(l.text)?l.text.length:1)*i.lineHeight+o.height}function vi(l,r,i){let o=ar(l);return(i&&"right"!==r||!i&&"right"===r)&&(o=Id(o)),o}class gs extends Ns{constructor(r){super(),this.id=r.id,this.type=r.type,this.options=void 0,this.ctx=r.ctx,this.chart=r.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(r){this.options=r.setContext(this.getContext()),this.axis=r.axis,this._userMin=this.parse(r.min),this._userMax=this.parse(r.max),this._suggestedMin=this.parse(r.suggestedMin),this._suggestedMax=this.parse(r.suggestedMax)}parse(r,i){return r}getUserBounds(){let{_userMin:r,_userMax:i,_suggestedMin:o,_suggestedMax:d}=this;return r=hs(r,Number.POSITIVE_INFINITY),i=hs(i,Number.NEGATIVE_INFINITY),o=hs(o,Number.POSITIVE_INFINITY),d=hs(d,Number.NEGATIVE_INFINITY),{min:hs(r,o),max:hs(i,d),minDefined:yn(r),maxDefined:yn(i)}}getMinMax(r){let x,{min:i,max:o,minDefined:d,maxDefined:_}=this.getUserBounds();if(d&&_)return{min:i,max:o};const T=this.getMatchingVisibleMetas();for(let C=0,D=T.length;C<D;++C)x=T[C].controller.getMinMax(this,r),d||(i=Math.min(i,x.min)),_||(o=Math.max(o,x.max));return i=_&&i>o?o:i,o=d&&i>o?i:o,{min:hs(i,hs(o,i)),max:hs(o,hs(i,o))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const r=this.chart.data;return this.options.labels||(this.isHorizontal()?r.xLabels:r.yLabels)||r.labels||[]}getLabelItems(r=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(r))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Ki(this.options.beforeUpdate,[this])}update(r,i,o){const{beginAtZero:d,grace:_,ticks:x}=this.options,T=x.sampleSize;this.beforeUpdate(),this.maxWidth=r,this.maxHeight=i,this._margins=o=Object.assign({left:0,right:0,top:0,bottom:0},o),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+o.left+o.right:this.height+o.top+o.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function O(l,r,i){const{min:o,max:d}=l,_=Nl(r,(d-o)/2),x=(T,C)=>i&&0===T?0:T+C;return{min:x(o,-Math.abs(_)),max:x(d,_)}}(this,_,d),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const C=T<this.ticks.length;this._convertTicksToLabels(C?Rd(this.ticks,T):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),x.display&&(x.autoSkip||"auto"===x.source)&&(this.ticks=function Pd(l,r){const i=l.options.ticks,o=function oc(l){const r=l.options.offset,i=l._tickSize();return Math.floor(Math.min(l._length/i+(r?0:1),l._maxLength/i))}(l),d=Math.min(i.maxTicksLimit||o,o),_=i.major.enabled?function yh(l){const r=[];let i,o;for(i=0,o=l.length;i<o;i++)l[i].major&&r.push(i);return r}(r):[],x=_.length,T=_[0],C=_[x-1],D=[];if(x>d)return function Eu(l,r,i,o){let x,d=0,_=i[0];for(o=Math.ceil(o),x=0;x<l.length;x++)x===_&&(r.push(l[x]),d++,_=i[d*o])}(r,D,_,x/d),D;const R=function rc(l,r,i){const o=function vh(l){const r=l.length;let i,o;if(r<2)return!1;for(o=l[0],i=1;i<r;++i)if(l[i]-l[i-1]!==o)return!1;return o}(l),d=r.length/i;if(!o)return Math.max(d,1);const _=function Te(l){const r=[],i=Math.sqrt(l);let o;for(o=1;o<i;o++)l%o==0&&(r.push(o),r.push(l/o));return i===(0|i)&&r.push(i),r.sort((d,_)=>d-_).pop(),r}(o);for(let x=0,T=_.length-1;x<T;x++){const C=_[x];if(C>d)return C}return Math.max(d,1)}(_,r,d);if(x>0){let V,H;const K=x>1?Math.round((C-T)/(x-1)):null;for(xh(r,D,R,Ci(K)?0:T-K,T),V=0,H=x-1;V<H;V++)xh(r,D,R,_[V],_[V+1]);return xh(r,D,R,C,Ci(K)?r.length:C+K),D}return xh(r,D,R),D}(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),C&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let i,o,r=this.options.reverse;this.isHorizontal()?(i=this.left,o=this.right):(i=this.top,o=this.bottom,r=!r),this._startPixel=i,this._endPixel=o,this._reversePixels=r,this._length=o-i,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Ki(this.options.afterUpdate,[this])}beforeSetDimensions(){Ki(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Ki(this.options.afterSetDimensions,[this])}_callHooks(r){this.chart.notifyPlugins(r,this.getContext()),Ki(this.options[r],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Ki(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(r){const i=this.options.ticks;let o,d,_;for(o=0,d=r.length;o<d;o++)_=r[o],_.label=Ki(i.callback,[_.value,o,r],this)}afterTickToLabelConversion(){Ki(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Ki(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const r=this.options,i=r.ticks,o=cl(this.ticks.length,r.ticks.maxTicksLimit),d=i.minRotation||0,_=i.maxRotation;let T,C,D,x=d;if(!this._isVisible()||!i.display||d>=_||o<=1||!this.isHorizontal())return void(this.labelRotation=d);const R=this._getLabelSizes(),V=R.widest.width,H=R.highest.height,K=Mi(this.chart.width-V,0,this.maxWidth);T=r.offset?this.maxWidth/o:K/(o-1),V+6>T&&(T=K/(o-(r.offset?.5:1)),C=this.maxHeight-bh(r.grid)-i.padding-nf(r.title,this.chart.options.font),D=Math.sqrt(V*V+H*H),x=rr(Math.min(Math.asin(Mi((R.highest.height+6)/T,-1,1)),Math.asin(Mi(C/D,-1,1))-Math.asin(Mi(H/D,-1,1)))),x=Math.max(d,Math.min(_,x))),this.labelRotation=x}afterCalculateLabelRotation(){Ki(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Ki(this.options.beforeFit,[this])}fit(){const r={width:0,height:0},{chart:i,options:{ticks:o,title:d,grid:_}}=this,x=this._isVisible(),T=this.isHorizontal();if(x){const C=nf(d,i.options.font);if(T?(r.width=this.maxWidth,r.height=bh(_)+C):(r.height=this.maxHeight,r.width=bh(_)+C),o.display&&this.ticks.length){const{first:D,last:R,widest:V,highest:H}=this._getLabelSizes(),K=2*o.padding,ct=Qn(this.labelRotation),gt=Math.cos(ct),_t=Math.sin(ct);T?r.height=Math.min(this.maxHeight,r.height+(o.mirror?0:_t*V.width+gt*H.height)+K):r.width=Math.min(this.maxWidth,r.width+(o.mirror?0:gt*V.width+_t*H.height)+K),this._calculatePadding(D,R,_t,gt)}}this._handleMargins(),T?(this.width=this._length=i.width-this._margins.left-this._margins.right,this.height=r.height):(this.width=r.width,this.height=this._length=i.height-this._margins.top-this._margins.bottom)}_calculatePadding(r,i,o,d){const{ticks:{align:_,padding:x},position:T}=this.options,C=0!==this.labelRotation,D="top"!==T&&"x"===this.axis;if(this.isHorizontal()){const R=this.getPixelForTick(0)-this.left,V=this.right-this.getPixelForTick(this.ticks.length-1);let H=0,K=0;C?D?(H=d*r.width,K=o*i.height):(H=o*r.height,K=d*i.width):"start"===_?K=i.width:"end"===_?H=r.width:"inner"!==_&&(H=r.width/2,K=i.width/2),this.paddingLeft=Math.max((H-R+x)*this.width/(this.width-R),0),this.paddingRight=Math.max((K-V+x)*this.width/(this.width-V),0)}else{let R=i.height/2,V=r.height/2;"start"===_?(R=0,V=r.height):"end"===_&&(R=i.height,V=0),this.paddingTop=R+x,this.paddingBottom=V+x}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Ki(this.options.afterFit,[this])}isHorizontal(){const{axis:r,position:i}=this.options;return"top"===i||"bottom"===i||"x"===r}isFullSize(){return this.options.fullSize}_convertTicksToLabels(r){let i,o;for(this.beforeTickToLabelConversion(),this.generateTickLabels(r),i=0,o=r.length;i<o;i++)Ci(r[i].label)&&(r.splice(i,1),o--,i--);this.afterTickToLabelConversion()}_getLabelSizes(){let r=this._labelSizes;if(!r){const i=this.options.ticks.sampleSize;let o=this.ticks;i<o.length&&(o=Rd(o,i)),this._labelSizes=r=this._computeLabelSizes(o,o.length,this.options.ticks.maxTicksLimit)}return r}_computeLabelSizes(r,i,o){const{ctx:d,_longestTextCache:_}=this,x=[],T=[],C=Math.floor(i/cl(i,o));let V,H,K,ct,gt,_t,Xt,$t,me,ge,ce,D=0,R=0;for(V=0;V<i;V+=C){if(ct=r[V].label,gt=this._resolveTickFontOptions(V),d.font=_t=gt.string,Xt=_[_t]=_[_t]||{data:{},gc:[]},$t=gt.lineHeight,me=ge=0,Ci(ct)||Ji(ct)){if(Ji(ct))for(H=0,K=ct.length;H<K;++H)ce=ct[H],!Ci(ce)&&!Ji(ce)&&(me=Cr(d,Xt.data,Xt.gc,me,ce),ge+=$t)}else me=Cr(d,Xt.data,Xt.gc,me,ct),ge=$t;x.push(me),T.push(ge),D=Math.max(me,D),R=Math.max(ge,R)}!function ef(l,r){Li(l,i=>{const o=i.gc,d=o.length/2;let _;if(d>r){for(_=0;_<d;++_)delete i.data[o[_]];o.splice(0,d)}})}(_,i);const _e=x.indexOf(D),Ve=T.indexOf(R),Pe=qe=>({width:x[qe]||0,height:T[qe]||0});return{first:Pe(0),last:Pe(i-1),widest:Pe(_e),highest:Pe(Ve),widths:x,heights:T}}getLabelForValue(r){return r}getPixelForValue(r,i){return NaN}getValueForPixel(r){}getPixelForTick(r){const i=this.ticks;return r<0||r>i.length-1?null:this.getPixelForValue(i[r].value)}getPixelForDecimal(r){this._reversePixels&&(r=1-r);const i=this._startPixel+r*this._length;return function $l(l){return Mi(l,-32768,32767)}(this._alignToPixels?ho(this.chart,i,0):i)}getDecimalForPixel(r){const i=(r-this._startPixel)/this._length;return this._reversePixels?1-i:i}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:r,max:i}=this;return r<0&&i<0?i:r>0&&i>0?r:0}getContext(r){const i=this.ticks||[];if(r>=0&&r<i.length){const o=i[r];return o.$context||(o.$context=function sf(l,r,i){return U(l,{tick:i,index:r,type:"tick"})}(this.getContext(),r,o))}return this.$context||(this.$context=function wh(l,r){return U(l,{scale:r,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const r=this.options.ticks,i=Qn(this.labelRotation),o=Math.abs(Math.cos(i)),d=Math.abs(Math.sin(i)),_=this._getLabelSizes(),x=r.autoSkipPadding||0,T=_?_.widest.width+x:0,C=_?_.highest.height+x:0;return this.isHorizontal()?C*o>T*d?T/o:C/d:C*d<T*o?C/o:T/d}_isVisible(){const r=this.options.display;return"auto"!==r?!!r:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(r){const i=this.axis,o=this.chart,d=this.options,{grid:_,position:x,border:T}=d,C=_.offset,D=this.isHorizontal(),V=this.ticks.length+(C?1:0),H=bh(_),K=[],ct=T.setContext(this.getContext()),gt=ct.display?ct.width:0,_t=gt/2,Xt=function(Ri){return ho(o,Ri,gt)};let $t,me,ge,ce,_e,Ve,Pe,qe,yi,li,Ai,Mn;if("top"===x)$t=Xt(this.bottom),Ve=this.bottom-H,qe=$t-_t,li=Xt(r.top)+_t,Mn=r.bottom;else if("bottom"===x)$t=Xt(this.top),li=r.top,Mn=Xt(r.bottom)-_t,Ve=$t+_t,qe=this.top+H;else if("left"===x)$t=Xt(this.right),_e=this.right-H,Pe=$t-_t,yi=Xt(r.left)+_t,Ai=r.right;else if("right"===x)$t=Xt(this.left),yi=r.left,Ai=Xt(r.right)-_t,_e=$t+_t,Pe=this.left+H;else if("x"===i){if("center"===x)$t=Xt((r.top+r.bottom)/2+.5);else if(di(x)){const Ri=Object.keys(x)[0];$t=Xt(this.chart.scales[Ri].getPixelForValue(x[Ri]))}li=r.top,Mn=r.bottom,Ve=$t+_t,qe=Ve+H}else if("y"===i){if("center"===x)$t=Xt((r.left+r.right)/2);else if(di(x)){const Ri=Object.keys(x)[0];$t=Xt(this.chart.scales[Ri].getPixelForValue(x[Ri]))}_e=$t-_t,Pe=_e-H,yi=r.left,Ai=r.right}const Ds=oi(d.ticks.maxTicksLimit,V),qi=Math.max(1,Math.ceil(V/Ds));for(me=0;me<V;me+=qi){const Ri=this.getContext(me),Tn=_.setContext(Ri),no=T.setContext(Ri),dn=Tn.lineWidth,xo=Tn.color,Wh=no.dash||[],xl=no.dashOffset,Nr=Tn.tickWidth,Aa=Tn.tickColor,vc=Tn.tickBorderDash||[],bc=Tn.tickBorderDashOffset;ge=zd(this,me,C),void 0!==ge&&(ce=ho(o,ge,dn),D?_e=Pe=yi=Ai=ce:Ve=qe=li=Mn=ce,K.push({tx1:_e,ty1:Ve,tx2:Pe,ty2:qe,x1:yi,y1:li,x2:Ai,y2:Mn,width:dn,color:xo,borderDash:Wh,borderDashOffset:xl,tickWidth:Nr,tickColor:Aa,tickBorderDash:vc,tickBorderDashOffset:bc}))}return this._ticksLength=V,this._borderValue=$t,K}_computeLabelItems(r){const i=this.axis,o=this.options,{position:d,ticks:_}=o,x=this.isHorizontal(),T=this.ticks,{align:C,crossAlign:D,padding:R,mirror:V}=_,H=bh(o.grid),K=H+R,ct=V?-R:K,gt=-Qn(this.labelRotation),_t=[];let Xt,$t,me,ge,ce,_e,Ve,Pe,qe,yi,li,Ai,Mn="middle";if("top"===d)_e=this.bottom-ct,Ve=this._getXAxisLabelAlignment();else if("bottom"===d)_e=this.top+ct,Ve=this._getXAxisLabelAlignment();else if("left"===d){const qi=this._getYAxisLabelAlignment(H);Ve=qi.textAlign,ce=qi.x}else if("right"===d){const qi=this._getYAxisLabelAlignment(H);Ve=qi.textAlign,ce=qi.x}else if("x"===i){if("center"===d)_e=(r.top+r.bottom)/2+K;else if(di(d)){const qi=Object.keys(d)[0];_e=this.chart.scales[qi].getPixelForValue(d[qi])+K}Ve=this._getXAxisLabelAlignment()}else if("y"===i){if("center"===d)ce=(r.left+r.right)/2-K;else if(di(d)){const qi=Object.keys(d)[0];ce=this.chart.scales[qi].getPixelForValue(d[qi])}Ve=this._getYAxisLabelAlignment(H).textAlign}"y"===i&&("start"===C?Mn="top":"end"===C&&(Mn="bottom"));const Ds=this._getLabelSizes();for(Xt=0,$t=T.length;Xt<$t;++Xt){me=T[Xt],ge=me.label;const qi=_.setContext(this.getContext(Xt));Pe=this.getPixelForTick(Xt)+_.labelOffset,qe=this._resolveTickFontOptions(Xt),yi=qe.lineHeight,li=Ji(ge)?ge.length:1;const Ri=li/2,Tn=qi.color,no=qi.textStrokeColor,dn=qi.textStrokeWidth;let Wh,xo=Ve;if(x?(ce=Pe,"inner"===Ve&&(xo=Xt===$t-1?this.options.reverse?"left":"right":0===Xt?this.options.reverse?"right":"left":"center"),Ai="top"===d?"near"===D||0!==gt?-li*yi+yi/2:"center"===D?-Ds.highest.height/2-Ri*yi+yi:yi/2-Ds.highest.height:"near"===D||0!==gt?yi/2:"center"===D?Ds.highest.height/2-Ri*yi:Ds.highest.height-li*yi,V&&(Ai*=-1),0!==gt&&!qi.showLabelBackdrop&&(ce+=yi/2*Math.sin(gt))):(_e=Pe,Ai=(1-li)*yi/2),qi.showLabelBackdrop){const xl=A(qi.backdropPadding),Nr=Ds.heights[Xt],Aa=Ds.widths[Xt];let vc=Ai-xl.top,bc=0-xl.left;switch(Mn){case"middle":vc-=Nr/2;break;case"bottom":vc-=Nr}switch(Ve){case"center":bc-=Aa/2;break;case"right":bc-=Aa}Wh={left:bc,top:vc,width:Aa+xl.width,height:Nr+xl.height,color:qi.backdropColor}}_t.push({label:ge,font:qe,textOffset:Ai,options:{rotation:gt,color:Tn,strokeColor:no,strokeWidth:dn,textAlign:xo,textBaseline:Mn,translation:[ce,_e],backdrop:Wh}})}return _t}_getXAxisLabelAlignment(){const{position:r,ticks:i}=this.options;if(-Qn(this.labelRotation))return"top"===r?"left":"right";let d="center";return"start"===i.align?d="left":"end"===i.align?d="right":"inner"===i.align&&(d="inner"),d}_getYAxisLabelAlignment(r){const{position:i,ticks:{crossAlign:o,mirror:d,padding:_}}=this.options,T=r+_,C=this._getLabelSizes().widest.width;let D,R;return"left"===i?d?(R=this.right+_,"near"===o?D="left":"center"===o?(D="center",R+=C/2):(D="right",R+=C)):(R=this.right-T,"near"===o?D="right":"center"===o?(D="center",R-=C/2):(D="left",R=this.left)):"right"===i?d?(R=this.left+_,"near"===o?D="right":"center"===o?(D="center",R-=C/2):(D="left",R-=C)):(R=this.left+T,"near"===o?D="left":"center"===o?(D="center",R+=C/2):(D="right",R=this.right)):D="right",{textAlign:D,x:R}}_computeLabelArea(){if(this.options.ticks.mirror)return;const r=this.chart,i=this.options.position;return"left"===i||"right"===i?{top:0,left:this.left,bottom:r.height,right:this.right}:"top"===i||"bottom"===i?{top:this.top,left:0,bottom:this.bottom,right:r.width}:void 0}drawBackground(){const{ctx:r,options:{backgroundColor:i},left:o,top:d,width:_,height:x}=this;i&&(r.save(),r.fillStyle=i,r.fillRect(o,d,_,x),r.restore())}getLineWidthForValue(r){const i=this.options.grid;if(!this._isVisible()||!i.display)return 0;const d=this.ticks.findIndex(_=>_.value===r);return d>=0?i.setContext(this.getContext(d)).lineWidth:0}drawGrid(r){const i=this.options.grid,o=this.ctx,d=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(r));let _,x;const T=(C,D,R)=>{!R.width||!R.color||(o.save(),o.lineWidth=R.width,o.strokeStyle=R.color,o.setLineDash(R.borderDash||[]),o.lineDashOffset=R.borderDashOffset,o.beginPath(),o.moveTo(C.x,C.y),o.lineTo(D.x,D.y),o.stroke(),o.restore())};if(i.display)for(_=0,x=d.length;_<x;++_){const C=d[_];i.drawOnChartArea&&T({x:C.x1,y:C.y1},{x:C.x2,y:C.y2},C),i.drawTicks&&T({x:C.tx1,y:C.ty1},{x:C.tx2,y:C.ty2},{color:C.tickColor,width:C.tickWidth,borderDash:C.tickBorderDash,borderDashOffset:C.tickBorderDashOffset})}}drawBorder(){const{chart:r,ctx:i,options:{border:o,grid:d}}=this,_=o.setContext(this.getContext()),x=o.display?_.width:0;if(!x)return;const T=d.setContext(this.getContext(0)).lineWidth,C=this._borderValue;let D,R,V,H;this.isHorizontal()?(D=ho(r,this.left,x)-x/2,R=ho(r,this.right,T)+T/2,V=H=C):(V=ho(r,this.top,x)-x/2,H=ho(r,this.bottom,T)+T/2,D=R=C),i.save(),i.lineWidth=_.width,i.strokeStyle=_.color,i.beginPath(),i.moveTo(D,V),i.lineTo(R,H),i.stroke(),i.restore()}drawLabels(r){if(!this.options.ticks.display)return;const o=this.ctx,d=this._computeLabelArea();d&&il(o,d);const _=this.getLabelItems(r);for(const x of _)po(o,x.label,0,x.textOffset,x.font,x.options);d&&nl(o)}drawTitle(){const{ctx:r,options:{position:i,title:o,reverse:d}}=this;if(!o.display)return;const _=P(o.font),x=A(o.padding),T=o.align;let C=_.lineHeight/2;"bottom"===i||"center"===i||di(i)?(C+=x.bottom,Ji(o.text)&&(C+=_.lineHeight*(o.text.length-1))):C+=x.top;const{titleX:D,titleY:R,maxWidth:V,rotation:H}=function Od(l,r,i,o){const{top:d,left:_,bottom:x,right:T,chart:C}=l,{chartArea:D,scales:R}=C;let H,K,ct,V=0;const gt=x-d,_t=T-_;if(l.isHorizontal()){if(K=kn(o,_,T),di(i)){const Xt=Object.keys(i)[0];ct=R[Xt].getPixelForValue(i[Xt])+gt-r}else ct="center"===i?(D.bottom+D.top)/2+gt-r:Ld(l,i,r);H=T-_}else{if(di(i)){const Xt=Object.keys(i)[0];K=R[Xt].getPixelForValue(i[Xt])-_t+r}else K="center"===i?(D.left+D.right)/2-_t+r:Ld(l,i,r);ct=kn(o,x,d),V="left"===i?-$i:$i}return{titleX:K,titleY:ct,maxWidth:H,rotation:V}}(this,C,i,T);po(r,o.text,0,0,_,{color:o.color,maxWidth:V,rotation:H,textAlign:vi(T,i,d),textBaseline:"middle",translation:[D,R]})}draw(r){this._isVisible()&&(this.drawBackground(),this.drawGrid(r),this.drawBorder(),this.drawTitle(),this.drawLabels(r))}_layers(){const r=this.options,i=r.ticks&&r.ticks.z||0,o=oi(r.grid&&r.grid.z,-1),d=oi(r.border&&r.border.z,0);return this._isVisible()&&this.draw===gs.prototype.draw?[{z:o,draw:_=>{this.drawBackground(),this.drawGrid(_),this.drawTitle()}},{z:d,draw:()=>{this.drawBorder()}},{z:i,draw:_=>{this.drawLabels(_)}}]:[{z:i,draw:_=>{this.draw(_)}}]}getMatchingVisibleMetas(r){const i=this.chart.getSortedVisibleDatasetMetas(),o=this.axis+"AxisID",d=[];let _,x;for(_=0,x=i.length;_<x;++_){const T=i[_];T[o]===this.id&&(!r||T.type===r)&&d.push(T)}return d}_resolveTickFontOptions(r){return P(this.options.ticks.setContext(this.getContext(r)).font)}_maxDigits(){const r=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/r}}class to{constructor(r,i,o){this.type=r,this.scope=i,this.override=o,this.items=Object.create(null)}isForType(r){return Object.prototype.isPrototypeOf.call(this.type.prototype,r.prototype)}register(r){const i=Object.getPrototypeOf(r);let o;(function Xn(l){return"id"in l&&"defaults"in l})(i)&&(o=this.register(i));const d=this.items,_=r.id,x=this.scope+"."+_;if(!_)throw new Error("class does not have id: "+r);return _ in d||(d[_]=r,function Zo(l,r,i){const o=wr(Object.create(null),[i?hn.get(i):{},hn.get(r),l.defaults]);hn.set(r,o),l.defaultRoutes&&function eo(l,r){Object.keys(r).forEach(i=>{const o=i.split("."),d=o.pop(),_=[l].concat(o).join("."),x=r[i].split("."),T=x.pop(),C=x.join(".");hn.route(_,d,C,T)})}(r,l.defaultRoutes),l.descriptors&&hn.describe(r,l.descriptors)}(r,x,o),this.override&&hn.override(r.id,r.overrides)),x}get(r){return this.items[r]}unregister(r){const i=this.items,o=r.id,d=this.scope;o in i&&delete i[o],d&&o in hn[d]&&(delete hn[d][o],this.override&&delete Ys[o])}}class of{constructor(){this.controllers=new to(Fs,"datasets",!0),this.elements=new to(Ns,"elements"),this.plugins=new to(Object,"plugins"),this.scales=new to(gs,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...r){this._each("register",r)}remove(...r){this._each("unregister",r)}addControllers(...r){this._each("register",r,this.controllers)}addElements(...r){this._each("register",r,this.elements)}addPlugins(...r){this._each("register",r,this.plugins)}addScales(...r){this._each("register",r,this.scales)}getController(r){return this._get(r,this.controllers,"controller")}getElement(r){return this._get(r,this.elements,"element")}getPlugin(r){return this._get(r,this.plugins,"plugin")}getScale(r){return this._get(r,this.scales,"scale")}removeControllers(...r){this._each("unregister",r,this.controllers)}removeElements(...r){this._each("unregister",r,this.elements)}removePlugins(...r){this._each("unregister",r,this.plugins)}removeScales(...r){this._each("unregister",r,this.scales)}_each(r,i,o){[...i].forEach(d=>{const _=o||this._getRegistryForType(d);o||_.isForType(d)||_===this.plugins&&d.id?this._exec(r,_,d):Li(d,x=>{const T=o||this._getRegistryForType(x);this._exec(r,T,x)})})}_exec(r,i,o){const d=pi(r);Ki(o["before"+d],[],o),i[r](o),Ki(o["after"+d],[],o)}_getRegistryForType(r){for(let i=0;i<this._typedRegistries.length;i++){const o=this._typedRegistries[i];if(o.isForType(r))return o}return this.plugins}_get(r,i,o){const d=i.get(r);if(void 0===d)throw new Error('"'+r+'" is not a registered '+o+".");return d}}var rn=new of;class rf{constructor(){this._init=[]}notify(r,i,o,d){"beforeInit"===i&&(this._init=this._createDescriptors(r,!0),this._notify(this._init,r,"install"));const _=d?this._descriptors(r).filter(d):this._descriptors(r),x=this._notify(_,r,i,o);return"afterDestroy"===i&&(this._notify(_,r,"stop"),this._notify(this._init,r,"uninstall")),x}_notify(r,i,o,d){d=d||{};for(const _ of r){const x=_.plugin;if(!1===Ki(x[o],[i,d,_.options],x)&&d.cancelable)return!1}return!0}invalidate(){Ci(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(r){if(this._cache)return this._cache;const i=this._cache=this._createDescriptors(r);return this._notifyStateChanges(r),i}_createDescriptors(r,i){const o=r&&r.config,d=oi(o.options&&o.options.plugins,{}),_=function ac(l){const r={},i=[],o=Object.keys(rn.plugins.items);for(let _=0;_<o.length;_++)i.push(rn.getPlugin(o[_]));const d=l.plugins||[];for(let _=0;_<d.length;_++){const x=d[_];-1===i.indexOf(x)&&(i.push(x),r[x.id]=!0)}return{plugins:i,localIds:r}}(o);return!1!==d||i?function af(l,{plugins:r,localIds:i},o,d){const _=[],x=l.getContext();for(const T of r){const C=T.id,D=Bd(o[C],d);null!==D&&_.push({plugin:T,options:Fd(l.config,{plugin:T,local:i[C]},D,x)})}return _}(r,_,d,i):[]}_notifyStateChanges(r){const i=this._oldCache||[],o=this._cache,d=(_,x)=>_.filter(T=>!x.some(C=>T.plugin.id===C.plugin.id));this._notify(d(i,o),r,"stop"),this._notify(d(o,i),r,"start")}}function Bd(l,r){return r||!1!==l?!0===l?{}:l:null}function Fd(l,{plugin:r,local:i},o,d){const _=l.pluginScopeKeys(r),x=l.getOptionScopes(o,_);return i&&r.defaults&&x.push(r.defaults),l.createResolver(x,d,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Ud(l,r){return((r.datasets||{})[l]||{}).indexAxis||r.indexAxis||(hn.datasets[l]||{}).indexAxis||"x"}function cf(l){if("x"===l||"y"===l||"r"===l)return l}function Rr(l){return"top"===l||"bottom"===l?"x":"left"===l||"right"===l?"y":void 0}function zr(l,...r){if(cf(l))return l;for(const i of r){const o=i.axis||Rr(i.position)||l.length>1&&cf(l[0].toLowerCase());if(o)return o}throw new Error(`Cannot determine type of '${l}' axis. Please provide 'axis' or 'position' option.`)}function Th(l,r,i){if(i[r+"AxisID"]===l)return{axis:r}}function jd(l){const r=l.options||(l.options={});r.plugins=oi(r.plugins,{}),r.scales=function Vd(l,r){const i=Ys[l.type]||{scales:{}},o=r.scales||{},d=Ud(l.type,r),_=Object.create(null);return Object.keys(o).forEach(x=>{const T=o[x];if(!di(T))return console.error(`Invalid scale configuration for scale: ${x}`);if(T._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${x}`);const C=zr(x,T,function Au(l,r){if(r.data&&r.data.datasets){const i=r.data.datasets.filter(o=>o.xAxisID===l||o.yAxisID===l);if(i.length)return Th(l,"x",i[0])||Th(l,"y",i[0])}return{}}(x,l),hn.scales[T.type]),D=function lf(l,r){return l===r?"_index_":"_value_"}(C,d),R=i.scales||{};_[x]=zs(Object.create(null),[{axis:C},T,R[C],R[D]])}),l.data.datasets.forEach(x=>{const T=x.type||l.type,C=x.indexAxis||Ud(T,r),R=(Ys[T]||{}).scales||{};Object.keys(R).forEach(V=>{const H=function Nd(l,r){let i=l;return"_index_"===l?i=r:"_value_"===l&&(i="x"===r?"y":"x"),i}(V,C),K=x[H+"AxisID"]||H;_[K]=_[K]||Object.create(null),zs(_[K],[{axis:H},o[K],R[V]])})}),Object.keys(_).forEach(x=>{const T=_[x];zs(T,[hn.scales[T.type],hn.scale])}),_}(l,r)}function hf(l){return(l=l||{}).datasets=l.datasets||[],l.labels=l.labels||[],l}const df=new Map,ku=new Set;function Du(l,r){let i=df.get(l);return i||(i=r(),df.set(l,i),ku.add(i)),i}const hl=(l,r,i)=>{const o=Ws(r,i);void 0!==o&&l.add(o)};class pf{constructor(r){this._config=function uf(l){return(l=l||{}).data=hf(l.data),jd(l),l}(r),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(r){this._config.type=r}get data(){return this._config.data}set data(r){this._config.data=hf(r)}get options(){return this._config.options}set options(r){this._config.options=r}get plugins(){return this._config.plugins}update(){const r=this._config;this.clearCache(),jd(r)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(r){return Du(r,()=>[[`datasets.${r}`,""]])}datasetAnimationScopeKeys(r,i){return Du(`${r}.transition.${i}`,()=>[[`datasets.${r}.transitions.${i}`,`transitions.${i}`],[`datasets.${r}`,""]])}datasetElementScopeKeys(r,i){return Du(`${r}-${i}`,()=>[[`datasets.${r}.elements.${i}`,`datasets.${r}`,`elements.${i}`,""]])}pluginScopeKeys(r){const i=r.id;return Du(`${this.type}-plugin-${i}`,()=>[[`plugins.${i}`,...r.additionalOptionScopes||[]]])}_cachedScopes(r,i){const o=this._scopeCache;let d=o.get(r);return(!d||i)&&(d=new Map,o.set(r,d)),d}getOptionScopes(r,i,o){const{options:d,type:_}=this,x=this._cachedScopes(r,o),T=x.get(i);if(T)return T;const C=new Set;i.forEach(R=>{r&&(C.add(r),R.forEach(V=>hl(C,r,V))),R.forEach(V=>hl(C,d,V)),R.forEach(V=>hl(C,Ys[_]||{},V)),R.forEach(V=>hl(C,hn,V)),R.forEach(V=>hl(C,Ql,V))});const D=Array.from(C);return 0===D.length&&D.push(Object.create(null)),ku.has(i)&&x.set(i,D),D}chartOptionScopes(){const{options:r,type:i}=this;return[r,Ys[i]||{},hn.datasets[i]||{},{type:i},hn,Ql]}resolveNamedOptions(r,i,o,d=[""]){const _={$shared:!0},{resolver:x,subPrefixes:T}=Zd(this._resolverCache,r,d);let C=x;(function ff(l,r){const{isScriptable:i,isIndexable:o}=X(l);for(const d of r){const _=i(d),x=o(d),T=(x||_)&&l[d];if(_&&(or(T)||ul(T))||x&&Ji(T))return!0}return!1})(x,i)&&(_.$shared=!1,C=W(x,o=or(o)?o():o,this.createResolver(r,o,T)));for(const D of i)_[D]=C[D];return _}createResolver(r,i,o=[""],d){const{resolver:_}=Zd(this._resolverCache,r,o);return di(i)?W(_,i,void 0,d):_}}function Zd(l,r,i){let o=l.get(r);o||(o=new Map,l.set(r,o));const d=i.join();let _=o.get(d);return _||(_={resolver:q(r,i),subPrefixes:i.filter(T=>!T.toLowerCase().includes("hover"))},o.set(d,_)),_}const ul=l=>di(l)&&Object.getOwnPropertyNames(l).reduce((r,i)=>r||or(l[i]),!1),lc=["top","bottom","left","right","chartArea"];function Sh(l,r){return"top"===l||"bottom"===l||-1===lc.indexOf(l)&&"x"===r}function Gd(l,r){return function(i,o){return i[l]===o[l]?i[r]-o[r]:i[l]-o[l]}}function qd(l){const r=l.chart,i=r.options.animation;r.notifyPlugins("afterRender"),Ki(i&&i.onComplete,[l],r)}function Mm(l){const r=l.chart,i=r.options.animation;Ki(i&&i.onProgress,[l],r)}function mf(l){return ri()&&"string"==typeof l?l=document.getElementById(l):l&&l.length&&(l=l[0]),l&&l.canvas&&(l=l.canvas),l}const Ch={},gf=l=>{const r=mf(l);return Object.values(Ch).filter(i=>i.canvas===r).pop()};function _f(l,r,i){const o=Object.keys(l);for(const d of o){const _=+d;if(_>=r){const x=l[d];delete l[d],(i>0||_>r)&&(l[_+i]=x)}}}let wa=(()=>{class l{static register(...i){rn.add(...i),Hd()}static unregister(...i){rn.remove(...i),Hd()}constructor(i,o){const d=this.config=new pf(o),_=mf(i),x=gf(_);if(x)throw new Error("Canvas is already in use. Chart with ID '"+x.id+"' must be destroyed before the canvas with ID '"+x.canvas.id+"' can be reused.");const T=d.createResolver(d.chartOptionScopes(),this.getContext());this.platform=new(d.platform||function Sm(l){return!ri()||typeof OffscreenCanvas<"u"&&l instanceof OffscreenCanvas?Kp:tf}(_)),this.platform.updateConfig(d);const C=this.platform.acquireContext(_,T.aspectRatio),D=C&&C.canvas,R=D&&D.height,V=D&&D.width;this.id=cu(),this.ctx=C,this.canvas=D,this.width=V,this.height=R,this._options=T,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new rf,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function Gc(l,r){let i;return function(...o){return r?(clearTimeout(i),i=setTimeout(l,r,o)):l.apply(this,o),r}}(H=>this.update(H),T.resizeDelay||0),this._dataChanges=[],Ch[this.id]=this,C&&D?(Er.listen(this,"complete",qd),Er.listen(this,"progress",Mm),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:i,maintainAspectRatio:o},width:d,height:_,_aspectRatio:x}=this;return Ci(i)?o&&x?x:_?d/_:null:i}get data(){return this.config.data}set data(i){this.config.data=i}get options(){return this._options}set options(i){this.config.options=i}get registry(){return rn}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():un(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Qc(this.canvas,this.ctx),this}stop(){return Er.stop(this),this}resize(i,o){Er.running(this)?this._resizeBeforeDraw={width:i,height:o}:this._resize(i,o)}_resize(i,o){const d=this.options,T=this.platform.getMaximumSize(this.canvas,i,o,d.maintainAspectRatio&&this.aspectRatio),C=d.devicePixelRatio||this.platform.getDevicePixelRatio(),D=this.width?"resize":"attach";this.width=T.width,this.height=T.height,this._aspectRatio=this.aspectRatio,un(this,C,!0)&&(this.notifyPlugins("resize",{size:T}),Ki(d.onResize,[this,T],this),this.attached&&this._doResize(D)&&this.render())}ensureScalesHaveIDs(){Li(this.options.scales||{},(d,_)=>{d.id=_})}buildOrUpdateScales(){const i=this.options,o=i.scales,d=this.scales,_=Object.keys(d).reduce((T,C)=>(T[C]=!1,T),{});let x=[];o&&(x=x.concat(Object.keys(o).map(T=>{const C=o[T],D=zr(T,C),R="r"===D,V="x"===D;return{options:C,dposition:R?"chartArea":V?"bottom":"left",dtype:R?"radialLinear":V?"category":"linear"}}))),Li(x,T=>{const C=T.options,D=C.id,R=zr(D,C),V=oi(C.type,T.dtype);(void 0===C.position||Sh(C.position,R)!==Sh(T.dposition))&&(C.position=T.dposition),_[D]=!0;let H=null;D in d&&d[D].type===V?H=d[D]:(H=new(rn.getScale(V))({id:D,type:V,ctx:this.ctx,chart:this}),d[H.id]=H),H.init(C,i)}),Li(_,(T,C)=>{T||delete d[C]}),Li(d,T=>{fs.configure(this,T,T.options),fs.addBox(this,T)})}_updateMetasets(){const i=this._metasets,o=this.data.datasets.length,d=i.length;if(i.sort((_,x)=>_.index-x.index),d>o){for(let _=o;_<d;++_)this._destroyDatasetMeta(_);i.splice(o,d-o)}this._sortedMetasets=i.slice(0).sort(Gd("order","index"))}_removeUnreferencedMetasets(){const{_metasets:i,data:{datasets:o}}=this;i.length>o.length&&delete this._stacks,i.forEach((d,_)=>{0===o.filter(x=>x===d._dataset).length&&this._destroyDatasetMeta(_)})}buildOrUpdateControllers(){const i=[],o=this.data.datasets;let d,_;for(this._removeUnreferencedMetasets(),d=0,_=o.length;d<_;d++){const x=o[d];let T=this.getDatasetMeta(d);const C=x.type||this.config.type;if(T.type&&T.type!==C&&(this._destroyDatasetMeta(d),T=this.getDatasetMeta(d)),T.type=C,T.indexAxis=x.indexAxis||Ud(C,this.options),T.order=x.order||0,T.index=d,T.label=""+x.label,T.visible=this.isDatasetVisible(d),T.controller)T.controller.updateIndex(d),T.controller.linkScales();else{const D=rn.getController(C),{datasetElementType:R,dataElementType:V}=hn.datasets[C];Object.assign(D,{dataElementType:rn.getElement(V),datasetElementType:R&&rn.getElement(R)}),T.controller=new D(this,d),i.push(T.controller)}}return this._updateMetasets(),i}_resetElements(){Li(this.data.datasets,(i,o)=>{this.getDatasetMeta(o).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(i){const o=this.config;o.update();const d=this._options=o.createResolver(o.chartOptionScopes(),this.getContext()),_=this._animationsDisabled=!d.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:i,cancelable:!0}))return;const x=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let T=0;for(let R=0,V=this.data.datasets.length;R<V;R++){const{controller:H}=this.getDatasetMeta(R),K=!_&&-1===x.indexOf(H);H.buildOrUpdateElements(K),T=Math.max(+H.getMaxOverflow(),T)}T=this._minPadding=d.layout.autoPadding?T:0,this._updateLayout(T),_||Li(x,R=>{R.reset()}),this._updateDatasets(i),this.notifyPlugins("afterUpdate",{mode:i}),this._layers.sort(Gd("z","_idx"));const{_active:C,_lastEvent:D}=this;D?this._eventHandler(D,!0):C.length&&this._updateHoverStyles(C,C,!0),this.render()}_updateScales(){Li(this.scales,i=>{fs.removeBox(this,i)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const i=this.options,o=new Set(Object.keys(this._listeners)),d=new Set(i.events);(!jl(o,d)||!!this._responsiveListeners!==i.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:i}=this,o=this._getUniformDataChanges()||[];for(const{method:d,start:_,count:x}of o)_f(i,_,"_removeElements"===d?-x:x)}_getUniformDataChanges(){const i=this._dataChanges;if(!i||!i.length)return;this._dataChanges=[];const o=this.data.datasets.length,d=x=>new Set(i.filter(T=>T[0]===x).map((T,C)=>C+","+T.splice(1).join(","))),_=d(0);for(let x=1;x<o;x++)if(!jl(_,d(x)))return;return Array.from(_).map(x=>x.split(",")).map(x=>({method:x[1],start:+x[2],count:+x[3]}))}_updateLayout(i){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;fs.update(this,this.width,this.height,i);const o=this.chartArea,d=o.width<=0||o.height<=0;this._layers=[],Li(this.boxes,_=>{d&&"chartArea"===_.position||(_.configure&&_.configure(),this._layers.push(..._._layers()))},this),this._layers.forEach((_,x)=>{_._idx=x}),this.notifyPlugins("afterLayout")}_updateDatasets(i){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:i,cancelable:!0})){for(let o=0,d=this.data.datasets.length;o<d;++o)this.getDatasetMeta(o).controller.configure();for(let o=0,d=this.data.datasets.length;o<d;++o)this._updateDataset(o,or(i)?i({datasetIndex:o}):i);this.notifyPlugins("afterDatasetsUpdate",{mode:i})}}_updateDataset(i,o){const d=this.getDatasetMeta(i),_={meta:d,index:i,mode:o,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",_)&&(d.controller._update(o),_.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",_))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(Er.has(this)?this.attached&&!Er.running(this)&&Er.start(this):(this.draw(),qd({chart:this})))}draw(){let i;if(this._resizeBeforeDraw){const{width:d,height:_}=this._resizeBeforeDraw;this._resize(d,_),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const o=this._layers;for(i=0;i<o.length&&o[i].z<=0;++i)o[i].draw(this.chartArea);for(this._drawDatasets();i<o.length;++i)o[i].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(i){const o=this._sortedMetasets,d=[];let _,x;for(_=0,x=o.length;_<x;++_){const T=o[_];(!i||T.visible)&&d.push(T)}return d}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const i=this.getSortedVisibleDatasetMetas();for(let o=i.length-1;o>=0;--o)this._drawDataset(i[o]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(i){const o=this.ctx,d=i._clip,_=!d.disabled,x=function Am(l){const{xScale:r,yScale:i}=l;if(r&&i)return{left:r.left,right:r.right,top:i.top,bottom:i.bottom}}(i)||this.chartArea,T={meta:i,index:i.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",T)&&(_&&il(o,{left:!1===d.left?0:x.left-d.left,right:!1===d.right?this.width:x.right+d.right,top:!1===d.top?0:x.top-d.top,bottom:!1===d.bottom?this.height:x.bottom+d.bottom}),i.controller.draw(),_&&nl(o),T.cancelable=!1,this.notifyPlugins("afterDatasetDraw",T))}isPointInArea(i){return uo(i,this.chartArea,this._minPadding)}getElementsAtEventForMode(i,o,d,_){const x=uh.modes[o];return"function"==typeof x?x(this,i,d,_):[]}getDatasetMeta(i){const o=this.data.datasets[i],d=this._metasets;let _=d.filter(x=>x&&x._dataset===o).pop();return _||(_={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:o&&o.order||0,index:i,_dataset:o,_parsed:[],_sorted:!1},d.push(_)),_}getContext(){return this.$context||(this.$context=U(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(i){const o=this.data.datasets[i];if(!o)return!1;const d=this.getDatasetMeta(i);return"boolean"==typeof d.hidden?!d.hidden:!o.hidden}setDatasetVisibility(i,o){this.getDatasetMeta(i).hidden=!o}toggleDataVisibility(i){this._hiddenIndices[i]=!this._hiddenIndices[i]}getDataVisibility(i){return!this._hiddenIndices[i]}_updateVisibility(i,o,d){const _=d?"show":"hide",x=this.getDatasetMeta(i),T=x.controller._resolveAnimations(void 0,_);sr(o)?(x.data[o].hidden=!d,this.update()):(this.setDatasetVisibility(i,d),T.update(x,{visible:d}),this.update(C=>C.datasetIndex===i?_:void 0))}hide(i,o){this._updateVisibility(i,o,!1)}show(i,o){this._updateVisibility(i,o,!0)}_destroyDatasetMeta(i){const o=this._metasets[i];o&&o.controller&&o.controller._destroy(),delete this._metasets[i]}_stop(){let i,o;for(this.stop(),Er.remove(this),i=0,o=this.data.datasets.length;i<o;++i)this._destroyDatasetMeta(i)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:i,ctx:o}=this;this._stop(),this.config.clearCache(),i&&(this.unbindEvents(),Qc(i,o),this.platform.releaseContext(o),this.canvas=null,this.ctx=null),delete Ch[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...i){return this.canvas.toDataURL(...i)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const i=this._listeners,o=this.platform,d=(x,T)=>{o.addEventListener(this,x,T),i[x]=T},_=(x,T,C)=>{x.offsetX=T,x.offsetY=C,this._eventHandler(x)};Li(this.options.events,x=>d(x,_))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const i=this._responsiveListeners,o=this.platform,d=(D,R)=>{o.addEventListener(this,D,R),i[D]=R},_=(D,R)=>{i[D]&&(o.removeEventListener(this,D,R),delete i[D])},x=(D,R)=>{this.canvas&&this.resize(D,R)};let T;const C=()=>{_("attach",C),this.attached=!0,this.resize(),d("resize",x),d("detach",T)};T=()=>{this.attached=!1,_("resize",x),this._stop(),this._resize(0,0),d("attach",C)},o.isAttached(this.canvas)?C():T()}unbindEvents(){Li(this._listeners,(i,o)=>{this.platform.removeEventListener(this,o,i)}),this._listeners={},Li(this._responsiveListeners,(i,o)=>{this.platform.removeEventListener(this,o,i)}),this._responsiveListeners=void 0}updateHoverStyle(i,o,d){const _=d?"set":"remove";let x,T,C,D;for("dataset"===o&&(x=this.getDatasetMeta(i[0].datasetIndex),x.controller["_"+_+"DatasetHoverStyle"]()),C=0,D=i.length;C<D;++C){T=i[C];const R=T&&this.getDatasetMeta(T.datasetIndex).controller;R&&R[_+"HoverStyle"](T.element,T.datasetIndex,T.index)}}getActiveElements(){return this._active||[]}setActiveElements(i){const o=this._active||[],d=i.map(({datasetIndex:x,index:T})=>{const C=this.getDatasetMeta(x);if(!C)throw new Error("No dataset found at index "+x);return{datasetIndex:x,element:C.data[T],index:T}});!ha(d,o)&&(this._active=d,this._lastEvent=null,this._updateHoverStyles(d,o))}notifyPlugins(i,o,d){return this._plugins.notify(this,i,o,d)}isPluginEnabled(i){return 1===this._plugins._cache.filter(o=>o.plugin.id===i).length}_updateHoverStyles(i,o,d){const _=this.options.hover,x=(D,R)=>D.filter(V=>!R.some(H=>V.datasetIndex===H.datasetIndex&&V.index===H.index)),T=x(o,i),C=d?i:x(i,o);T.length&&this.updateHoverStyle(T,_.mode,!1),C.length&&_.mode&&this.updateHoverStyle(C,_.mode,!0)}_eventHandler(i,o){const d={event:i,replay:o,cancelable:!0,inChartArea:this.isPointInArea(i)},_=T=>(T.options.events||this.options.events).includes(i.native.type);if(!1===this.notifyPlugins("beforeEvent",d,_))return;const x=this._handleEvent(i,o,d.inChartArea);return d.cancelable=!1,this.notifyPlugins("afterEvent",d,_),(x||d.changed)&&this.render(),this}_handleEvent(i,o,d){const{_active:_=[],options:x}=this,C=this._getActiveElements(i,_,d,o),D=function Ha(l){return"mouseup"===l.type||"click"===l.type||"contextmenu"===l.type}(i),R=function Em(l,r,i,o){return i&&"mouseout"!==l.type?o?r:l:null}(i,this._lastEvent,d,D);d&&(this._lastEvent=null,Ki(x.onHover,[i,C,this],this),D&&Ki(x.onClick,[i,C,this],this));const V=!ha(C,_);return(V||o)&&(this._active=C,this._updateHoverStyles(C,_,o)),this._lastEvent=R,V}_getActiveElements(i,o,d,_){if("mouseout"===i.type)return[];if(!d)return o;const x=this.options.hover;return this.getElementsAtEventForMode(i,x.mode,x,_)}}return(0,ke.Z)(l,"defaults",hn),(0,ke.Z)(l,"instances",Ch),(0,ke.Z)(l,"overrides",Ys),(0,ke.Z)(l,"registry",rn),(0,ke.Z)(l,"version","4.3.0"),(0,ke.Z)(l,"getChart",gf),l})();function Hd(){return Li(wa.instances,l=>l._plugins.invalidate())}function jn(l,r,i,o){return{x:i+l*Math.cos(r),y:o+l*Math.sin(r)}}function Pu(l,r,i,o,d,_){const{x,y:T,startAngle:C,pixelMargin:D,innerRadius:R}=r,V=Math.max(r.outerRadius+o+i-D,0),H=R>0?R+o+i+D:0;let K=0;const ct=d-C;if(o){const Tn=((R>0?R-o:0)+(V>0?V-o:0))/2;K=(ct-(0!==Tn?ct*Tn/(Tn+o):ct))/2}const _t=(ct-Math.max(.001,ct*V-i/Qi)/V)/2,Xt=C+_t+K,$t=d-_t-K,{outerStart:me,outerEnd:ge,innerStart:ce,innerEnd:_e}=function Or(l,r,i,o){const d=function $d(l){return v(l,["outerStart","outerEnd","innerStart","innerEnd"])}(l.options.borderRadius),_=(i-r)/2,x=Math.min(_,o*r/2),T=C=>{const D=(i-Math.min(_,C))*o/2;return Mi(C,0,Math.min(_,D))};return{outerStart:T(d.outerStart),outerEnd:T(d.outerEnd),innerStart:Mi(d.innerStart,0,x),innerEnd:Mi(d.innerEnd,0,x)}}(r,H,V,$t-Xt),Ve=V-me,Pe=V-ge,qe=Xt+me/Ve,yi=$t-ge/Pe,li=H+ce,Ai=H+_e,Mn=Xt+ce/li,Ds=$t-_e/Ai;if(l.beginPath(),_){const qi=(qe+yi)/2;if(l.arc(x,T,V,qe,qi),l.arc(x,T,V,qi,yi),ge>0){const dn=jn(Pe,yi,x,T);l.arc(dn.x,dn.y,ge,yi,$t+$i)}const Ri=jn(Ai,$t,x,T);if(l.lineTo(Ri.x,Ri.y),_e>0){const dn=jn(Ai,Ds,x,T);l.arc(dn.x,dn.y,_e,$t+$i,Ds+Math.PI)}const Tn=($t-_e/H+(Xt+ce/H))/2;if(l.arc(x,T,H,$t-_e/H,Tn,!0),l.arc(x,T,H,Tn,Xt+ce/H,!0),ce>0){const dn=jn(li,Mn,x,T);l.arc(dn.x,dn.y,ce,Mn+Math.PI,Xt-$i)}const no=jn(Ve,Xt,x,T);if(l.lineTo(no.x,no.y),me>0){const dn=jn(Ve,qe,x,T);l.arc(dn.x,dn.y,me,Xt-$i,qe)}}else{l.moveTo(x,T);const qi=Math.cos(qe)*V+x,Ri=Math.sin(qe)*V+T;l.lineTo(qi,Ri);const Tn=Math.cos(yi)*V+x,no=Math.sin(yi)*V+T;l.lineTo(Tn,no)}l.closePath()}class Mh extends Ns{constructor(r){super(),(0,ke.Z)(this,"circumference",void 0),(0,ke.Z)(this,"endAngle",void 0),(0,ke.Z)(this,"fullCircles",void 0),(0,ke.Z)(this,"innerRadius",void 0),(0,ke.Z)(this,"outerRadius",void 0),(0,ke.Z)(this,"pixelMargin",void 0),(0,ke.Z)(this,"startAngle",void 0),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,r&&Object.assign(this,r)}inRange(r,i,o){const d=this.getProps(["x","y"],o),{angle:_,distance:x}=Xa(d,{x:r,y:i}),{startAngle:T,endAngle:C,innerRadius:D,outerRadius:R,circumference:V}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],o),H=(this.options.spacing+this.options.borderWidth)/2,ct=oi(V,C-T)>=tn||zo(_,T,C),gt=Oo(x,D+H,R+H);return ct&&gt}getCenterPoint(r){const{x:i,y:o,startAngle:d,endAngle:_,innerRadius:x,outerRadius:T}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],r),{offset:C,spacing:D}=this.options,R=(d+_)/2,V=(x+T+D+C)/2;return{x:i+Math.cos(R)*V,y:o+Math.sin(R)*V}}tooltipPosition(r){return this.getCenterPoint(r)}draw(r){const{options:i,circumference:o}=this,d=(i.offset||0)/4,_=(i.spacing||0)/2,x=i.circular;if(this.pixelMargin="inner"===i.borderAlign?.33:0,this.fullCircles=o>tn?Math.floor(o/tn):0,0===o||this.innerRadius<0||this.outerRadius<0)return;r.save();const T=(this.startAngle+this.endAngle)/2;r.translate(Math.cos(T)*d,Math.sin(T)*d);const D=d*(1-Math.sin(Math.min(Qi,o||0)));r.fillStyle=i.backgroundColor,r.strokeStyle=i.borderColor,function Wd(l,r,i,o,d){const{fullCircles:_,startAngle:x,circumference:T}=r;let C=r.endAngle;if(_){Pu(l,r,i,o,C,d);for(let D=0;D<_;++D)l.fill();isNaN(T)||(C=x+(T%tn||tn))}Pu(l,r,i,o,C,d),l.fill()}(r,this,D,_,x),function km(l,r,i,o,d){const{fullCircles:_,startAngle:x,circumference:T,options:C}=r,{borderWidth:D,borderJoinStyle:R,borderDash:V,borderDashOffset:H}=C,K="inner"===C.borderAlign;if(!D)return;l.setLineDash(V||[]),l.lineDashOffset=H,K?(l.lineWidth=2*D,l.lineJoin=R||"round"):(l.lineWidth=D,l.lineJoin=R||"bevel");let ct=r.endAngle;if(_){Pu(l,r,i,o,ct,d);for(let gt=0;gt<_;++gt)l.stroke();isNaN(T)||(ct=x+(T%tn||tn))}K&&function yf(l,r,i){const{startAngle:o,pixelMargin:d,x:_,y:x,outerRadius:T,innerRadius:C}=r;let D=d/T;l.beginPath(),l.arc(_,x,T,o-D,i+D),C>d?(D=d/C,l.arc(_,x,C,i+D,o-D,!0)):l.arc(_,x,d,i+$i,o-$i),l.closePath(),l.clip()}(l,r,ct),_||(Pu(l,r,i,o,ct,d),l.stroke())}(r,this,D,_,x),r.restore()}}function xf(l,r,i=r){l.lineCap=oi(i.borderCapStyle,r.borderCapStyle),l.setLineDash(oi(i.borderDash,r.borderDash)),l.lineDashOffset=oi(i.borderDashOffset,r.borderDashOffset),l.lineJoin=oi(i.borderJoinStyle,r.borderJoinStyle),l.lineWidth=oi(i.borderWidth,r.borderWidth),l.strokeStyle=oi(i.borderColor,r.borderColor)}function cc(l,r,i){l.lineTo(i.x,i.y)}function Xd(l,r,i={}){const o=l.length,{start:d=0,end:_=o-1}=i,{start:x,end:T}=r,C=Math.max(d,x),D=Math.min(_,T);return{count:o,start:C,loop:r.loop,ilen:D<C&&!(d<x&&_<x||d>T&&_>T)?o+D-C:D-C}}function dl(l,r,i,o){const{points:d,options:_}=r,{count:x,start:T,loop:C,ilen:D}=Xd(d,i,o),R=function Iu(l){return l.stepped?th:l.tension||"monotone"===l.cubicInterpolationMode?mu:cc}(_);let K,ct,gt,{move:V=!0,reverse:H}=o||{};for(K=0;K<=D;++K)ct=d[(T+(H?D-K:K))%x],!ct.skip&&(V?(l.moveTo(ct.x,ct.y),V=!1):R(l,gt,ct,H,_.stepped),gt=ct);return C&&(ct=d[(T+(H?D:0))%x],R(l,gt,ct,H,_.stepped)),!!C}function Eh(l,r,i,o){const d=r.points,{count:_,start:x,ilen:T}=Xd(d,i,o),{move:C=!0,reverse:D}=o||{};let H,K,ct,gt,_t,Xt,R=0,V=0;const $t=ge=>(x+(D?T-ge:ge))%_,me=()=>{gt!==_t&&(l.lineTo(R,_t),l.lineTo(R,gt),l.lineTo(R,Xt))};for(C&&(K=d[$t(0)],l.moveTo(K.x,K.y)),H=0;H<=T;++H){if(K=d[$t(H)],K.skip)continue;const ge=K.x,ce=K.y,_e=0|ge;_e===ct?(ce<gt?gt=ce:ce>_t&&(_t=ce),R=(V*R+ge)/++V):(me(),l.lineTo(ge,ce),ct=_e,V=0,gt=_t=ce),Xt=ce}me()}function Yd(l){const r=l.options;return l._decimated||l._loop||r.tension||"monotone"===r.cubicInterpolationMode||r.stepped||r.borderDash&&r.borderDash.length?dl:Eh}(0,ke.Z)(Mh,"id","arc"),(0,ke.Z)(Mh,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),(0,ke.Z)(Mh,"defaultRoutes",{backgroundColor:"backgroundColor"}),(0,ke.Z)(Mh,"descriptors",{_scriptable:!0,_indexable:l=>"borderDash"!==l});const Lm="function"==typeof Path2D;let Lu=(()=>{class l extends Ns{constructor(i){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,i&&Object.assign(this,i)}updateControlPoints(i,o){const d=this.options;!d.tension&&"monotone"!==d.cubicInterpolationMode||d.stepped||this._pointsUpdated||(Ue(this._points,d,i,d.spanGaps?this._loop:this._fullLoop,o),this._pointsUpdated=!0)}set points(i){this._points=i,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function Ap(l,r){const i=l.points,o=l.options.spanGaps,d=i.length;if(!d)return[];const _=!!l._loop,{start:x,end:T}=function Mp(l,r,i,o){let d=0,_=r-1;if(i&&!o)for(;d<r&&!l[d].skip;)d++;for(;d<r&&l[d].skip;)d++;for(d%=r,i&&(_+=d);_>d&&l[_%r].skip;)_--;return _%=r,{start:d,end:_}}(i,d,_,o);return function vd(l,r,i,o){return o&&o.setContext&&i?function kp(l,r,i,o){const d=l._chart.getContext(),_=bd(l.options),{_datasetIndex:x,options:{spanGaps:T}}=l,C=i.length,D=[];let R=_,V=r[0].start,H=V;function K(ct,gt,_t,Xt){const $t=T?-1:1;if(ct!==gt){for(ct+=C;i[ct%C].skip;)ct-=$t;for(;i[gt%C].skip;)gt+=$t;ct%C!=gt%C&&(D.push({start:ct%C,end:gt%C,loop:_t,style:Xt}),R=Xt,V=gt%C)}}for(const ct of r){V=T?V:ct.start;let _t,gt=i[V%C];for(H=V+1;H<=ct.end;H++){const Xt=i[H%C];_t=bd(o.setContext(U(d,{type:"segment",p0:gt,p1:Xt,p0DataIndex:(H-1)%C,p1DataIndex:H%C,datasetIndex:x}))),Dp(_t,R)&&K(V,H-1,ct.loop,R),gt=Xt,R=_t}V<H-1&&K(V,H-1,ct.loop,R)}return D}(l,r,i,o):r}(l,!0===o?[{start:x,end:T,loop:_}]:function Ep(l,r,i,o){const d=l.length,_=[];let C,x=r,T=l[r];for(C=r+1;C<=i;++C){const D=l[C%d];D.skip||D.stop?T.skip||(_.push({start:r%d,end:(C-1)%d,loop:o=!1}),r=x=D.stop?C:null):(x=C,T.skip&&(r=C)),T=D}return null!==x&&_.push({start:r%d,end:x%d,loop:o}),_}(i,x,T<x?T+d:T,!!l._fullLoop&&0===x&&T===d-1),i,r)}(this,this.options.segment))}first(){const i=this.segments;return i.length&&this.points[i[0].start]}last(){const i=this.segments,d=i.length;return d&&this.points[i[d-1].end]}interpolate(i,o){const d=this.options,_=i[o],x=this.points,T=xd(this,{property:o,start:_,end:_});if(!T.length)return;const C=[],D=function Dm(l){return l.stepped?Wn:l.tension||"monotone"===l.cubicInterpolationMode?cr:xn}(d);let R,V;for(R=0,V=T.length;R<V;++R){const{start:H,end:K}=T[R],ct=x[H],gt=x[K];if(ct===gt){C.push(ct);continue}const Xt=D(ct,gt,Math.abs((_-ct[o])/(gt[o]-ct[o])),d.stepped);Xt[o]=i[o],C.push(Xt)}return 1===C.length?C[0]:C}pathSegment(i,o,d){return Yd(this)(i,this,o,d)}path(i,o,d){const _=this.segments,x=Yd(this);let T=this._loop;o=o||0,d=d||this.points.length-o;for(const C of _)T&=x(i,this,C,{start:o,end:o+d-1});return!!T}draw(i,o,d,_){(this.points||[]).length&&(this.options||{}).borderWidth&&(i.save(),function Rm(l,r,i,o){Lm&&!r.options.segment?function Pm(l,r,i,o){let d=r._path;d||(d=r._path=new Path2D,r.path(d,i,o)&&d.closePath()),xf(l,r.options),l.stroke(d)}(l,r,i,o):function Im(l,r,i,o){const{segments:d,options:_}=r,x=Yd(r);for(const T of d)xf(l,_,T.style),l.beginPath(),x(l,r,T,{start:i,end:i+o-1})&&l.closePath(),l.stroke()}(l,r,i,o)}(i,this,d,_),i.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return(0,ke.Z)(l,"id","line"),(0,ke.Z)(l,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),(0,ke.Z)(l,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),(0,ke.Z)(l,"descriptors",{_scriptable:!0,_indexable:r=>"borderDash"!==r&&"fill"!==r}),l})();function Ru(l,r,i,o){const d=l.options,{[i]:_}=l.getProps([i],o);return Math.abs(r-_)<d.radius+d.hitRadius}let zm=(()=>{class l extends Ns{constructor(i){super(),(0,ke.Z)(this,"parsed",void 0),(0,ke.Z)(this,"skip",void 0),(0,ke.Z)(this,"stop",void 0),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,i&&Object.assign(this,i)}inRange(i,o,d){const _=this.options,{x,y:T}=this.getProps(["x","y"],d);return Math.pow(i-x,2)+Math.pow(o-T,2)<Math.pow(_.hitRadius+_.radius,2)}inXRange(i,o){return Ru(this,i,"x",o)}inYRange(i,o){return Ru(this,i,"y",o)}getCenterPoint(i){const{x:o,y:d}=this.getProps(["x","y"],i);return{x:o,y:d}}size(i){let o=(i=i||this.options||{}).radius||0;return o=Math.max(o,o&&i.hoverRadius||0),2*(o+(o&&i.borderWidth||0))}draw(i,o){const d=this.options;this.skip||d.radius<.1||!uo(this,o,this.size(d)/2)||(i.strokeStyle=d.borderColor,i.lineWidth=d.borderWidth,i.fillStyle=d.backgroundColor,ec(i,d,this.x,this.y))}getRange(){const i=this.options||{};return i.radius+i.hitRadius}}return(0,ke.Z)(l,"id","point"),(0,ke.Z)(l,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),(0,ke.Z)(l,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),l})();function pl(l,r){const{x:i,y:o,base:d,width:_,height:x}=l.getProps(["x","y","base","width","height"],r);let T,C,D,R,V;return l.horizontal?(V=x/2,T=Math.min(i,d),C=Math.max(i,d),D=o-V,R=o+V):(V=_/2,T=i-V,C=i+V,D=Math.min(o,d),R=Math.max(o,d)),{left:T,top:D,right:C,bottom:R}}function Ta(l,r,i,o){return l?0:Mi(r,i,o)}function hc(l,r,i,o){const d=null===r,_=null===i,T=l&&!(d&&_)&&pl(l,o);return T&&(d||Oo(r,T.left,T.right))&&(_||Oo(i,T.top,T.bottom))}function Ah(l,r){l.rect(r.x,r.y,r.w,r.h)}function Bu(l,r,i={}){const o=l.x!==i.x?-r:0,d=l.y!==i.y?-r:0;return{x:l.x+o,y:l.y+d,w:l.w+((l.x+l.w!==i.x+i.w?r:0)-o),h:l.h+((l.y+l.h!==i.y+i.h?r:0)-d),radius:l.radius}}class kh extends Ns{constructor(r){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,r&&Object.assign(this,r)}draw(r){const{inflateAmount:i,options:{borderColor:o,backgroundColor:d}}=this,{inner:_,outer:x}=function vf(l){const r=pl(l),i=r.right-r.left,o=r.bottom-r.top,d=function wn(l,r,i){const d=l.borderSkipped,_=w(l.options.borderWidth);return{t:Ta(d.top,_.top,0,i),r:Ta(d.right,_.right,0,r),b:Ta(d.bottom,_.bottom,0,i),l:Ta(d.left,_.left,0,r)}}(l,i/2,o/2),_=function zu(l,r,i){const{enableBorderRadius:o}=l.getProps(["enableBorderRadius"]),d=l.options.borderRadius,_=E(d),x=Math.min(r,i),T=l.borderSkipped,C=o||di(d);return{topLeft:Ta(!C||T.top||T.left,_.topLeft,0,x),topRight:Ta(!C||T.top||T.right,_.topRight,0,x),bottomLeft:Ta(!C||T.bottom||T.left,_.bottomLeft,0,x),bottomRight:Ta(!C||T.bottom||T.right,_.bottomRight,0,x)}}(l,i/2,o/2);return{outer:{x:r.left,y:r.top,w:i,h:o,radius:_},inner:{x:r.left+d.l,y:r.top+d.t,w:i-d.l-d.r,h:o-d.t-d.b,radius:{topLeft:Math.max(0,_.topLeft-Math.max(d.t,d.l)),topRight:Math.max(0,_.topRight-Math.max(d.t,d.r)),bottomLeft:Math.max(0,_.bottomLeft-Math.max(d.b,d.l)),bottomRight:Math.max(0,_.bottomRight-Math.max(d.b,d.r))}}}}(this),T=function Ou(l){return l.topLeft||l.topRight||l.bottomLeft||l.bottomRight}(x.radius)?Fo:Ah;r.save(),(x.w!==_.w||x.h!==_.h)&&(r.beginPath(),T(r,Bu(x,i,_)),r.clip(),T(r,Bu(_,-i,x)),r.fillStyle=o,r.fill("evenodd")),r.beginPath(),T(r,Bu(_,i)),r.fillStyle=d,r.fill(),r.restore()}inRange(r,i,o){return hc(this,r,i,o)}inXRange(r,i){return hc(this,r,null,i)}inYRange(r,i){return hc(this,null,r,i)}getCenterPoint(r){const{x:i,y:o,base:d,horizontal:_}=this.getProps(["x","y","base","horizontal"],r);return{x:_?(i+d)/2:i,y:_?o:(o+d)/2}}getRange(r){return"x"===r?this.width/2:this.height/2}}(0,ke.Z)(kh,"id","bar"),(0,ke.Z)(kh,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),(0,ke.Z)(kh,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var Dh=Object.freeze({__proto__:null,ArcElement:Mh,BarElement:kh,LineElement:Lu,PointElement:zm});const Ph=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Fu=Ph.map(l=>l.replace("rgb(","rgba(").replace(")",", 0.5)"));function bf(l){return Ph[l%Ph.length]}function Jd(l){return Fu[l%Fu.length]}function Uu(l){let r;for(r in l)if(l[r].borderColor||l[r].backgroundColor)return!0;return!1}var Nu={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(l,r,i){if(!i.enabled)return;const{data:{datasets:o},options:d}=l.config,{elements:_}=d;if(!i.forceOverride&&(Uu(o)||function Qd(l){return l&&(l.borderColor||l.backgroundColor)}(d)||_&&Uu(_)))return;const x=function Bm(l){let r=0;return(i,o)=>{const d=l.getDatasetMeta(o).controller;d instanceof Pr?r=function Om(l,r){return l.backgroundColor=l.data.map(()=>bf(r++)),r}(i,r):d instanceof va?r=function Kd(l,r){return l.backgroundColor=l.data.map(()=>Jd(r++)),r}(i,r):d&&(r=function Ih(l,r){return l.borderColor=bf(r),l.backgroundColor=Jd(r),++r}(i,r))}}(l);o.forEach(x)}};function wf(l){if(l._decimated){const r=l._data;delete l._decimated,delete l._data,Object.defineProperty(l,"data",{configurable:!0,enumerable:!0,writable:!0,value:r})}}function Tf(l){l.data.datasets.forEach(r=>{wf(r)})}var Vm={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(l,r,i)=>{if(!i.enabled)return void Tf(l);const o=l.width;l.data.datasets.forEach((d,_)=>{const{_data:x,indexAxis:T}=d,C=l.getDatasetMeta(_),D=x||d.data;if("y"===z([T,l.options.indexAxis])||!C.controller.supportsDecimation)return;const R=l.scales[C.xAxisID];if("linear"!==R.type&&"time"!==R.type||l.options.parsing)return;let ct,{start:V,count:H}=function Nm(l,r){const i=r.length;let d,o=0;const{iScale:_}=l,{min:x,max:T,minDefined:C,maxDefined:D}=_.getUserBounds();return C&&(o=Mi(Bs(r,_.axis,x).lo,0,i-1)),d=D?Mi(Bs(r,_.axis,T).hi+1,o,i)-o:i-o,{start:o,count:d}}(C,D);if(H<=(i.threshold||4*o))wf(d);else{switch(Ci(x)&&(d._data=D,delete d.data,Object.defineProperty(d,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(gt){this._data=gt}})),i.algorithm){case"lttb":ct=function Fm(l,r,i,o,d){const _=d.samples||o;if(_>=i)return l.slice(r,r+i);const x=[],T=(i-2)/(_-2);let C=0;const D=r+i-1;let V,H,K,ct,gt,R=r;for(x[C++]=l[R],V=0;V<_-2;V++){let $t,_t=0,Xt=0;const me=Math.floor((V+1)*T)+1+r,ge=Math.min(Math.floor((V+2)*T)+1,i)+r,ce=ge-me;for($t=me;$t<ge;$t++)_t+=l[$t].x,Xt+=l[$t].y;_t/=ce,Xt/=ce;const _e=Math.floor(V*T)+1+r,Ve=Math.min(Math.floor((V+1)*T)+1,i)+r,{x:Pe,y:qe}=l[R];for(K=ct=-1,$t=_e;$t<Ve;$t++)ct=.5*Math.abs((Pe-_t)*(l[$t].y-qe)-(Pe-l[$t].x)*(Xt-qe)),ct>K&&(K=ct,H=l[$t],gt=$t);x[C++]=H,R=gt}return x[C++]=l[D],x}(D,V,H,o,i);break;case"min-max":ct=function Um(l,r,i,o){let x,T,C,D,R,V,H,K,ct,gt,d=0,_=0;const _t=[],$t=l[r].x,ge=l[r+i-1].x-$t;for(x=r;x<r+i;++x){T=l[x],C=(T.x-$t)/ge*o,D=T.y;const ce=0|C;if(ce===R)D<ct?(ct=D,V=x):D>gt&&(gt=D,H=x),d=(_*d+T.x)/++_;else{const _e=x-1;if(!Ci(V)&&!Ci(H)){const Ve=Math.min(V,H),Pe=Math.max(V,H);Ve!==K&&Ve!==_e&&_t.push({...l[Ve],x:d}),Pe!==K&&Pe!==_e&&_t.push({...l[Pe],x:d})}x>0&&_e!==K&&_t.push(l[_e]),_t.push(T),R=ce,_=0,ct=gt=D,V=H=K=x}}return _t}(D,V,H,o);break;default:throw new Error(`Unsupported decimation algorithm '${i.algorithm}'`)}d._decimated=ct}})},destroy(l){Tf(l)}};function tp(l,r,i,o){if(o)return;let d=r[l],_=i[l];return"angle"===l&&(d=Nn(d),_=Nn(_)),{property:l,start:d,end:_}}function Sa(l,r,i){for(;r>l;r--){const o=i[r];if(!isNaN(o.x)&&!isNaN(o.y))break}return r}function Cf(l,r,i,o){return l&&r?o(l[i],r[i]):l?l[i]:r?r[i]:0}function Mf(l,r){let i=[],o=!1;return Ji(l)?(o=!0,i=l):i=function Sf(l,r){const{x:i=null,y:o=null}=l||{},d=r.points,_=[];return r.segments.forEach(({start:x,end:T})=>{T=Sa(x,T,d);const C=d[x],D=d[T];null!==o?(_.push({x:C.x,y:o}),_.push({x:D.x,y:o})):null!==i&&(_.push({x:i,y:C.y}),_.push({x:i,y:D.y}))}),_}(l,r),i.length?new Lu({points:i,options:{tension:0},_loop:o,_fullLoop:o}):null}function Ef(l){return l&&!1!==l.fill}function Af(l,r,i){let d=l[r].fill;const _=[r];let x;if(!i)return d;for(;!1!==d&&-1===_.indexOf(d);){if(!yn(d))return d;if(x=l[d],!x)return!1;if(x.visible)return d;_.push(d),d=x.fill}return!1}function kf(l,r,i){const o=function ep(l){const r=l.options,i=r.fill;let o=oi(i&&i.target,i);return void 0===o&&(o=!!r.backgroundColor),!1!==o&&null!==o&&(!0===o?"origin":o)}(l);if(di(o))return!isNaN(o.value)&&o;let d=parseFloat(o);return yn(d)&&Math.floor(d)===d?function jm(l,r,i,o){return("-"===l||"+"===l)&&(i=r+i),!(i===r||i<0||i>=o)&&i}(o[0],r,d,i):["origin","start","end","stack","shape"].indexOf(o)>=0&&o}function qm(l,r,i){const o=[];for(let d=0;d<i.length;d++){const _=i[d],{first:x,last:T,point:C}=Hm(_,r,"x");if(!(!C||x&&T))if(x)o.unshift(C);else if(l.push(C),!T)break}l.push(...o)}function Hm(l,r,i){const o=l.interpolate(r,i);if(!o)return{};const d=o[i],_=l.segments,x=l.points;let T=!1,C=!1;for(let D=0;D<_.length;D++){const R=_[D],V=x[R.start][i],H=x[R.end][i];if(Oo(d,V,H)){T=d===V,C=d===H;break}}return{first:T,last:C,point:o}}class uc{constructor(r){this.x=r.x,this.y=r.y,this.radius=r.radius}pathSegment(r,i,o){const{x:d,y:_,radius:x}=this;return r.arc(d,_,x,(i=i||{start:0,end:tn}).end,i.start,!0),!o.bounds}interpolate(r){const{x:i,y:o,radius:d}=this,_=r.angle;return{x:i+Math.cos(_)*d,y:o+Math.sin(_)*d,angle:_}}}function Gu(l,r,i){const o=function Lh(l){const{chart:r,fill:i,line:o}=l;if(yn(i))return function Df(l,r){const i=l.getDatasetMeta(r);return i&&l.isDatasetVisible(r)?i.dataset:null}(r,i);if("stack"===i)return function ju(l){const{scale:r,index:i,line:o}=l,d=[],_=o.segments,x=o.points,T=function Zu(l,r){const i=[],o=l.getMatchingVisibleMetas("line");for(let d=0;d<o.length;d++){const _=o[d];if(_.index===r)break;_.hidden||i.unshift(_.dataset)}return i}(r,i);T.push(Mf({x:null,y:r.bottom},o));for(let C=0;C<_.length;C++){const D=_[C];for(let R=D.start;R<=D.end;R++)qm(d,x[R],T)}return new Lu({points:d,options:{}})}(l);if("shape"===i)return!0;const d=function Rh(l){return(l.scale||{}).getPointPositionForValue?function $m(l){const{scale:r,fill:i}=l,o=r.options,d=r.getLabels().length,_=o.reverse?r.max:r.min,x=function Gm(l,r,i){let o;return o="start"===l?i:"end"===l?r.options.reverse?r.min:r.max:di(l)?l.value:r.getBaseValue(),o}(i,r,_),T=[];if(o.grid.circular){const C=r.getPointPositionForValue(0,_);return new uc({x:C.x,y:C.y,radius:r.getDistanceFromCenterForValue(x)})}for(let C=0;C<d;++C)T.push(r.getPointPositionForValue(C,x));return T}(l):function Pf(l){const{scale:r={},fill:i}=l,o=function Zm(l,r){let i=null;return"start"===l?i=r.bottom:"end"===l?i=r.top:di(l)?i=r.getPixelForValue(l.value):r.getBasePixel&&(i=r.getBasePixel()),i}(i,r);if(yn(o)){const d=r.isHorizontal();return{x:d?o:null,y:d?null:o}}return null}(l)}(l);return d instanceof uc?d:Mf(d,o)}(r),{line:d,scale:_,axis:x}=r,T=d.options,C=T.fill,D=T.backgroundColor,{above:R=D,below:V=D}=C||{};o&&d.points.length&&(il(l,i),function If(l,r){const{line:i,target:o,above:d,below:_,area:x,scale:T}=r,C=i._loop?"angle":r.axis;l.save(),"x"===C&&_!==d&&(ip(l,o,x.top),np(l,{line:i,target:o,color:d,scale:T,property:C}),l.restore(),l.save(),ip(l,o,x.bottom)),np(l,{line:i,target:o,color:_,scale:T,property:C}),l.restore()}(l,{line:d,target:o,above:R,below:V,area:i,scale:_,axis:x}),nl(l))}function ip(l,r,i){const{segments:o,points:d}=r;let _=!0,x=!1;l.beginPath();for(const T of o){const{start:C,end:D}=T,R=d[C],V=d[Sa(C,D,d)];_?(l.moveTo(R.x,R.y),_=!1):(l.lineTo(R.x,i),l.lineTo(R.x,R.y)),x=!!r.pathSegment(l,T,{move:x}),x?l.closePath():l.lineTo(V.x,i)}l.lineTo(r.first().x,i),l.closePath(),l.clip()}function np(l,r){const{line:i,target:o,property:d,color:_,scale:x}=r,T=function Vu(l,r,i){const o=l.segments,d=l.points,_=r.points,x=[];for(const T of o){let{start:C,end:D}=T;D=Sa(C,D,d);const R=tp(i,d[C],d[D],T.loop);if(!r.segments){x.push({source:T,target:R,start:d[C],end:d[D]});continue}const V=xd(r,R);for(const H of V){const K=tp(i,_[H.start],_[H.end],H.loop),ct=xu(T,d,K);for(const gt of ct)x.push({source:gt,target:H,start:{[i]:Cf(R,K,"start",Math.max)},end:{[i]:Cf(R,K,"end",Math.min)}})}}return x}(i,o,d);for(const{source:C,target:D,start:R,end:V}of T){const{style:{backgroundColor:H=_}={}}=C,K=!0!==o;l.save(),l.fillStyle=H,Lf(l,x,K&&tp(d,R,V)),l.beginPath();const ct=!!i.pathSegment(l,C);let gt;if(K){ct?l.closePath():sp(l,o,V,d);const _t=!!o.pathSegment(l,D,{move:ct,reverse:!0});gt=ct&&_t,gt||sp(l,o,R,d)}l.closePath(),l.fill(gt?"evenodd":"nonzero"),l.restore()}}function Lf(l,r,i){const{top:o,bottom:d}=r.chart.chartArea,{property:_,start:x,end:T}=i||{};"x"===_&&(l.beginPath(),l.rect(x,o,T-x,d-o),l.clip())}function sp(l,r,i,o){const d=r.interpolate(i,o);d&&l.lineTo(d.x,d.y)}var Wm={id:"filler",afterDatasetsUpdate(l,r,i){const o=(l.data.datasets||[]).length,d=[];let _,x,T,C;for(x=0;x<o;++x)_=l.getDatasetMeta(x),T=_.dataset,C=null,T&&T.options&&T instanceof Lu&&(C={visible:l.isDatasetVisible(x),index:x,fill:kf(T,x,o),chart:l,axis:_.controller.options.indexAxis,scale:_.vScale,line:T}),_.$filler=C,d.push(C);for(x=0;x<o;++x)C=d[x],C&&!1!==C.fill&&(C.fill=Af(d,x,i.propagate))},beforeDraw(l,r,i){const o="beforeDraw"===i.drawTime,d=l.getSortedVisibleDatasetMetas(),_=l.chartArea;for(let x=d.length-1;x>=0;--x){const T=d[x].$filler;T&&(T.line.updateControlPoints(_,T.axis),o&&T.fill&&Gu(l.ctx,T,_))}},beforeDatasetsDraw(l,r,i){if("beforeDatasetsDraw"!==i.drawTime)return;const o=l.getSortedVisibleDatasetMetas();for(let d=o.length-1;d>=0;--d){const _=o[d].$filler;Ef(_)&&Gu(l.ctx,_,l.chartArea)}},beforeDatasetDraw(l,r,i){const o=r.meta.$filler;!Ef(o)||"beforeDatasetDraw"!==i.drawTime||Gu(l.ctx,o,l.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Rf=(l,r)=>{let{boxHeight:i=r,boxWidth:o=r}=l;return l.usePointStyle&&(i=Math.min(i,r),o=l.pointStyleWidth||Math.min(o,r)),{boxWidth:o,boxHeight:i,itemHeight:Math.max(r,i)}};class zh extends Ns{constructor(r){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=r.chart,this.options=r.options,this.ctx=r.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(r,i,o){this.maxWidth=r,this.maxHeight=i,this._margins=o,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const r=this.options.labels||{};let i=Ki(r.generateLabels,[this.chart],this)||[];r.filter&&(i=i.filter(o=>r.filter(o,this.chart.data))),r.sort&&(i=i.sort((o,d)=>r.sort(o,d,this.chart.data))),this.options.reverse&&i.reverse(),this.legendItems=i}fit(){const{options:r,ctx:i}=this;if(!r.display)return void(this.width=this.height=0);const o=r.labels,d=P(o.font),_=d.size,x=this._computeTitleHeight(),{boxWidth:T,itemHeight:C}=Rf(o,_);let D,R;i.font=d.string,this.isHorizontal()?(D=this.maxWidth,R=this._fitRows(x,_,T,C)+10):(R=this.maxHeight,D=this._fitCols(x,d,T,C)+10),this.width=Math.min(D,r.maxWidth||this.maxWidth),this.height=Math.min(R,r.maxHeight||this.maxHeight)}_fitRows(r,i,o,d){const{ctx:_,maxWidth:x,options:{labels:{padding:T}}}=this,C=this.legendHitBoxes=[],D=this.lineWidths=[0],R=d+T;let V=r;_.textAlign="left",_.textBaseline="middle";let H=-1,K=-R;return this.legendItems.forEach((ct,gt)=>{const _t=o+i/2+_.measureText(ct.text).width;(0===gt||D[D.length-1]+_t+2*T>x)&&(V+=R,D[D.length-(gt>0?0:1)]=0,K+=R,H++),C[gt]={left:0,top:K,row:H,width:_t,height:d},D[D.length-1]+=_t+T}),V}_fitCols(r,i,o,d){const{ctx:_,maxHeight:x,options:{labels:{padding:T}}}=this,C=this.legendHitBoxes=[],D=this.columnSizes=[],R=x-r;let V=T,H=0,K=0,ct=0,gt=0;return this.legendItems.forEach((_t,Xt)=>{const{itemWidth:$t,itemHeight:me}=function Of(l,r,i,o,d){const _=function _s(l,r,i,o){let d=l.text;return d&&"string"!=typeof d&&(d=d.reduce((_,x)=>_.length>x.length?_:x)),r+i.size/2+o.measureText(d).width}(o,l,r,i),x=function Oh(l,r,i){let o=l;return"string"!=typeof r.text&&(o=fl(r,i)),o}(d,o,r.lineHeight);return{itemWidth:_,itemHeight:x}}(o,i,_,_t,d);Xt>0&&K+me+2*T>R&&(V+=H+T,D.push({width:H,height:K}),ct+=H+T,gt++,H=K=0),C[Xt]={left:ct,top:K,col:gt,width:$t,height:me},H=Math.max(H,$t),K+=me+T}),V+=H,D.push({width:H,height:K}),V}adjustHitBoxes(){if(!this.options.display)return;const r=this._computeTitleHeight(),{legendHitBoxes:i,options:{align:o,labels:{padding:d},rtl:_}}=this,x=Vn(_,this.left,this.width);if(this.isHorizontal()){let T=0,C=kn(o,this.left+d,this.right-this.lineWidths[T]);for(const D of i)T!==D.row&&(T=D.row,C=kn(o,this.left+d,this.right-this.lineWidths[T])),D.top+=this.top+r+d,D.left=x.leftForLtr(x.x(C),D.width),C+=D.width+d}else{let T=0,C=kn(o,this.top+r+d,this.bottom-this.columnSizes[T].height);for(const D of i)D.col!==T&&(T=D.col,C=kn(o,this.top+r+d,this.bottom-this.columnSizes[T].height)),D.top=C,D.left+=this.left+d,D.left=x.leftForLtr(x.x(D.left),D.width),C+=D.height+d}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const r=this.ctx;il(r,this),this._draw(),nl(r)}}_draw(){const{options:r,columnSizes:i,lineWidths:o,ctx:d}=this,{align:_,labels:x}=r,T=hn.color,C=Vn(r.rtl,this.left,this.width),D=P(x.font),{padding:R}=x,V=D.size,H=V/2;let K;this.drawTitle(),d.textAlign=C.textAlign("left"),d.textBaseline="middle",d.lineWidth=.5,d.font=D.string;const{boxWidth:ct,boxHeight:gt,itemHeight:_t}=Rf(x,V),me=this.isHorizontal(),ge=this._computeTitleHeight();K=me?{x:kn(_,this.left+R,this.right-o[0]),y:this.top+R+ge,line:0}:{x:this.left+R,y:kn(_,this.top+ge+R,this.bottom-i[0].height),line:0},fo(this.ctx,r.textDirection);const ce=_t+R;this.legendItems.forEach((_e,Ve)=>{d.strokeStyle=_e.fontColor,d.fillStyle=_e.fontColor;const Pe=d.measureText(_e.text).width,qe=C.textAlign(_e.textAlign||(_e.textAlign=x.textAlign)),yi=ct+H+Pe;let li=K.x,Ai=K.y;C.setWidth(this.width),me?Ve>0&&li+yi+R>this.right&&(Ai=K.y+=ce,K.line++,li=K.x=kn(_,this.left+R,this.right-o[K.line])):Ve>0&&Ai+ce>this.bottom&&(li=K.x=li+i[K.line].width+R,K.line++,Ai=K.y=kn(_,this.top+ge+R,this.bottom-i[K.line].height)),function(_e,Ve,Pe){if(isNaN(ct)||ct<=0||isNaN(gt)||gt<0)return;d.save();const qe=oi(Pe.lineWidth,1);if(d.fillStyle=oi(Pe.fillStyle,T),d.lineCap=oi(Pe.lineCap,"butt"),d.lineDashOffset=oi(Pe.lineDashOffset,0),d.lineJoin=oi(Pe.lineJoin,"miter"),d.lineWidth=qe,d.strokeStyle=oi(Pe.strokeStyle,T),d.setLineDash(oi(Pe.lineDash,[])),x.usePointStyle){const yi={radius:gt*Math.SQRT2/2,pointStyle:Pe.pointStyle,rotation:Pe.rotation,borderWidth:qe},li=C.xPlus(_e,ct/2);ic(d,yi,li,Ve+H,x.pointStyleWidth&&ct)}else{const yi=Ve+Math.max((V-gt)/2,0),li=C.leftForLtr(_e,ct),Ai=E(Pe.borderRadius);d.beginPath(),Object.values(Ai).some(Mn=>0!==Mn)?Fo(d,{x:li,y:yi,w:ct,h:gt,radius:Ai}):d.rect(li,yi,ct,gt),d.fill(),0!==qe&&d.stroke()}d.restore()}(C.x(li),Ai,_e),li=((l,r,i,o)=>l===(o?"left":"right")?i:"center"===l?(r+i)/2:r)(qe,li+ct+H,me?li+yi:this.right,r.rtl),function(_e,Ve,Pe){po(d,Pe.text,_e,Ve+_t/2,D,{strikethrough:Pe.hidden,textAlign:C.textAlign(Pe.textAlign)})}(C.x(li),Ai,_e),me?K.x+=yi+R:K.y+="string"!=typeof _e.text?fl(_e,D.lineHeight):ce}),Uo(this.ctx,r.textDirection)}drawTitle(){const r=this.options,i=r.title,o=P(i.font),d=A(i.padding);if(!i.display)return;const _=Vn(r.rtl,this.left,this.width),x=this.ctx,T=i.position,D=d.top+o.size/2;let R,V=this.left,H=this.width;if(this.isHorizontal())H=Math.max(...this.lineWidths),R=this.top+D,V=kn(r.align,V,this.right-H);else{const ct=this.columnSizes.reduce((gt,_t)=>Math.max(gt,_t.height),0);R=D+kn(r.align,this.top,this.bottom-ct-r.labels.padding-this._computeTitleHeight())}const K=kn(T,V,V+H);x.textAlign=_.textAlign(ar(T)),x.textBaseline="middle",x.strokeStyle=i.color,x.fillStyle=i.color,x.font=o.string,po(x,i.text,K,R,o)}_computeTitleHeight(){const r=this.options.title,i=P(r.font),o=A(r.padding);return r.display?i.lineHeight+o.height:0}_getLegendItemAt(r,i){let o,d,_;if(Oo(r,this.left,this.right)&&Oo(i,this.top,this.bottom))for(_=this.legendHitBoxes,o=0;o<_.length;++o)if(d=_[o],Oo(r,d.left,d.left+d.width)&&Oo(i,d.top,d.top+d.height))return this.legendItems[o];return null}handleEvent(r){const i=this.options;if(!function Bh(l,r){return!(("mousemove"!==l&&"mouseout"!==l||!r.onHover&&!r.onLeave)&&(!r.onClick||"click"!==l&&"mouseup"!==l))}(r.type,i))return;const o=this._getLegendItemAt(r.x,r.y);if("mousemove"===r.type||"mouseout"===r.type){const d=this._hoveredItem,_=((l,r)=>null!==l&&null!==r&&l.datasetIndex===r.datasetIndex&&l.index===r.index)(d,o);d&&!_&&Ki(i.onLeave,[r,d,this],this),this._hoveredItem=o,o&&!_&&Ki(i.onHover,[r,o,this],this)}else o&&Ki(i.onClick,[r,o,this],this)}}function fl(l,r){return r*(l.text?l.text.length+.5:0)}var Bf={id:"legend",_element:zh,start(l,r,i){const o=l.legend=new zh({ctx:l.ctx,options:i,chart:l});fs.configure(l,o,i),fs.addBox(l,o)},stop(l){fs.removeBox(l,l.legend),delete l.legend},beforeUpdate(l,r,i){const o=l.legend;fs.configure(l,o,i),o.options=i},afterUpdate(l){const r=l.legend;r.buildLabels(),r.adjustHitBoxes()},afterEvent(l,r){r.replay||l.legend.handleEvent(r.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(l,r,i){const o=r.datasetIndex,d=i.chart;d.isDatasetVisible(o)?(d.hide(o),r.hidden=!0):(d.show(o),r.hidden=!1)},onHover:null,onLeave:null,labels:{color:l=>l.chart.options.color,boxWidth:40,padding:10,generateLabels(l){const r=l.data.datasets,{labels:{usePointStyle:i,pointStyle:o,textAlign:d,color:_,useBorderRadius:x,borderRadius:T}}=l.legend.options;return l._getSortedDatasetMetas().map(C=>{const D=C.controller.getStyle(i?0:void 0),R=A(D.borderWidth);return{text:r[C.index].label,fillStyle:D.backgroundColor,fontColor:_,hidden:!C.visible,lineCap:D.borderCapStyle,lineDash:D.borderDash,lineDashOffset:D.borderDashOffset,lineJoin:D.borderJoinStyle,lineWidth:(R.width+R.height)/4,strokeStyle:D.borderColor,pointStyle:o||D.pointStyle,rotation:D.rotation,textAlign:d||D.textAlign,borderRadius:x&&(T||D.borderRadius),datasetIndex:C.index}},this)}},title:{color:l=>l.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:l=>!l.startsWith("on"),labels:{_scriptable:l=>!["generateLabels","filter","sort"].includes(l)}}};class qu extends Ns{constructor(r){super(),this.chart=r.chart,this.options=r.options,this.ctx=r.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(r,i){const o=this.options;if(this.left=0,this.top=0,!o.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=r,this.height=this.bottom=i;const d=Ji(o.text)?o.text.length:1;this._padding=A(o.padding);const _=d*P(o.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=_:this.width=_}isHorizontal(){const r=this.options.position;return"top"===r||"bottom"===r}_drawArgs(r){const{top:i,left:o,bottom:d,right:_,options:x}=this,T=x.align;let D,R,V,C=0;return this.isHorizontal()?(R=kn(T,o,_),V=i+r,D=_-o):("left"===x.position?(R=o+r,V=kn(T,d,i),C=-.5*Qi):(R=_-r,V=kn(T,i,d),C=.5*Qi),D=d-i),{titleX:R,titleY:V,maxWidth:D,rotation:C}}draw(){const r=this.ctx,i=this.options;if(!i.display)return;const o=P(i.font),_=o.lineHeight/2+this._padding.top,{titleX:x,titleY:T,maxWidth:C,rotation:D}=this._drawArgs(_);po(r,i.text,0,0,o,{color:i.color,maxWidth:C,rotation:D,textAlign:ar(i.align),textBaseline:"middle",translation:[x,T]})}}var Ym={id:"title",_element:qu,start(l,r,i){!function Xm(l,r){const i=new qu({ctx:l.ctx,options:r,chart:l});fs.configure(l,i,r),fs.addBox(l,i),l.titleBlock=i}(l,i)},stop(l){fs.removeBox(l,l.titleBlock),delete l.titleBlock},beforeUpdate(l,r,i){const o=l.titleBlock;fs.configure(l,o,i),o.options=i},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Hu=new WeakMap;var Jm={id:"subtitle",start(l,r,i){const o=new qu({ctx:l.ctx,options:i,chart:l});fs.configure(l,o,i),fs.addBox(l,o),Hu.set(l,o)},stop(l){fs.removeBox(l,Hu.get(l)),Hu.delete(l)},beforeUpdate(l,r,i){const o=Hu.get(l);fs.configure(l,o,i),o.options=i},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Fh={average(l){if(!l.length)return!1;let r,i,o=0,d=0,_=0;for(r=0,i=l.length;r<i;++r){const x=l[r].element;if(x&&x.hasValue()){const T=x.tooltipPosition();o+=T.x,d+=T.y,++_}}return{x:o/_,y:d/_}},nearest(l,r){if(!l.length)return!1;let _,x,T,i=r.x,o=r.y,d=Number.POSITIVE_INFINITY;for(_=0,x=l.length;_<x;++_){const C=l[_].element;if(C&&C.hasValue()){const R=Ya(r,C.getCenterPoint());R<d&&(d=R,T=C)}}if(T){const C=T.tooltipPosition();i=C.x,o=C.y}return{x:i,y:o}}};function pr(l,r){return r&&(Ji(r)?Array.prototype.push.apply(l,r):l.push(r)),l}function yo(l){return("string"==typeof l||l instanceof String)&&l.indexOf("\n")>-1?l.split("\n"):l}function Km(l,r){const{element:i,datasetIndex:o,index:d}=r,_=l.getDatasetMeta(o).controller,{label:x,value:T}=_.getLabelAndValue(d);return{chart:l,label:x,parsed:_.getParsed(d),raw:l.data.datasets[o].data[d],formattedValue:T,dataset:_.getDataset(),dataIndex:d,datasetIndex:o,element:i}}function op(l,r){const i=l.chart.ctx,{body:o,footer:d,title:_}=l,{boxWidth:x,boxHeight:T}=r,C=P(r.bodyFont),D=P(r.titleFont),R=P(r.footerFont),V=_.length,H=d.length,K=o.length,ct=A(r.padding);let gt=ct.height,_t=0,Xt=o.reduce((ge,ce)=>ge+ce.before.length+ce.lines.length+ce.after.length,0);Xt+=l.beforeBody.length+l.afterBody.length,V&&(gt+=V*D.lineHeight+(V-1)*r.titleSpacing+r.titleMarginBottom),Xt&&(gt+=K*(r.displayColors?Math.max(T,C.lineHeight):C.lineHeight)+(Xt-K)*C.lineHeight+(Xt-1)*r.bodySpacing),H&&(gt+=r.footerMarginTop+H*R.lineHeight+(H-1)*r.footerSpacing);let $t=0;const me=function(ge){_t=Math.max(_t,i.measureText(ge).width+$t)};return i.save(),i.font=D.string,Li(l.title,me),i.font=C.string,Li(l.beforeBody.concat(l.afterBody),me),$t=r.displayColors?x+2+r.boxPadding:0,Li(o,ge=>{Li(ge.before,me),Li(ge.lines,me),Li(ge.after,me)}),$t=0,i.font=R.string,Li(l.footer,me),i.restore(),_t+=ct.width,{width:_t,height:gt}}function Qm(l,r,i,o){const{x:d,width:_}=i,{width:x,chartArea:{left:T,right:C}}=l;let D="center";return"center"===o?D=d<=(T+C)/2?"left":"right":d<=_/2?D="left":d>=x-_/2&&(D="right"),function Uf(l,r,i,o){const{x:d,width:_}=o,x=i.caretSize+i.caretPadding;if("left"===l&&d+_+x>r.width||"right"===l&&d-_-x<0)return!0}(D,l,r,i)&&(D="center"),D}function Nf(l,r,i){const o=i.yAlign||r.yAlign||function Ff(l,r){const{y:i,height:o}=r;return i<o/2?"top":i>l.height-o/2?"bottom":"center"}(l,i);return{xAlign:i.xAlign||r.xAlign||Qm(l,r,i,o),yAlign:o}}function Vf(l,r,i,o){const{caretSize:d,caretPadding:_,cornerRadius:x}=l,{xAlign:T,yAlign:C}=i,D=d+_,{topLeft:R,topRight:V,bottomLeft:H,bottomRight:K}=E(x);let ct=function tg(l,r){let{x:i,width:o}=l;return"right"===r?i-=o:"center"===r&&(i-=o/2),i}(r,T);const gt=function eg(l,r,i){let{y:o,height:d}=l;return"top"===r?o+=i:o-="bottom"===r?d+i:d/2,o}(r,C,D);return"center"===C?"left"===T?ct+=D:"right"===T&&(ct-=D):"left"===T?ct-=Math.max(R,H)+d:"right"===T&&(ct+=Math.max(V,K)+d),{x:Mi(ct,0,o.width-r.width),y:Mi(gt,0,o.height-r.height)}}function Uh(l,r,i){const o=A(i.padding);return"center"===r?l.x+l.width/2:"right"===r?l.x+l.width-o.right:l.x+o.left}function jf(l){return pr([],yo(l))}function Go(l,r){const i=r&&r.dataset&&r.dataset.tooltip&&r.dataset.tooltip.callbacks;return i?l.override(i):l}const $u={beforeTitle:Kn,title(l){if(l.length>0){const r=l[0],i=r.chart.data.labels,o=i?i.length:0;if(this&&this.options&&"dataset"===this.options.mode)return r.dataset.label||"";if(r.label)return r.label;if(o>0&&r.dataIndex<o)return i[r.dataIndex]}return""},afterTitle:Kn,beforeBody:Kn,beforeLabel:Kn,label(l){if(this&&this.options&&"dataset"===this.options.mode)return l.label+": "+l.formattedValue||l.formattedValue;let r=l.dataset.label||"";r&&(r+=": ");const i=l.formattedValue;return Ci(i)||(r+=i),r},labelColor(l){const i=l.chart.getDatasetMeta(l.datasetIndex).controller.getStyle(l.dataIndex);return{borderColor:i.borderColor,backgroundColor:i.backgroundColor,borderWidth:i.borderWidth,borderDash:i.borderDash,borderDashOffset:i.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(l){const i=l.chart.getDatasetMeta(l.datasetIndex).controller.getStyle(l.dataIndex);return{pointStyle:i.pointStyle,rotation:i.rotation}},afterLabel:Kn,afterBody:Kn,beforeFooter:Kn,footer:Kn,afterFooter:Kn};function is(l,r,i,o){const d=l[r].call(i,o);return typeof d>"u"?$u[r].call(i,o):d}let ml=(()=>{class l extends Ns{constructor(i){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=i.chart,this.options=i.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(i){this.options=i,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const i=this._cachedAnimations;if(i)return i;const o=this.chart,d=this.options.setContext(this.getContext()),_=d.enabled&&o.options.animation&&d.animations,x=new vu(this.chart,_);return _._cacheable&&(this._cachedAnimations=Object.freeze(x)),x}getContext(){return this.$context||(this.$context=function Yn(l,r,i){return U(l,{tooltip:r,tooltipItems:i,type:"tooltip"})}(this.chart.getContext(),this,this._tooltipItems))}getTitle(i,o){const{callbacks:d}=o,_=is(d,"beforeTitle",this,i),x=is(d,"title",this,i),T=is(d,"afterTitle",this,i);let C=[];return C=pr(C,yo(_)),C=pr(C,yo(x)),C=pr(C,yo(T)),C}getBeforeBody(i,o){return jf(is(o.callbacks,"beforeBody",this,i))}getBody(i,o){const{callbacks:d}=o,_=[];return Li(i,x=>{const T={before:[],lines:[],after:[]},C=Go(d,x);pr(T.before,yo(is(C,"beforeLabel",this,x))),pr(T.lines,is(C,"label",this,x)),pr(T.after,yo(is(C,"afterLabel",this,x))),_.push(T)}),_}getAfterBody(i,o){return jf(is(o.callbacks,"afterBody",this,i))}getFooter(i,o){const{callbacks:d}=o,_=is(d,"beforeFooter",this,i),x=is(d,"footer",this,i),T=is(d,"afterFooter",this,i);let C=[];return C=pr(C,yo(_)),C=pr(C,yo(x)),C=pr(C,yo(T)),C}_createItems(i){const o=this._active,d=this.chart.data,_=[],x=[],T=[];let D,R,C=[];for(D=0,R=o.length;D<R;++D)C.push(Km(this.chart,o[D]));return i.filter&&(C=C.filter((V,H,K)=>i.filter(V,H,K,d))),i.itemSort&&(C=C.sort((V,H)=>i.itemSort(V,H,d))),Li(C,V=>{const H=Go(i.callbacks,V);_.push(is(H,"labelColor",this,V)),x.push(is(H,"labelPointStyle",this,V)),T.push(is(H,"labelTextColor",this,V))}),this.labelColors=_,this.labelPointStyles=x,this.labelTextColors=T,this.dataPoints=C,C}update(i,o){const d=this.options.setContext(this.getContext()),_=this._active;let x,T=[];if(_.length){const C=Fh[d.position].call(this,_,this._eventPosition);T=this._createItems(d),this.title=this.getTitle(T,d),this.beforeBody=this.getBeforeBody(T,d),this.body=this.getBody(T,d),this.afterBody=this.getAfterBody(T,d),this.footer=this.getFooter(T,d);const D=this._size=op(this,d),R=Object.assign({},C,D),V=Nf(this.chart,d,R),H=Vf(d,R,V,this.chart);this.xAlign=V.xAlign,this.yAlign=V.yAlign,x={opacity:1,x:H.x,y:H.y,width:D.width,height:D.height,caretX:C.x,caretY:C.y}}else 0!==this.opacity&&(x={opacity:0});this._tooltipItems=T,this.$context=void 0,x&&this._resolveAnimations().update(this,x),i&&d.external&&d.external.call(this,{chart:this.chart,tooltip:this,replay:o})}drawCaret(i,o,d,_){const x=this.getCaretPosition(i,d,_);o.lineTo(x.x1,x.y1),o.lineTo(x.x2,x.y2),o.lineTo(x.x3,x.y3)}getCaretPosition(i,o,d){const{xAlign:_,yAlign:x}=this,{caretSize:T,cornerRadius:C}=d,{topLeft:D,topRight:R,bottomLeft:V,bottomRight:H}=E(C),{x:K,y:ct}=i,{width:gt,height:_t}=o;let Xt,$t,me,ge,ce,_e;return"center"===x?(ce=ct+_t/2,"left"===_?(Xt=K,$t=Xt-T,ge=ce+T,_e=ce-T):(Xt=K+gt,$t=Xt+T,ge=ce-T,_e=ce+T),me=Xt):($t="left"===_?K+Math.max(D,V)+T:"right"===_?K+gt-Math.max(R,H)-T:this.caretX,"top"===x?(ge=ct,ce=ge-T,Xt=$t-T,me=$t+T):(ge=ct+_t,ce=ge+T,Xt=$t+T,me=$t-T),_e=ge),{x1:Xt,x2:$t,x3:me,y1:ge,y2:ce,y3:_e}}drawTitle(i,o,d){const _=this.title,x=_.length;let T,C,D;if(x){const R=Vn(d.rtl,this.x,this.width);for(i.x=Uh(this,d.titleAlign,d),o.textAlign=R.textAlign(d.titleAlign),o.textBaseline="middle",T=P(d.titleFont),C=d.titleSpacing,o.fillStyle=d.titleColor,o.font=T.string,D=0;D<x;++D)o.fillText(_[D],R.x(i.x),i.y+T.lineHeight/2),i.y+=T.lineHeight+C,D+1===x&&(i.y+=d.titleMarginBottom-C)}}_drawColorBox(i,o,d,_,x){const T=this.labelColors[d],C=this.labelPointStyles[d],{boxHeight:D,boxWidth:R}=x,V=P(x.bodyFont),H=Uh(this,"left",x),K=_.x(H),gt=o.y+(D<V.lineHeight?(V.lineHeight-D)/2:0);if(x.usePointStyle){const _t={radius:Math.min(R,D)/2,pointStyle:C.pointStyle,rotation:C.rotation,borderWidth:1},Xt=_.leftForLtr(K,R)+R/2,$t=gt+D/2;i.strokeStyle=x.multiKeyBackground,i.fillStyle=x.multiKeyBackground,ec(i,_t,Xt,$t),i.strokeStyle=T.borderColor,i.fillStyle=T.backgroundColor,ec(i,_t,Xt,$t)}else{i.lineWidth=di(T.borderWidth)?Math.max(...Object.values(T.borderWidth)):T.borderWidth||1,i.strokeStyle=T.borderColor,i.setLineDash(T.borderDash||[]),i.lineDashOffset=T.borderDashOffset||0;const _t=_.leftForLtr(K,R),Xt=_.leftForLtr(_.xPlus(K,1),R-2),$t=E(T.borderRadius);Object.values($t).some(me=>0!==me)?(i.beginPath(),i.fillStyle=x.multiKeyBackground,Fo(i,{x:_t,y:gt,w:R,h:D,radius:$t}),i.fill(),i.stroke(),i.fillStyle=T.backgroundColor,i.beginPath(),Fo(i,{x:Xt,y:gt+1,w:R-2,h:D-2,radius:$t}),i.fill()):(i.fillStyle=x.multiKeyBackground,i.fillRect(_t,gt,R,D),i.strokeRect(_t,gt,R,D),i.fillStyle=T.backgroundColor,i.fillRect(Xt,gt+1,R-2,D-2))}i.fillStyle=this.labelTextColors[d]}drawBody(i,o,d){const{body:_}=this,{bodySpacing:x,bodyAlign:T,displayColors:C,boxHeight:D,boxWidth:R,boxPadding:V}=d,H=P(d.bodyFont);let K=H.lineHeight,ct=0;const gt=Vn(d.rtl,this.x,this.width),_t=function(qe){o.fillText(qe,gt.x(i.x+ct),i.y+K/2),i.y+=K+x},Xt=gt.textAlign(T);let $t,me,ge,ce,_e,Ve,Pe;for(o.textAlign=T,o.textBaseline="middle",o.font=H.string,i.x=Uh(this,Xt,d),o.fillStyle=d.bodyColor,Li(this.beforeBody,_t),ct=C&&"right"!==Xt?"center"===T?R/2+V:R+2+V:0,ce=0,Ve=_.length;ce<Ve;++ce){for($t=_[ce],me=this.labelTextColors[ce],o.fillStyle=me,Li($t.before,_t),ge=$t.lines,C&&ge.length&&(this._drawColorBox(o,i,ce,gt,d),K=Math.max(H.lineHeight,D)),_e=0,Pe=ge.length;_e<Pe;++_e)_t(ge[_e]),K=H.lineHeight;Li($t.after,_t)}ct=0,K=H.lineHeight,Li(this.afterBody,_t),i.y-=x}drawFooter(i,o,d){const _=this.footer,x=_.length;let T,C;if(x){const D=Vn(d.rtl,this.x,this.width);for(i.x=Uh(this,d.footerAlign,d),i.y+=d.footerMarginTop,o.textAlign=D.textAlign(d.footerAlign),o.textBaseline="middle",T=P(d.footerFont),o.fillStyle=d.footerColor,o.font=T.string,C=0;C<x;++C)o.fillText(_[C],D.x(i.x),i.y+T.lineHeight/2),i.y+=T.lineHeight+d.footerSpacing}}drawBackground(i,o,d,_){const{xAlign:x,yAlign:T}=this,{x:C,y:D}=i,{width:R,height:V}=d,{topLeft:H,topRight:K,bottomLeft:ct,bottomRight:gt}=E(_.cornerRadius);o.fillStyle=_.backgroundColor,o.strokeStyle=_.borderColor,o.lineWidth=_.borderWidth,o.beginPath(),o.moveTo(C+H,D),"top"===T&&this.drawCaret(i,o,d,_),o.lineTo(C+R-K,D),o.quadraticCurveTo(C+R,D,C+R,D+K),"center"===T&&"right"===x&&this.drawCaret(i,o,d,_),o.lineTo(C+R,D+V-gt),o.quadraticCurveTo(C+R,D+V,C+R-gt,D+V),"bottom"===T&&this.drawCaret(i,o,d,_),o.lineTo(C+ct,D+V),o.quadraticCurveTo(C,D+V,C,D+V-ct),"center"===T&&"left"===x&&this.drawCaret(i,o,d,_),o.lineTo(C,D+H),o.quadraticCurveTo(C,D,C+H,D),o.closePath(),o.fill(),_.borderWidth>0&&o.stroke()}_updateAnimationTarget(i){const o=this.chart,d=this.$animations,_=d&&d.x,x=d&&d.y;if(_||x){const T=Fh[i.position].call(this,this._active,this._eventPosition);if(!T)return;const C=this._size=op(this,i),D=Object.assign({},T,this._size),R=Nf(o,i,D),V=Vf(i,D,R,o);(_._to!==V.x||x._to!==V.y)&&(this.xAlign=R.xAlign,this.yAlign=R.yAlign,this.width=C.width,this.height=C.height,this.caretX=T.x,this.caretY=T.y,this._resolveAnimations().update(this,V))}}_willRender(){return!!this.opacity}draw(i){const o=this.options.setContext(this.getContext());let d=this.opacity;if(!d)return;this._updateAnimationTarget(o);const _={width:this.width,height:this.height},x={x:this.x,y:this.y};d=Math.abs(d)<.001?0:d;const T=A(o.padding);o.enabled&&(this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length)&&(i.save(),i.globalAlpha=d,this.drawBackground(x,i,_,o),fo(i,o.textDirection),x.y+=T.top,this.drawTitle(x,i,o),this.drawBody(x,i,o),this.drawFooter(x,i,o),Uo(i,o.textDirection),i.restore())}getActiveElements(){return this._active||[]}setActiveElements(i,o){const d=this._active,_=i.map(({datasetIndex:C,index:D})=>{const R=this.chart.getDatasetMeta(C);if(!R)throw new Error("Cannot find a dataset at index "+C);return{datasetIndex:C,element:R.data[D],index:D}}),x=!ha(d,_),T=this._positionChanged(_,o);(x||T)&&(this._active=_,this._eventPosition=o,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(i,o,d=!0){if(o&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const _=this.options,x=this._active||[],T=this._getActiveElements(i,x,o,d),C=this._positionChanged(T,i),D=o||!ha(T,x)||C;return D&&(this._active=T,(_.enabled||_.external)&&(this._eventPosition={x:i.x,y:i.y},this.update(!0,o))),D}_getActiveElements(i,o,d,_){const x=this.options;if("mouseout"===i.type)return[];if(!_)return o;const T=this.chart.getElementsAtEventForMode(i,x.mode,x,d);return x.reverse&&T.reverse(),T}_positionChanged(i,o){const{caretX:d,caretY:_,options:x}=this,T=Fh[x.position].call(this,i,o);return!1!==T&&(d!==T.x||_!==T.y)}}return(0,ke.Z)(l,"positioners",Fh),l})();var ng=Object.freeze({__proto__:null,Colors:Nu,Decimation:Vm,Filler:Wm,Legend:Bf,SubTitle:Jm,Title:Ym,Tooltip:{id:"tooltip",_element:ml,positioners:Fh,afterInit(l,r,i){i&&(l.tooltip=new ml({chart:l,options:i}))},beforeUpdate(l,r,i){l.tooltip&&l.tooltip.initialize(i)},reset(l,r,i){l.tooltip&&l.tooltip.initialize(i)},afterDraw(l){const r=l.tooltip;if(r&&r._willRender()){const i={tooltip:r};if(!1===l.notifyPlugins("beforeTooltipDraw",{...i,cancelable:!0}))return;r.draw(l.ctx),l.notifyPlugins("afterTooltipDraw",i)}},afterEvent(l,r){l.tooltip&&l.tooltip.handleEvent(r.event,r.replay,r.inChartArea)&&(r.changed=!0)},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(l,r)=>r.bodyFont.size,boxWidth:(l,r)=>r.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:$u},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:l=>"filter"!==l&&"itemSort"!==l&&"external"!==l,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]}});function dc(l){const r=this.getLabels();return l>=0&&l<r.length?r[l]:l}let Zf=(()=>{class l extends gs{constructor(i){super(i),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(i){const o=this._addedLabels;if(o.length){const d=this.getLabels();for(const{index:_,label:x}of o)d[_]===x&&d.splice(_,1);this._addedLabels=[]}super.init(i)}parse(i,o){if(Ci(i))return null;const d=this.getLabels();return o=isFinite(o)&&d[o]===i?o:function sg(l,r,i,o){const d=l.indexOf(r);return-1===d?((l,r,i,o)=>("string"==typeof r?(i=l.push(r)-1,o.unshift({index:i,label:r})):isNaN(r)&&(i=null),i))(l,r,i,o):d!==l.lastIndexOf(r)?i:d}(d,i,oi(o,i),this._addedLabels),((l,r)=>null===l?null:Mi(Math.round(l),0,r))(o,d.length-1)}determineDataLimits(){const{minDefined:i,maxDefined:o}=this.getUserBounds();let{min:d,max:_}=this.getMinMax(!0);"ticks"===this.options.bounds&&(i||(d=0),o||(_=this.getLabels().length-1)),this.min=d,this.max=_}buildTicks(){const i=this.min,o=this.max,d=this.options.offset,_=[];let x=this.getLabels();x=0===i&&o===x.length-1?x:x.slice(i,o+1),this._valueRange=Math.max(x.length-(d?0:1),1),this._startValue=this.min-(d?.5:0);for(let T=i;T<=o;T++)_.push({value:T});return _}getLabelForValue(i){return dc.call(this,i)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(i){return"number"!=typeof i&&(i=this.parse(i)),null===i?NaN:this.getPixelForDecimal((i-this._startValue)/this._valueRange)}getPixelForTick(i){const o=this.ticks;return i<0||i>o.length-1?null:this.getPixelForValue(o[i].value)}getValueForPixel(i){return Math.round(this._startValue+this.getDecimalForPixel(i)*this._valueRange)}getBasePixel(){return this.bottom}}return(0,ke.Z)(l,"id","category"),(0,ke.Z)(l,"defaults",{ticks:{callback:dc}}),l})();function Oi(l,r,{horizontal:i,minRotation:o}){const d=Qn(o),_=(i?Math.sin(d):Math.cos(d))||.001;return Math.min(r/_,.75*r*(""+l).length)}class pc extends gs{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(r,i){return Ci(r)||("number"==typeof r||r instanceof Number)&&!isFinite(+r)?null:+r}handleTickRangeOptions(){const{beginAtZero:r}=this.options,{minDefined:i,maxDefined:o}=this.getUserBounds();let{min:d,max:_}=this;const x=C=>d=i?d:C,T=C=>_=o?_:C;if(r){const C=Hn(d),D=Hn(_);C<0&&D<0?T(0):C>0&&D>0&&x(0)}if(d===_){let C=0===_?1:Math.abs(.05*_);T(_+C),r||x(d-C)}this.min=d,this.max=_}getTickLimit(){const r=this.options.ticks;let d,{maxTicksLimit:i,stepSize:o}=r;return o?(d=Math.ceil(this.max/o)-Math.floor(this.min/o)+1,d>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${o} would result generating up to ${d} ticks. Limiting to 1000.`),d=1e3)):(d=this.computeTickLimit(),i=i||11),i&&(d=Math.min(i,d)),d}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const r=this.options,i=r.ticks;let o=this.getTickLimit();o=Math.max(2,o);const x=function Gf(l,r){const i=[],{bounds:d,step:_,min:x,max:T,precision:C,count:D,maxTicks:R,maxDigits:V,includeBounds:H}=l,K=_||1,ct=R-1,{min:gt,max:_t}=r,Xt=!Ci(x),$t=!Ci(T),me=!Ci(D),ge=(_t-gt)/(V+1);let _e,Ve,Pe,qe,ce=pa((_t-gt)/ct/K)*K;if(ce<1e-14&&!Xt&&!$t)return[{value:gt},{value:_t}];qe=Math.ceil(_t/ce)-Math.floor(gt/ce),qe>ct&&(ce=pa(qe*ce/ct/K)*K),Ci(C)||(_e=Math.pow(10,C),ce=Math.ceil(ce*_e)/_e),"ticks"===d?(Ve=Math.floor(gt/ce)*ce,Pe=Math.ceil(_t/ce)*ce):(Ve=gt,Pe=_t),Xt&&$t&&_&&function du(l,r){const i=Math.round(l);return i-r<=l&&i+r>=l}((T-x)/_,ce/1e3)?(qe=Math.round(Math.min((T-x)/ce,R)),ce=(T-x)/qe,Ve=x,Pe=T):me?(Ve=Xt?x:Ve,Pe=$t?T:Pe,qe=D-1,ce=(Pe-Ve)/qe):(qe=(Pe-Ve)/ce,qe=Ro(qe,Math.round(qe),ce/1e3)?Math.round(qe):Math.ceil(qe));const yi=Math.max(Fc(ce),Fc(Ve));_e=Math.pow(10,Ci(C)?yi:C),Ve=Math.round(Ve*_e)/_e,Pe=Math.round(Pe*_e)/_e;let li=0;for(Xt&&(H&&Ve!==x?(i.push({value:x}),Ve<x&&li++,Ro(Math.round((Ve+li*ce)*_e)/_e,x,Oi(x,ge,l))&&li++):Ve<x&&li++);li<qe;++li){const Ai=Math.round((Ve+li*ce)*_e)/_e;if($t&&Ai>T)break;i.push({value:Ai})}return $t&&H&&Pe!==T?i.length&&Ro(i[i.length-1].value,T,Oi(T,ge,l))?i[i.length-1].value=T:i.push({value:T}):(!$t||Pe===T)&&i.push({value:Pe}),i}({maxTicks:o,bounds:r.bounds,min:r.min,max:r.max,precision:i.precision,step:i.stepSize,count:i.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:i.minRotation||0,includeBounds:!1!==i.includeBounds},this._range||this);return"ticks"===r.bounds&&ql(x,this,"value"),r.reverse?(x.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),x}configure(){const r=this.ticks;let i=this.min,o=this.max;if(super.configure(),this.options.offset&&r.length){const d=(o-i)/Math.max(r.length-1,1)/2;i-=d,o+=d}this._startValue=i,this._endValue=o,this._valueRange=o-i}getLabelForValue(r){return De(r,this.chart.options.locale,this.options.ticks.format)}}class Wu extends pc{determineDataLimits(){const{min:r,max:i}=this.getMinMax(!0);this.min=yn(r)?r:0,this.max=yn(i)?i:1,this.handleTickRangeOptions()}computeTickLimit(){const r=this.isHorizontal(),i=r?this.width:this.height,o=Qn(this.options.ticks.minRotation),d=(r?Math.sin(o):Math.cos(o))||.001,_=this._resolveTickFontOptions(0);return Math.ceil(i/Math.min(40,_.lineHeight/d))}getPixelForValue(r){return null===r?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getValueForPixel(r){return this._startValue+this.getDecimalForPixel(r)*this._valueRange}}(0,ke.Z)(Wu,"id","linear"),(0,ke.Z)(Wu,"defaults",{ticks:{callback:lr.formatters.numeric}});const fc=l=>Math.floor(us(l)),ks=(l,r)=>Math.pow(10,fc(l)+r);function gl(l){return l/Math.pow(10,fc(l))==1}function rp(l,r,i){const o=Math.pow(10,i),d=Math.floor(l/o);return Math.ceil(r/o)-d}class ap extends gs{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(r,i){const o=pc.prototype.parse.apply(this,[r,i]);if(0!==o)return yn(o)&&o>0?o:null;this._zero=!0}determineDataLimits(){const{min:r,max:i}=this.getMinMax(!0);this.min=yn(r)?Math.max(0,r):null,this.max=yn(i)?Math.max(0,i):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!yn(this._userMin)&&(this.min=r===ks(this.min,0)?ks(this.min,-1):ks(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:r,maxDefined:i}=this.getUserBounds();let o=this.min,d=this.max;const _=T=>o=r?o:T,x=T=>d=i?d:T;o===d&&(o<=0?(_(1),x(10)):(_(ks(o,-1)),x(ks(d,1)))),o<=0&&_(ks(d,-1)),d<=0&&x(ks(o,1)),this.min=o,this.max=d}buildTicks(){const r=this.options,o=function ag(l,{min:r,max:i}){r=hs(l.min,r);const o=[],d=fc(r);let _=function rg(l,r){let o=fc(r-l);for(;rp(l,r,o)>10;)o++;for(;rp(l,r,o)<10;)o--;return Math.min(o,fc(l))}(r,i),x=_<0?Math.pow(10,Math.abs(_)):1;const T=Math.pow(10,_),C=d>_?Math.pow(10,d):0,D=Math.round((r-C)*x)/x,R=Math.floor((r-C)/T/10)*T*10;let V=Math.floor((D-R)/Math.pow(10,_)),H=hs(l.min,Math.round((C+R+V*Math.pow(10,_))*x)/x);for(;H<i;)o.push({value:H,major:gl(H),significand:V}),V>=10?V=V<15?15:20:V++,V>=20&&(_++,V=2,x=_>=0?1:x),H=Math.round((C+R+V*Math.pow(10,_))*x)/x;const K=hs(l.max,H);return o.push({value:K,major:gl(K),significand:V}),o}({min:this._userMin,max:this._userMax},this);return"ticks"===r.bounds&&ql(o,this,"value"),r.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}getLabelForValue(r){return void 0===r?"0":De(r,this.chart.options.locale,this.options.ticks.format)}configure(){const r=this.min;super.configure(),this._startValue=us(r),this._valueRange=us(this.max)-us(r)}getPixelForValue(r){return(void 0===r||0===r)&&(r=this.min),null===r||isNaN(r)?NaN:this.getPixelForDecimal(r===this.min?0:(us(r)-this._startValue)/this._valueRange)}getValueForPixel(r){const i=this.getDecimalForPixel(r);return Math.pow(10,this._startValue+i*this._valueRange)}}function lp(l){const r=l.ticks;if(r.display&&l.display){const i=A(r.backdropPadding);return oi(r.font&&r.font.size,hn.font.size)+i.height}return 0}function lg(l,r,i){return i=Ji(i)?i:[i],{w:_a(l,r.string,i),h:i.length*r.lineHeight}}function qf(l,r,i,o,d){return l===o||l===d?{start:r-i/2,end:r+i/2}:l<o||l>d?{start:r-i,end:r}:{start:r,end:r+i}}function hg(l,r,i,o,d){const _=Math.abs(Math.sin(i)),x=Math.abs(Math.cos(i));let T=0,C=0;o.start<r.l?(T=(r.l-o.start)/_,l.l=Math.min(l.l,r.l-T)):o.end>r.r&&(T=(o.end-r.r)/_,l.r=Math.max(l.r,r.r+T)),d.start<r.t?(C=(r.t-d.start)/x,l.t=Math.min(l.t,r.t-C)):d.end>r.b&&(C=(d.end-r.b)/x,l.b=Math.max(l.b,r.b+C))}function ug(l,r,i){const o=l.drawingArea,{extra:d,additionalAngle:_,padding:x,size:T}=i,C=l.getPointPosition(r,o+d+x,_),D=Math.round(rr(Nn(C.angle+$i))),R=function pg(l,r,i){return 90===i||270===i?l-=r/2:(i>270||i<90)&&(l-=r),l}(C.y,T.h,D),V=function Hf(l){return 0===l||180===l?"center":l<180?"left":"right"}(D),H=function dg(l,r,i){return"right"===i?l-=r:"center"===i&&(l-=r/2),l}(C.x,T.w,V);return{visible:!0,x:C.x,y:R,textAlign:V,left:H,top:R,right:H+T.w,bottom:R+T.h}}function Xu(l,r){if(!r)return!0;const{left:i,top:o,right:d,bottom:_}=l;return!(uo({x:i,y:o},r)||uo({x:i,y:_},r)||uo({x:d,y:o},r)||uo({x:d,y:_},r))}function fg(l,r,i){const{left:o,top:d,right:_,bottom:x}=i,{backdropColor:T}=r;if(!Ci(T)){const C=E(r.borderRadius),D=A(r.backdropPadding);l.fillStyle=T;const R=o-D.left,V=d-D.top,H=_-o+D.width,K=x-d+D.height;Object.values(C).some(ct=>0!==ct)?(l.beginPath(),Fo(l,{x:R,y:V,w:H,h:K,radius:C}),l.fill()):l.fillRect(R,V,H,K)}}function Yu(l,r,i,o){const{ctx:d}=l;if(i)d.arc(l.xCenter,l.yCenter,r,0,tn);else{let _=l.getPointPosition(0,r);d.moveTo(_.x,_.y);for(let x=1;x<o;x++)_=l.getPointPosition(x,r),d.lineTo(_.x,_.y)}}(0,ke.Z)(ap,"id","logarithmic"),(0,ke.Z)(ap,"defaults",{ticks:{callback:lr.formatters.logarithmic,major:{enabled:!0}}});class Br extends pc{constructor(r){super(r),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const r=this._padding=A(lp(this.options)/2),i=this.width=this.maxWidth-r.width,o=this.height=this.maxHeight-r.height;this.xCenter=Math.floor(this.left+i/2+r.left),this.yCenter=Math.floor(this.top+o/2+r.top),this.drawingArea=Math.floor(Math.min(i,o)/2)}determineDataLimits(){const{min:r,max:i}=this.getMinMax(!1);this.min=yn(r)&&!isNaN(r)?r:0,this.max=yn(i)&&!isNaN(i)?i:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/lp(this.options))}generateTickLabels(r){pc.prototype.generateTickLabels.call(this,r),this._pointLabels=this.getLabels().map((i,o)=>{const d=Ki(this.options.pointLabels.callback,[i,o],this);return d||0===d?d:""}).filter((i,o)=>this.chart.getDataVisibility(o))}fit(){const r=this.options;r.display&&r.pointLabels.display?function cg(l){const r={l:l.left+l._padding.left,r:l.right-l._padding.right,t:l.top+l._padding.top,b:l.bottom-l._padding.bottom},i=Object.assign({},r),o=[],d=[],_=l._pointLabels.length,x=l.options.pointLabels,T=x.centerPointLabels?Qi/_:0;for(let C=0;C<_;C++){const D=x.setContext(l.getPointLabelContext(C));d[C]=D.padding;const R=l.getPointPosition(C,l.drawingArea+d[C],T),V=P(D.font),H=lg(l.ctx,V,l._pointLabels[C]);o[C]=H;const K=Nn(l.getIndexAngle(C)+T),ct=Math.round(rr(K));hg(i,r,K,qf(ct,R.x,H.w,0,180),qf(ct,R.y,H.h,90,270))}l.setCenterPoint(r.l-i.l,i.r-r.r,r.t-i.t,i.b-r.b),l._pointLabelItems=function mc(l,r,i){const o=[],d=l._pointLabels.length,_=l.options,{centerPointLabels:x,display:T}=_.pointLabels,C={extra:lp(_)/2,additionalAngle:x?Qi/d:0};let D;for(let R=0;R<d;R++){C.padding=i[R],C.size=r[R];const V=ug(l,R,C);o.push(V),"auto"===T&&(V.visible=Xu(V,D),V.visible&&(D=V))}return o}(l,o,d)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(r,i,o,d){this.xCenter+=Math.floor((r-i)/2),this.yCenter+=Math.floor((o-d)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(r,i,o,d))}getIndexAngle(r){return Nn(r*(tn/(this._pointLabels.length||1))+Qn(this.options.startAngle||0))}getDistanceFromCenterForValue(r){if(Ci(r))return NaN;const i=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-r)*i:(r-this.min)*i}getValueForDistanceFromCenter(r){if(Ci(r))return NaN;const i=r/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-i:this.min+i}getPointLabelContext(r){const i=this._pointLabels||[];if(r>=0&&r<i.length){const o=i[r];return function io(l,r,i){return U(l,{label:i,index:r,type:"pointLabel"})}(this.getContext(),r,o)}}getPointPosition(r,i,o=0){const d=this.getIndexAngle(r)-$i+o;return{x:Math.cos(d)*i+this.xCenter,y:Math.sin(d)*i+this.yCenter,angle:d}}getPointPositionForValue(r,i){return this.getPointPosition(r,this.getDistanceFromCenterForValue(i))}getBasePosition(r){return this.getPointPositionForValue(r||0,this.getBaseValue())}getPointLabelPosition(r){const{left:i,top:o,right:d,bottom:_}=this._pointLabelItems[r];return{left:i,top:o,right:d,bottom:_}}drawBackground(){const{backgroundColor:r,grid:{circular:i}}=this.options;if(r){const o=this.ctx;o.save(),o.beginPath(),Yu(this,this.getDistanceFromCenterForValue(this._endValue),i,this._pointLabels.length),o.closePath(),o.fillStyle=r,o.fill(),o.restore()}}drawGrid(){const r=this.ctx,i=this.options,{angleLines:o,grid:d,border:_}=i,x=this._pointLabels.length;let T,C,D;if(i.pointLabels.display&&function cp(l,r){const{ctx:i,options:{pointLabels:o}}=l;for(let d=r-1;d>=0;d--){const _=l._pointLabelItems[d];if(!_.visible)continue;const x=o.setContext(l.getPointLabelContext(d));fg(i,x,_);const T=P(x.font),{x:C,y:D,textAlign:R}=_;po(i,l._pointLabels[d],C,D+T.lineHeight/2,T,{color:x.color,textAlign:R,textBaseline:"middle"})}}(this,x),d.display&&this.ticks.forEach((R,V)=>{if(0!==V){C=this.getDistanceFromCenterForValue(R.value);const H=this.getContext(V),K=d.setContext(H),ct=_.setContext(H);!function $f(l,r,i,o,d){const _=l.ctx,x=r.circular,{color:T,lineWidth:C}=r;!x&&!o||!T||!C||i<0||(_.save(),_.strokeStyle=T,_.lineWidth=C,_.setLineDash(d.dash),_.lineDashOffset=d.dashOffset,_.beginPath(),Yu(l,i,x,o),_.closePath(),_.stroke(),_.restore())}(this,K,C,x,ct)}}),o.display){for(r.save(),T=x-1;T>=0;T--){const R=o.setContext(this.getPointLabelContext(T)),{color:V,lineWidth:H}=R;!H||!V||(r.lineWidth=H,r.strokeStyle=V,r.setLineDash(R.borderDash),r.lineDashOffset=R.borderDashOffset,C=this.getDistanceFromCenterForValue(i.ticks.reverse?this.min:this.max),D=this.getPointPosition(T,C),r.beginPath(),r.moveTo(this.xCenter,this.yCenter),r.lineTo(D.x,D.y),r.stroke())}r.restore()}}drawBorder(){}drawLabels(){const r=this.ctx,i=this.options,o=i.ticks;if(!o.display)return;const d=this.getIndexAngle(0);let _,x;r.save(),r.translate(this.xCenter,this.yCenter),r.rotate(d),r.textAlign="center",r.textBaseline="middle",this.ticks.forEach((T,C)=>{if(0===C&&!i.reverse)return;const D=o.setContext(this.getContext(C)),R=P(D.font);if(_=this.getDistanceFromCenterForValue(this.ticks[C].value),D.showLabelBackdrop){r.font=R.string,x=r.measureText(T.label).width,r.fillStyle=D.backdropColor;const V=A(D.backdropPadding);r.fillRect(-x/2-V.left,-_-R.size/2-V.top,x+V.width,R.size+V.height)}po(r,T.label,0,-_,R,{color:D.color})}),r.restore()}drawTitle(){}}(0,ke.Z)(Br,"id","radialLinear"),(0,ke.Z)(Br,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:lr.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:l=>l,padding:5,centerPointLabels:!1}}),(0,ke.Z)(Br,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),(0,ke.Z)(Br,"descriptors",{angleLines:{_fallback:"grid"}});const Fr={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ys=Object.keys(Fr);function Ju(l,r){return l-r}function Wf(l,r){if(Ci(r))return null;const i=l._adapter,{parser:o,round:d,isoWeekday:_}=l._parseOpts;let x=r;return"function"==typeof o&&(x=o(x)),yn(x)||(x="string"==typeof o?i.parse(x,o):i.parse(x)),null===x?null:(d&&(x="week"!==d||!Un(_)&&!0!==_?i.startOf(x,d):i.startOf(x,"isoWeek",_)),+x)}function hp(l,r,i,o){const d=ys.length;for(let _=ys.indexOf(l);_<d-1;++_){const x=Fr[ys[_]];if(x.common&&Math.ceil((i-r)/((x.steps?x.steps:Number.MAX_SAFE_INTEGER)*x.size))<=o)return ys[_]}return ys[d-1]}function up(l,r,i){if(i){if(i.length){const{lo:o,hi:d}=Wl(i,r);l[i[o]>=r?i[o]:i[d]]=!0}}else l[r]=!0}function Ku(l,r,i){const o=[],d={},_=r.length;let x,T;for(x=0;x<_;++x)T=r[x],d[T]=x,o.push({value:T,major:!1});return 0!==_&&i?function Yf(l,r,i,o){const d=l._adapter,_=+d.startOf(r[0].value,o),x=r[r.length-1].value;let T,C;for(T=_;T<=x;T=+d.add(T,1,o))C=i[T],C>=0&&(r[C].major=!0);return r}(l,o,d,i):o}let Qu=(()=>{class l extends gs{constructor(i){super(i),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(i,o={}){const d=i.time||(i.time={}),_=this._adapter=new qp__date(i.adapters.date);_.init(o),zs(d.displayFormats,_.formats()),this._parseOpts={parser:d.parser,round:d.round,isoWeekday:d.isoWeekday},super.init(i),this._normalized=o.normalized}parse(i,o){return void 0===i?null:Wf(this,i)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const i=this.options,o=this._adapter,d=i.time.unit||"day";let{min:_,max:x,minDefined:T,maxDefined:C}=this.getUserBounds();function D(R){!T&&!isNaN(R.min)&&(_=Math.min(_,R.min)),!C&&!isNaN(R.max)&&(x=Math.max(x,R.max))}(!T||!C)&&(D(this._getLabelBounds()),("ticks"!==i.bounds||"labels"!==i.ticks.source)&&D(this.getMinMax(!1))),_=yn(_)&&!isNaN(_)?_:+o.startOf(Date.now(),d),x=yn(x)&&!isNaN(x)?x:+o.endOf(Date.now(),d)+1,this.min=Math.min(_,x-1),this.max=Math.max(_+1,x)}_getLabelBounds(){const i=this.getLabelTimestamps();let o=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY;return i.length&&(o=i[0],d=i[i.length-1]),{min:o,max:d}}buildTicks(){const i=this.options,o=i.time,d=i.ticks,_="labels"===d.source?this.getLabelTimestamps():this._generate();"ticks"===i.bounds&&_.length&&(this.min=this._userMin||_[0],this.max=this._userMax||_[_.length-1]);const x=this.min,C=function Xl(l,r,i){let o=0,d=l.length;for(;o<d&&l[o]<r;)o++;for(;d>o&&l[d-1]>i;)d--;return o>0||d<l.length?l.slice(o,d):l}(_,x,this.max);return this._unit=o.unit||(d.autoSkip?hp(o.minUnit,this.min,this.max,this._getLabelCapacity(x)):function Xf(l,r,i,o,d){for(let _=ys.length-1;_>=ys.indexOf(i);_--){const x=ys[_];if(Fr[x].common&&l._adapter.diff(d,o,x)>=r-1)return x}return ys[i?ys.indexOf(i):0]}(this,C.length,o.minUnit,this.min,this.max)),this._majorUnit=d.major.enabled&&"year"!==this._unit?function mg(l){for(let r=ys.indexOf(l)+1,i=ys.length;r<i;++r)if(Fr[ys[r]].common)return ys[r]}(this._unit):void 0,this.initOffsets(_),i.reverse&&C.reverse(),Ku(this,C,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(i=>+i.value))}initOffsets(i=[]){let _,x,o=0,d=0;this.options.offset&&i.length&&(_=this.getDecimalForValue(i[0]),o=1===i.length?1-_:(this.getDecimalForValue(i[1])-_)/2,x=this.getDecimalForValue(i[i.length-1]),d=1===i.length?x:(x-this.getDecimalForValue(i[i.length-2]))/2);const T=i.length<3?.5:.25;o=Mi(o,0,T),d=Mi(d,0,T),this._offsets={start:o,end:d,factor:1/(o+1+d)}}_generate(){const i=this._adapter,o=this.min,d=this.max,_=this.options,x=_.time,T=x.unit||hp(x.minUnit,o,d,this._getLabelCapacity(o)),C=oi(_.ticks.stepSize,1),D="week"===T&&x.isoWeekday,R=Un(D)||!0===D,V={};let K,ct,H=o;if(R&&(H=+i.startOf(H,"isoWeek",D)),H=+i.startOf(H,R?"day":T),i.diff(d,o,T)>1e5*C)throw new Error(o+" and "+d+" are too far apart with stepSize of "+C+" "+T);const gt="data"===_.ticks.source&&this.getDataTimestamps();for(K=H,ct=0;K<d;K=+i.add(K,C,T),ct++)up(V,K,gt);return(K===d||"ticks"===_.bounds||1===ct)&&up(V,K,gt),Object.keys(V).sort((_t,Xt)=>_t-Xt).map(_t=>+_t)}getLabelForValue(i){const d=this.options.time;return this._adapter.format(i,d.tooltipFormat?d.tooltipFormat:d.displayFormats.datetime)}format(i,o){return this._adapter.format(i,o||this.options.time.displayFormats[this._unit])}_tickFormatFunction(i,o,d,_){const x=this.options,T=x.ticks.callback;if(T)return Ki(T,[i,o,d],this);const C=x.time.displayFormats,D=this._unit,R=this._majorUnit,H=R&&C[R],K=d[o];return this._adapter.format(i,_||(R&&H&&K&&K.major?H:D&&C[D]))}generateTickLabels(i){let o,d,_;for(o=0,d=i.length;o<d;++o)_=i[o],_.label=this._tickFormatFunction(_.value,o,i)}getDecimalForValue(i){return null===i?NaN:(i-this.min)/(this.max-this.min)}getPixelForValue(i){const o=this._offsets,d=this.getDecimalForValue(i);return this.getPixelForDecimal((o.start+d)*o.factor)}getValueForPixel(i){const o=this._offsets,d=this.getDecimalForPixel(i)/o.factor-o.end;return this.min+d*(this.max-this.min)}_getLabelSize(i){const o=this.options.ticks,d=this.ctx.measureText(i).width,_=Qn(this.isHorizontal()?o.maxRotation:o.minRotation),x=Math.cos(_),T=Math.sin(_),C=this._resolveTickFontOptions(0).size;return{w:d*x+C*T,h:d*T+C*x}}_getLabelCapacity(i){const o=this.options.time,d=o.displayFormats,_=d[o.unit]||d.millisecond,x=this._tickFormatFunction(i,0,Ku(this,[i],this._majorUnit),_),T=this._getLabelSize(x),C=Math.floor(this.isHorizontal()?this.width/T.w:this.height/T.h)-1;return C>0?C:1}getDataTimestamps(){let o,d,i=this._cache.data||[];if(i.length)return i;const _=this.getMatchingVisibleMetas();if(this._normalized&&_.length)return this._cache.data=_[0].controller.getAllParsedValues(this);for(o=0,d=_.length;o<d;++o)i=i.concat(_[o].controller.getAllParsedValues(this));return this._cache.data=this.normalize(i)}getLabelTimestamps(){const i=this._cache.labels||[];let o,d;if(i.length)return i;const _=this.getLabels();for(o=0,d=_.length;o<d;++o)i.push(Wf(this,_[o]));return this._cache.labels=this._normalized?i:this.normalize(i)}normalize(i){return Vc(i.sort(Ju))}}return(0,ke.Z)(l,"id","time"),(0,ke.Z)(l,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}}),l})();function td(l,r,i){let _,x,T,C,o=0,d=l.length-1;i?(r>=l[o].pos&&r<=l[d].pos&&({lo:o,hi:d}=Bs(l,"pos",r)),({pos:_,time:T}=l[o]),({pos:x,time:C}=l[d])):(r>=l[o].time&&r<=l[d].time&&({lo:o,hi:d}=Bs(l,"time",r)),({time:_,pos:T}=l[o]),({time:x,pos:C}=l[d]));const D=x-_;return D?T+(C-T)*(r-_)/D:T}class ed extends Qu{constructor(r){super(r),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const r=this._getTimestampsForTable(),i=this._table=this.buildLookupTable(r);this._minPos=td(i,this.min),this._tableRange=td(i,this.max)-this._minPos,super.initOffsets(r)}buildLookupTable(r){const{min:i,max:o}=this,d=[],_=[];let x,T,C,D,R;for(x=0,T=r.length;x<T;++x)D=r[x],D>=i&&D<=o&&d.push(D);if(d.length<2)return[{time:i,pos:0},{time:o,pos:1}];for(x=0,T=d.length;x<T;++x)R=d[x+1],C=d[x-1],D=d[x],Math.round((R+C)/2)!==D&&_.push({time:D,pos:x/(T-1)});return _}_getTimestampsForTable(){let r=this._cache.all||[];if(r.length)return r;const i=this.getDataTimestamps(),o=this.getLabelTimestamps();return r=i.length&&o.length?this.normalize(i.concat(o)):i.length?i:o,r=this._cache.all=r,r}getDecimalForValue(r){return(td(this._table,r)-this._minPos)/this._tableRange}getValueForPixel(r){const i=this._offsets,o=this.getDecimalForPixel(r)/i.factor-i.end;return td(this._table,o*this._tableRange+this._minPos,!0)}}(0,ke.Z)(ed,"id","timeseries"),(0,ke.Z)(ed,"defaults",Qu.defaults);const dp=[Gp,Dh,ng,Object.freeze({__proto__:null,CategoryScale:Zf,LinearScale:Wu,LogarithmicScale:ap,RadialLinearScale:Br,TimeScale:Qu,TimeSeriesScale:ed})];var _l=bt(6904),Vh=bt(6616),gc=bt(3976),jh=bt(296);const gg=["content"];function Jf(l,r){if(1&l&&(p.TgZ(0,"div",14)(1,"div",15),p._uU(2),p.qZA()()),2&l){const i=p.oxw();p.xp6(2),p.Oqu(null==i.selectedLocation?null:i.selectedLocation.name)}}function Kf(l,r){1&l&&p._UZ(0,"div",16)}function Zh(l,r){if(1&l&&(p.TgZ(0,"div",19)(1,"mat-icon",20),p._uU(2,"bookmark"),p.qZA(),p.TgZ(3,"div",21),p._uU(4),p.qZA()()),2&l){const i=p.oxw(2);p.xp6(4),p.hij(" ",null==i.selectedLocation?null:i.selectedLocation.saved_name," ")}}function Qf(l,r){if(1&l&&(p.TgZ(0,"div",19)(1,"mat-icon",22),p._uU(2,"description"),p.qZA(),p.TgZ(3,"div",23),p._uU(4),p.qZA()()),2&l){const i=p.oxw(2);p.xp6(4),p.hij(" ",null==i.selectedLocation?null:i.selectedLocation.note," ")}}function tm(l,r){if(1&l&&(p.TgZ(0,"div",19)(1,"mat-icon",24),p._uU(2,"home"),p.qZA(),p.TgZ(3,"div",21),p._uU(4),p.qZA()()),2&l){const i=p.oxw(2);p.xp6(4),p.Oqu(null==i.selectedLocation?null:i.selectedLocation.address)}}function pp(l,r){if(1&l&&(p.TgZ(0,"div",19)(1,"mat-icon",25),p._uU(2,"my_location"),p.qZA(),p.TgZ(3,"div",21),p._uU(4),p.qZA()()),2&l){const i=p.oxw(2);p.xp6(4),p.AsE(" ",null==i.selectedLocation?null:i.selectedLocation.lat,", ",null==i.selectedLocation?null:i.selectedLocation.lon," ")}}function _c(l,r){if(1&l&&(p.TgZ(0,"div",19)(1,"mat-icon",26),p._uU(2),p.qZA(),p.TgZ(3,"div",21),p._uU(4),p.qZA()()),2&l){const i=p.oxw(2);p.xp6(2),p.Oqu("charging station"===(null==i.selectedLocation?null:i.selectedLocation.type)?"ev_station":"parking"===(null==i.selectedLocation?null:i.selectedLocation.type)?"local_parking":"hotel"===(null==i.selectedLocation?null:i.selectedLocation.type)?"hotel":"Retail"===(null==i.selectedLocation?null:i.selectedLocation.type)?"shopping_cart":"gas station"===(null==i.selectedLocation?null:i.selectedLocation.type)?"local_gas_station":"pinned location"===(null==i.selectedLocation?null:i.selectedLocation.type)?"flag":"local_offer"),p.xp6(2),p.hij(" ",i.Capitalize(null==i.selectedLocation?null:i.selectedLocation.type)," ")}}function em(l,r){if(1&l&&(p.TgZ(0,"div",17),p.YNc(1,Zh,5,1,"div",18),p.YNc(2,Qf,5,1,"div",18),p.YNc(3,tm,5,1,"div",18),p.YNc(4,pp,5,2,"div",18),p.YNc(5,_c,5,2,"div",18),p.qZA()),2&l){const i=p.oxw();p.xp6(1),p.Q6J("ngIf",null==i.selectedLocation?null:i.selectedLocation.saved_name),p.xp6(1),p.Q6J("ngIf",null==i.selectedLocation?null:i.selectedLocation.note),p.xp6(1),p.Q6J("ngIf",null==i.selectedLocation?null:i.selectedLocation.address),p.xp6(1),p.Q6J("ngIf",(null==i.selectedLocation?null:i.selectedLocation.lat)&&(null==i.selectedLocation?null:i.selectedLocation.lon)),p.xp6(1),p.Q6J("ngIf",null==i.selectedLocation?null:i.selectedLocation.type)}}function id(l,r){1&l&&(p.TgZ(0,"div",17),p._UZ(1,"div",27)(2,"div",27),p.qZA())}function im(l,r){1&l&&(p.TgZ(0,"div",28),p._UZ(1,"div",29)(2,"div",29)(3,"div",29)(4,"div",29),p.qZA())}function nd(l,r){if(1&l&&(p.ynx(0),p.TgZ(1,"div",19),p._UZ(2,"img",59),p.TgZ(3,"h3",15),p._uU(4),p.qZA()(),p.TgZ(5,"div",60)(6,"p",61)(7,"span",62),p._uU(8,"Rated power:"),p.qZA(),p._uU(9),p.qZA(),p.TgZ(10,"p",61)(11,"span",62),p._uU(12,"Voltage:"),p.qZA(),p._uU(13),p.qZA(),p.TgZ(14,"p",61)(15,"span",62),p._uU(16,"Current:"),p.qZA(),p._uU(17),p.qZA(),p.TgZ(18,"p",61)(19,"span",62),p._uU(20,"Current type:"),p.qZA(),p._uU(21),p.qZA()(),p.BQk()),2&l){const i=p.oxw().$implicit;p.xp6(2),p.Q6J("src","../../../../../../assets/images/connectors-images/"+i.connectorType+".jpg",p.LSH),p.xp6(2),p.hij(" ",i.connectorType," "),p.xp6(5),p.hij(" ",i.ratedPowerKW," kW "),p.xp6(4),p.hij(" ",i.voltageV," V "),p.xp6(4),p.hij(" ",i.currentA," A "),p.xp6(4),p.hij(" ",i.currentType," ")}}function sd(l,r){if(1&l&&(p.TgZ(0,"div",57),p.YNc(1,nd,22,6,"ng-container",58),p.qZA()),2&l){const i=r.$implicit;p.xp6(1),p.Q6J("ngIf","StandardHouseholdCountrySpecific"!==i.connectorType)}}function _g(l,r){1&l&&(p.TgZ(0,"div",63)(1,"p",61),p._uU(2,"No connectors found."),p.qZA()())}function yg(l,r){if(1&l&&(p.TgZ(0,"mat-expansion-panel",54)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),p._uU(3,"Charging station details"),p.qZA()(),p.TgZ(4,"div"),p.YNc(5,sd,2,1,"div",55),p.YNc(6,_g,3,0,"div",56),p.qZA()()),2&l){const i=p.oxw(2);p.xp6(5),p.Q6J("ngForOf",i.evConnector),p.xp6(1),p.Q6J("ngIf",0===i.evConnector.length)}}function xg(l,r){1&l&&(p.TgZ(0,"div"),p._UZ(1,"canvas",69),p.qZA())}function vg(l,r){if(1&l&&(p.TgZ(0,"div",64),p.YNc(1,xg,2,0,"div",58),p.TgZ(2,"div",65)(3,"div",66)(4,"span",67),p._uU(5,"Charging stations within 500m"),p.qZA(),p.TgZ(6,"span",15),p._uU(7),p.qZA()(),p.TgZ(8,"mat-icon",68),p._uU(9,"ev_station"),p.qZA()(),p.TgZ(10,"div",65)(11,"div",66)(12,"span",67),p._uU(13,"Charge points within 500m"),p.qZA(),p.TgZ(14,"span",15),p._uU(15),p.qZA()(),p.TgZ(16,"mat-icon",68),p._uU(17,"electric_car"),p.qZA()(),p.TgZ(18,"div",30)(19,"div",66)(20,"span",67),p._uU(21,"Number of EVs in the area"),p.qZA(),p.TgZ(22,"span",15),p._uU(23),p.ALo(24,"number"),p.qZA()(),p.TgZ(25,"mat-icon",68),p._uU(26,"pie_chart"),p.qZA()()()),2&l){const i=p.oxw(2);p.xp6(1),p.Q6J("ngIf",!i.isValuesArrayAllZeros()),p.xp6(6),p.Oqu(i.evStats.chargingStation),p.xp6(8),p.Oqu(i.evStats.chargingPoints),p.xp6(8),p.Oqu(p.xi3(24,4,i.evStats.evShare,"1.0-0"))}}function bg(l,r){1&l&&(p.TgZ(0,"div",70)(1,"p",71),p._uU(2," No points of interest found "),p.qZA()())}function yc(l,r){if(1&l&&(p.TgZ(0,"div",72)(1,"div",3)(2,"span",73)(3,"mat-icon"),p._uU(4),p.qZA()(),p.TgZ(5,"span",74),p._uU(6),p.qZA()(),p.TgZ(7,"span",75),p._uU(8),p.qZA()()),2&l){const i=r.$implicit;p.xp6(4),p.Oqu(i.type),p.xp6(2),p.Oqu(i.name),p.xp6(2),p.Oqu(i.distance)}}function fp(l,r){if(1&l){const i=p.EpF();p.TgZ(0,"button",76),p.NdJ("click",function(){p.CHM(i);const d=p.oxw(2);return p.KtG(d.showMore())}),p._uU(1," See More "),p.qZA()}}function wg(l,r){if(1&l){const i=p.EpF();p.TgZ(0,"div",30)(1,"div",31)(2,"mat-expansion-panel",32),p.NdJ("afterExpand",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.siteAttrac=!0)})("afterCollapse",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.siteAttrac=!1)}),p.TgZ(3,"mat-expansion-panel-header")(4,"mat-panel-title"),p._uU(5,"Site attractiveness score"),p.qZA()(),p.TgZ(6,"div"),p._UZ(7,"app-circular-score",33),p.TgZ(8,"div",34)(9,"div",35)(10,"span",36),p._uU(11,"EV density score"),p.qZA(),p.TgZ(12,"span",37),p._uU(13),p.ALo(14,"number"),p.qZA()(),p.TgZ(15,"div",38),p._UZ(16,"div",39),p.qZA()(),p.TgZ(17,"div",34)(18,"div",35)(19,"span",36),p._uU(20,"Population density score"),p.qZA(),p.TgZ(21,"span",37),p._uU(22),p.ALo(23,"number"),p.qZA()(),p.TgZ(24,"div",38),p._UZ(25,"div",39),p.qZA()(),p.TgZ(26,"div",34)(27,"div",35)(28,"span",36),p._uU(29,"Population average revenue score"),p.qZA(),p.TgZ(30,"span",37),p._uU(31),p.ALo(32,"number"),p.qZA()(),p.TgZ(33,"div",38),p._UZ(34,"div",39),p.qZA()(),p.TgZ(35,"div",34)(36,"div",35)(37,"span",36),p._uU(38,"Charge point density score"),p.qZA(),p.TgZ(39,"span",37),p._uU(40),p.ALo(41,"number"),p.qZA()(),p.TgZ(42,"div",38),p._UZ(43,"div",39),p.qZA()(),p.TgZ(44,"div",34)(45,"div",35)(46,"span",36),p._uU(47,"POI density score"),p.qZA(),p.TgZ(48,"span",37),p._uU(49),p.ALo(50,"number"),p.qZA()(),p.TgZ(51,"div",38),p._UZ(52,"div",39),p.qZA()()()(),p.YNc(53,yg,7,2,"mat-expansion-panel",40),p.TgZ(54,"mat-expansion-panel",41),p.NdJ("closed",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.evStatsPanel=!1)})("opened",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.evStatsPanel=!0)}),p.TgZ(55,"mat-expansion-panel-header")(56,"mat-panel-title"),p._uU(57,"EV stats"),p.qZA()(),p.YNc(58,vg,27,7,"div",42),p.qZA(),p.TgZ(59,"mat-expansion-panel",43),p.NdJ("opened",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.areaStatsPanel=!0)})("closed",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.areaStatsPanel=!1)}),p.TgZ(60,"mat-expansion-panel-header")(61,"mat-panel-title"),p._uU(62,"Area stats"),p.qZA()(),p.TgZ(63,"div"),p._UZ(64,"canvas",44),p.qZA(),p.TgZ(65,"div",45)(66,"div",46)(67,"span",47),p._uU(68,"Population density"),p.qZA(),p.TgZ(69,"span",48),p._uU(70),p.ALo(71,"number"),p.qZA()(),p._UZ(72,"hr"),p.TgZ(73,"div",46)(74,"span",47),p._uU(75,"Median income"),p.qZA(),p.TgZ(76,"span",48),p._uU(77),p.ALo(78,"number"),p.qZA()(),p._UZ(79,"hr"),p.TgZ(80,"div")(81,"span",47),p._uU(82,"Area potential score"),p.qZA(),p._UZ(83,"app-circular-score",33),p.qZA()()(),p.TgZ(84,"mat-expansion-panel",41),p.NdJ("closed",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.poiNearbyPanel=!1)})("opened",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.poiNearbyPanel=!0)}),p.TgZ(85,"mat-expansion-panel-header")(86,"mat-panel-title"),p._uU(87,"Point of interest nearby\xa0 "),p.TgZ(88,"span"),p._uU(89),p.qZA()()(),p.TgZ(90,"div",49),p.YNc(91,bg,3,0,"div",50),p.TgZ(92,"div",51),p.YNc(93,yc,9,3,"div",52),p.YNc(94,fp,2,0,"button",53),p.qZA()()()()()}if(2&l){const i=p.oxw();p.xp6(2),p.Q6J("expanded",i.siteAttrac),p.xp6(5),p.Q6J("score",i.siteAttractiviness.siteScore)("animate",i.siteAttrac),p.xp6(6),p.Oqu(p.xi3(14,31,i.siteAttractiviness.evUptake,"1.2-2")),p.xp6(3),p.Udp("width",i.siteAttrac?10*i.siteAttractiviness.evUptake:0,"%"),p.xp6(6),p.Oqu(p.xi3(23,34,i.siteAttractiviness.populationDensityScore,"1.2-2")),p.xp6(3),p.Udp("width",i.siteAttrac?10*i.siteAttractiviness.populationDensityScore:0,"%"),p.xp6(6),p.Oqu(p.xi3(32,37,i.siteAttractiviness.populationAvgRevenueScore,"1.2-2")),p.xp6(3),p.Udp("width",i.siteAttrac?10*i.siteAttractiviness.populationAvgRevenueScore:0,"%"),p.xp6(6),p.Oqu(p.xi3(41,40,i.siteAttractiviness.nearbyCompetitionScore,"1.2-2")),p.xp6(3),p.Udp("width",i.siteAttrac?10*i.siteAttractiviness.nearbyCompetitionScore:0,"%"),p.xp6(6),p.Oqu(p.xi3(50,43,i.siteAttractiviness.nearbyPointOfInterestScore,"1.2-2")),p.xp6(3),p.Udp("width",i.siteAttrac?10*i.siteAttractiviness.nearbyPointOfInterestScore:0,"%"),p.xp6(1),p.Q6J("ngIf","charging station"===i.selectedLocation.type),p.xp6(1),p.Q6J("expanded",i.evStatsPanel),p.xp6(4),p.Q6J("ngIf",i.evStats),p.xp6(1),p.Q6J("expanded",i.areaStatsPanel),p.xp6(11),p.Oqu(p.xi3(71,46,i.areaStats.populationDensity,"1.0-0")),p.xp6(7),p.hij("\u20ac",p.xi3(78,49,i.areaStats.medianIncome,"1.0-0"),""),p.xp6(6),p.Q6J("score",i.areaStats.areaScore)("animate",i.areaStatsPanel),p.xp6(1),p.Q6J("expanded",i.poiNearbyPanel),p.xp6(5),p.hij(" (",i.poiNearby.length,")"),p.xp6(2),p.Q6J("ngIf",0===i.poiNearby.length),p.xp6(2),p.Q6J("ngForOf",i.poiNearby.slice(0,i.itemsToShow)),p.xp6(1),p.Q6J("ngIf",i.itemsToShow<i.poiNearby.length)}}function nm(l,r){if(1&l){const i=p.EpF();p.TgZ(0,"div",77)(1,"div",78)(2,"button",79),p.NdJ("click",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.compare())}),p._uU(3," Compare "),p.qZA(),p.TgZ(4,"button",80),p.NdJ("click",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.updateParentVariable())}),p._uU(5," Predict "),p.qZA()()()}}wa.register(...dp);let Tg=(()=>{class l{constructor(i,o,d,_,x,T){this._exploreService=i,this.dialog=o,this._tokenService=d,this._simulationService=_,this._compareService=x,this.snackBar=T,this.parentVariableUpdated=new p.vpe,this.panelStateChange=new p.vpe,this.numParkingSpaces=50,this.itemsToShow=20,this.score=5,this.isBookmarkAdded=!1,this.poiNearby=[],this.siteAttractiviness={siteScore:0,evUptake:0,populationDensityScore:0,populationAvgRevenueScore:0,nearbyCompetitionScore:0,nearbyPointOfInterestScore:0},this.evConnector=[],this.areaStats={areaScore:-1,medianIncome:-1,populationDensity:-1},this.revenueScore=3.5,this.densityScore=4.6,this.evStatsPanel=!1,this.poiNearbyPanel=!1,this.areaStatsPanel=!1,this.evStatsLoading=!1,this.loadingData=!0,this.siteAttrac=!1,this.evStatsChartLabels=["Slow","Regular","Fast","Very fast"],this.evStatsChartValues=[0,0,0,0],this.ageDistribution=[]}ngOnDestroy(){this.clearRPSubscription.unsubscribe()}ngOnInit(){this._exploreService.selectedLocationData$.subscribe({next:i=>{console.error("this is the data : ",i),this.poiNearby=i.poiNearby,this.evStats={chargingPoints:i.evChargePointStats.chargingPoints,chargingStation:i.evChargePointStats.chargingStation,evShare:i.evChargePointStats.evShare},this.evStatsChartValues=i.evChargePointStats.evStatsChartValues,this.areaStats.populationDensity=i.areaStats.populationDensity,this.areaStats.areaScore=i.areaStats.areaScore,this.areaStats.medianIncome=i.areaStats.medianIncome,this.score=i.areaStats.areaScore,this.siteAttractiviness.siteScore=i.siteAttractiviness.siteScore,this.siteAttractiviness.evUptake=i.siteAttractiviness.evUptake,this.siteAttractiviness.populationDensityScore=i.siteAttractiviness.populationDensityScore,this.siteAttractiviness.populationAvgRevenueScore=i.siteAttractiviness.populationAvgRevenueScore,this.siteAttractiviness.nearbyCompetitionScore=i.siteAttractiviness.nearbyCompetitionScore,this.siteAttractiviness.nearbyPointOfInterestScore=i.siteAttractiviness.nearbyPointOfInterestScore,this.ageDistribution=i.areaStats.ageDistribution,setTimeout(()=>{this.loadingData=!1},300),setTimeout(()=>{this.siteAttrac=!0,this.renderChargePointDistributionChart(),this.rederAgeDistributionChart()},500)}}),this._exploreService.selectedLocation$.subscribe({next:i=>{this.selectedLocation=i,console.error("this is the selected location : ",this.selectedLocation),this.evConnector=this.selectedLocation.evConnector,this.siteAttrac=!1,this.loadingData=!0,this._exploreService.simulationOptions$.subscribe({next:o=>{o&&this.parentVariableUpdated.emit("simulation-results")}})}}),this.clearRPSubscription=this._exploreService.clearRP.subscribe({next:i=>{console.error("I am here --------------",i,this.selectedLocation?.type),"saved_locations"===i&&this.selectedLocation.saved_name&&(this.clearPoiDetails(),this._exploreService.removePoiMarker.next(1),this.parentVariableUpdated.emit("poi-list")),i&&this.selectedLocation?.type.toLowerCase()===("supermarket"===i?"retail":i.toLowerCase())&&(this.clearPoiDetails(),this._exploreService.removePoiMarker.next(1),this.parentVariableUpdated.emit("poi-list"))}})}showMore(){this.itemsToShow+=20}hideRightPanel(){console.error(this.selectedLocation),-1!==this.selectedLocation.markerId||this._exploreService.clearRP.next(this.selectedLocation.type),this._exploreService.diselectAllMarkers.next(1),this.removeDataFromCash(),this.parentVariableUpdated.emit("poi-list")}updateParentVariable(){this.parentVariableUpdated.emit("simulation-options")}removeMarker(){-1!==this.selectedLocation?.markerId?(this._exploreService.deleteMarker(this.selectedLocation?.markerId),this.selectedLocation=void 0,this.clearPoiDetails(),this.parentVariableUpdated.emit("poi-list")):this.hideRightPanel()}toggleBookmark(){this.selectedLocation.saved_name||this.dialog.open(oa,{width:"30%",minWidth:"300px"}).afterClosed().subscribe({next:o=>{o&&this._exploreService.SaveLocation(o).subscribe({next:d=>{this.snackBar.open("Location saved successfully","close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["custom-style-green"]})},error:d=>{this.snackBar.open(d.error.msg,"close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["custom-style"]})}})}})}removeNearbyPoi(){this.poiNearby=[]}isValuesArrayAllZeros(){return this.evStatsChartValues.every(i=>0===i)}renderChargePointDistributionChart(){new wa("chargePointDistribution",{type:"pie",data:{labels:["Slow","Regular","Fast","Very fast"],datasets:[{label:"# of Votes",data:this.evStatsChartValues,borderWidth:1}]}})}rederAgeDistributionChart(){new wa("ageDistribution",{type:"pie",data:{labels:["18-24","25-39","40-54","55-64","65-79","80+"],datasets:[{label:"something ",data:this.ageDistribution,borderWidth:1}]}})}clearPoiDetails(){this.marker=void 0,this.pointOfIntrest=void 0,this.evStats=void 0,this.isBookmarkAdded=!1,this.poiNearby=[],this.content.nativeElement.scrollTop=0,this.evStatsPanel=!1,this.poiNearbyPanel=!1,this.areaStatsPanel=!1,this.loadingData=!1,this.siteAttrac=!1,this.score=0}removeDataFromCash(){this._simulationService.setEvStats(void 0),this._simulationService.setPoiNearby(void 0),this._simulationService.setAreaStats(void 0),this._simulationService.setSiteAttractiviness(void 0),this._simulationService.setSavedLoaction(!1),this._simulationService.setEvStatsChartLabels(this.evStatsChartLabels),this._simulationService.setEvStatsChartValues([0,0,0,0])}setData(){this._simulationService.setEvStats(this.evStats),this._simulationService.setPoiNearby(this.poiNearby),this._simulationService.setAreaStats(this.areaStats),this._simulationService.setSiteAttractiviness(this.siteAttractiviness),this._simulationService.setEvStatsChartLabels(this.evStatsChartLabels),this._simulationService.setEvStatsChartValues(this.evStatsChartValues)}Capitalize(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""}compare(){const o=(new Date).getTime().toString();this._compareService.addLocations([{index:o,name:this.selectedLocation.name,type:this.selectedLocation.type,address:this.selectedLocation.address,score:this.siteAttractiviness.siteScore,populationDensity:this.areaStats.populationDensity,medianRevenue:this.areaStats.medianIncome,poiNearbyCount:this.poiNearby.length,competitionCount:this.evStats.chargingPoints,evRegistration:this.evStats.evShare,lon:this.selectedLocation.lon,lat:this.selectedLocation.lat}],!0),this.parentVariableUpdated.emit("compare")}}return l.\u0275fac=function(i){return new(i||l)(p.Y36(_l.G),p.Y36(Po.uw),p.Y36(Vh.B),p.Y36(gc.s),p.Y36(jh.z),p.Y36(Cs.ux))},l.\u0275cmp=p.Xpm({type:l,selectors:[["app-poi-details"]],viewQuery:function(i,o){if(1&i&&p.Gf(gg,5),2&i){let d;p.iGM(d=p.CRH())&&(o.content=d.first)}},outputs:{parentVariableUpdated:"parentVariableUpdated",panelStateChange:"panelStateChange"},standalone:!0,features:[p.jDz],decls:19,vars:9,consts:[[1,"h-full","relative","flex","flex-col","space-y-0","justify-between","align-items-stretch"],[1,"flex","justify-between","items-center","ml-1","w-full","p-2","pb-0"],[1,"hover:cursor-pointer",3,"click"],[1,"flex","items-center"],[1,"bookmark-icon-color",2,"font-size","30px","width","30px","height","30px","margin-right","10px",3,"ngClass","click"],[1,"text-gray-500","hover:text-red-500","cursor-pointer","mr-1",3,"click"],["class","flex justify-between items-center ml-1 w-full p-2",4,"ngIf"],["class","skeleton skeleton-text-header",4,"ngIf"],[1,"overflow-y-auto","scroll-smooth","flex-1","pb-3"],["content",""],["class","flex flex-col w-full p-2",4,"ngIf"],["class","flex flex-col space-y-3 mt-3",4,"ngIf"],["class","flex justify-between items-center",4,"ngIf"],["class","flex items-center justify-end w-full bg-white border-t border-gray-300 p-3 z-50",4,"ngIf"],[1,"flex","justify-between","items-center","ml-1","w-full","p-2"],[1,"text-lg","font-bold"],[1,"skeleton","skeleton-text-header"],[1,"flex","flex-col","w-full","p-2"],["class","flex items-center mb-2",4,"ngIf"],[1,"flex","items-center","mb-2"],["matTooltip","Saved name","matTooltipPosition","above",1,"text-gray-400","mr-2"],[1,"text-xs","text-gray-500"],["matTooltip","Description","matTooltipPosition","above",1,"text-gray-400","mr-2"],[1,"text-xs","text-gray-500","w-3/4","whitespace-normal","break-words"],["matTooltip","Address","matTooltipPosition","above",1,"text-gray-400","mr-2"],["matTooltip","latitude, longitude","matTooltipPosition","above",1,"text-gray-400","mr-2"],[1,"text-gray-400","mr-2"],[1,"skeleton","skeleton-text-info"],[1,"flex","flex-col","space-y-3","mt-3"],[1,"skeleton","skeleton-text-dropDown"],[1,"flex","justify-between","items-center"],[1,"flex","flex-col","space-y-3","mt-3","w-full"],[1,"w-11/12",2,"margin-left","auto","margin-right","auto",3,"expanded","afterExpand","afterCollapse"],[3,"score","animate"],[1,"my-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","text-gray-500","font-medium","mr-2"],[1,"text-xs","font-medium"],[1,"h-2","bg-gray-200","rounded-full"],[1,"h-full","rounded-full","bg-gradient-to-r","from-teal-400","to-blue-500","transition-all","duration-500"],["style","margin-left: auto; margin-right: auto","class","w-11/12",4,"ngIf"],[1,"w-11/12",2,"margin-left","auto","margin-right","auto",3,"expanded","closed","opened"],["class","flex flex-col space-y-3 p-2",4,"ngIf"],[1,"w-11/12",2,"margin-left","auto","margin-right","auto",3,"expanded","opened","closed"],["id","ageDistribution",1,"w-full","h-full"],[1,"flex","flex-col","space-y-6"],[1,"ml-3","flex","flex-col"],[1,"text-sm","text-gray-500"],[1,"text-xl","font-bold"],[1,"flex","flex-col","space-y-3"],["class","h-20 flex items-center justify-center",4,"ngIf"],[1,"poi-list"],["class","bg-gray-200 p-3 rounded flex items-center justify-between mb-2",4,"ngFor","ngForOf"],["class","bg-gray-200 text-gray-700 py-2 px-4 rounded hover:bg-gray-300",3,"click",4,"ngIf"],[1,"w-11/12",2,"margin-left","auto","margin-right","auto"],["class","bg-white p-4 mb-4 shadow-md",4,"ngFor","ngForOf"],["class","bg-white p-4 shadow-md",4,"ngIf"],[1,"bg-white","p-4","mb-4","shadow-md"],[4,"ngIf"],["alt","",1,"h-10","mr-3",3,"src"],[1,"grid","grid-cols-2","gap-4","mb-2"],[1,"text-gray-500"],[1,"font-medium"],[1,"bg-white","p-4","shadow-md"],[1,"flex","flex-col","space-y-3","p-2"],[1,"flex","justify-between","items-center","border-b-2","pb-2"],[1,"flex","flex-col"],[1,"text-sm"],[1,"text-gray-400","text-2xl"],["id","chargePointDistribution",1,"w-full","h-full"],[1,"h-20","flex","items-center","justify-center"],[1,"text-gray-500","text-sm","font-medium","text-center"],[1,"bg-gray-200","p-3","rounded","flex","items-center","justify-between","mb-2"],[1,"text-gray-700","mr-3"],[1,"text-gray-900"],[1,"text-gray-700"],[1,"bg-gray-200","text-gray-700","py-2","px-4","rounded","hover:bg-gray-300",3,"click"],[1,"flex","items-center","justify-end","w-full","bg-white","border-t","border-gray-300","p-3","z-50"],[2,"margin-right","1rem"],["mat-raised-button","",2,"background-color","#335579","color","white","margin-right","10px",3,"click"],["mat-raised-button","",2,"background-color","#335579","color","white",3,"click"]],template:function(i,o){1&i&&(p.TgZ(0,"div",0)(1,"div")(2,"div",1)(3,"mat-icon",2),p.NdJ("click",function(){return o.hideRightPanel()}),p._uU(4,"arrow_back"),p.qZA(),p.TgZ(5,"div",3)(6,"mat-icon",4),p.NdJ("click",function(){return o.toggleBookmark()}),p._uU(7),p.qZA(),p.TgZ(8,"mat-icon",5),p.NdJ("click",function(){return o.removeMarker()}),p._uU(9,"close"),p.qZA()()(),p.YNc(10,Jf,3,1,"div",6),p.YNc(11,Kf,1,0,"div",7),p.qZA(),p.TgZ(12,"div",8,9),p.YNc(14,em,6,5,"div",10),p.YNc(15,id,3,0,"div",10),p.YNc(16,im,5,0,"div",11),p.YNc(17,wg,95,52,"div",12),p.qZA(),p.YNc(18,nm,6,0,"div",13),p.qZA()),2&i&&(p.xp6(6),p.Q6J("ngClass",null!=o.selectedLocation&&o.selectedLocation.saved_name?"bookmark-added":"hover:cursor-pointer"),p.xp6(1),p.Oqu(null!=o.selectedLocation&&o.selectedLocation.saved_name?"bookmark_added":"bookmark_add"),p.xp6(3),p.Q6J("ngIf",(null==o.selectedLocation?null:o.selectedLocation.name)&&!o.loadingData),p.xp6(1),p.Q6J("ngIf",o.loadingData),p.xp6(3),p.Q6J("ngIf",o.selectedLocation&&!o.loadingData),p.xp6(1),p.Q6J("ngIf",o.loadingData),p.xp6(1),p.Q6J("ngIf",o.loadingData),p.xp6(1),p.Q6J("ngIf",o.selectedLocation&&!o.loadingData),p.xp6(1),p.Q6J("ngIf",o.selectedLocation&&!o.loadingData))},dependencies:[c.ez,c.mk,c.sg,c.O5,c.JJ,vn.ot,vn.lW,cn.Ps,cn.Hw,Dl,sa,kc,Na,Po.Is,Qo.Cq,Cs.ZX,Si,ro.AV,ro.gM],styles:["[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:50px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{border-radius:6px;background:#f1f1f1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:6px;background:#888;height:20%}[_ngcontent-%COMP%]::-webkit-scrollbar-button{height:100%}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{-webkit-transition:.8s;transition:.8s;background:#555}.score-display[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;font-size:18px;margin-bottom:16px}.message[_ngcontent-%COMP%]{font-weight:700;margin-bottom:8px}.progress-bar[_ngcontent-%COMP%]{width:200px;height:16px;background-color:#ccc;border-radius:10px;overflow:hidden}.fill[_ngcontent-%COMP%]{height:100%;border-radius:10px;transition:width .5s ease-in-out}.score-low[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]{background-color:red}.score-medium[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]{background-color:#ffc107}.score-high[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]{background-color:#4caf50}.bookmark-icon-color[_ngcontent-%COMP%]{color:#666;transition:color .5s}.bookmark-added[_ngcontent-%COMP%]{color:green}@keyframes _ngcontent-%COMP%_bookmark-add{0%{transform:scale(1)}50%{transform:scale(1.5)}to{transform:scale(1)}}.bookmark-add-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bookmark-add-icon .5s forwards}@keyframes _ngcontent-%COMP%_bookmark-add-icon{0%{opacity:1}to{opacity:0}}.bookmark-added-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bookmark-added-icon .5s forwards}@keyframes _ngcontent-%COMP%_bookmark-added-icon{0%{opacity:0;transform:scale(.5)}to{opacity:1;transform:scale(1)}}  .custom-style{background-color:#fe5157;color:#fff}  .custom-style-green{background-color:#10b981;color:#fff}  .mat-simple-snackbar-action>button{color:#fff}.skeleton[_ngcontent-%COMP%]{opacity:.7;animation:_ngcontent-%COMP%_skeleton-loading 1s linear infinite alternate}.skeleton-text-header[_ngcontent-%COMP%]{width:50%;height:.7rem;margin-bottom:.25rem;border-radius:.125rem;margin:10px}.skeleton-text-info[_ngcontent-%COMP%]{width:60%;height:.7rem;margin-bottom:.5rem;border-radius:.125rem;margin-left:.5rem}.skeleton-text-dropDown[_ngcontent-%COMP%]{width:91%;height:3.125rem;border-radius:.125rem;margin-left:auto;margin-right:auto}@keyframes _ngcontent-%COMP%_skeleton-loading{0%{background-color:#a3b8c2}to{background-color:#f0f3f5}}  .mat-expansion-indicator:after{border-color:#000}"]}),l})();function mp(l,r){1&l&&(p.TgZ(0,"mat-error"),p._uU(1,"Prediction name is required"),p.qZA())}function Sg(l,r){1&l&&(p.TgZ(0,"mat-icon"),p._UZ(1,"mat-spinner",31),p.qZA())}function Ca(l,r){1&l&&(p.TgZ(0,"span"),p._uU(1,"Run"),p.qZA())}let sm=(()=>{class l{constructor(i,o,d,_,x){this._simulationService=i,this._exploreService=o,this._tokenService=d,this.snackBar=_,this.dialog=x,this.parentVariableUpdated=new p.vpe,this.disabled=!1,this.isBookmarkAdded=!1}ngOnDestroy(){this.clearRPSubscription.unsubscribe()}ngOnInit(){this._exploreService.selectedLocationData$.subscribe({next:o=>{this.locationData=o}}),this._exploreService.selectedLocation$.subscribe({next:o=>{this.selectedLocation=o}}),this.clearRPSubscription=this._exploreService.clearRP.subscribe({next:o=>{console.error("I am here --------------",o,this.selectedLocation?.type),o&&this.selectedLocation?.type.toLowerCase()===("supermarket"===o?"retail":o.toLowerCase())&&(this._exploreService.removePoiMarker.next(1),this.parentVariableUpdated.emit("poi-list"))}}),this.simulationForm=new Me.cw({simulationName:new Me.NI("",[Me.kI.required]),latitude:new Me.NI({value:this.selectedLocation.lat,disabled:!0},[Me.kI.required]),longitude:new Me.NI({value:this.selectedLocation.lon,disabled:!0},[Me.kI.required]),dcLessThan50:new Me.NI("0",[Me.kI.required]),dcBetween50_150:new Me.NI("0",[Me.kI.required]),dcBetween150_350:new Me.NI("0",[Me.kI.required]),dcGreaterThan350:new Me.NI("0",[Me.kI.required]),acLessThan7:new Me.NI("0",[Me.kI.required]),acBetween7_22:new Me.NI("0",[Me.kI.required]),acGreaterThan22:new Me.NI("0",[Me.kI.required])},{validators:o=>{const d=["latitude","longitude","simulationName"],_=o;return Object.keys(_.value).filter(C=>!d.includes(C)).map(C=>parseInt(_.value[C])).reduce((C,D)=>C+D,0)>0?null:{atLeastOneGreaterThanZero:!0}}})}updateParentVariable(){this.disabled=!1,this.parentVariableUpdated.emit("simulation-results")}goBackTopoiDetails(){this.parentVariableUpdated.emit("poi-details")}RunSimulation(){this.disabled=!0,console.log("this is the sim: ",this.simulationForm.getRawValue()),this._exploreService._simulationOptions=this.simulationForm.getRawValue(),this._simulationService.setsimulationData(this.simulationForm.getRawValue());let i={name:this.selectedLocation.name,saved_name:"simulation-location",type_location:this.selectedLocation.type,long:this.selectedLocation.lon,lat:this.selectedLocation.lat,note:"",location_source:"saved_simulation",site_attractiveness_score:this.locationData.siteAttractiviness.siteScore,population_densit:this.locationData.areaStats.populationDensity,median_revenue:this.locationData.areaStats.medianIncome,nearby_POIs_count:this.locationData.poiNearby.length,competition_count:this.locationData.evChargePointStats.chargingPoints,ev_registration:this.locationData.evChargePointStats.evShare,location_address:this.selectedLocation.address,ev_connectors:JSON.stringify(this.selectedLocation.evConnector),user_id:this._tokenService.getuserId(),city:this.selectedLocation.city};this._simulationService.SaveSimulation(this.simulationForm.getRawValue(),i).subscribe({next:o=>{this._simulationService.predictNumber=o.prediction,this._exploreService.simulationId=o.createdSimulation.simulation_id,this.updateParentVariable()},error:o=>{this.snackBar.open(o.error.msg,"close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["custom-style"]}),this.disabled=!1}})}toggleBookmark(){this.selectedLocation.saved_name||this.dialog.open(oa,{width:"30%"}).afterClosed().subscribe({next:o=>{o&&this._exploreService.SaveLocation(o).subscribe({next:d=>{this.snackBar.open("Location saved successfully","close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["custom-style-green"]})},error:d=>{this.snackBar.open(d.error.msg,"close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["custom-style"]})}})}})}removeMarker(){void 0!==this._simulationService.getMarkerId()?(this._exploreService.deleteMarker(this._simulationService.getMarkerId()),this.removeDataFromCash(),this.parentVariableUpdated.emit("poi-list")):(this._exploreService.removePoiMarker.next(1),this.removeDataFromCash(),this.parentVariableUpdated.emit("poi-list"))}removeDataFromCash(){this._simulationService.setEvStats(void 0),this._simulationService.setPoiNearby(void 0),this._simulationService.setAreaStats(void 0),this._simulationService.setSiteAttractiviness(void 0),this._simulationService.setSavedLoaction(!1),this._simulationService.setMarkerId(void 0),this._simulationService.setlocationData(void 0),this._simulationService.setEvStatsChartLabels(["Slow","Regular","Fast","Very fast"]),this._simulationService.setEvStatsChartValues([0,0,0,0])}}return l.\u0275fac=function(i){return new(i||l)(p.Y36(gc.s),p.Y36(_l.G),p.Y36(Vh.B),p.Y36(Cs.ux),p.Y36(Po.uw))},l.\u0275cmp=p.Xpm({type:l,selectors:[["app-simulation-options"]],outputs:{parentVariableUpdated:"parentVariableUpdated"},standalone:!0,features:[p.jDz],decls:88,vars:9,consts:[[1,"h-full","relative","flex","flex-col","space-y-0","justify-between","align-items-stretch"],[1,"flex","justify-between","items-center","ml-1","w-full","p-2","pb-0"],[1,"hover:cursor-pointer",3,"click"],[1,"flex","justify-center","items-center"],[1,"bookmark-icon-color",2,"font-size","30px","width","30px","height","30px","margin-right","10px",3,"ngClass","click"],[1,"text-gray-500","hover:text-red-500","cursor-pointer","mr-1",3,"click"],[1,"title"],[1,"h-full","relative","p-3","overflow-y-scroll"],["id","simulationForm",3,"formGroup","submit"],[1,"text-base","font-bold","mb-2"],[1,"grid","grid-cols-2","gap-4"],["appearance","outline","floatLabel","always"],["matInput","","formControlName","latitude","type","text"],["matSuffix",""],["matInput","","formControlName","longitude","type","text"],[1,"bordered-box","grid","grid-cols-2","gap-2","border-b-2"],["appearance","outline"],["matInput","","formControlName","dcLessThan50","type","number","min","0"],["matInput","","formControlName","acLessThan7","type","number","min","0"],["matInput","","formControlName","dcBetween50_150","type","number","min","0"],["matInput","","formControlName","acBetween7_22","type","number","min","0"],["matInput","","formControlName","dcBetween150_350","type","number","min","0"],["matInput","","formControlName","acGreaterThan22","type","number","min","0"],["appearance","outline",1,"no-bottom-margin"],["matInput","","formControlName","dcGreaterThan350","type","number","min","0"],[1,"text-base","font-bold","mb-1","mt-6"],["appearance","outline",1,"simulation-name","pb-4"],["matInput","","formControlName","simulationName","type","text"],[4,"ngIf"],[1,"flex","items-center","justify-end","w-full","bg-white","border-t","border-gray-300","p-3","z-50"],["type","submit","form","simulationForm","mat-raised-button","",1,"flex","items-center","justify-center",2,"margin-right","1rem",3,"disabled"],["diameter","20"]],template:function(i,o){1&i&&(p.TgZ(0,"div",0)(1,"div")(2,"div",1)(3,"mat-icon",2),p.NdJ("click",function(){return o.goBackTopoiDetails()}),p._uU(4,"arrow_back"),p.qZA(),p.TgZ(5,"div",3)(6,"mat-icon",4),p.NdJ("click",function(){return o.toggleBookmark()}),p._uU(7),p.qZA(),p.TgZ(8,"mat-icon",5),p.NdJ("click",function(){return o.removeMarker()}),p._uU(9,"close"),p.qZA()()(),p.TgZ(10,"div")(11,"h3",6),p._uU(12,"Prediction details"),p.qZA()()(),p.TgZ(13,"div",7)(14,"form",8),p.NdJ("submit",function(){return o.RunSimulation()}),p.TgZ(15,"div",9),p._uU(16,"Location"),p.qZA(),p.TgZ(17,"div",10)(18,"mat-form-field",11)(19,"mat-label"),p._uU(20,"Latitude"),p.qZA(),p._UZ(21,"input",12),p.TgZ(22,"mat-icon",13),p._uU(23,"gps_fixed"),p.qZA()(),p.TgZ(24,"mat-form-field",11)(25,"mat-label"),p._uU(26,"Longitude"),p.qZA(),p._UZ(27,"input",14),p.TgZ(28,"mat-icon",13),p._uU(29,"gps_fixed"),p.qZA()()(),p.TgZ(30,"div",9),p._uU(31,"Infrastructure to Install"),p.qZA(),p.TgZ(32,"div",15)(33,"mat-form-field",16)(34,"mat-label"),p._uU(35,"DC <50KW"),p.qZA(),p._UZ(36,"input",17),p.TgZ(37,"mat-icon",13),p._uU(38,"power"),p.qZA()(),p.TgZ(39,"mat-form-field",16)(40,"mat-label"),p._uU(41,"AC <7.4KW"),p.qZA(),p._UZ(42,"input",18),p.TgZ(43,"mat-icon",13),p._uU(44,"power"),p.qZA()(),p.TgZ(45,"mat-form-field",16)(46,"mat-label"),p._uU(47,"DC 50KW-150KW"),p.qZA(),p._UZ(48,"input",19),p.TgZ(49,"mat-icon",13),p._uU(50,"power"),p.qZA()(),p.TgZ(51,"mat-form-field",16)(52,"mat-label"),p._uU(53,"AC 7.4KW-22KW"),p.qZA(),p._UZ(54,"input",20),p.TgZ(55,"mat-icon",13),p._uU(56,"power"),p.qZA()(),p.TgZ(57,"mat-form-field",16)(58,"mat-label"),p._uU(59,"DC 150KW-350KW"),p.qZA(),p._UZ(60,"input",21),p.TgZ(61,"mat-icon",13),p._uU(62,"power"),p.qZA()(),p.TgZ(63,"mat-form-field",16)(64,"mat-label"),p._uU(65,"AC > 22KW"),p.qZA(),p._UZ(66,"input",22),p.TgZ(67,"mat-icon",13),p._uU(68,"power"),p.qZA()(),p.TgZ(69,"mat-form-field",23)(70,"mat-label"),p._uU(71,"DC >350KW"),p.qZA(),p._UZ(72,"input",24),p.TgZ(73,"mat-icon",13),p._uU(74,"power"),p.qZA()()(),p.TgZ(75,"div",25),p._uU(76,"Prediction name"),p.qZA(),p.TgZ(77,"mat-form-field",26)(78,"mat-label"),p._uU(79,"Prediction name"),p.qZA(),p._UZ(80,"input",27),p.TgZ(81,"mat-icon",13),p._uU(82,"label"),p.qZA(),p.YNc(83,mp,2,0,"mat-error",28),p.qZA()()(),p.TgZ(84,"div",29)(85,"button",30),p.YNc(86,Sg,2,0,"mat-icon",28),p.YNc(87,Ca,2,0,"span",28),p.qZA()()()),2&i&&(p.xp6(6),p.Q6J("ngClass",null!=o.selectedLocation&&o.selectedLocation.saved_name?"bookmark-added":"hover:cursor-pointer"),p.xp6(1),p.Oqu(null!=o.selectedLocation&&o.selectedLocation.saved_name?"bookmark_added":"bookmark_add"),p.xp6(7),p.Q6J("formGroup",o.simulationForm),p.xp6(69),p.Q6J("ngIf",null==o.simulationForm.get("simulationName").errors?null:o.simulationForm.get("simulationName").errors.required),p.xp6(2),p.Akn(!o.disabled&&o.simulationForm.valid?"background-color:#335579;color:white;":"background-color:rgba(224,224,224,1);"),p.Q6J("disabled",o.disabled||!o.simulationForm.valid),p.xp6(1),p.Q6J("ngIf",o.disabled),p.xp6(1),p.Q6J("ngIf",!o.disabled))},dependencies:[c.ez,c.mk,c.O5,vn.ot,vn.lW,Me.u5,Me._Y,Me.Fj,Me.wV,Me.JJ,Me.JL,Me.qQ,Me.UX,Me.sg,Me.u,br.c,Rn.TO,Rn.KE,Rn.hX,Rn.R9,br.Nt,cn.Ps,cn.Hw,Qo.Cq,Qo.$g,Cs.ZX],styles:["[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:50px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{border-radius:6px;background:#f1f1f1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:6px;background:#888;height:20%}[_ngcontent-%COMP%]::-webkit-scrollbar-button{height:100%}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{-webkit-transition:.8s;transition:.8s;background:#555}.title[_ngcontent-%COMP%]{font-weight:700;text-align:center;font-size:17px;border-bottom:1px solid rgba(230,230,230,.9450980392);padding-bottom:.6rem}  .simulation-name{width:49%}.simulation-name-title[_ngcontent-%COMP%]{margin-bottom:0;margin-top:1rem}.bordered-box[_ngcontent-%COMP%]{border-bottom:1px solid rgba(230,230,230,.9450980392)}.no-bottom-margin[_ngcontent-%COMP%]{margin-bottom:0}  .custom-style{background-color:#fe5157;color:#fff}  .custom-style-green{background-color:#10b981;color:#fff}  .mat-simple-snackbar-action>button{color:#fff}.bookmark-icon-color[_ngcontent-%COMP%]{color:#666;transition:color .5s}.bookmark-added[_ngcontent-%COMP%]{color:green}@keyframes _ngcontent-%COMP%_bookmark-add{0%{transform:scale(1)}50%{transform:scale(1.5)}to{transform:scale(1)}}.bookmark-add-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bookmark-add-icon .5s forwards}@keyframes _ngcontent-%COMP%_bookmark-add-icon{0%{opacity:1}to{opacity:0}}.bookmark-added-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bookmark-added-icon .5s forwards}@keyframes _ngcontent-%COMP%_bookmark-added-icon{0%{opacity:0;transform:scale(.5)}to{opacity:1;transform:scale(1)}}"]}),l})();var om=bt(9310);function od(l,r){if(1&l&&(p.TgZ(0,"div",53)(1,"mat-icon",56),p._uU(2,"bookmark"),p.qZA(),p.TgZ(3,"div",55),p._uU(4),p.qZA()()),2&l){const i=p.oxw(2);p.xp6(4),p.hij(" ",null==i.selectedLocation?null:i.selectedLocation.saved_name," ")}}function gp(l,r){if(1&l&&(p.TgZ(0,"div",53)(1,"mat-icon",57),p._uU(2,"description"),p.qZA(),p.TgZ(3,"div",58),p._uU(4),p.qZA()()),2&l){const i=p.oxw(2);p.xp6(4),p.hij(" ",null==i.selectedLocation?null:i.selectedLocation.note," ")}}function Cg(l,r){if(1&l&&(p.TgZ(0,"div",53)(1,"mat-icon",54),p._uU(2,"home"),p.qZA(),p.TgZ(3,"div",55),p._uU(4),p.qZA()()),2&l){const i=p.oxw(2);p.xp6(4),p.Oqu(null==i.selectedLocation?null:i.selectedLocation.address)}}function rm(l,r){if(1&l&&(p.TgZ(0,"div",53)(1,"mat-icon",59),p._uU(2,"my_location"),p.qZA(),p.TgZ(3,"div",55),p._uU(4),p.qZA()()),2&l){const i=p.oxw(2);p.xp6(4),p.AsE(" ",null==i.selectedLocation?null:i.selectedLocation.lat,", ",null==i.selectedLocation?null:i.selectedLocation.lon," ")}}function yl(l,r){if(1&l&&(p.TgZ(0,"div",53)(1,"mat-icon",60),p._uU(2),p.qZA(),p.TgZ(3,"div",55),p._uU(4),p.qZA()()),2&l){const i=p.oxw(2);p.xp6(2),p.Oqu("charging station"===(null==i.selectedLocation?null:i.selectedLocation.type)?"ev_station":"parking"===(null==i.selectedLocation?null:i.selectedLocation.type)?"local_parking":"hotel"===(null==i.selectedLocation?null:i.selectedLocation.type)?"hotel":"Retail"===(null==i.selectedLocation?null:i.selectedLocation.type)?"shopping_cart":"gas station"===(null==i.selectedLocation?null:i.selectedLocation.type)?"local_gas_station":"pinned location"===(null==i.selectedLocation?null:i.selectedLocation.type)?"flag":"local_offer"),p.xp6(2),p.hij(" ",i.Capitalize(null==i.selectedLocation?null:i.selectedLocation.type)," ")}}function Mg(l,r){if(1&l&&(p.TgZ(0,"div",51),p.YNc(1,od,5,1,"div",52),p.YNc(2,gp,5,1,"div",52),p.YNc(3,Cg,5,1,"div",52),p.YNc(4,rm,5,2,"div",52),p.YNc(5,yl,5,2,"div",52),p.TgZ(6,"div",53)(7,"mat-icon",54),p._uU(8,"label"),p.qZA(),p.TgZ(9,"div",55),p._uU(10),p.qZA()()()),2&l){const i=p.oxw();p.xp6(1),p.Q6J("ngIf",null==i.selectedLocation?null:i.selectedLocation.saved_name),p.xp6(1),p.Q6J("ngIf",null==i.selectedLocation?null:i.selectedLocation.note),p.xp6(1),p.Q6J("ngIf",null==i.selectedLocation?null:i.selectedLocation.address),p.xp6(1),p.Q6J("ngIf",(null==i.selectedLocation?null:i.selectedLocation.lat)&&(null==i.selectedLocation?null:i.selectedLocation.lon)),p.xp6(1),p.Q6J("ngIf",null==i.selectedLocation?null:i.selectedLocation.type),p.xp6(5),p.Oqu(i.simulationName)}}function Ma(l,r){if(1&l&&(p.ynx(0),p.TgZ(1,"div",53),p._UZ(2,"img",66),p.TgZ(3,"h3",67),p._uU(4),p.qZA()(),p.TgZ(5,"div",68)(6,"p",69)(7,"span",70),p._uU(8,"Rated power:"),p.qZA(),p._uU(9),p.qZA(),p.TgZ(10,"p",69)(11,"span",70),p._uU(12,"Voltage:"),p.qZA(),p._uU(13),p.qZA(),p.TgZ(14,"p",69)(15,"span",70),p._uU(16,"Current:"),p.qZA(),p._uU(17),p.qZA(),p.TgZ(18,"p",69)(19,"span",70),p._uU(20,"Current type:"),p.qZA(),p._uU(21),p.qZA()(),p.BQk()),2&l){const i=p.oxw().$implicit;p.xp6(2),p.Q6J("src","../../../../../../assets/images/connectors-images/"+i.connectorType+".jpg",p.LSH),p.xp6(2),p.hij(" ",i.connectorType," "),p.xp6(5),p.hij(" ",i.ratedPowerKW," kW "),p.xp6(4),p.hij(" ",i.voltageV," V "),p.xp6(4),p.hij(" ",i.currentA," A "),p.xp6(4),p.hij(" ",i.currentType," ")}}function Eg(l,r){if(1&l&&(p.TgZ(0,"div",64),p.YNc(1,Ma,22,6,"ng-container",65),p.qZA()),2&l){const i=r.$implicit;p.xp6(1),p.Q6J("ngIf","StandardHouseholdCountrySpecific"!==i.connectorType)}}function Gh(l,r){1&l&&(p.TgZ(0,"div",71)(1,"p",69),p._uU(2,"No connectors found."),p.qZA()())}function qh(l,r){if(1&l&&(p.TgZ(0,"mat-expansion-panel",61)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),p._uU(3,"Charging station details"),p.qZA()(),p.TgZ(4,"div"),p.YNc(5,Eg,2,1,"div",62),p.YNc(6,Gh,3,0,"div",63),p.qZA()()),2&l){const i=p.oxw();p.xp6(5),p.Q6J("ngForOf",i.evConnector),p.xp6(1),p.Q6J("ngIf",0===i.evConnector.length)}}function Hh(l,r){1&l&&(p.TgZ(0,"div"),p._UZ(1,"canvas",77),p.qZA())}function $h(l,r){if(1&l&&(p.TgZ(0,"div",72),p.YNc(1,Hh,2,0,"div",65),p.TgZ(2,"div",73)(3,"div",74)(4,"span",75),p._uU(5,"Charging stations within 500m"),p.qZA(),p.TgZ(6,"span",67),p._uU(7),p.qZA()(),p.TgZ(8,"mat-icon",76),p._uU(9,"ev_station"),p.qZA()(),p.TgZ(10,"div",73)(11,"div",74)(12,"span",75),p._uU(13,"Charge points within 500m"),p.qZA(),p.TgZ(14,"span",67),p._uU(15),p.qZA()(),p.TgZ(16,"mat-icon",76),p._uU(17,"electric_car"),p.qZA()(),p.TgZ(18,"div",14)(19,"div",74)(20,"span",75),p._uU(21,"Number of EVs in the area"),p.qZA(),p.TgZ(22,"span",67),p._uU(23),p.ALo(24,"number"),p.qZA()(),p.TgZ(25,"mat-icon",76),p._uU(26,"pie_chart"),p.qZA()()()),2&l){const i=p.oxw();p.xp6(1),p.Q6J("ngIf",!i.isValuesArrayAllZeros()),p.xp6(6),p.Oqu(i.evStats.chargingStation),p.xp6(8),p.Oqu(i.evStats.chargingPoints),p.xp6(8),p.Oqu(p.xi3(24,4,i.evStats.evShare,"1.0-0"))}}function rd(l,r){1&l&&(p.TgZ(0,"div",78)(1,"p",79),p._uU(2," No points of interest found "),p.qZA()())}function Ag(l,r){if(1&l&&(p.TgZ(0,"div",80)(1,"div",81)(2,"span",82)(3,"mat-icon"),p._uU(4),p.qZA()(),p.TgZ(5,"span",83),p._uU(6),p.qZA()(),p.TgZ(7,"span",84),p._uU(8),p.qZA()()),2&l){const i=r.$implicit;p.xp6(4),p.Oqu(i.type),p.xp6(2),p.Oqu(i.name),p.xp6(2),p.Oqu(i.distance)}}function kg(l,r){if(1&l){const i=p.EpF();p.TgZ(0,"button",85),p.NdJ("click",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.showMore())}),p._uU(1," See More "),p.qZA()}}wa.register(...dp);let xc=(()=>{class l{constructor(i,o,d,_,x,T){this._simulationService=i,this._exploreService=o,this._tokenService=d,this.snackBar=_,this.dialog=x,this._printPdfServiceService=T,this.parentVariableUpdated=new p.vpe,this.score=2,this.isBookmarkAdded=!1,this.poiNearby=[],this.areaStats={areaScore:-1,medianIncome:-1,populationDensity:-1},this.siteAttractiviness={siteScore:0,evUptake:0,populationDensityScore:0,populationAvgRevenueScore:0,nearbyCompetitionScore:0,nearbyPointOfInterestScore:0},this.siteAttrac=!1,this.evStatsPanel=!1,this.poiNearbyPanel=!1,this.areaStatsPanel=!1,this.evStatsLoading=!1,this.loadingData=!1,this.itemsToShow=20,this.evConnector=[],this.animate=!1,this.simulationName="",this.evStatsChartLabels=["Slow","Regular","Fast","Very fast"],this.evStatsChartValues=[0,0,0,0],this.ageDistribution=[]}ngOnDestroy(){this._exploreService._simulationOptions=void 0,this.clearRPSubscription.unsubscribe()}ngOnInit(){this._exploreService.selectedLocationData$.subscribe({next:i=>{this.poiNearby=i.poiNearby,this.evStats={chargingPoints:i.evChargePointStats.chargingPoints,chargingStation:i.evChargePointStats.chargingStation,evShare:i.evChargePointStats.evShare},this.evStatsChartValues=i.evChargePointStats.evStatsChartValues,this.areaStats.populationDensity=i.areaStats.populationDensity,this.areaStats.areaScore=i.areaStats.areaScore,this.areaStats.medianIncome=i.areaStats.medianIncome,this.score=i.areaStats.areaScore,this.siteAttractiviness.siteScore=i.siteAttractiviness.siteScore,this.siteAttractiviness.evUptake=i.siteAttractiviness.evUptake,this.siteAttractiviness.populationDensityScore=i.siteAttractiviness.populationDensityScore,this.siteAttractiviness.populationAvgRevenueScore=i.siteAttractiviness.populationAvgRevenueScore,this.siteAttractiviness.nearbyCompetitionScore=i.siteAttractiviness.nearbyCompetitionScore,this.siteAttractiviness.nearbyPointOfInterestScore=i.siteAttractiviness.nearbyPointOfInterestScore,this.ageDistribution=i.areaStats.ageDistribution,setTimeout(()=>{this.animate=!0,this.renderChart(),this.rederAgeDistributionChart()},500)}}),this._exploreService.selectedLocation$.subscribe({next:i=>{this.selectedLocation=i,console.error("this is the selected location : ",this.selectedLocation),this.evConnector=this.selectedLocation.evConnector}}),this.clearRPSubscription=this._exploreService.clearRP.subscribe({next:i=>{console.error("I am here --------------",i,this.selectedLocation?.type),i&&this.selectedLocation?.type.toLowerCase()===("supermarket"===i?"retail":i.toLowerCase())&&(this._exploreService.removePoiMarker.next(1),this.parentVariableUpdated.emit("poi-list"))}}),this._exploreService.simulationOptions$.subscribe({next:i=>{this.data=i}}),console.error("thi is the data ",this.data),this.simulationName=this.data.simulationName,this.simulationForm=new Me.cw({simulationName:new Me.NI({value:this.data.simulationName,disabled:!0},[Me.kI.required]),latitude:new Me.NI({value:this.data.latitude,disabled:!0},[Me.kI.required]),longitude:new Me.NI({value:this.data.longitude,disabled:!0},[Me.kI.required]),dcLessThan50:new Me.NI({value:this.data.dcLessThan50,disabled:!0},[Me.kI.required]),dcBetween50_150:new Me.NI({value:this.data.dcBetween50_150,disabled:!0},[Me.kI.required]),dcBetween150_350:new Me.NI({value:this.data.dcBetween150_350,disabled:!0},[Me.kI.required]),dcGreaterThan350:new Me.NI({value:this.data.dcGreaterThan350,disabled:!0},[Me.kI.required]),acLessThan7:new Me.NI({value:this.data.acLessThan7,disabled:!0},[Me.kI.required]),acBetween7_22:new Me.NI({value:this.data.acBetween7_22,disabled:!0},[Me.kI.required]),acGreaterThan22:new Me.NI({value:this.data.acGreaterThan22,disabled:!0},[Me.kI.required])})}goBackToSimulationOptions(){this.parentVariableUpdated.emit("simulation-options")}toggleBookmark(){this.selectedLocation.saved_name||this.dialog.open(oa,{width:"30%"}).afterClosed().subscribe({next:o=>{o&&this._exploreService.SaveLocation(o).subscribe({next:d=>{this.isBookmarkAdded=!0,this.snackBar.open("Location saved successfully","close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["custom-style-green"]})},error:d=>{this.snackBar.open(d.error.msg,"close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["custom-style"]})}})}})}showMore(){this.itemsToShow+=20}Capitalize(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""}makePDF(){this._printPdfServiceService.showOrHideReport(!0)}removeMarker(){-1!==this.selectedLocation.markerId?(this._exploreService.deleteMarker(this.selectedLocation.markerId),this.removeDataFromCash(),this.parentVariableUpdated.emit("poi-list")):(this._exploreService.removePoiMarker.next(1),this.removeDataFromCash(),this.parentVariableUpdated.emit("poi-list"))}removeDataFromCash(){this._simulationService.setEvStats(void 0),this._simulationService.setPoiNearby(void 0),this._simulationService.setAreaStats(void 0),this._simulationService.setSiteAttractiviness(void 0),this._simulationService.setSavedLoaction(!1),this._simulationService.setMarkerId(void 0),this._simulationService.setlocationData(void 0),this._simulationService.setEvStatsChartLabels(this.evStatsChartLabels),this._simulationService.setEvStatsChartValues([0,0,0,0])}renderChart(){console.error("this is the loading : ",this.loadingData),new wa("chargePointDistribution",{type:"pie",data:{labels:["Slow","Regular","Fast","Very fast"],datasets:[{label:"# of Votes",data:this.evStatsChartValues,borderWidth:1}]}})}rederAgeDistributionChart(){new wa("ageDistribution",{type:"pie",data:{labels:["0-3","4-5","6-10","11-17","18-24","25-39","40-54","55-64","65-79","80+"],datasets:[{label:"something ",data:this.ageDistribution,borderWidth:1}]}})}isValuesArrayAllZeros(){return this.evStatsChartValues.every(i=>0===i)}}return l.\u0275fac=function(i){return new(i||l)(p.Y36(gc.s),p.Y36(_l.G),p.Y36(Vh.B),p.Y36(Cs.ux),p.Y36(Po.uw),p.Y36(om.v))},l.\u0275cmp=p.Xpm({type:l,selectors:[["app-simulation-results"]],outputs:{parentVariableUpdated:"parentVariableUpdated"},standalone:!0,features:[p.jDz],decls:166,vars:72,consts:[[1,"h-full","relative","flex","flex-col","space-y-0","justify-between","align-items-stretch"],[1,"flex","justify-between","items-center","ml-1","w-full","p-2","pb-0"],[1,"hover:cursor-pointer",3,"click"],[1,"flex","justify-center","items-center"],[1,"mr-6","hover:cursor-pointer",3,"click"],[1,"bookmark-icon-color",2,"font-size","30px","width","30px","height","30px","margin-right","10px",3,"ngClass","click"],[1,"text-gray-500","hover:text-red-500","cursor-pointer","mr-1",3,"click"],[1,"overflow-y-auto","scroll-smooth","flex-1"],["class","flex flex-col w-full p-2",4,"ngIf"],[1,"my-4","text-center"],[1,"text-lg","font-bold","mb-2"],[1,"w-full","flex","justify-center","items-center"],[1,"rounded-full","bg-gradient-to-r","from-blue-400","to-blue-500","flex","items-center","justify-center","text-white","font-bold","text-xl","transition-all","duration-500"],["_ngcontent-vpw-c31","",1,"text-lg","font-bold","ml-1","text-white",2,"font-size","12px"],[1,"flex","justify-between","items-center"],[1,"flex","flex-col","space-y-3","mt-3","w-full"],[1,"w-11/12",2,"margin-left","auto","margin-right","auto",3,"expanded"],[3,"formGroup"],[1,"grid","grid-cols-2","gap-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","dcLessThan50","type","number","min","0",3,"disabled"],["matSuffix",""],["matInput","","formControlName","acLessThan7","type","number","min","0",3,"disabled"],["matInput","","formControlName","dcBetween50_150","type","number","min","0",3,"disabled"],["matInput","","formControlName","acBetween7_22","type","number","min","0",3,"disabled"],["matInput","","formControlName","dcBetween150_350","type","number","min","0",3,"disabled"],["matInput","","formControlName","acGreaterThan22","type","number","min","0",3,"disabled"],["matInput","","formControlName","dcGreaterThan350","type","number","min","0",3,"disabled"],[1,"w-11/12",2,"margin-left","auto","margin-right","auto",3,"expanded","afterExpand","afterCollapse"],[3,"score","animate"],[1,"my-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","text-gray-500","font-medium","mr-2"],[1,"text-xs","font-medium"],[1,"h-2","bg-gray-200","rounded-full"],[1,"h-full","rounded-full","bg-gradient-to-r","from-teal-400","to-blue-500","transition-all","duration-500"],["style","margin-left: auto; margin-right: auto","class","w-11/12",4,"ngIf"],[1,"w-11/12",2,"margin-left","auto","margin-right","auto",3,"expanded","closed","opened"],["class","flex flex-col space-y-3 p-2",4,"ngIf"],[1,"w-11/12",2,"margin-left","auto","margin-right","auto",3,"expanded","opened","closed"],["id","ageDistribution",1,"w-full","h-full"],[1,"flex","flex-col","space-y-6"],[1,"ml-3","flex","flex-col"],[1,"text-sm","text-gray-500"],[1,"text-xl","font-bold"],[1,"w-11/12",2,"margin-left","auto","margin-right","auto","margin-bottom","10px",3,"expanded","closed","opened"],[1,"flex","flex-col","space-y-3"],["class","h-20 flex items-center justify-center",4,"ngIf"],[1,"poi-list"],["class","bg-gray-200 p-3 rounded flex items-center justify-between mb-2",4,"ngFor","ngForOf"],["class","bg-gray-200 text-gray-700 py-2 px-4 rounded hover:bg-gray-300",3,"click",4,"ngIf"],[1,"flex","flex-col","w-full","p-2"],["class","flex items-center mb-2",4,"ngIf"],[1,"flex","items-center","mb-2"],["matTooltip","Address","matTooltipPosition","above",1,"text-gray-400","mr-2"],[1,"text-xs","text-gray-500"],["matTooltip","Saved name","matTooltipPosition","above",1,"text-gray-400","mr-2"],["matTooltip","Description","matTooltipPosition","above",1,"text-gray-400","mr-2"],[1,"text-xs","text-gray-500","w-3/4","whitespace-normal","break-words"],["matTooltip","latitude, longitude","matTooltipPosition","above",1,"text-gray-400","mr-2"],[1,"text-gray-400","mr-2"],[1,"w-11/12",2,"margin-left","auto","margin-right","auto"],["class","bg-white p-4 mb-4 shadow-md",4,"ngFor","ngForOf"],["class","bg-white p-4 shadow-md",4,"ngIf"],[1,"bg-white","p-4","mb-4","shadow-md"],[4,"ngIf"],["alt","",1,"h-10","mr-3",3,"src"],[1,"text-lg","font-bold"],[1,"grid","grid-cols-2","gap-4","mb-2"],[1,"text-gray-500"],[1,"font-medium"],[1,"bg-white","p-4","shadow-md"],[1,"flex","flex-col","space-y-3","p-2"],[1,"flex","justify-between","items-center","border-b-2","pb-2"],[1,"flex","flex-col"],[1,"text-sm"],[1,"text-gray-400","text-2xl"],["id","chargePointDistribution",1,"w-full","h-full"],[1,"h-20","flex","items-center","justify-center"],[1,"text-gray-500","text-sm","font-medium","text-center"],[1,"bg-gray-200","p-3","rounded","flex","items-center","justify-between","mb-2"],[1,"flex","items-center"],[1,"text-gray-700","mr-3"],[1,"text-gray-900"],[1,"text-gray-700"],[1,"bg-gray-200","text-gray-700","py-2","px-4","rounded","hover:bg-gray-300",3,"click"]],template:function(i,o){1&i&&(p.TgZ(0,"div",0)(1,"div",1)(2,"mat-icon",2),p.NdJ("click",function(){return o.goBackToSimulationOptions()}),p._uU(3,"arrow_back"),p.qZA(),p.TgZ(4,"div",3)(5,"mat-icon",4),p.NdJ("click",function(){return o.makePDF()}),p._uU(6," file_download "),p.qZA(),p.TgZ(7,"mat-icon",5),p.NdJ("click",function(){return o.toggleBookmark()}),p._uU(8),p.qZA(),p.TgZ(9,"mat-icon",6),p.NdJ("click",function(){return o.removeMarker()}),p._uU(10,"close"),p.qZA()()(),p.TgZ(11,"div",7),p.YNc(12,Mg,11,6,"div",8),p.TgZ(13,"div",9)(14,"p",10),p._uU(15,"Annual charging demand prediction"),p.qZA(),p.TgZ(16,"div",11)(17,"div",12),p._uU(18),p.ALo(19,"number"),p.TgZ(20,"span",13),p._uU(21,"KWh"),p.qZA()()()(),p.TgZ(22,"div",14)(23,"div",15)(24,"mat-expansion-panel",16)(25,"mat-expansion-panel-header")(26,"mat-panel-title"),p._uU(27,"Infrastructure to install"),p.qZA()(),p.TgZ(28,"form",17)(29,"div")(30,"div",18)(31,"mat-form-field",19)(32,"mat-label"),p._uU(33,"DC <50KW"),p.qZA(),p._UZ(34,"input",20),p.TgZ(35,"mat-icon",21),p._uU(36,"power"),p.qZA()(),p.TgZ(37,"mat-form-field",19)(38,"mat-label"),p._uU(39,"AC <7.4KW"),p.qZA(),p._UZ(40,"input",22),p.TgZ(41,"mat-icon",21),p._uU(42,"power"),p.qZA()(),p.TgZ(43,"mat-form-field",19)(44,"mat-label"),p._uU(45,"DC 50KW-150KW"),p.qZA(),p._UZ(46,"input",23),p.TgZ(47,"mat-icon",21),p._uU(48,"power"),p.qZA()(),p.TgZ(49,"mat-form-field",19)(50,"mat-label"),p._uU(51,"AC 7.4KW-22KW"),p.qZA(),p._UZ(52,"input",24),p.TgZ(53,"mat-icon",21),p._uU(54,"power"),p.qZA()(),p.TgZ(55,"mat-form-field",19)(56,"mat-label"),p._uU(57,"DC 150KW-350KW"),p.qZA(),p._UZ(58,"input",25),p.TgZ(59,"mat-icon",21),p._uU(60,"power"),p.qZA()(),p.TgZ(61,"mat-form-field",19)(62,"mat-label"),p._uU(63,"AC > 22KW"),p.qZA(),p._UZ(64,"input",26),p.TgZ(65,"mat-icon",21),p._uU(66,"power"),p.qZA()(),p.TgZ(67,"mat-form-field",19)(68,"mat-label"),p._uU(69,"DC >350KW"),p.qZA(),p._UZ(70,"input",27),p.TgZ(71,"mat-icon",21),p._uU(72,"power"),p.qZA()()()()()(),p.TgZ(73,"mat-expansion-panel",28),p.NdJ("afterExpand",function(){return o.siteAttrac=!0})("afterCollapse",function(){return o.siteAttrac=!1}),p.TgZ(74,"mat-expansion-panel-header")(75,"mat-panel-title"),p._uU(76,"Site attractiveness score"),p.qZA()(),p.TgZ(77,"div"),p._UZ(78,"app-circular-score",29),p.TgZ(79,"div",30)(80,"div",31)(81,"span",32),p._uU(82,"EV density score"),p.qZA(),p.TgZ(83,"span",33),p._uU(84),p.ALo(85,"number"),p.qZA()(),p.TgZ(86,"div",34),p._UZ(87,"div",35),p.qZA()(),p.TgZ(88,"div",30)(89,"div",31)(90,"span",32),p._uU(91,"Population density score"),p.qZA(),p.TgZ(92,"span",33),p._uU(93),p.ALo(94,"number"),p.qZA()(),p.TgZ(95,"div",34),p._UZ(96,"div",35),p.qZA()(),p.TgZ(97,"div",30)(98,"div",31)(99,"span",32),p._uU(100,"Population average revenue score"),p.qZA(),p.TgZ(101,"span",33),p._uU(102),p.ALo(103,"number"),p.qZA()(),p.TgZ(104,"div",34),p._UZ(105,"div",35),p.qZA()(),p.TgZ(106,"div",30)(107,"div",31)(108,"span",32),p._uU(109,"Charge point density score"),p.qZA(),p.TgZ(110,"span",33),p._uU(111),p.ALo(112,"number"),p.qZA()(),p.TgZ(113,"div",34),p._UZ(114,"div",35),p.qZA()(),p.TgZ(115,"div",30)(116,"div",31)(117,"span",32),p._uU(118,"POI density score"),p.qZA(),p.TgZ(119,"span",33),p._uU(120),p.ALo(121,"number"),p.qZA()(),p.TgZ(122,"div",34),p._UZ(123,"div",35),p.qZA()()()(),p.YNc(124,qh,7,2,"mat-expansion-panel",36),p.TgZ(125,"mat-expansion-panel",37),p.NdJ("closed",function(){return o.evStatsPanel=!1})("opened",function(){return o.evStatsPanel=!0}),p.TgZ(126,"mat-expansion-panel-header")(127,"mat-panel-title"),p._uU(128,"EV stats"),p.qZA()(),p.YNc(129,$h,27,7,"div",38),p.qZA(),p.TgZ(130,"mat-expansion-panel",39),p.NdJ("opened",function(){return o.areaStatsPanel=!0})("closed",function(){return o.areaStatsPanel=!1}),p.TgZ(131,"mat-expansion-panel-header")(132,"mat-panel-title"),p._uU(133,"Area stats"),p.qZA()(),p.TgZ(134,"div"),p._UZ(135,"canvas",40),p.qZA(),p.TgZ(136,"div",41)(137,"div",42)(138,"span",43),p._uU(139,"Population density"),p.qZA(),p.TgZ(140,"span",44),p._uU(141),p.ALo(142,"number"),p.qZA()(),p._UZ(143,"hr"),p.TgZ(144,"div",42)(145,"span",43),p._uU(146,"Median income"),p.qZA(),p.TgZ(147,"span",44),p._uU(148),p.ALo(149,"number"),p.qZA()(),p._UZ(150,"hr"),p.TgZ(151,"div")(152,"span",43),p._uU(153,"Area potential score"),p.qZA(),p._UZ(154,"app-circular-score",29),p.qZA()()(),p.TgZ(155,"mat-expansion-panel",45),p.NdJ("closed",function(){return o.poiNearbyPanel=!1})("opened",function(){return o.poiNearbyPanel=!0}),p.TgZ(156,"mat-expansion-panel-header")(157,"mat-panel-title"),p._uU(158,"Point of interest nearby\xa0 "),p.TgZ(159,"span"),p._uU(160),p.qZA()()(),p.TgZ(161,"div",46),p.YNc(162,rd,3,0,"div",47),p.TgZ(163,"div",48),p.YNc(164,Ag,9,3,"div",49),p.YNc(165,kg,2,0,"button",50),p.qZA()()()()()()()),2&i&&(p.xp6(7),p.Q6J("ngClass",null!=o.selectedLocation&&o.selectedLocation.saved_name?"bookmark-added":"hover:cursor-pointer"),p.xp6(1),p.hij("",null!=o.selectedLocation&&o.selectedLocation.saved_name?"bookmark_added":"bookmark_add"," "),p.xp6(4),p.Q6J("ngIf",o.selectedLocation),p.xp6(5),p.Udp("width",o.animate?120:0,"px")("height",o.animate?120:0,"px"),p.xp6(1),p.hij(" ",p.xi3(19,48,400*o.siteAttractiviness.siteScore*12,"1.0-0")," "),p.xp6(6),p.Q6J("expanded",!0),p.xp6(4),p.Q6J("formGroup",o.simulationForm),p.xp6(6),p.Q6J("disabled",!0),p.xp6(6),p.Q6J("disabled",!0),p.xp6(6),p.Q6J("disabled",!0),p.xp6(6),p.Q6J("disabled",!0),p.xp6(6),p.Q6J("disabled",!0),p.xp6(6),p.Q6J("disabled",!0),p.xp6(6),p.Q6J("disabled",!0),p.xp6(3),p.Q6J("expanded",o.siteAttrac),p.xp6(5),p.Q6J("score",o.siteAttractiviness.siteScore)("animate",o.siteAttrac),p.xp6(6),p.Oqu(p.xi3(85,51,o.siteAttractiviness.evUptake,"1.2-2")),p.xp6(3),p.Udp("width",o.siteAttrac?10*o.siteAttractiviness.evUptake:0,"%"),p.xp6(6),p.Oqu(p.xi3(94,54,o.siteAttractiviness.populationDensityScore,"1.2-2")),p.xp6(3),p.Udp("width",o.siteAttrac?10*o.siteAttractiviness.populationDensityScore:0,"%"),p.xp6(6),p.Oqu(p.xi3(103,57,o.siteAttractiviness.populationAvgRevenueScore,"1.2-2")),p.xp6(3),p.Udp("width",o.siteAttrac?10*o.siteAttractiviness.populationAvgRevenueScore:0,"%"),p.xp6(6),p.Oqu(p.xi3(112,60,o.siteAttractiviness.nearbyCompetitionScore,"1.2-2")),p.xp6(3),p.Udp("width",o.siteAttrac?10*o.siteAttractiviness.nearbyCompetitionScore:0,"%"),p.xp6(6),p.Oqu(p.xi3(121,63,o.siteAttractiviness.nearbyPointOfInterestScore,"1.2-2")),p.xp6(3),p.Udp("width",o.siteAttrac?10*o.siteAttractiviness.nearbyPointOfInterestScore:0,"%"),p.xp6(1),p.Q6J("ngIf","charging station"===(null==o.selectedLocation?null:o.selectedLocation.type)),p.xp6(1),p.Q6J("expanded",o.evStatsPanel),p.xp6(4),p.Q6J("ngIf",o.evStats),p.xp6(1),p.Q6J("expanded",o.areaStatsPanel),p.xp6(11),p.Oqu(p.xi3(142,66,o.areaStats.populationDensity,"1.0-0")),p.xp6(7),p.hij("\u20ac",p.xi3(149,69,o.areaStats.medianIncome,"1.0-0"),""),p.xp6(6),p.Q6J("score",o.areaStats.areaScore)("animate",o.areaStatsPanel),p.xp6(1),p.Q6J("expanded",o.poiNearbyPanel),p.xp6(5),p.hij(" (",o.poiNearby.length,")"),p.xp6(2),p.Q6J("ngIf",0===o.poiNearby.length),p.xp6(2),p.Q6J("ngForOf",o.poiNearby.slice(0,o.itemsToShow)),p.xp6(1),p.Q6J("ngIf",o.itemsToShow<o.poiNearby.length))},dependencies:[c.ez,c.mk,c.sg,c.O5,c.JJ,br.c,Rn.KE,Rn.hX,Rn.R9,br.Nt,vn.ot,Rn.lN,cn.Ps,cn.Hw,Me.UX,Me._Y,Me.Fj,Me.wV,Me.JJ,Me.JL,Me.qQ,Me.sg,Me.u,Qo.Cq,Dl,sa,kc,Na,Si,ro.AV,ro.gM],styles:["[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:50px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{border-radius:6px;background:#f1f1f1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:6px;background:#888;height:20%}[_ngcontent-%COMP%]::-webkit-scrollbar-button{height:100%}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{-webkit-transition:.8s;transition:.8s;background:#555}.score-display[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;font-size:18px;margin-bottom:16px}.message[_ngcontent-%COMP%]{font-weight:700;margin-bottom:8px}.progress-bar[_ngcontent-%COMP%]{width:200px;height:16px;background-color:#ccc;border-radius:10px;overflow:hidden}.fill[_ngcontent-%COMP%]{height:100%;border-radius:10px;transition:width .5s ease-in-out}.score-low[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]{background-color:red}.score-medium[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]{background-color:#ffc107}.score-high[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]{background-color:#4caf50}  .custom-style{background-color:#fe5157;color:#fff}  .custom-style-green{background-color:#10b981;color:#fff}  .mat-simple-snackbar-action>button{color:#fff}.bookmark-icon-color[_ngcontent-%COMP%]{color:#666;transition:color .5s}.bookmark-added[_ngcontent-%COMP%]{color:green}@keyframes _ngcontent-%COMP%_bookmark-add{0%{transform:scale(1)}50%{transform:scale(1.5)}to{transform:scale(1)}}.bookmark-add-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bookmark-add-icon .5s forwards}@keyframes _ngcontent-%COMP%_bookmark-add-icon{0%{opacity:1}to{opacity:0}}.bookmark-added-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bookmark-added-icon .5s forwards}@keyframes _ngcontent-%COMP%_bookmark-added-icon{0%{opacity:0;transform:scale(.5)}to{opacity:1;transform:scale(1)}}"]}),l})();function ad(l,r){1&l&&(p.TgZ(0,"div",3),p.O4$(),p.TgZ(1,"svg",4)(2,"defs")(3,"radialGradient",5),p._UZ(4,"stop",6)(5,"stop",7),p.qZA()(),p._UZ(6,"path",8)(7,"path",9)(8,"circle",10),p.qZA(),p.kcU(),p.TgZ(9,"div",11)(10,"p",12),p._uU(11," To get started, select a point of interest or drag the marker on the map. "),p.qZA()()())}function Dg(l,r){if(1&l){const i=p.EpF();p.TgZ(0,"div",13),p.NdJ("click",function(){const _=p.CHM(i).$implicit,x=p.oxw();return p.KtG(x.showOnMap(_))}),p.TgZ(1,"div",14)(2,"mat-icon",15),p._uU(3),p.qZA(),p.TgZ(4,"p",16),p._uU(5),p.qZA()(),p.TgZ(6,"div",17)(7,"mat-icon",18),p._uU(8," home "),p.qZA(),p.TgZ(9,"p",19),p._uU(10),p.qZA()()()}if(2&l){const i=r.$implicit;p.xp6(3),p.hij(" ","charging station"===(null==i||null==i.properties?null:i.properties.type)?"ev_station":"parking"===(null==i||null==i.properties?null:i.properties.type)?"local_parking":"hotel"===(null==i||null==i.properties?null:i.properties.type)?"hotel":"Retail"===(null==i||null==i.properties?null:i.properties.type)?"shopping_cart":"gas station"===(null==i||null==i.properties?null:i.properties.type)?"local_gas_station":"flag"," "),p.xp6(2),p.hij(" ",null==i||null==i.properties?null:i.properties.name," "),p.xp6(5),p.Oqu(null==i||null==i.properties?null:i.properties.address)}}let am=(()=>{class l{constructor(i,o,d){this._exploreService=i,this._simulationService=o,this._tokenService=d,this.parentVariableUpdated=new p.vpe,this.poiList=[]}ngOnDestroy(){this.updatePoiListSubscription.unsubscribe()}ngOnInit(){this.updatePoiListSubscription=this._exploreService.locationsList$.subscribe({next:i=>{void 0!==i&&(console.log(i),this.poiList=[],i.features.forEach(o=>{this.poiList.push(o)}))}})}showOnMap(i){this._exploreService.listPoiClick.next(i)}}return l.\u0275fac=function(i){return new(i||l)(p.Y36(_l.G),p.Y36(gc.s),p.Y36(Vh.B))},l.\u0275cmp=p.Xpm({type:l,selectors:[["app-poi-list"]],outputs:{parentVariableUpdated:"parentVariableUpdated"},standalone:!0,features:[p.jDz],decls:3,vars:2,consts:[["class","absolute top-0 h-full w-full flex justify-center items-center",4,"ngIf"],[1,"h-full","max-h-full","overflow-y-auto","scroll-smooth","p-2"],["class","bg-white rounded-lg shadow-md p-4 mb-4 hover:cursor-pointer hover:bg-gray-100",3,"click",4,"ngFor","ngForOf"],[1,"absolute","top-0","h-full","w-full","flex","justify-center","items-center"],["display","block","height","41px","width","27px","viewBox","0 0 27 41",1,"animate-bounce"],["id","shadowGradient"],["offset","10%","stop-opacity","0.4"],["offset","100%","stop-opacity","0.05"],["fill","#3B82F6","d","M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"],["opacity","0.25","d","M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"],["fill","white","cx","13.5","cy","13.5","r","5.5"],[1,"w-3/4"],[1,"text-sm","font-medium","text-center",2,"color","#335579"],[1,"bg-white","rounded-lg","shadow-md","p-4","mb-4","hover:cursor-pointer","hover:bg-gray-100",3,"click"],[1,"flex","items-center"],[1,"mr-2",2,"color","#335579"],[1,"text-lg","font-medium",2,"margin","0"],[1,"flex","items-center","text-gray-500","mt-2"],["matTooltip","Address","matTooltipPosition","above",1,"mr-2",2,"color","#335579"],[1,"text-sm",2,"margin","0"]],template:function(i,o){1&i&&(p.YNc(0,ad,12,0,"div",0),p.TgZ(1,"div",1),p.YNc(2,Dg,11,3,"div",2),p.qZA()),2&i&&(p.Q6J("ngIf",0===o.poiList.length),p.xp6(2),p.Q6J("ngForOf",o.poiList))},dependencies:[c.ez,c.sg,c.O5,cn.Ps,cn.Hw,ro.AV,ro.gM],styles:["[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:50px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{border-radius:6px;background:#f1f1f1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:6px;background:#888;height:20%}[_ngcontent-%COMP%]::-webkit-scrollbar-button{height:100%}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{-webkit-transition:.8s;transition:.8s;background:#555}"]}),l})();var _p=bt(8754),Pg=bt(6115);function lm(l,r){if(1&l){const i=p.EpF();p.TgZ(0,"mat-icon",13),p.NdJ("click",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.saveComparison())}),p._uU(1,"bookmark_add"),p.qZA()}2&l&&p.Q6J("ngClass","hover:cursor-pointer")}function Ig(l,r){if(1&l){const i=p.EpF();p.TgZ(0,"mat-icon",14),p.NdJ("click",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.deleteComparison())}),p._uU(1,"delete"),p.qZA()}2&l&&p.Q6J("ngClass","hover:cursor-pointer")}function cm(l,r){if(1&l){const i=p.EpF();p.TgZ(0,"div",15)(1,"div",16)(2,"div",17)(3,"div",3)(4,"mat-icon",18),p._uU(5),p.qZA(),p.TgZ(6,"span",19),p._uU(7),p.qZA()(),p.TgZ(8,"button",20),p.NdJ("click",function(){const _=p.CHM(i).$implicit,x=p.oxw();return p.KtG(x.removeLocation(_.index))}),p.TgZ(9,"mat-icon"),p._uU(10,"close"),p.qZA()()(),p.TgZ(11,"div",3)(12,"mat-icon",18),p._uU(13),p.qZA(),p.TgZ(14,"span",21),p._uU(15),p.ALo(16,"number"),p.qZA()(),p.TgZ(17,"div",22)(18,"mat-icon",23),p._uU(19," home "),p.qZA(),p.TgZ(20,"p",24),p._uU(21),p.qZA()()()()}if(2&l){const i=r.$implicit,o=p.oxw();p.xp6(5),p.hij(" ","charging station"===i.type?"ev_station":"parking"===i.type?"local_parking":"hotel"===i.type?"hotel":"Retail"===i.type?"shopping_cart":"gas station"===i.type?"local_gas_station":"flag"," "),p.xp6(2),p.Oqu(i.name),p.xp6(6),p.Oqu(o.getScoreIcon(i.score)),p.xp6(2),p.Oqu(p.xi3(16,5,i.score,"1.1-2")),p.xp6(6),p.Oqu(i.address)}}let Lg=(()=>{class l{constructor(i,o){this._compareService=i,this.dialog=o,this.parentVariableUpdated=new p.vpe,this.locations=[],this.isSaved=!1,this.comparisonId=""}ngOnDestroy(){this._compareService.clearData()}ngOnInit(){this._compareService.compareLocationsList$.subscribe({next:i=>{this.locations=i}}),this._compareService.isComparisonSaved$.subscribe({next:i=>{this.isSaved=i.isSaved,this.comparisonId=i.id}})}removeLocation(i){this.dialog.open(_p.$,{width:"30%",minWidth:"300px",data:{content:"Are you sure you want to remove this location?"}}).afterClosed().subscribe(d=>{d&&this._compareService.removeLocation(i)})}openComparisonTable(){this._compareService.openDetailedComparisonDialog()}getScoreIcon(i){return i>=7?"favorite":i>=5?"thumb_up":"thumb_down"}openTableFromId(){this._compareService.openDetailedComparisonDialogFromId(this.comparisonId)}saveComparison(){this.dialog.open(Pg.a,{width:"30%",minWidth:"300px"}).afterClosed().subscribe(o=>{o&&this._compareService.savedComparison(o.name,o.description)})}deleteComparison(){this.dialog.open(_p.$,{width:"30%",minWidth:"300px",data:{content:"Are you sure you want to remove this comparison?"}}).afterClosed().subscribe(o=>{o&&this._compareService.deleteComparison(this.comparisonId)})}goBackToPoiDetails(){this.parentVariableUpdated.emit("poi-details")}}return l.\u0275fac=function(i){return new(i||l)(p.Y36(jh.z),p.Y36(Po.uw))},l.\u0275cmp=p.Xpm({type:l,selectors:[["app-compare"]],outputs:{parentVariableUpdated:"parentVariableUpdated"},standalone:!0,features:[p.jDz],decls:18,vars:3,consts:[[1,"h-full","relative","flex","flex-col","space-y-0","justify-between","align-items-stretch"],[1,"flex","justify-between","items-center","ml-1","w-full","p-2","pb-0"],[1,"hover:cursor-pointer",3,"click"],[1,"flex","items-center"],["style","font-size: 30px; width: 30px; height: 30px; margin-right: 10px","class","bookmark-icon-color",3,"ngClass","click",4,"ngIf"],["style","\n            font-size: 30px;\n            width: 30px;\n            height: 30px;\n            margin-right: 10px;\n            color: red;\n          ","class","bookmark-icon-color",3,"ngClass","click",4,"ngIf"],[1,"text-gray-500","hover:text-red-500","cursor-pointer","mr-1",3,"click"],[1,"overflow-y-auto","scroll-smooth","flex-1","p-3"],["class","relative bg-white rounded-lg shadow-md p-4 mb-4 hover:cursor-pointer hover:bg-gray-100",4,"ngFor","ngForOf"],[1,"p-4","shadow-lg","rounded-lg","text-base",2,"background-color","#f1f1f1"],[1,"flex","items-center","justify-end","w-full","bg-white","border-t","border-gray-300","p-3","z-50"],[2,"margin-right","1rem"],["mat-raised-button","",2,"background-color","#335579","color","white",3,"click"],[1,"bookmark-icon-color",2,"font-size","30px","width","30px","height","30px","margin-right","10px",3,"ngClass","click"],[1,"bookmark-icon-color",2,"font-size","30px","width","30px","height","30px","margin-right","10px","color","red",3,"ngClass","click"],[1,"relative","bg-white","rounded-lg","shadow-md","p-4","mb-4","hover:cursor-pointer","hover:bg-gray-100"],[1,"flex","flex-col","space-y-1"],[1,"flex","items-center","justify-between"],[1,"mr-2",2,"color","#335579"],[1,"text-lg","font-medium"],[1,"flex","items-center","justify-center","text-gray-500","hover:text-red-500","focus:outline-none","p-0","m-0",3,"click"],[1,"text-sm","text-gray-500"],[1,"flex","items-center","text-gray-500"],["matTooltip","Address","matTooltipPosition","above",1,"mr-2",2,"color","#335579"],[1,"text-sm",2,"margin","0"]],template:function(i,o){1&i&&(p.TgZ(0,"div",0)(1,"div")(2,"div",1)(3,"mat-icon",2),p.NdJ("click",function(){return o.goBackToPoiDetails()}),p._uU(4,"arrow_back"),p.qZA(),p.TgZ(5,"div",3),p.YNc(6,lm,2,1,"mat-icon",4),p.YNc(7,Ig,2,1,"mat-icon",5),p.TgZ(8,"mat-icon",6),p.NdJ("click",function(){return o.goBackToPoiDetails()}),p._uU(9,"close"),p.qZA()()()(),p.TgZ(10,"div",7),p.YNc(11,cm,22,8,"div",8),p.TgZ(12,"div",9),p._uU(13," A location is added by dropping a pin, performing a search, or selecting a POI pin. "),p.qZA()(),p.TgZ(14,"div",10)(15,"div",11)(16,"button",12),p.NdJ("click",function(){return o.openComparisonTable()}),p._uU(17," Show details "),p.qZA()()()()),2&i&&(p.xp6(6),p.Q6J("ngIf",!o.isSaved),p.xp6(1),p.Q6J("ngIf",o.isSaved),p.xp6(4),p.Q6J("ngForOf",o.locations))},dependencies:[c.ez,c.mk,c.sg,c.O5,c.JJ,cn.Ps,cn.Hw,vn.ot,vn.lW],styles:["[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:50px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{border-radius:6px;background:#f1f1f1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:6px;background:#888;height:20%}[_ngcontent-%COMP%]::-webkit-scrollbar-button{height:100%}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{-webkit-transition:.8s;transition:.8s;background:#555}  .custom-style-green{background-color:#10b981;color:#fff}  .custom-style-red{background-color:#fe5157;color:#fff}  .mat-simple-snackbar-action>button{color:#fff}.bookmark-icon-color[_ngcontent-%COMP%]{color:#666;transition:color .5s}"]}),l})();function hm(l,r){if(1&l){const i=p.EpF();p.TgZ(0,"app-compare",3),p.NdJ("parentVariableUpdated",function(d){p.CHM(i);const _=p.oxw();return p.KtG(_.onParentVariableUpdated(d))}),p.qZA()}}function Rg(l,r){if(1&l){const i=p.EpF();p.TgZ(0,"app-poi-list",3),p.NdJ("parentVariableUpdated",function(d){p.CHM(i);const _=p.oxw();return p.KtG(_.onParentVariableUpdated(d))}),p.qZA()}}function zg(l,r){if(1&l){const i=p.EpF();p.TgZ(0,"app-poi-details",4),p.NdJ("parentVariableUpdated",function(d){p.CHM(i);const _=p.oxw();return p.KtG(_.onParentVariableUpdated(d))})("panelStateChange",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.go())}),p.qZA()}}function ld(l,r){if(1&l){const i=p.EpF();p.TgZ(0,"app-simulation-options",3),p.NdJ("parentVariableUpdated",function(d){p.CHM(i);const _=p.oxw();return p.KtG(_.onParentVariableUpdated(d))}),p.qZA()}}function cd(l,r){if(1&l){const i=p.EpF();p.TgZ(0,"app-simulation-results",3),p.NdJ("parentVariableUpdated",function(d){p.CHM(i);const _=p.oxw();return p.KtG(_.onParentVariableUpdated(d))}),p.qZA()}}let hd=(()=>{class l{constructor(i,o){this._exploreService=i,this._compareService=o,this.step="poi-list",this.panelState="slide-left",this.panelStateChange=new p.vpe}ngOnInit(){console.error("thi is the step : ",this.step),this._exploreService.selectedLocationData$.subscribe({next:i=>{if(void 0===i||"compare"!==this.step)return;const d=(new Date).getTime().toString();this._compareService.addLocations([{index:d,name:this.selectedLocation.name,type:this.selectedLocation.type,address:this.selectedLocation.address,score:i.siteAttractiviness.siteScore,populationDensity:i.areaStats.populationDensity,medianRevenue:i.areaStats.medianIncome,poiNearbyCount:i.poiNearby.length,competitionCount:i.evChargePointStats.chargingPoints,evRegistration:i.evChargePointStats.evShare,lon:this.selectedLocation.lon,lat:this.selectedLocation.lat}],!0)}}),this._exploreService.selectedLocation$.subscribe({next:i=>{i&&("compare"!==this.step?this.step="poi-details":this.selectedLocation=i)}})}go(){this.panelState="slide-left",this.panelStateChange.emit(this.panelState)}onParentVariableUpdated(i){this.step=i}}return l.\u0275fac=function(i){return new(i||l)(p.Y36(_l.G),p.Y36(jh.z))},l.\u0275cmp=p.Xpm({type:l,selectors:[["app-right-panel"]],inputs:{panelState:"panelState"},outputs:{panelStateChange:"panelStateChange"},standalone:!0,features:[p.jDz],decls:6,vars:7,consts:[[1,"bg-white","absolute","right-0","mt-16","z-10","rounded-tl-xl","do",2,"height","calc(100% - 70px)","width","30%","min-width","25%","margin-top","70px",3,"ngSwitch"],[3,"parentVariableUpdated",4,"ngSwitchCase"],[3,"parentVariableUpdated","panelStateChange",4,"ngSwitchCase"],[3,"parentVariableUpdated"],[3,"parentVariableUpdated","panelStateChange"]],template:function(i,o){1&i&&(p.TgZ(0,"div",0),p.YNc(1,hm,1,0,"app-compare",1),p.YNc(2,Rg,1,0,"app-poi-list",1),p.YNc(3,zg,1,0,"app-poi-details",2),p.YNc(4,ld,1,0,"app-simulation-options",1),p.YNc(5,cd,1,0,"app-simulation-results",1),p.qZA()),2&i&&(p.Q6J("@slideRight",o.panelState)("ngSwitch",o.step),p.xp6(1),p.Q6J("ngSwitchCase","compare"),p.xp6(1),p.Q6J("ngSwitchCase","poi-list"),p.xp6(1),p.Q6J("ngSwitchCase","poi-details"),p.xp6(1),p.Q6J("ngSwitchCase","simulation-options"),p.xp6(1),p.Q6J("ngSwitchCase","simulation-results"))},dependencies:[c.ez,c.RF,c.n9,pn.Bz,Tg,sm,xc,cn.Ps,am,Lg],data:{animation:[(0,mt.X$)("slideRight",[(0,mt.SB)("slide-left",(0,mt.oB)({transform:"translateX(0)"})),(0,mt.SB)("slide-right",(0,mt.oB)({transform:"translateX(100%)"})),(0,mt.eR)("slide-left => slide-right",(0,mt.jt)("500ms ease-in-out")),(0,mt.eR)("slide-right => slide-left",(0,mt.jt)("500ms ease-in-out"))])]}}),l})();var um=bt(455),yp=bt(4385);let xp=(()=>{class l{}return l.\u0275fac=function(i){return new(i||l)},l.\u0275cmp=p.Xpm({type:l,selectors:[["app-loading-modal-component"]],standalone:!0,features:[p.jDz],decls:8,vars:0,consts:[[1,"flex","items-center","justify-center"],["mode","indeterminate","color","primary","diameter","48","strokeWidth","4",1,"w-12","h-12"],[1,"ml-6"],[1,"text-sm","font-semibold","mb-3",2,"color","#2c3e50"],[1,"flex","justify-center","items-center"],[1,"text-xs",2,"color","#2c3e50"]],template:function(i,o){1&i&&(p.TgZ(0,"div",0),p._UZ(1,"mat-progress-spinner",1),p.TgZ(2,"div",2)(3,"div",3),p._uU(4," Loading zones "),p.qZA(),p.TgZ(5,"div",4)(6,"div",5),p._uU(7," Just a few seconds, while we draw beautiful zones for you! "),p.qZA()()()())},dependencies:[c.ez,Qo.Cq,Qo.Ou]}),l})();var ns=bt(6170);let Og=(()=>{class l{constructor(){this.minVal=0,this.maxVal=0,this.minValColor="",this.maxValColor=""}}return l.\u0275fac=function(i){return new(i||l)},l.\u0275cmp=p.Xpm({type:l,selectors:[["app-heatmap-legend"]],inputs:{minVal:"minVal",maxVal:"maxVal",minValColor:"minValColor",maxValColor:"maxValColor"},standalone:!0,features:[p.jDz],decls:9,vars:2,consts:[[1,"flex-grow","h-2","relative"],[1,"absolute","w-full","inset-0","bg-gradient-to-r","from-yellow-500","via-red-500","to-red-500","opacity-70","rounded-lg"],[1,"absolute","bottom-0","left-0","right-0","flex","justify-between"],[1,"flex","justify-between","mt-1"],[1,"text-xs",2,"color","#7994ab","line-height","1.375","font-weight","700"]],template:function(i,o){1&i&&(p.TgZ(0,"div")(1,"div",0),p._UZ(2,"div",1)(3,"div",2),p.qZA(),p.TgZ(4,"div",3)(5,"span",4),p._uU(6),p.qZA(),p.TgZ(7,"span",4),p._uU(8),p.qZA()()()),2&i&&(p.xp6(6),p.Oqu(o.minVal),p.xp6(2),p.Oqu(o.maxVal))},dependencies:[c.ez]}),l})();var vp=bt(5684),dm=bt(3202);function ud(l,r){1&l&&(p.TgZ(0,"div",27)(1,"div",28),p._UZ(2,"img",29),p.TgZ(3,"div",30),p._UZ(4,"div",31),p.qZA()()())}function Bg(l,r){if(1&l){const i=p.EpF();p.TgZ(0,"app-right-panel",32),p.NdJ("panelStateChange",function(){p.CHM(i);const d=p.oxw();return p.KtG(d.toggleRightPanel())}),p.qZA()}if(2&l){const i=p.oxw();p.Q6J("panelState",i.panelState)}}let Ea=0,Fg=(()=>{class l{constructor(i,o,d,_,x,T,C,D){this._exploreService=i,this._simulationService=o,this._compareService=d,this.dialog=_,this.snackBar=x,this.route=T,this._locationData=C,this._comparisonService=D,this.mapLoaded=!1,this.geocoderHTML="",this.showNavbar=!1,this.panelState="slide-right",this.buttonState="active",this.divState="hidden",this.isOpen=!0,this.activeSlide="",this.zoneScore="out",this.populationDensity="out",this.populationRevenue="out",this.evRegistrations="out",this.chargePointSlow="out",this.chargePointFast="out",this.chargePointRapid="out",this.chargePointUltraFast="out",this.places={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.shoppingCenters={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.parkings={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.hotels={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.transportations={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.gasStations={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.chargePoints={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.savedLocations={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.savedShoppingCenters={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.savedParkings={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.savedHotels={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.savedTransportations={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.savedGasStations={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.savedChargePoints={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.markers=new Map,this.mapLoading=!0,window.addEventListener("beforeunload",R=>{const V=this.map.unproject([window.innerWidth/2,window.innerHeight/2]),H=new ls.LngLat(V.lng,V.lat);localStorage.setItem("lastPos",JSON.stringify(H))})}ngOnDestroy(){const i=this.map.unproject([window.innerWidth/2,window.innerHeight/2]),o=new ls.LngLat(i.lng,i.lat);localStorage.setItem("lastPos",JSON.stringify(o)),this.updateDataSubscription?.unsubscribe(),this._compareService.clearData(),this._exploreService._selectedLocation=void 0,this._exploreService._selectedLocationData=void 0,this.zoneScore="out",this.populationDensity="out",this.populationRevenue="out",this.evRegistrations="out",this.chargePointSlow="out",this.chargePointFast="out",this.chargePointRapid="out",this.chargePointUltraFast="out",this._exploreService.deselectAllPois(),this.getCurrentViewSubscription?.unsubscribe(),this.listPoiClickSubscription?.unsubscribe(),this.removePoiMarkerSubscription?.unsubscribe(),this.diselectAllMarkersSubscription?.unsubscribe(),this.removeMarkerSubscription?.unsubscribe(),this.removeMarkerSubscription1?.unsubscribe(),this._exploreService.setLocationdListFeatures([])}ngOnInit(){this._comparisonService.clearData(),this.mapLoading=!0;const i=[2.3459,48.84065],o=JSON.parse(localStorage.getItem("lastPos")??"{}");0===Object.values(o).length?this._exploreService.getDataFromIP().subscribe({next:d=>{this.renderMap(d.loc.split(",").map(Number).reverse()||i)},error:d=>{this.renderMap(i)}}):this.renderMap([o.lng,o.lat]),this.getCurrentViewSubscription=this._exploreService.getCurrentView.subscribe({next:d=>{let _=this.map.unproject([0,0]),x=this.map.unproject([window.innerWidth,window.innerHeight]);this._exploreService.addPoiData({place:d,topLeftLat:_.lat,topLeftLon:_.lng,btmRightLat:x.lat,btmRightLon:x.lng,update:!0})}}),this.listPoiClickSubscription=this._exploreService.listPoiClick.subscribe({next:d=>{let _="";switch(console.error("I am here : ",d),d.properties.type){case"hotel":_=d.properties.saved_name?"savedHotels":"hotels";break;case"gas station":_=d.properties.saved_name?"savedGasStations":"gasStations";break;case"charging station":_=d.properties.saved_name?"savedChargePoints":"chargePoints";break;case"Retail":_=d.properties.saved_name?"savedShoppingCenter":"shoppingCenter";break;case"parking":_=d.properties.saved_name?"savedParkings":"parkings";break;case"pinned location":_="savedLocations"}const x=d.geometry.coordinates.slice(),T=d.properties;this._exploreService.activeId=d.id,this._exploreService.activeLayer=_,this._exploreService.activeTomtomId=T.apiId,this.map.setFeatureState({source:_,id:d.id},{ttype:!0}),this.map.querySourceFeatures(_).forEach(D=>{D.id!==d.id&&this.map.setFeatureState({source:_,id:D.id},{ttype:!1})}),this.showRest(_);const C=this.marker.getElement();C.style.display="block",this.marker.setLngLat(x),this.panelState="slide-left",this.slideLeft(),this._exploreService.setLocation(d);for(const[D,R]of this.markers.entries())R.getElement().querySelector("path")?.setAttribute("fill","#335579");this.map?.flyTo({center:x,zoom:15,easing:D=>{if(1===D){const R=C.getBoundingClientRect();C.style.transform=`translate(${R.left}px, ${R.top}px) scale(0.5)`,C.animate([{transform:`translate(${R.left}px, ${R.top}px) scaleY(0)`,easing:"ease-out"},{transform:`translate(${R.left}px, ${R.top-20}px) scaleY(1.2)`,easing:"ease-in"},{transform:`translate(${R.left}px, ${R.top}px) scaleY(0.9)`,easing:"ease-out"},{transform:`translate(${R.left}px, ${R.top}px) scaleY(1)`,easing:"ease-in"}],{duration:700}).onfinish=()=>{C.style.transform=`translate(${R.left}px, ${R.top}px)`},console.log("Fly-to animation complete")}return D}})}})}openLoadingHeatmapsDialog(){this.dialog.open(xp,{disableClose:!0,panelClass:"loading-modal"})}toggleZoneScore(){switch("in"===this.zoneScore?(this.zoneScore="out",this.map?.removeLayer("potentialScoreHeatmapsDataBorders"),this.map?.removeLayer("potentialScoreHeatmapsDataLayer"),this.map?.removeSource("potentialScoreHeatmapsData")):this.getScoreHeatMaps(),this.activeSlide){case"populationDensity":"in"===this.populationDensity&&(this.map?.removeLayer("populationDensityHeatMapDataBorders"),this.map?.removeLayer("populationDensityHeatMapDataLayer"),this.map?.removeSource("populationDensityHeatMapData"));break;case"populationRevenue":"in"===this.populationRevenue&&(this.map?.removeLayer("populationRevenueHeatMapDataBorders"),this.map?.removeLayer("populationRevenueHeatMapDataLayer"),this.map?.removeSource("populationRevenueHeatMapData"));break;case"evRegistrations":"in"===this.evRegistrations&&(this.map?.removeLayer("evRegistrationsHeatMapDataBorders"),this.map?.removeLayer("evRegistrationsHeatMapDataLayer"),this.map?.removeSource("evRegistrationsHeatMapData"));break;case"chargePointUltraFast":"in"===this.chargePointUltraFast&&(this.map?.removeLayer("chargePointsHeatMapDataBorders"),this.map?.removeLayer("chargePointsHeatMapDataLayer"),this.map?.removeSource("chargePointsHeatMapData"))}this.activeSlide="zoneScore",this.populationDensity="out",this.populationRevenue="out",this.evRegistrations="out",this.chargePointUltraFast="out"}togglePopulationDensity(){switch("in"===this.populationDensity?(this.map?.removeLayer("populationDensityHeatMapDataBorders"),this.map?.removeLayer("populationDensityHeatMapDataLayer"),this.map?.removeSource("populationDensityHeatMapData"),this.populationDensity="out"):this.getPopulationDensityHeatMaps(),this.activeSlide){case"zoneScore":"in"===this.zoneScore&&(this.map?.removeLayer("potentialScoreHeatmapsDataBorders"),this.map?.removeLayer("potentialScoreHeatmapsDataLayer"),this.map?.removeSource("potentialScoreHeatmapsData"));break;case"populationRevenue":"in"===this.populationRevenue&&(this.map?.removeLayer("populationRevenueHeatMapDataBorders"),this.map?.removeLayer("populationRevenueHeatMapDataLayer"),this.map?.removeSource("populationRevenueHeatMapData"));break;case"evRegistrations":"in"===this.evRegistrations&&(this.map?.removeLayer("evRegistrationsHeatMapDataBorders"),this.map?.removeLayer("evRegistrationsHeatMapDataLayer"),this.map?.removeSource("evRegistrationsHeatMapData"));break;case"chargePointUltraFast":"in"===this.chargePointUltraFast&&(this.map?.removeLayer("chargePointsHeatMapDataBorders"),this.map?.removeLayer("chargePointsHeatMapDataLayer"),this.map?.removeSource("chargePointsHeatMapData"))}this.activeSlide="populationDensity",this.zoneScore="out",this.populationRevenue="out",this.evRegistrations="out",this.chargePointUltraFast="out"}togglePopulationRevenue(){switch("in"===this.populationRevenue?(this.map?.removeLayer("populationRevenueHeatMapDataBorders"),this.map?.removeLayer("populationRevenueHeatMapDataLayer"),this.map?.removeSource("populationRevenueHeatMapData"),this.populationRevenue="out"):this.getPopulationRevenueHeatMaps(),this.activeSlide){case"zoneScore":"in"===this.zoneScore&&(this.map?.removeLayer("potentialScoreHeatmapsDataBorders"),this.map?.removeLayer("potentialScoreHeatmapsDataLayer"),this.map?.removeSource("potentialScoreHeatmapsData"));break;case"populationDensity":"in"===this.populationDensity&&(this.map?.removeLayer("populationDensityHeatMapDataBorders"),this.map?.removeLayer("populationDensityHeatMapDataLayer"),this.map?.removeSource("populationDensityHeatMapData"));break;case"evRegistrations":"in"===this.evRegistrations&&(this.map?.removeLayer("evRegistrationsHeatMapDataBorders"),this.map?.removeLayer("evRegistrationsHeatMapDataLayer"),this.map?.removeSource("evRegistrationsHeatMapData"));break;case"chargePointUltraFast":"in"===this.chargePointUltraFast&&(this.map?.removeLayer("chargePointsHeatMapDataBorders"),this.map?.removeLayer("chargePointsHeatMapDataLayer"),this.map?.removeSource("chargePointsHeatMapData"))}this.activeSlide="populationRevenue",this.zoneScore="out",this.populationDensity="out",this.evRegistrations="out",this.chargePointUltraFast="out"}toggleEvRegistrations(){switch("in"===this.evRegistrations?(this.map?.removeLayer("evRegistrationsHeatMapDataBorders"),this.map?.removeLayer("evRegistrationsHeatMapDataLayer"),this.map?.removeSource("evRegistrationsHeatMapData"),this.evRegistrations="out"):this.getEvRegistrationsHeatMaps(),this.activeSlide){case"zoneScore":"in"===this.zoneScore&&(this.map?.removeLayer("potentialScoreHeatmapsDataBorders"),this.map?.removeLayer("potentialScoreHeatmapsDataLayer"),this.map?.removeSource("potentialScoreHeatmapsData"));break;case"populationDensity":"in"===this.populationDensity&&(this.map?.removeLayer("populationDensityHeatMapDataBorders"),this.map?.removeLayer("populationDensityHeatMapDataLayer"),this.map?.removeSource("populationDensityHeatMapData"));break;case"populationRevenue":"in"===this.populationRevenue&&(this.map?.removeLayer("populationRevenueHeatMapDataBorders"),this.map?.removeLayer("populationRevenueHeatMapDataLayer"),this.map?.removeSource("populationRevenueHeatMapData"));break;case"chargePointUltraFast":"in"===this.chargePointUltraFast&&(this.map?.removeLayer("chargePointsHeatMapDataBorders"),this.map?.removeLayer("chargePointsHeatMapDataLayer"),this.map?.removeSource("chargePointsHeatMapData"))}this.activeSlide="evRegistrations",this.zoneScore="out",this.populationDensity="out",this.populationRevenue="out",this.chargePointUltraFast="out"}toggleChargePointUltraFast(){switch("in"===this.chargePointUltraFast?(this.map?.removeLayer("chargePointsHeatMapDataBorders"),this.map?.removeLayer("chargePointsHeatMapDataLayer"),this.map?.removeSource("chargePointsHeatMapData"),this.chargePointUltraFast="out"):this.getChargePointsHeatMaps(),this.activeSlide){case"zoneScore":"in"===this.zoneScore&&(this.map?.removeLayer("potentialScoreHeatmapsDataBorders"),this.map?.removeLayer("potentialScoreHeatmapsDataLayer"),this.map?.removeSource("potentialScoreHeatmapsData"));break;case"populationDensity":"in"===this.populationDensity&&(this.map?.removeLayer("populationDensityHeatMapDataBorders"),this.map?.removeLayer("populationDensityHeatMapDataLayer"),this.map?.removeSource("populationDensityHeatMapData"));break;case"populationRevenue":"in"===this.populationRevenue&&(this.map?.removeLayer("populationRevenueHeatMapDataBorders"),this.map?.removeLayer("populationRevenueHeatMapDataLayer"),this.map?.removeSource("populationRevenueHeatMapData"));break;case"evRegistrations":"in"===this.evRegistrations&&(this.map?.removeLayer("evRegistrationsHeatMapDataBorders"),this.map?.removeLayer("evRegistrationsHeatMapDataLayer"),this.map?.removeSource("evRegistrationsHeatMapData"))}this.activeSlide="chargePointUltraFast",this.zoneScore="out",this.populationDensity="out",this.populationRevenue="out",this.evRegistrations="out"}toggleDiv(){"inactive"===this.buttonState?(this.buttonState="active",setTimeout(()=>{this.isOpen=!this.isOpen},500)):(this.isOpen=!this.isOpen,setTimeout(()=>{this.buttonState="inactive"},500))}slideLeft(){document.querySelector(".mapboxgl-ctrl-bottom-right").classList.contains("slide-right")&&(document.querySelector(".mapboxgl-ctrl-bottom-right").classList.toggle("slide-right"),document.querySelector(".mapboxgl-ctrl-bottom-right").classList.toggle("slide-left")),document.querySelector("#rightPanelToggleButton").classList.contains("slide-right")&&(document.querySelector("#rightPanelToggleButton").classList.toggle("slide-right"),document.querySelector("#rightPanelToggleButton").classList.toggle("slide-left"))}slideRight(){document.querySelector(".mapboxgl-ctrl-bottom-right").classList.contains("slide-left")&&(document.querySelector(".mapboxgl-ctrl-bottom-right").classList.toggle("slide-left"),document.querySelector(".mapboxgl-ctrl-bottom-right").classList.toggle("slide-right")),document.querySelector("#rightPanelToggleButton").classList.contains("slide-left")&&(document.querySelector("#rightPanelToggleButton").classList.toggle("slide-left"),document.querySelector("#rightPanelToggleButton").classList.toggle("slide-right"))}toggleRightPanel(){this.panelState="slide-left"===this.panelState?"slide-right":"slide-left","slide-left"===this.panelState?this.slideLeft():this.slideRight()}getHeatmapsRequestBody(i){let o={inputPolygon:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[]]}}},limit:i};for(let[d,_]of[[0,0],[window.innerWidth,0],[window.innerWidth,window.innerHeight],[0,window.innerHeight],[0,0]]){let x=this.map.unproject([d,_]);o.inputPolygon.data.geometry.coordinates[0].push([x.lng,x.lat])}return o}getScoreHeatMaps(){this.openLoadingHeatmapsDialog();const i=this.getHeatmapsRequestBody(2e3);let o=0;const d=(new Date).getTime();this._exploreService.getPotentialScoreHeatmaps(i).subscribe({next:_=>{let x={type:"FeatureCollection",features:[]};_.forEach(T=>{x.features.push({properties:{score:Math.floor(T.score)},geometry:T.geom}),o++}),this.map?.getSource("potentialScoreHeatmapsData")?(this.map.getSource("potentialScoreHeatmapsData").setData(x),this.map?.triggerRepaint()):(this.map?.addSource("potentialScoreHeatmapsData",{type:"geojson",data:x}),this.map?.addLayer({id:"potentialScoreHeatmapsDataLayer",type:"fill",source:"potentialScoreHeatmapsData",paint:{"fill-color":["interpolate",["linear"],["get","score"],0,"yellow",10,"red"],"fill-opacity":.5}}),this.map?.addLayer({id:"potentialScoreHeatmapsDataBorders",type:"line",source:"potentialScoreHeatmapsData",layout:{},paint:{"line-color":"gray","line-width":1}}),this.map?.moveLayer("potentialScoreHeatmapsDataLayer","waterway-label"),this.map?.moveLayer("potentialScoreHeatmapsDataBorders","waterway-label"))},error:()=>{this.activeSlide="",this.dialog.closeAll(),this.snackBar.open("Error loading areas. Please try again later.","close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["custom-style"]})},complete:()=>{this.zoneScore="in";const x=(new Date).getTime()-d,T=Math.max(2e3-x,0);setTimeout(()=>{this.dialog.closeAll(),2e3===o?this.snackBar.openFromComponent(ns.u,{data:{coloredMessage:"Limited display",message:"for performance reasons, please zoom in to see all areas."},duration:4e3,panelClass:["bg-white"],horizontalPosition:"center",verticalPosition:"bottom",politeness:"assertive"}):0===o&&this.snackBar.openFromComponent(ns.u,{data:{coloredMessage:"Data is not available yet",message:"for this region, we are working on it"},duration:4e3,panelClass:["bg-white"],horizontalPosition:"center",verticalPosition:"bottom",politeness:"assertive"})},T)}})}getPopulationDensityHeatMaps(){this.openLoadingHeatmapsDialog();const i=this.getHeatmapsRequestBody(2e3);let o=0;const d=(new Date).getTime();this._exploreService.getPopulationDensityHeatmaps(i).subscribe({next:_=>{let x={type:"FeatureCollection",features:[]};_.forEach(T=>{x.features.push({properties:{populationDensity:Math.floor(T.pop_densit)},geometry:T.geom}),o++}),this.map?.getSource("populationDensityHeatMapData")?(this.map.getSource("populationDensityHeatMapData").setData(x),this.map?.triggerRepaint()):(this.map?.addSource("populationDensityHeatMapData",{type:"geojson",data:x}),this.map?.addLayer({id:"populationDensityHeatMapDataLayer",type:"fill",source:"populationDensityHeatMapData",paint:{"fill-color":["interpolate",["linear"],["get","populationDensity"],1,"#ffffb2",300,"#fdd976",1300,"#feb554",3200,"#fd8d3c",6300,"#fc4e2a",12e3,"#e31a1c",23600,"#b10026",47997,"red"],"fill-opacity":.5}}),this.map?.addLayer({id:"populationDensityHeatMapDataBorders",type:"line",source:"populationDensityHeatMapData",layout:{},paint:{"line-color":"gray","line-width":1}}),this.map?.moveLayer("populationDensityHeatMapDataLayer","waterway-label"),this.map?.moveLayer("populationDensityHeatMapDataBorders","waterway-label"))},error:()=>{this.activeSlide="",this.dialog.closeAll(),this.snackBar.open("Error loading areas. Please try again later.","close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["custom-style"]})},complete:()=>{this.populationDensity="in";const x=(new Date).getTime()-d,T=Math.max(2e3-x,0);setTimeout(()=>{this.dialog.closeAll(),2e3===o?this.snackBar.openFromComponent(ns.u,{data:{coloredMessage:"Limited display",message:"for performance reasons, please zoom in to see all areas."},duration:4e3,panelClass:["bg-white"],horizontalPosition:"center",verticalPosition:"bottom",politeness:"assertive"}):0===o&&this.snackBar.openFromComponent(ns.u,{data:{coloredMessage:"Data is not available yet",message:"for this region, we are working on it"},duration:4e3,panelClass:["bg-white"],horizontalPosition:"center",verticalPosition:"bottom",politeness:"assertive"})},T)}})}getPopulationRevenueHeatMaps(){this.openLoadingHeatmapsDialog();const i=this.getHeatmapsRequestBody(2e3);let o=0;const d=(new Date).getTime();this._exploreService.getPopulationRevenueHeatmaps(i).subscribe({next:_=>{let x={type:"FeatureCollection",features:[]};_.polygons.forEach(T=>{x.features.push({properties:{populationRevenue:Math.floor(T.avg_revenu)},geometry:T.geom}),o++}),this.map?.getSource("populationRevenueHeatMapData")?(this.map.getSource("populationRevenueHeatMapData").setData(x),this.map?.triggerRepaint()):(this.map?.addSource("populationRevenueHeatMapData",{type:"geojson",data:x}),this.map?.addLayer({id:"populationRevenueHeatMapDataLayer",type:"fill",source:"populationRevenueHeatMapData",paint:{"fill-color":["interpolate",["linear"],["get","populationRevenue"],1,"#ffffb2",9539,"#fdd976",17900,"#feb554",20200,"#fd8d3c",22200,"#fc4e2a",24400,"#e31a1c",27300,"#b10026",32300,"red"],"fill-opacity":.5}}),this.map?.addLayer({id:"populationRevenueHeatMapDataBorders",type:"line",source:"populationRevenueHeatMapData",layout:{},paint:{"line-color":"gray","line-width":1}}),this.map?.moveLayer("populationRevenueHeatMapDataLayer","waterway-label"),this.map?.moveLayer("populationRevenueHeatMapDataBorders","waterway-label"))},error:()=>{this.activeSlide="",this.dialog.closeAll(),this.snackBar.open("Error loading areas. Please try again later.","close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["custom-style"]})},complete:()=>{this.populationRevenue="in";const x=(new Date).getTime()-d,T=Math.max(2e3-x,0);setTimeout(()=>{this.dialog.closeAll(),2e3===o?this.snackBar.openFromComponent(ns.u,{data:{coloredMessage:"Limited display",message:"for performance reasons, please zoom in to see all areas."},duration:4e3,panelClass:["bg-white"],horizontalPosition:"center",verticalPosition:"bottom",politeness:"assertive"}):0===o&&this.snackBar.openFromComponent(ns.u,{data:{coloredMessage:"Data is not available yet",message:"for this region, we are working on it"},duration:4e3,panelClass:["bg-white"],horizontalPosition:"center",verticalPosition:"bottom",politeness:"assertive"})},T)}})}getEvRegistrationsHeatMaps(){this.openLoadingHeatmapsDialog();const i=this.getHeatmapsRequestBody(2e3);let o=0;const d=(new Date).getTime();this._exploreService.getEvRegistrationsHeatmaps(i).subscribe({next:_=>{let x={type:"FeatureCollection",features:[]};_.polygons.forEach(T=>{x.features.push({properties:{evRegistration:Math.floor(T.ev_count)},geometry:T.geom}),o++}),this.map?.getSource("evRegistrationsHeatMapData")?(this.map.getSource("evRegistrationsHeatMapData").setData(x),this.map?.triggerRepaint()):(this.map?.addSource("evRegistrationsHeatMapData",{type:"geojson",data:x}),this.map?.addLayer({id:"evRegistrationsHeatMapDataLayer",type:"fill",source:"evRegistrationsHeatMapData",paint:{"fill-color":["interpolate",["linear"],["get","evRegistration"],0,"#ffffb2",280,"#fdd976",825,"#feb554",1700,"#fd8d3c",2500,"#fc4e2a",4e3,"#e31a1c",5e3,"#b10026",9e3,"red"],"fill-opacity":.5}}),this.map?.addLayer({id:"evRegistrationsHeatMapDataBorders",type:"line",source:"evRegistrationsHeatMapData",layout:{},paint:{"line-color":"gray","line-width":1}}),this.map?.moveLayer("evRegistrationsHeatMapDataLayer","waterway-label"),this.map?.moveLayer("evRegistrationsHeatMapDataBorders","waterway-label"))},error:()=>{this.activeSlide="",this.dialog.closeAll(),this.snackBar.open("Error loading areas. Please try again later.","close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["custom-style"]})},complete:()=>{this.evRegistrations="in";const x=(new Date).getTime()-d,T=Math.max(2e3-x,0);setTimeout(()=>{this.dialog.closeAll(),2e3===o?this.snackBar.openFromComponent(ns.u,{data:{coloredMessage:"Limited display",message:"for performance reasons, please zoom in to see all areas."},duration:4e3,panelClass:["bg-white"],horizontalPosition:"center",verticalPosition:"bottom",politeness:"assertive"}):0===o&&this.snackBar.openFromComponent(ns.u,{data:{coloredMessage:"Data is not available yet",message:"for this region, we are working on it"},duration:4e3,panelClass:["bg-white"],horizontalPosition:"center",verticalPosition:"bottom",politeness:"assertive"})},T)}})}getChargePointsHeatMaps(){this.openLoadingHeatmapsDialog();const i=this.getHeatmapsRequestBody(2e3);let o=0;const d=(new Date).getTime();this._exploreService.getChargePointsHeatmaps(i).subscribe({next:_=>{let x={type:"FeatureCollection",features:[]};_.polygons.forEach(T=>{x.features.push({properties:{chargePoints:Math.floor(T.cp_count)},geometry:T.geom}),o++}),this.map?.getSource("chargePointsHeatMapData")?(this.map.getSource("chargePointsHeatMapData").setData(x),this.map?.triggerRepaint()):(this.map?.addSource("chargePointsHeatMapData",{type:"geojson",data:x}),this.map?.addLayer({id:"chargePointsHeatMapDataLayer",type:"fill",source:"chargePointsHeatMapData",paint:{"fill-color":["interpolate",["linear"],["get","chargePoints"],0,"#fdd976",10,"#feb554",30,"#fd8d3c",60,"#fc4e2a",125,"#e31a1c",250,"#b10026",520,"red"],"fill-opacity":.5}}),this.map?.addLayer({id:"chargePointsHeatMapDataBorders",type:"line",source:"chargePointsHeatMapData",layout:{},paint:{"line-color":"gray","line-width":1}}),this.map?.moveLayer("chargePointsHeatMapDataLayer","waterway-label"),this.map?.moveLayer("chargePointsHeatMapDataBorders","waterway-label"))},error:()=>{this.activeSlide="",this.dialog.closeAll(),this.snackBar.open("Error loading areas. Please try again later.","close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["custom-style"]})},complete:()=>{this.chargePointUltraFast="in";const x=(new Date).getTime()-d,T=Math.max(2e3-x,0);setTimeout(()=>{this.dialog.closeAll(),2e3===o?this.snackBar.openFromComponent(ns.u,{data:{coloredMessage:"Limited display",message:"for performance reasons, please zoom in to see all areas."},duration:4e3,panelClass:["bg-white"],horizontalPosition:"center",verticalPosition:"bottom",politeness:"assertive"}):0===o&&this.snackBar.openFromComponent(ns.u,{data:{coloredMessage:"Data is not available yet",message:"for this region, we are working on it"},duration:4e3,panelClass:["bg-white"],horizontalPosition:"center",verticalPosition:"bottom",politeness:"assertive"})},T)}})}renderMap(i){ls.accessToken=ae.N.mapboxKey,"unavailable"===ls.getRTLTextPluginStatus()&&ls.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",x=>{console.error(x)},!0),this.map=new ls.Map({container:"map",style:"mapbox://styles/mapbox/outdoors-v12",center:i,zoom:8}),this.map.getCanvas().style.height="100vh",this.map.getCanvas().style.width="100%",this.marker=new ls.Marker({color:"#3B82F6"}).setLngLat([2.3459,48.84065]).addTo(this.map),this.marker.getElement().style.display="none",this.marker.setLngLat([0,0]),this.removePoiMarkerSubscription=this._exploreService.removePoiMarker.subscribe({next:x=>{this.marker.getElement().style.display="none",this.marker.setLngLat([0,0]),this.showRest(""),this._exploreService.activeId=-1,this._exploreService.activeLayer="",this._exploreService.activeTomtomId=""}});const o=new cs({accessToken:ls.accessToken,types:"country,region,place,postcode,district,locality,neighborhood,address,poi",mapboxgl:ls,placeholder:"Enter a location (e.g. Lille)",marker:!1});o.on("result",x=>{!x.result.place_type.includes("neighborhood")&&!x.result.place_type.includes("country")&&!x.result.place_type.includes("region")&&!x.result.place_type.includes("place")&&this.dropMarkerSearchBar({lat:x.result.center[1],lng:x.result.center[0]})}),document.getElementById("geocoder").appendChild(o.onAdd(this.map)),this.map.addControl(new ls.NavigationControl,"bottom-right"),this.map.addControl(new ls.FullscreenControl({container:document.querySelector("body")}),"bottom-right"),document.querySelector(".mapboxgl-ctrl-bottom-right").classList.add("slide-right"),document.querySelector("#rightPanelToggleButton").classList.add("slide-right"),this.diselectAllMarkersSubscription=this._exploreService.diselectAllMarkers.subscribe({next:x=>{console.error("this is the value: ",this.markers);for(const[T,C]of this.markers.entries())C.getElement().querySelector("path")?.setAttribute("fill","#335579")}}),this.updateLayers(),this.map.on("load",()=>{this.map.addSource("shoppingCenter",this.shoppingCenters),this.map.addSource("parkings",this.parkings),this.map.addSource("hotels",this.hotels),this.map.addSource("gasStations",this.gasStations),this.map.addSource("chargePoints",this.chargePoints),this.map.addSource("savedLocations",this.chargePoints),this.map.addSource("savedShoppingCenter",this.savedShoppingCenters),this.map.addSource("savedParkings",this.savedParkings),this.map.addSource("savedHotels",this.savedHotels),this.map.addSource("savedGasStations",this.savedGasStations),this.map.addSource("savedChargePoints",this.savedChargePoints),this.createMapLayerWithImage("shoppingcartIcon","shoppingCenter"),this.createMapLayerWithImage("parkingIcon","parkings"),this.createMapLayerWithImage("hotelIcon","hotels"),this.createMapLayerWithImage("gasStationIcon","gasStations"),this.createMapLayerWithImage("chargingPointIcon","chargePoints"),this.createMapLayerWithImage("savedLocationIcon","savedLocations"),this.createMapLayerWithImage("shoppingcartIconSaved","savedShoppingCenter"),this.createMapLayerWithImage("parkingIconSaved","savedParkings"),this.createMapLayerWithImage("hotelIconSaved","savedHotels"),this.createMapLayerWithImage("gasStationIconSaved","savedGasStations"),this.createMapLayerWithImage("chargingPointIconSaved","savedChargePoints"),this.handleLayerClickEvent("shoppingCenter"),this.handleLayerClickEvent("parkings"),this.handleLayerClickEvent("hotels"),this.handleLayerClickEvent("gasStations"),this.handleLayerClickEvent("chargePoints"),this.handleLayerClickEvent("savedLocations"),this.handleLayerClickEvent("savedShoppingCenter"),this.handleLayerClickEvent("savedParkings"),this.handleLayerClickEvent("savedHotels"),this.handleLayerClickEvent("savedGasStations"),this.handleLayerClickEvent("savedChargePoints")});const d=new dd(this._exploreService,"draggable-pin",()=>{}),_=new dd(this._exploreService,"rightPanelToggleButton",()=>{});this.map.addControl(d,"bottom-right"),this.map.addControl(_,"bottom-right"),this.mapLoaded=!0,this.map.on("moveend",x=>{"in"===this.zoneScore?this.getScoreHeatMaps():"in"===this.populationDensity?this.getPopulationDensityHeatMaps():"in"===this.populationRevenue?this.getPopulationRevenueHeatMaps():"in"===this.evRegistrations?this.getEvRegistrationsHeatMaps():"in"===this.chargePointUltraFast&&this.getChargePointsHeatMaps();let T=this.map.unproject([0,0]),C=this.map.unproject([window.innerWidth,window.innerHeight]);this._exploreService.updatePoiView({place:"",topLeftLat:T.lat,topLeftLon:T.lng,btmRightLat:C.lat,btmRightLon:C.lng,update:!1}).then(D=>{D.subscribe({next:R=>{R&&(this.panelState="slide-left",this.slideLeft())}})})}),this.mapLoading=!1,this.route.queryParams.subscribe({next:x=>{x.prediction_id?this._locationData.getLocationFromSimulationId(x.prediction_id).subscribe({next:C=>{console.error(C),this.dropMarkerSearchBar({lat:C[0].lat,lng:C[0].long}),this._exploreService._simulationOptions={acBetween7_22:C[0].ac_between_7_22,acGreaterThan22:C[0].ac_greater_than_22,acLessThan7:C[0].ac_less_than_7,dcBetween50_150:C[0].dc_between_50_150,dcBetween150_350:C[0].dc_between_150_350,dcGreaterThan350:C[0].dc_greater_than_350,dcLessThan50:C[0].dc_less_than_50,latitude:C[0].lat,longitude:C[0].long,simulationName:C[0].simulation_name},this.map?.flyTo({center:[C[0].long,C[0].lat],zoom:15})}}):console.error("no Data was provided")}})}handleLayerClickEvent(i){this.map.on("click",i,o=>{console.log(this._exploreService.activeId,this._exploreService.activeLayer,this._exploreService.activeTomtomId);const d=o.features[0].geometry.coordinates.slice();console.error("I am here ",d);const _=o.features[0].properties;this._exploreService.activeId=o.features[0].id,this._exploreService.activeLayer=i,this._exploreService.activeTomtomId=_.apiId,console.log(this._exploreService.activeId,this._exploreService.activeLayer,this._exploreService.activeTomtomId),this.map.setFeatureState({source:i,id:o.features[0].id},{ttype:!0}),this.map.querySourceFeatures(i).forEach(T=>{T.id!==o.features[0].id&&this.map.setFeatureState({source:i,id:T.id},{ttype:!1})}),this.showRest(i);const x=this.map.getZoom();this.animateMarker(d[0]-Math.pow(2,-x),d[1]-7*Math.pow(2,-x),!0),this.panelState="slide-left",this.slideLeft(),this._exploreService.setLocation(o.features[0]);for(const[T,C]of this.markers.entries())C.getElement().querySelector("path")?.setAttribute("fill","#335579")}),this.map.on("mouseenter",i,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",i,()=>{this.map.getCanvas().style.cursor=""})}createMapLayerWithImage(i,o){this.map?.loadImage(`../../../../assets/images/mapIcons/${i}.png`,(d,_)=>{d&&console.error("this is my error ",d),this.map?.addImage(i,_),this.map.addLayer({id:o,type:"symbol",source:o,layout:{"icon-image":i,"icon-allow-overlap":!0,"icon-size":.7},paint:{"icon-opacity":["case",["boolean",["feature-state","ttype"],!1],0,1]}})})}updateLayers(){this.updateDataSubscription=this._exploreService.locationsList$.pipe((0,vp.T)(1)).subscribe({next:i=>{if(void 0===i)return;let o=[],d=[],_=[],x=[],T=[],C=[],D=[],R=[],V=[],H=[],K=[];i.features.forEach(ct=>{switch(ct.properties.type){case"Retail":ct.properties.saved_name?D.push(ct):o.push(ct);break;case"parking":ct.properties.saved_name?R.push(ct):d.push(ct);break;case"hotel":ct.properties.saved_name?V.push(ct):_.push(ct);break;case"gas station":ct.properties.saved_name?H.push(ct):x.push(ct);break;case"charging station":ct.properties.saved_name?K.push(ct):T.push(ct);break;case"pinned location":C.push(ct)}}),this.map.getSource("shoppingCenter").setData({type:"FeatureCollection",features:o}),this.map.getSource("parkings").setData({type:"FeatureCollection",features:d}),this.map.getSource("hotels").setData({type:"FeatureCollection",features:_}),this.map.getSource("gasStations").setData({type:"FeatureCollection",features:x}),this.map.getSource("chargePoints").setData({type:"FeatureCollection",features:T}),this.map.getSource("savedLocations").setData({type:"FeatureCollection",features:C}),this.map.getSource("savedShoppingCenter").setData({type:"FeatureCollection",features:D}),this.map.getSource("savedParkings").setData({type:"FeatureCollection",features:R}),this.map.getSource("savedHotels").setData({type:"FeatureCollection",features:V}),this.map.getSource("savedGasStations").setData({type:"FeatureCollection",features:H}),this.map.getSource("savedChargePoints").setData({type:"FeatureCollection",features:K}),console.error(this._exploreService.activeLayer,this._exploreService.activeId),-1!==this._exploreService.activeId&&this.map.setFeatureState({source:this._exploreService.activeLayer,id:this._exploreService.activeId},{ttype:!0}),this.panelState="slide-left",this.slideLeft()}})}showRest(i){for(let o of["shoppingCenter","parkings","hotels","transportations","gasStations","chargePoints","savedLocations","savedShoppingCenter","savedParkings","savedHotels","savedGasStations","savedChargePoints"])o!=i&&this.map.querySourceFeatures(o).forEach(d=>{this.map.setFeatureState({source:o,id:d.id},{ttype:!1})})}dropMarkerSearchBar(i){this._exploreService.addmarkers({id:Ea,pos:{lng:i.lng,lat:i.lat},name:""}),this.panelState="slide-left",this.slideLeft(),this._exploreService.reverseGeo(i.lat,i.lng,Ea);for(const[d,_]of this.markers.entries())_.getElement().querySelector("path")?.setAttribute("fill","#335579");let o=new pm({draggable:!0,color:"#3B82F6"},Ea++);this.markers.set(Ea-1,o),this.showRest(""),this._exploreService.activeId=-1,this._exploreService.activeLayer="",this._exploreService.activeTomtomId="",this.marker.getElement().style.display="none",this.marker.setLngLat([0,0]),o.setLngLat(i).onClick(d=>{let _=!1;for(const[T,C]of this.markers.entries())if(T===o.getIndex()&&"#3B82F6"===C.getElement().querySelector("path")?.getAttribute("fill")){_=!0;break}if(_)return;this._exploreService.displayInPoi(d),this.showRest(""),this._exploreService.activeId=-1,this._exploreService.activeLayer="",this._exploreService.activeTomtomId="",this.marker.getElement().style.display="none",this.marker.setLngLat([0,0]);const x=o.getIndex();for(const[T,C]of this.markers.entries())T===x?C.getElement().querySelector("path")?.setAttribute("fill","#3B82F6"):C.getElement().querySelector("path")?.setAttribute("fill","#335579");this.panelState="slide-left",this.slideLeft()}).addTo(this.map),o.on("dragend",d=>{const _=o.getIndex();for(const[x,T]of this.markers.entries())x===_?T.getElement().querySelector("path")?.setAttribute("fill","#3B82F6"):T.getElement().querySelector("path")?.setAttribute("fill","#335579");this._exploreService.changemarkerpos(o.getLngLat(),d.target.getIndex()),this._exploreService.reverseGeo(o.getLngLat().lat,o.getLngLat().lng,d.target.getIndex()),this.panelState="slide-left",this.slideLeft()}),this.removeMarkerSubscription=this._exploreService.removeMarker.subscribe({next:d=>{o.getIndex()===d&&(o.remove(),this.markers.delete(d))}})}drop(i){const o=this.map.unproject([i.dropPoint.x,i.dropPoint.y]);this._exploreService.addmarkers({id:Ea,pos:{lng:o.lng,lat:o.lat},name:""}),this.panelState="slide-left",this.slideLeft(),this._exploreService.reverseGeo(o.lat,o.lng,Ea);for(const[_,x]of this.markers.entries())x.getElement().querySelector("path")?.setAttribute("fill","#335579");let d=new pm({draggable:!0,color:"#3B82F6"},Ea++);this.markers.set(Ea-1,d),this.showRest(""),this._exploreService.activeId=-1,this._exploreService.activeLayer="",this._exploreService.activeTomtomId="",this.marker.getElement().style.display="none",this.marker.setLngLat([0,0]),d.setLngLat(o).onClick(_=>{let x=!1;for(const[C,D]of this.markers.entries())if(C===d.getIndex()&&"#3B82F6"===D.getElement().querySelector("path")?.getAttribute("fill")){x=!0;break}if(x)return;this._exploreService.displayInPoi(_),this.showRest(""),this._exploreService.activeId=-1,this._exploreService.activeLayer="",this._exploreService.activeTomtomId="",this.marker.getElement().style.display="none",this.marker.setLngLat([0,0]);const T=d.getIndex();for(const[C,D]of this.markers.entries())C===T?D.getElement().querySelector("path")?.setAttribute("fill","#3B82F6"):D.getElement().querySelector("path")?.setAttribute("fill","#335579");this.panelState="slide-left",this.slideLeft()}).addTo(this.map),d.on("dragend",_=>{const x=d.getIndex();for(const[T,C]of this.markers.entries())T===x?C.getElement().querySelector("path")?.setAttribute("fill","#3B82F6"):C.getElement().querySelector("path")?.setAttribute("fill","#335579");this._exploreService.changemarkerpos(d.getLngLat(),_.target.getIndex()),this._exploreService.reverseGeo(d.getLngLat().lat,d.getLngLat().lng,_.target.getIndex()),this.panelState="slide-left",this.slideLeft()}),this.removeMarkerSubscription1=this._exploreService.removeMarker.subscribe({next:_=>{d.getIndex()===_&&(d.remove(),this.markers.delete(_))}})}animateMarker(i,o,d){const _=this.marker.getElement();if(this.marker.getLngLat().lng===i&&this.marker.getLngLat().lat===o)return;d&&(_.style.display="block",this.marker.setLngLat([i,o]));const x=_.getBoundingClientRect();_.style.transform=`translate(${x.left}px, ${x.top}px) scale(0.5)`,_.animate([{transform:`translate(${x.left}px, ${x.top}px) scaleY(0)`,easing:"ease-out"},{transform:`translate(${x.left}px, ${x.top-20}px) scaleY(1.2)`,easing:"ease-in"},{transform:`translate(${x.left}px, ${x.top}px) scaleY(0.9)`,easing:"ease-out"},{transform:`translate(${x.left}px, ${x.top}px) scaleY(1)`,easing:"ease-in"}],{duration:700}).onfinish=()=>{_.style.transform=`translate(${x.left}px, ${x.top}px)`}}}return l.\u0275fac=function(i){return new(i||l)(p.Y36(_l.G),p.Y36(gc.s),p.Y36(jh.z),p.Y36(Po.uw),p.Y36(Cs.ux),p.Y36(pn.gz),p.Y36(dm._),p.Y36(jh.z))},l.\u0275cmp=p.Xpm({type:l,selectors:[["app-explore"]],standalone:!0,features:[p.jDz],decls:82,vars:47,consts:[["class","flex items-center justify-center h-screen w-screen z-50 absolute top-0 left-0 bg-white",4,"ngIf"],["id","map",1,"-z-10",2,"position","absolute","top","0","bottom","0","width","100%"],[3,"panelState","panelStateChange",4,"ngIf"],["id","rightPanelToggleButton",1,"flex","justify-center","items-center","mapboxgl-ctrl-group","mapboxgl-ctrl",3,"click"],[1,"flex","justify-center","items-center",2,"width","30px","height","30px"],[2,"font-size","30px","width","30px","height","30px"],[1,"fixed","w-12","mapboxgl-ctrl-group","mapboxgl-ctrl",2,"z-index","998","height","auto","left","30px","bottom","1.8rem"],[1,"relative","w-full","h-fit","flex","justify-center","items-center","flex-col"],["id","leftPanel",1,"w-full"],[1,"flex","flex-col","space-y-4","m-2"],[1,"flex","items-center","w-full","space-x-4","align-items-center","justify-between"],[1,"flex","items-center","justify-center"],[2,"color","#335579"],[1,"text-style","ml-3",2,"color","#335579"],["color","primary",3,"checked","change"],[1,"mt-3",2,"overflow","hidden"],[3,"minVal","maxVal","minValColor","maxValColor"],[2,"margin","0.5rem -0.5rem 0 -0.5rem","background-color","rgba(44, 48, 50, 0.12)"],[1,"text-style",2,"color","#335579"],[1,"flex","justify-center","items-center"],[1,"bottom-1","flex","items-center","justify-between","w-full","hover:cursor-pointer",3,"click"],[1,"text-sm","font-semibold","ml-3"],[1,"mr-2"],["id","geocoder",1,"geocoder"],["id","draggable-pin","cdkDropList","",1,"mapboxgl-ctrl-group","mapboxgl-ctrl","flex","items-center","justify-center",3,"ngClass","cdkDropListDropped"],["cdkDrag","",1,"flex","items-center","justify-center",2,"width","30px","height","30px"],["src","../../../../assets/images/pin.png","width","25","height","25","alt","",1,"hover:cursor-grab"],[1,"flex","items-center","justify-center","h-screen","w-screen","z-50","absolute","top-0","left-0","bg-white"],[1,"relative","w-1/4","h-1/5"],["src","../../../../assets/images/dvl3.svg","alt","",1,"w-full","h-full"],[1,"absolute","bottom-0","left-0","w-full","h-1","bg-blue-500"],[1,"h-full","bg-white","animate-slide"],[3,"panelState","panelStateChange"]],template:function(i,o){1&i&&(p.YNc(0,ud,5,0,"div",0),p.TgZ(1,"div",1),p.YNc(2,Bg,1,1,"app-right-panel",2),p.TgZ(3,"div",3),p.NdJ("click",function(){return o.toggleRightPanel()}),p.TgZ(4,"div",4)(5,"mat-icon",5),p._uU(6),p.qZA()()(),p.TgZ(7,"div",6)(8,"div",7)(9,"div",8)(10,"div",9)(11,"div")(12,"div",10)(13,"div",11)(14,"mat-icon",12),p._uU(15,"star_half"),p.qZA(),p.TgZ(16,"span",13),p._uU(17,"Area potential score"),p.qZA()(),p.TgZ(18,"mat-slide-toggle",14),p.NdJ("change",function(){return o.toggleZoneScore()}),p.qZA()(),p.TgZ(19,"div",15),p._UZ(20,"app-heatmap-legend",16),p.qZA()(),p._UZ(21,"hr",17),p.TgZ(22,"div")(23,"div",10)(24,"div",11)(25,"mat-icon",12),p._uU(26,"groups"),p.qZA(),p.TgZ(27,"span",13),p._uU(28,"Population density"),p.qZA()(),p.TgZ(29,"mat-slide-toggle",14),p.NdJ("change",function(){return o.togglePopulationDensity()}),p.qZA()(),p.TgZ(30,"div",15)(31,"span",18),p._uU(32,"Habitant/km\xb2"),p.qZA(),p._UZ(33,"app-heatmap-legend",16),p.qZA()(),p._UZ(34,"hr",17),p.TgZ(35,"div")(36,"div",10)(37,"div",19)(38,"mat-icon",12),p._uU(39,"monetization_on"),p.qZA(),p.TgZ(40,"span",13),p._uU(41,"Median income"),p.qZA()(),p.TgZ(42,"mat-slide-toggle",14),p.NdJ("change",function(){return o.togglePopulationRevenue()}),p.qZA()(),p.TgZ(43,"div",15)(44,"span",18),p._uU(45,"\u20ac/Habitant"),p.qZA(),p._UZ(46,"app-heatmap-legend",16),p.qZA()(),p._UZ(47,"hr",17),p.TgZ(48,"div")(49,"div",10)(50,"div",19)(51,"mat-icon",12),p._uU(52,"electric_car"),p.qZA(),p.TgZ(53,"span",13),p._uU(54,"EV registrations"),p.qZA()(),p.TgZ(55,"mat-slide-toggle",14),p.NdJ("change",function(){return o.toggleEvRegistrations()}),p.qZA()(),p.TgZ(56,"div",15)(57,"span",18),p._uU(58,"EVs"),p.qZA(),p._UZ(59,"app-heatmap-legend",16),p.qZA()(),p._UZ(60,"hr",17),p.TgZ(61,"div")(62,"div",10)(63,"div",19)(64,"mat-icon",12),p._uU(65,"ev_station"),p.qZA(),p.TgZ(66,"span",13),p._uU(67,"EV stations density"),p.qZA()(),p.TgZ(68,"mat-slide-toggle",14),p.NdJ("change",function(){return o.toggleChargePointUltraFast()}),p.qZA()(),p.TgZ(69,"div",15)(70,"span",18),p._uU(71,"Charge points"),p.qZA(),p._UZ(72,"app-heatmap-legend",16),p.qZA()()()(),p.TgZ(73,"div",20),p.NdJ("click",function(){return o.toggleDiv()}),p.TgZ(74,"span",21),p._uU(75,"Layers"),p.qZA(),p.TgZ(76,"mat-icon",22),p._uU(77,"layers"),p.qZA()()()(),p._UZ(78,"div",23),p.TgZ(79,"div",24),p.NdJ("cdkDropListDropped",function(_){return o.drop(_)}),p.TgZ(80,"div",25),p._UZ(81,"img",26),p.qZA()()()),2&i&&(p.Q6J("ngIf",o.mapLoading),p.xp6(2),p.Q6J("ngIf",!o.mapLoading),p.xp6(4),p.Oqu("slide-right"===o.panelState?"chevron_left":"chevron_right"),p.xp6(1),p.Q6J("@buttonAnim",o.buttonState),p.xp6(2),p.ekj("animate-height",!0)("open",o.isOpen),p.xp6(9),p.Q6J("checked","zoneScore"===o.activeSlide),p.xp6(1),p.Q6J("@slideInOut",o.zoneScore),p.xp6(1),p.Q6J("minVal",0)("maxVal",10)("minValColor","yellow-500")("maxValColor","red-500"),p.xp6(9),p.Q6J("checked","populationDensity"===o.activeSlide),p.xp6(1),p.Q6J("@slideInOut",o.populationDensity),p.xp6(3),p.Q6J("minVal",0)("maxVal",5e4)("minValColor","yellow-500")("maxValColor","red-500"),p.xp6(9),p.Q6J("checked","populationRevenue"===o.activeSlide),p.xp6(1),p.Q6J("@slideInOut",o.populationRevenue),p.xp6(3),p.Q6J("minVal",9e3)("maxVal",6e4)("minValColor","yellow-500")("maxValColor","red-500"),p.xp6(9),p.Q6J("checked","evRegistrations"===o.activeSlide),p.xp6(1),p.Q6J("@slideInOut",o.evRegistrations),p.xp6(3),p.Q6J("minVal",0)("maxVal",9e3)("minValColor","yellow-500")("maxValColor","red-500"),p.xp6(9),p.Q6J("checked","chargePointUltraFast"===o.activeSlide),p.xp6(1),p.Q6J("@slideInOut",o.chargePointUltraFast),p.xp6(3),p.Q6J("minVal",0)("maxVal",600)("minValColor","yellow-500")("maxValColor","red-500"),p.xp6(1),p.Akn("inactive"===o.buttonState?"padding-top: 0.2rem; padding-bottom: 0.2rem":"padding-top: 0.2rem; padding-bottom: 0.2rem;border-end-end-radius:4px;border-end-start-radius:4px;"),p.Tol("inactive"===o.buttonState?"bg-white transition rounded-md duration-300":"deepvoltBlueBackground transition duration-300"),p.xp6(1),p.Tol("inactive"===o.buttonState?"deepvoltBlueColor":"text-white"),p.xp6(2),p.Tol("inactive"===o.buttonState?"deepvoltBlueColor":"text-white"),p.xp6(3),p.Q6J("ngClass",o.mapLoaded?"block":"hidden"))},dependencies:[Gn,cn.Ps,cn.Hw,Wo,vn.ot,hd,Qr,Ui,yr,c.ez,c.mk,c.O5,um.rP,um.Rr,Cs.ZX,Og,Rn.lN,yp.LD,Me.u5],styles:[".geocoder[_ngcontent-%COMP%]{position:absolute;z-index:999;left:0;margin-left:30px;top:70px;width:260px}.mapboxgl-ctrl-geocoder[_ngcontent-%COMP%]{min-width:100%}.mapbox-gl-draw_polygon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;pointer-events:auto}.coordinates[_ngcontent-%COMP%]{background:rgba(0,0,0,.5);color:#fff;position:absolute;bottom:40px;left:10px;padding:5px 10px;margin:0;font-size:11px;line-height:18px;border-radius:3px;display:none}  .mapboxgl-ctrl-geocoder{width:100%!important}  .slide-left{right:30%;transition:right .5s ease-in-out}  .slide-right{right:0;transition:right .5s ease-in-out}  .mat-slide-toggle.mat-checked:not(.mat-disabled) .mat-slide-toggle-bar{background-color:#335579}  .mat-slide-toggle.mat-checked:not(.mat-disabled) .mat-slide-toggle-thumb{background-color:#335579}.animate-height[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content;overflow:hidden;transition:max-height .5s ease-in-out 0s;max-height:0px}.animate-height.open[_ngcontent-%COMP%]{max-height:350px}  .custom-style{background-color:#fe5157;color:#fff}  .mat-simple-snackbar-action>button{color:#fff}.text-style[_ngcontent-%COMP%]{font-size:.8rem;font-family:Montserrat,sans-serif;font-weight:600;line-height:1.5;letter-spacing:.009em;-webkit-font-smoothing:antialiased}.deepvoltBlueBackground[_ngcontent-%COMP%]{background-color:#335579}.deepvoltBlueColor[_ngcontent-%COMP%]{color:#335579}@keyframes _ngcontent-%COMP%_slide{0%{transform:translate(-100%)}to{transform:translate(100%)}}.animate-slide[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide 1s ease-in-out infinite}"],data:{animation:[(0,mt.X$)("buttonAnim",[(0,mt.SB)("inactive",(0,mt.oB)({width:"6.5rem"})),(0,mt.SB)("active",(0,mt.oB)({width:"260px"})),(0,mt.eR)("inactive => active",[(0,mt.jt)("0.5s ease-in-out")]),(0,mt.eR)("active => inactive",[(0,mt.jt)("0.5s ease-in-out")])]),(0,mt.X$)("slideInOut",[(0,mt.SB)("in",(0,mt.oB)({height:"*",opacity:1,paddingTop:"*",paddingBottom:"*",marginTop:"*",marginBottom:"*",overflow:"hidden"})),(0,mt.SB)("out",(0,mt.oB)({height:"0px",opacity:0,paddingTop:"0px",paddingBottom:"0px",marginTop:"0px",marginBottom:"0px",overflow:"hidden"})),(0,mt.eR)("in => out",[(0,mt.jt)("0.3s ease-in-out",(0,mt.oB)({height:"0px",opacity:0,paddingTop:"0px",paddingBottom:"0px",marginTop:"0px",marginBottom:"0px"}))]),(0,mt.eR)("out => in",[(0,mt.jt)("0.3s ease-in-out",(0,mt.oB)({height:"*",opacity:1,paddingTop:"*",paddingBottom:"*",marginTop:"*",marginBottom:"*"}))])])]}}),l})();class pm extends ls.Marker{constructor(r,i){super(r),this.index=i}getIndex(){return this.index}getcolor(){}onClick(r){return this._handleClick=r,this}_onMapClick(r){const i=r.originalEvent.target,o=this._element;this._element.querySelector("svg").setAttribute("fill","#3B82F6"),this._handleClick&&(i===o||o.contains(i))&&this._handleClick(this.index)}}class dd{constructor(r,i,o){this._exploreService=r,this.ButtonId="",this.eventHandler=()=>{},this.ButtonId=i,this.eventHandler=o}onAdd(r){return document.getElementById(this.ButtonId)}onRemove(){}}},2049:function(Le,Ae,bt){var ae;Le=bt.nmd(Le),function(Zt){"object"==typeof global&&global;var Tt=function(ye){this.message=ye};(Tt.prototype=new Error).name="InvalidCharacterError";var mt=function(ye){throw new Tt(ye)},St="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",zt=/[\t\n\f\r ]/g,Ce={encode:function(ye){ye=String(ye),/[^\0-\xFF]/.test(ye)&&mt("The string to be encoded contains characters outside of the Latin1 range.");for(var Mt,Ut,Dt,Jt,pe=ye.length%3,lt="",qt=-1,le=ye.length-pe;++qt<le;)Mt=ye.charCodeAt(qt)<<16,Ut=ye.charCodeAt(++qt)<<8,Dt=ye.charCodeAt(++qt),lt+=St.charAt((Jt=Mt+Ut+Dt)>>18&63)+St.charAt(Jt>>12&63)+St.charAt(Jt>>6&63)+St.charAt(63&Jt);return 2==pe?(Mt=ye.charCodeAt(qt)<<8,Ut=ye.charCodeAt(++qt),lt+=St.charAt((Jt=Mt+Ut)>>10)+St.charAt(Jt>>4&63)+St.charAt(Jt<<2&63)+"="):1==pe&&(Jt=ye.charCodeAt(qt),lt+=St.charAt(Jt>>2)+St.charAt(Jt<<4&63)+"=="),lt},decode:function(ye){var pe=(ye=String(ye).replace(zt,"")).length;pe%4==0&&(pe=(ye=ye.replace(/==?$/,"")).length),(pe%4==1||/[^+a-zA-Z0-9/]/.test(ye))&&mt("Invalid character: the string to be decoded is not correctly encoded.");for(var qt,Mt,lt=0,Ut="",Dt=-1;++Dt<pe;)Mt=St.indexOf(ye.charAt(Dt)),qt=lt%4?64*qt+Mt:Mt,lt++%4&&(Ut+=String.fromCharCode(255&qt>>(-2*lt&6)));return Ut},version:"0.1.0"};void 0!==(ae=function(){return Ce}.call(Ae,bt,Ae,Le))&&(Le.exports=ae)}()},9069:Le=>{"use strict";var ae,Ae="object"==typeof Reflect?Reflect:null,bt=Ae&&"function"==typeof Ae.apply?Ae.apply:function(Dt,Qt,Jt){return Function.prototype.apply.call(Dt,Qt,Jt)};ae=Ae&&"function"==typeof Ae.ownKeys?Ae.ownKeys:Object.getOwnPropertySymbols?function(Dt){return Object.getOwnPropertyNames(Dt).concat(Object.getOwnPropertySymbols(Dt))}:function(Dt){return Object.getOwnPropertyNames(Dt)};var Ct=Number.isNaN||function(Dt){return Dt!=Dt};function c(){c.init.call(this)}Le.exports=c,Le.exports.once=function lt(Ut,Dt){return new Promise(function(Qt,Jt){function le(Qe){Ut.removeListener(Dt,ze),Jt(Qe)}function ze(){"function"==typeof Ut.removeListener&&Ut.removeListener("error",le),Qt([].slice.call(arguments))}Mt(Ut,Dt,ze,{once:!0}),"error"!==Dt&&function qt(Ut,Dt,Qt){"function"==typeof Ut.on&&Mt(Ut,"error",Dt,Qt)}(Ut,le,{once:!0})})},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var p=10;function Tt(Ut){if("function"!=typeof Ut)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Ut)}function mt(Ut){return void 0===Ut._maxListeners?c.defaultMaxListeners:Ut._maxListeners}function St(Ut,Dt,Qt,Jt){var le,ze,Qe;if(Tt(Qt),void 0===(ze=Ut._events)?(ze=Ut._events=Object.create(null),Ut._eventsCount=0):(void 0!==ze.newListener&&(Ut.emit("newListener",Dt,Qt.listener?Qt.listener:Qt),ze=Ut._events),Qe=ze[Dt]),void 0===Qe)Qe=ze[Dt]=Qt,++Ut._eventsCount;else if("function"==typeof Qe?Qe=ze[Dt]=Jt?[Qt,Qe]:[Qe,Qt]:Jt?Qe.unshift(Qt):Qe.push(Qt),(le=mt(Ut))>0&&Qe.length>le&&!Qe.warned){Qe.warned=!0;var Gi=new Error("Possible EventEmitter memory leak detected. "+Qe.length+" "+String(Dt)+" listeners added. Use emitter.setMaxListeners() to increase limit");Gi.name="MaxListenersExceededWarning",Gi.emitter=Ut,Gi.type=Dt,Gi.count=Qe.length,function Zt(Ut){console&&console.warn&&console.warn(Ut)}(Gi)}return Ut}function zt(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function de(Ut,Dt,Qt){var Jt={fired:!1,wrapFn:void 0,target:Ut,type:Dt,listener:Qt},le=zt.bind(Jt);return le.listener=Qt,Jt.wrapFn=le,le}function Fe(Ut,Dt,Qt){var Jt=Ut._events;if(void 0===Jt)return[];var le=Jt[Dt];return void 0===le?[]:"function"==typeof le?Qt?[le.listener||le]:[le]:Qt?function pe(Ut){for(var Dt=new Array(Ut.length),Qt=0;Qt<Dt.length;++Qt)Dt[Qt]=Ut[Qt].listener||Ut[Qt];return Dt}(le):Re(le,le.length)}function Ce(Ut){var Dt=this._events;if(void 0!==Dt){var Qt=Dt[Ut];if("function"==typeof Qt)return 1;if(void 0!==Qt)return Qt.length}return 0}function Re(Ut,Dt){for(var Qt=new Array(Dt),Jt=0;Jt<Dt;++Jt)Qt[Jt]=Ut[Jt];return Qt}function Mt(Ut,Dt,Qt,Jt){if("function"==typeof Ut.on)Jt.once?Ut.once(Dt,Qt):Ut.on(Dt,Qt);else{if("function"!=typeof Ut.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Ut);Ut.addEventListener(Dt,function le(ze){Jt.once&&Ut.removeEventListener(Dt,le),Qt(ze)})}}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return p},set:function(Ut){if("number"!=typeof Ut||Ut<0||Ct(Ut))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Ut+".");p=Ut}}),c.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(Dt){if("number"!=typeof Dt||Dt<0||Ct(Dt))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Dt+".");return this._maxListeners=Dt,this},c.prototype.getMaxListeners=function(){return mt(this)},c.prototype.emit=function(Dt){for(var Qt=[],Jt=1;Jt<arguments.length;Jt++)Qt.push(arguments[Jt]);var le="error"===Dt,ze=this._events;if(void 0!==ze)le=le&&void 0===ze.error;else if(!le)return!1;if(le){var Qe;if(Qt.length>0&&(Qe=Qt[0]),Qe instanceof Error)throw Qe;var Gi=new Error("Unhandled error."+(Qe?" ("+Qe.message+")":""));throw Gi.context=Qe,Gi}var ln=ze[Dt];if(void 0===ln)return!1;if("function"==typeof ln)bt(ln,this,Qt);else{var Je=ln.length,Gn=Re(ln,Je);for(Jt=0;Jt<Je;++Jt)bt(Gn[Jt],this,Qt)}return!0},c.prototype.on=c.prototype.addListener=function(Dt,Qt){return St(this,Dt,Qt,!1)},c.prototype.prependListener=function(Dt,Qt){return St(this,Dt,Qt,!0)},c.prototype.once=function(Dt,Qt){return Tt(Qt),this.on(Dt,de(this,Dt,Qt)),this},c.prototype.prependOnceListener=function(Dt,Qt){return Tt(Qt),this.prependListener(Dt,de(this,Dt,Qt)),this},c.prototype.off=c.prototype.removeListener=function(Dt,Qt){var Jt,le,ze,Qe,Gi;if(Tt(Qt),void 0===(le=this._events))return this;if(void 0===(Jt=le[Dt]))return this;if(Jt===Qt||Jt.listener===Qt)0==--this._eventsCount?this._events=Object.create(null):(delete le[Dt],le.removeListener&&this.emit("removeListener",Dt,Jt.listener||Qt));else if("function"!=typeof Jt){for(ze=-1,Qe=Jt.length-1;Qe>=0;Qe--)if(Jt[Qe]===Qt||Jt[Qe].listener===Qt){Gi=Jt[Qe].listener,ze=Qe;break}if(ze<0)return this;0===ze?Jt.shift():function ye(Ut,Dt){for(;Dt+1<Ut.length;Dt++)Ut[Dt]=Ut[Dt+1];Ut.pop()}(Jt,ze),1===Jt.length&&(le[Dt]=Jt[0]),void 0!==le.removeListener&&this.emit("removeListener",Dt,Gi||Qt)}return this},c.prototype.removeAllListeners=function(Dt){var Qt,Jt,le;if(void 0===(Jt=this._events))return this;if(void 0===Jt.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Jt[Dt]&&(0==--this._eventsCount?this._events=Object.create(null):delete Jt[Dt]),this;if(0===arguments.length){var Qe,ze=Object.keys(Jt);for(le=0;le<ze.length;++le)"removeListener"!==(Qe=ze[le])&&this.removeAllListeners(Qe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(Qt=Jt[Dt]))this.removeListener(Dt,Qt);else if(void 0!==Qt)for(le=Qt.length-1;le>=0;le--)this.removeListener(Dt,Qt[le]);return this},c.prototype.listeners=function(Dt){return Fe(this,Dt,!0)},c.prototype.rawListeners=function(Dt){return Fe(this,Dt,!1)},c.listenerCount=function(Ut,Dt){return"function"==typeof Ut.listenerCount?Ut.listenerCount(Dt):Ce.call(Ut,Dt)},c.prototype.listenerCount=Ce,c.prototype.eventNames=function(){return this._eventsCount>0?ae(this._events):[]}},5780:Le=>{var bt;Le.exports=bt={},bt.simpleFilter=function(ae,Zt){return Zt.filter(function(Ct){return bt.test(ae,Ct)})},bt.test=function(ae,Zt){return null!==bt.match(ae,Zt)},bt.match=function(ae,Zt,Ct){var Ce,c=0,p=[],Tt=Zt.length,mt=0,St=0,zt=(Ct=Ct||{}).pre||"",de=Ct.post||"",Fe=Ct.caseSensitive&&Zt||Zt.toLowerCase();ae=Ct.caseSensitive&&ae||ae.toLowerCase();for(var Re=0;Re<Tt;Re++)Ce=Zt[Re],Fe[Re]===ae[c]?(Ce=zt+Ce+de,c+=1,St+=1+St):St=0,mt+=St,p[p.length]=Ce;return c===ae.length?(mt=Fe===ae?1/0:mt,{rendered:p.join(""),score:mt}):null},bt.filter=function(ae,Zt,Ct){return Zt&&0!==Zt.length?"string"!=typeof ae?Zt:(Ct=Ct||{},Zt.reduce(function(c,p,Tt,mt){var St=p;Ct.extract&&(St=Ct.extract(p));var zt=bt.match(ae,St,Ct);return null!=zt&&(c[c.length]={string:zt.rendered,score:zt.score,index:Tt,original:p}),c},[]).sort(function(c,p){return p.score-c.score||c.index-p.index})):[]}},3082:Le=>{var bt=NaN,ae="[object Symbol]",Zt=/^\s+|\s+$/g,Ct=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,p=/^0o[0-7]+$/i,Tt=parseInt,mt="object"==typeof global&&global&&global.Object===Object&&global,St="object"==typeof self&&self&&self.Object===Object&&self,zt=mt||St||Function("return this")(),Fe=Object.prototype.toString,Ce=Math.max,Re=Math.min,ye=function(){return zt.Date.now()};function lt(Dt){var Qt=typeof Dt;return!!Dt&&("object"==Qt||"function"==Qt)}function Ut(Dt){if("number"==typeof Dt)return Dt;if(function Mt(Dt){return"symbol"==typeof Dt||function qt(Dt){return!!Dt&&"object"==typeof Dt}(Dt)&&Fe.call(Dt)==ae}(Dt))return bt;if(lt(Dt)){var Qt="function"==typeof Dt.valueOf?Dt.valueOf():Dt;Dt=lt(Qt)?Qt+"":Qt}if("string"!=typeof Dt)return 0===Dt?Dt:+Dt;Dt=Dt.replace(Zt,"");var Jt=c.test(Dt);return Jt||p.test(Dt)?Tt(Dt.slice(2),Jt?2:8):Ct.test(Dt)?bt:+Dt}Le.exports=function pe(Dt,Qt,Jt){var le,ze,Qe,Gi,ln,Je,Gn=0,cn=!1,vn=!1,_i=!0;if("function"!=typeof Dt)throw new TypeError("Expected a function");function ni(Hi){var mn=le,wo=ze;return le=ze=void 0,Gn=Hi,Gi=Dt.apply(wo,mn)}function Bn(Hi){var mn=Hi-Je;return void 0===Je||mn>=Qt||mn<0||vn&&Hi-Gn>=Qe}function Pn(){var Hi=ye();if(Bn(Hi))return In(Hi);ln=setTimeout(Pn,function Is(Hi){var on=Qt-(Hi-Je);return vn?Re(on,Qe-(Hi-Gn)):on}(Hi))}function In(Hi){return ln=void 0,_i&&le?ni(Hi):(le=ze=void 0,Gi)}function xs(){var Hi=ye(),mn=Bn(Hi);if(le=arguments,ze=this,Je=Hi,mn){if(void 0===ln)return function On(Hi){return Gn=Hi,ln=setTimeout(Pn,Qt),cn?ni(Hi):Gi}(Je);if(vn)return ln=setTimeout(Pn,Qt),ni(Je)}return void 0===ln&&(ln=setTimeout(Pn,Qt)),Gi}return Qt=Ut(Qt)||0,lt(Jt)&&(cn=!!Jt.leading,Qe=(vn="maxWait"in Jt)?Ce(Ut(Jt.maxWait)||0,Qt):Qe,_i="trailing"in Jt?!!Jt.trailing:_i),xs.cancel=function Me(){void 0!==ln&&clearTimeout(ln),Gn=0,le=Je=ze=ln=void 0},xs.flush=function js(){return void 0===ln?Gi:In(ye())},xs}},9898:function(Le){Le.exports=function(){"use strict";var Ae,bt,ae;function Zt(c,p){if(Ae)if(bt){var Tt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ae+")(sharedChunk); ("+bt+")(sharedChunk); self.onerror = null;",mt={};Ae(mt),ae=p(mt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(ae.workerUrl=window.URL.createObjectURL(new Blob([Tt],{type:"text/javascript"})))}else bt=p;else Ae=p}return Zt(0,function(c){var p=typeof self<"u"?self:{},Tt="2.13.0";let mt;const St={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==mt){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{mt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch{mt=e}}return mt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},zt={supported:!1,testSupport:function(e){!Ce&&Fe&&(Re?ye(e):de=e)}};let de,Fe,Ce=!1,Re=!1;function ye(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Fe),e.isContextLost())return;zt.supported=!0}catch{}e.deleteTexture(t),Ce=!0}p.document&&(Fe=p.document.createElement("img"),Fe.onload=function(){de&&ye(de),de=null,Re=!0},Fe.onerror=function(){Ce=!0,de=null},Fe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const pe="01";var lt=qt;function qt(e,t,n,a){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=a}qt.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,a=0;a<8;a++){var u=this.sampleCurveX(n)-e;if(Math.abs(u)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=u/m}var y=0,b=1;for(n=e,a=0;a<20&&(u=this.sampleCurveX(n),!(Math.abs(u-e)<t));a++)e>u?y=n:b=n,n=.5*(b-y)+y;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var Mt=Ut;function Ut(e,t){this.x=e,this.y=t}Ut.prototype={clone:function(){return new Ut(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),a=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=a,this},_rotateAround:function(e,t){var n=Math.cos(e),a=Math.sin(e),u=t.y+a*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-a*(this.y-t.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ut.convert=function(e){return e instanceof Ut?e:Array.isArray(e)?new Ut(e[0],e[1]):e};const Dt=Math.PI/180,Qt=180/Math.PI;function Jt(e){return e*Dt}function le(e){return e*Qt}const ze=[[0,0],[1,0],[1,1],[0,1]];function Qe(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function Gi(e,t,n,a){const u=new lt(e,t,n,a);return function(m){return u.solve(m)}}const ln=Gi(.25,.1,.25,1);function Je(e,t,n){return Math.min(n,Math.max(t,e))}function Gn(e,t,n){return(n=Je((n-e)/(t-e),0,1))*n*(3-2*n)}function cn(e,t,n){const a=n-t,u=((e-t)%a+a)%a+t;return u===t?n:u}function vn(e,t,n){if(!e.length)return n(null,[]);let a=e.length;const u=new Array(e.length);let m=null;e.forEach((y,b)=>{t(y,(S,M)=>{S&&(m=S),u[b]=M,0==--a&&n(m,u)})})}function _i(e){const t=[];for(const n in e)t.push(e[n]);return t}function ni(e,...t){for(const n of t)for(const a in n)e[a]=n[a];return e}let On=1;function Is(){return On++}function Bn(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Pn(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function In(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Me(e,t){e.forEach(n=>{t[n]&&(t[n]=t[n].bind(t))})}function js(e,t){return-1!==e.indexOf(t,e.length-t.length)}function xs(e,t,n){const a={};for(const u in e)a[u]=t.call(n||this,e[u],u,e);return a}function Hi(e,t,n){const a={};for(const u in e)t.call(n||this,e[u],u,e)&&(a[u]=e[u]);return a}function mn(e){return Array.isArray(e)?e.map(mn):"object"==typeof e&&e?xs(e,mn):e}const wo={};function on(e){wo[e]||(typeof console<"u"&&console.warn(e),wo[e]=!0)}function Zs(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function Ti(e){let t=0;for(let n,a,u=0,m=e.length,y=m-1;u<m;y=u++)n=e[u],a=e[y],t+=(a.x-n.x)*(n.y+a.y);return t}function Gs(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function qo(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,u,m)=>{const y=u||m;return t[a]=!y||y.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t}let bl=null;function Ho(e){if(null==bl){const t=e.navigator?e.navigator.userAgent:null;bl=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return bl}function wl(e){try{const t=p[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function Vr(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}const Da="mapbox-tiles";let so,oo,jr=500,Pa=50;function Tl(){try{return p.caches}catch{}}function $o(){Tl()&&!so&&(so=p.caches.open(Da))}function Zr(e){const t=e.indexOf("?");if(t<0)return e;const a=function(u){const m=u.indexOf("?");return m>0?u.slice(m+1).split("&"):[]}(e).filter(u=>{const m=u.split("=");return"language"===m[0]||"worldview"===m[0]});return a.length?`${e.slice(0,t)}?${a.join("&")}`:e.slice(0,t)}let Gr=1/0;const qr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(qr);class vs extends Error{constructor(t,n,a){401===n&&So(a)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Hr=Gs()?()=>self.worker&&self.worker.referrer:()=>("blob:"===p.location.protocol?p.parent:p).location.href,Wo=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(Hr())&&!/^\w+:/.test(n))){if(p.fetch&&p.Request&&p.AbortController&&p.Request.prototype.hasOwnProperty("signal"))return function(a,u){const m=new p.AbortController,y=new p.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Hr(),signal:m.signal});let b=!1,S=!1;const M=(k=y.url).indexOf("sku=")>0&&So(k);var k;"json"===a.type&&y.headers.set("Accept","application/json");const I=(B,F,j)=>{if(S)return;if(B&&"SecurityError"!==B.message&&on(B),F&&j)return L(F);const $=Date.now();p.fetch(y).then(nt=>{if(nt.ok){const ht=M?nt.clone():null;return L(nt,ht,$)}return u(new vs(nt.statusText,nt.status,a.url))}).catch(nt=>{"AbortError"!==nt.name&&u(new Error(`${nt.message} ${a.url}`))})},L=(B,F,j)=>{("arrayBuffer"===a.type?B.arrayBuffer():"json"===a.type?B.json():B.text()).then($=>{S||(F&&j&&function(nt,ht,tt){if($o(),!so)return;const at={status:ht.status,statusText:ht.statusText,headers:new p.Headers};ht.headers.forEach((Ft,Rt)=>at.headers.set(Rt,Ft));const ft=qo(ht.headers.get("Cache-Control")||"");if(ft["no-store"])return;ft["max-age"]&&at.headers.set("Expires",new Date(tt+1e3*ft["max-age"]).toUTCString());const ut=at.headers.get("Expires");ut&&(new Date(ut).getTime()-tt<42e4||function(Ft,Rt){if(void 0===oo)try{new Response(new ReadableStream),oo=!0}catch{oo=!1}oo?Rt(Ft.body):Ft.blob().then(Rt)}(ht,Ft=>{const Rt=new p.Response(Ft,at);$o(),so&&so.then(Wt=>Wt.put(Zr(nt.url),Rt)).catch(Wt=>on(Wt.message))}))}(y,F,j),b=!0,u(null,$,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch($=>{S||u(new Error($.message))})};return M?function(B,F){if($o(),!so)return F(null);const j=Zr(B.url);so.then($=>{$.match(j).then(nt=>{const ht=function(tt){if(!tt)return!1;const at=new Date(tt.headers.get("Expires")||0),ft=qo(tt.headers.get("Cache-Control")||"");return at>Date.now()&&!ft["no-cache"]}(nt);$.delete(j),ht&&$.put(j,nt.clone()),F(null,nt,ht)}).catch(F)}).catch(F)}(y,I):I(null,null),{cancel:()=>{S=!0,b||m.abort()}}}(e,t);if(Gs()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(a,u){const m=new p.XMLHttpRequest;m.open(a.method||"GET",a.url,!0),"arrayBuffer"===a.type&&(m.responseType="arraybuffer");for(const y in a.headers)m.setRequestHeader(y,a.headers[y]);return"json"===a.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===a.credentials,m.onerror=()=>{u(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let y=m.response;if("json"===a.type)try{y=JSON.parse(m.response)}catch(b){return u(b)}u(null,y,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else u(new vs(m.statusText,m.status,a.url))},m.send(a.body),{cancel:()=>m.abort()}}(e,t)},bs=function(e,t){return Wo(ni(e,{type:"arrayBuffer"}),t)};function Ia(e){const t=p.document.createElement("a");return t.href=e,t.protocol===p.document.location.protocol&&t.host===p.document.location.host}const $r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Wr,fr;Wr=[],fr=0;const Xr=function(e,t){if(zt.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),fr>=St.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Wr.push(m),m}fr++;let n=!1;const a=()=>{if(!n)for(n=!0,fr--;Wr.length&&fr<St.MAX_PARALLEL_IMAGE_REQUESTS;){const m=Wr.shift(),{requestParameters:y,callback:b,cancelled:S}=m;S||(m.cancel=Xr(y,b).cancel)}},u=bs(e,(m,y,b,S)=>{a(),m?t(m):y&&(p.createImageBitmap?function(M,k){const I=new p.Blob([new Uint8Array(M)],{type:"image/png"});p.createImageBitmap(I).then(L=>{k(null,L)}).catch(L=>{k(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(M,k)=>t(M,k,b,S)):function(M,k){const I=new p.Image,L=p.URL;I.onload=()=>{k(null,I),L.revokeObjectURL(I.src),I.onload=null,p.requestAnimationFrame(()=>{I.src=$r})},I.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new p.Blob([new Uint8Array(M)],{type:"image/png"});I.src=M.byteLength?L.createObjectURL(B):$r}(y,(M,k)=>t(M,k,b,S)))});return{cancel:()=>{u.cancel(),a()}}},To="NO_ACCESS_TOKEN";function qs(e){return 0===e.indexOf("mapbox:")}function So(e){return St.API_URL_REGEX.test(e)}function Sl(e){return St.API_CDN_URL_REGEX.test(e)}function Cl(e){return St.API_STYLE_REGEX.test(e)&&!mr(e)}function mr(e){return St.API_SPRITE_REGEX.test(e)}const Co=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ln(e){const t=e.match(Co);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Mo(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}function gr(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(p.atob(t[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Xo{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=gr(St.ACCESS_TOKEN);let a="";return a=n&&n.u?p.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(u,m)=>String.fromCharCode(Number("0x"+m)))):St.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${a}`:`mapbox.eventData:${a}`}fetchEventData(){const t=wl("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(t)try{const u=p.localStorage.getItem(n);u&&(this.eventData=JSON.parse(u));const m=p.localStorage.getItem(a);m&&(this.anonId=m)}catch{on("Unable to read from LocalStorage")}}saveEventData(){const t=wl("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(t)try{p.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&p.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{on("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,a,u){if(!St.EVENTS_URL)return;const m=Ln(St.EVENTS_URL);m.params.push(`access_token=${u||St.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(t).toISOString()},b=n?ni(y,n):y,S={url:Mo(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};var k;this.pendingRequest=(k=M=>{this.pendingRequest=null,a(M),this.saveEventData(),this.processRequests(u)},Wo(ni(S,{method:"POST"}),k))}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const et=new class extends Xo{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){St.EVENTS_URL&&St.ACCESS_TOKEN&&Array.isArray(e)&&e.some(n=>qs(n)||So(n))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=gr(St.ACCESS_TOKEN),n=t?t.u:St.ACCESS_TOKEN;let a=n!==this.eventData.tokenU;In(this.anonId)||(this.anonId=Bn(),a=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),y=new Date(u),b=(u-this.eventData.lastSuccess)/864e5;a=a||b>=1||b<-1||m.getDate()!==y.getDate()}else a=!0;a?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Tt,skuId:pe,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=u,this.eventData.tokenU=n)},e):this.processRequests()}},N=et.postTurnstileEvent.bind(et),Z=new class extends Xo{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,n,a){this.skuToken=t,this.errorCb=a,St.EVENTS_URL&&(n||St.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(To)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),In(this.anonId)||(this.anonId=Bn()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Tt,skuId:pe,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):t&&(this.success[t]=!0)},e))}},Q=Z.postMapLoadEvent.bind(Z),ot=new class extends Xo{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){St.EVENTS_URL&&(e||St.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,performanceData:n}=this.queue.shift(),a=function(u){const m=p.performance.getEntriesByType("resource"),y=p.performance.getEntriesByType("mark"),b=function(L){const B={};if(L)for(const F in L)if("other"!==F)for(const j of L[F]){const $=`${F}ResolveRangeMin`,nt=`${F}ResolveRangeMax`,ht=`${F}RequestCount`,tt=`${F}RequestCachedCount`;B[$]=Math.min(B[$]||1/0,j.startTime),B[nt]=Math.max(B[nt]||-1/0,j.responseEnd);const at=ft=>{void 0===B[ft]&&(B[ft]=0),++B[ft]};void 0!==j.transferSize&&0===j.transferSize&&at(tt),at(ht)}return B}(function(L,B){const F={};if(L)for(const j of L){const $=B(j);void 0===F[$]&&(F[$]=[]),F[$].push(j)}return F}(m,we)),S=p.devicePixelRatio,M=p.navigator.connection||p.navigator.mozConnection||p.navigator.webkitConnection,k={counters:[],metadata:[],attributes:[]},I=(L,B,F)=>{null!=F&&L.push({name:B,value:F.toString()})};for(const L in b)I(k.counters,L,b[L]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(I(k.counters,"interactionRangeMin",u.interactionRange[0]),I(k.counters,"interactionRangeMax",u.interactionRange[1])),y)for(const L of Object.keys(It)){const B=It[L],F=y.find(j=>j.name===B);F&&I(k.counters,B,F.startTime)}return I(k.counters,"visibilityHidden",u.visibilityHidden),I(k.attributes,"style",function(L){if(L)for(const B of L){const F=B.name.split("?")[0];if(Cl(F)){const j=F.split("/").slice(-2);if(2===j.length)return`mapbox://styles/${j[0]}/${j[1]}`}}}(m)),I(k.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),I(k.attributes,"fogEnabled",u.fogEnabled?"true":"false"),I(k.attributes,"projection",u.projection),I(k.attributes,"zoom",u.zoom),I(k.metadata,"devicePixelRatio",S),I(k.metadata,"connectionEffectiveType",M?M.effectiveType:void 0),I(k.metadata,"navigatorUserAgent",p.navigator.userAgent),I(k.metadata,"screenWidth",p.screen.width),I(k.metadata,"screenHeight",p.screen.height),I(k.metadata,"windowWidth",p.innerWidth),I(k.metadata,"windowHeight",p.innerHeight),I(k.metadata,"mapWidth",u.width/S),I(k.metadata,"mapHeight",u.height/S),I(k.metadata,"webglRenderer",u.renderer),I(k.metadata,"webglVendor",u.vendor),I(k.metadata,"sdkVersion",Tt),I(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(n);for(const u of a.metadata);for(const u of a.counters);for(const u of a.attributes);this.postEvent(t,a,()=>{},e)}},yt=ot.postPerformanceEvent.bind(ot),kt=new class extends Xo{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,n,a){if(!St.API_URL||!St.SESSION_PATH)return;const u=Ln(St.API_URL+St.SESSION_PATH);u.params.push(`sku=${t||""}`),u.params.push(`access_token=${a||St.ACCESS_TOKEN||""}`);const m={url:Mo(u),headers:{"Content-Type":"text/plain"}};var b;this.pendingRequest=(b=y=>{this.pendingRequest=null,n(y),this.saveEventData(),this.processRequests(a)},Wo(ni(m,{method:"GET"}),b))}getSessionAPI(e,t,n,a){this.skuToken=t,this.errorCb=a,St.SESSION_PATH&&St.API_URL&&(n||St.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(To)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,a=>{a?this.errorCb(a):t&&(this.success[t]=!0)},e)}},At=kt.getSessionAPI.bind(kt),vt=new Set,It={create:"create",load:"load",fullLoad:"fullLoad"},ie={mark(e){p.performance.mark(e)},measure(e,t,n){p.performance.measure(e,t,n)}};function we(e){const t=e.name.split("?")[0];return Sl(t)&&t.includes("mapbox-gl.js")?"javascript":Sl(t)&&t.includes("mapbox-gl.css")?"css":St.API_FONTS_REGEX.test(t)?"fontRange":mr(t)?"sprite":Cl(t)?"style":St.API_TILEJSON_REGEX.test(t)?"tilejson":"other"}const re=p.performance;function Ze(e){const t=e?e.url.toString():void 0;return re.getEntriesByName(t)}let Ge,Ne,We,ei;const bi={now:()=>void 0!==We?We:p.performance.now(),setNow(e){We=e},restoreNow(){We=void 0},frame(e){const t=p.requestAnimationFrame(e);return{cancel:()=>p.cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:n,height:a}=e;ei||(ei=p.document.createElement("canvas"));const u=ei.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(n>ei.width||a>ei.height)&&(ei.width=n,ei.height=a),u.clearRect(-t,-t,n+2*t,a+2*t),u.drawImage(e,0,0,n,a),u.getImageData(-t,-t,n+2*t,a+2*t)},resolveURL:e=>(Ge||(Ge=p.document.createElement("a")),Ge.href=e,Ge.href),get devicePixelRatio(){return p.devicePixelRatio},get prefersReducedMotion(){return!!p.matchMedia&&(null==Ne&&(Ne=p.matchMedia("(prefers-reduced-motion: reduce)")),Ne.matches)}};function He(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function Pi(e,t,n){if(n&&n[e]){const a=n[e].indexOf(t);-1!==a&&n[e].splice(a,1)}}class Ii{constructor(t,n={}){ni(this,n),this.type=t}}class Yo extends Ii{constructor(t,n={}){super("error",ni({error:t},n))}}class Jo{on(t,n){return this._listeners=this._listeners||{},He(t,n,this._listeners),this}off(t,n){return Pi(t,n,this._listeners),Pi(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},He(t,n,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,n){"string"==typeof t&&(t=new Ii(t,n||{}));const a=t.type;if(this.listens(a)){t.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const b of u)b.call(this,t);const m=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const b of m)Pi(a,b,this._oneTimeListeners),b.call(this,t);const y=this._eventedParent;y&&(ni(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(t))}else t instanceof Yo&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var Ht=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ws(e,...t){for(const n of t)for(const a in n)e[a]=n[a];return e}function gn(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Eo(e){if(Array.isArray(e))return e.map(Eo);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=Eo(e[n]);return t}return gn(e)}class Jh extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}var Hs=Jh;class _r{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[a,u]of n)this.bindings[a]=u}concat(t){return new _r(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var Kh=_r;const Ao={kind:"null"},xe={kind:"number"},hi={kind:"string"},si={kind:"boolean"},$s={kind:"color"},Ko={kind:"object"},ai={kind:"value"},Yr={kind:"collator"},La={kind:"formatted"},Jr={kind:"resolvedImage"};function qn(e,t){return{kind:"array",itemType:e,N:t}}function Ui(e){if("array"===e.kind){const t=Ui(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Tc=[Ao,xe,hi,si,$s,La,Ko,qn(ai),Jr];function Ts(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Ts(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const n of Tc)if(!Ts(n,t))return null}return`Expected ${Ui(e)} but found ${Ui(t)} instead.`}function Sc(e,t){return t.some(n=>n.kind===e.kind)}function Kr(e,t){return t.some(n=>"null"===n?null===e:"array"===n?Array.isArray(e):"object"===n?e&&!Array.isArray(e)&&"object"==typeof e:n===typeof e)}var Cc,Mc={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ra(e){return(e=Math.round(e))<0?0:e>255?255:e}function yr(e){return Ra("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function Qr(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function ls(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{Cc={}.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in Mc)return Mc[n].slice();if("#"===n[0])return 4===n.length?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===n.length&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var a=n.indexOf("("),u=n.indexOf(")");if(-1!==a&&u+1===n.length){var m=n.substr(0,a),y=n.substr(a+1,u-(a+1)).split(","),b=1;switch(m){case"rgba":if(4!==y.length)return null;b=Qr(y.pop());case"rgb":return 3!==y.length?null:[yr(y[0]),yr(y[1]),yr(y[2]),b];case"hsla":if(4!==y.length)return null;b=Qr(y.pop());case"hsl":if(3!==y.length)return null;var S=(parseFloat(y[0])%360+360)%360/360,M=Qr(y[1]),k=Qr(y[2]),I=k<=.5?k*(M+1):k+M-k*M,L=2*k-I;return[Ra(255*ls(L,I,S+1/3)),Ra(255*ls(L,I,S)),Ra(255*ls(L,I,S-1/3)),b];default:return null}}return null}}catch{}class cs{constructor(t,n,a,u=1){this.r=t,this.g=n,this.b=a,this.a=u}static parse(t){if(!t)return;if(t instanceof cs)return t;if("string"!=typeof t)return;const n=Cc(t);return n?new cs(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[t,n,a,u]=this.toArray();return`rgba(${Math.round(t)},${Math.round(n)},${Math.round(a)},${u})`}toArray(){const{r:t,g:n,b:a,a:u}=this;return 0===u?[0,0,0,0]:[255*t/u,255*n/u,255*a/u,u]}toArray01(){const{r:t,g:n,b:a,a:u}=this;return 0===u?[0,0,0,0]:[t/u,n/u,a/u,u]}toArray01PremultipliedAlpha(){const{r:t,g:n,b:a,a:u}=this;return[t,n,a,u]}}cs.black=new cs(0,0,0,1),cs.white=new cs(1,1,1,1),cs.transparent=new cs(0,0,0,0),cs.red=new cs(1,0,0,1),cs.blue=new cs(0,0,1,1);var pn=cs;class Ec{constructor(t,n,a){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ta{constructor(t,n,a,u,m){this.text=t.normalize?t.normalize():t,this.image=n,this.scale=a,this.fontStack=u,this.textColor=m}}class Ss{constructor(t){this.sections=t}static fromString(t){return new Ss([new ta(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof Ss?t:Ss.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const n of this.sections){if(n.image){t.push(["image",n.image.name]);continue}t.push(n.text);const a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(a)}return t}}class Jn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Jn({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Qh(e,t,n,a){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===a||"number"==typeof a&&a>=0&&a<=1?null:`Invalid rgba value [${[e,t,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof a?[e,t,n,a]:[e,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ml(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof pn||e instanceof Ec||e instanceof Ss||e instanceof Jn)return!0;if(Array.isArray(e)){for(const t of e)if(!Ml(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Ml(e[t]))return!1;return!0}return!1}function _n(e){if(null===e)return Ao;if("string"==typeof e)return hi;if("boolean"==typeof e)return si;if("number"==typeof e)return xe;if(e instanceof pn)return $s;if(e instanceof Ec)return Yr;if(e instanceof Ss)return La;if(e instanceof Jn)return Jr;if(Array.isArray(e)){const t=e.length;let n;for(const a of e){const u=_n(a);if(n){if(n===u)continue;n=ai;break}n=u}return qn(n||ai,t)}return Ko}function za(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof pn||e instanceof Ss||e instanceof Jn?e.toString():JSON.stringify(e)}class ea{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(2!==t.length)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ml(t[1]))return n.error("invalid value");const a=t[1];let u=_n(a);const m=n.expectedType;return"array"!==u.kind||0!==u.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(u=m),new ea(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof pn?["rgba"].concat(this.value.toArray()):this.value instanceof Ss?this.value.serialize():this.value}}var Oa=ea,Fn=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const El={string:hi,number:xe,boolean:si,object:Ko};class ia{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let a,u=1;const m=t[0];if("array"===m){let b,S;if(t.length>2){const M=t[1];if("string"!=typeof M||!(M in El)||"object"===M)return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=El[M],u++}else b=ai;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);S=t[2],u++}a=qn(b,S)}else a=El[m];const y=[];for(;u<t.length;u++){const b=n.parse(t[u],u,ai);if(!b)return null;y.push(b)}return new ia(a,y)}evaluate(t){for(let n=0;n<this.args.length;n++){const a=this.args[n].evaluate(t);if(!Ts(this.type,_n(a)))return a;if(n===this.args.length-1)throw new Fn(`Expected value to be of type ${Ui(this.type)}, but found ${Ui(_n(a))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,n=[t.kind];if("array"===t.kind){const a=t.itemType;if("string"===a.kind||"number"===a.kind||"boolean"===a.kind){n.push(a.kind);const u=t.N;("number"==typeof u||this.args.length>1)&&n.push(u)}}return n.concat(this.args.map(a=>a.serialize()))}}var ko=ia;class Ba{constructor(t){this.type=La,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&"object"==typeof a)return n.error("First argument must be an image or text section.");const u=[];let m=!1;for(let y=1;y<=t.length-1;++y){const b=t[y];if(m&&"object"==typeof b&&!Array.isArray(b)){m=!1;let S=null;if(b["font-scale"]&&(S=n.parse(b["font-scale"],1,xe),!S))return null;let M=null;if(b["text-font"]&&(M=n.parse(b["text-font"],1,qn(hi)),!M))return null;let k=null;if(b["text-color"]&&(k=n.parse(b["text-color"],1,$s),!k))return null;const I=u[u.length-1];I.scale=S,I.font=M,I.textColor=k}else{const S=n.parse(t[y],1,ai);if(!S)return null;const M=S.type.kind;if("string"!==M&&"value"!==M&&"null"!==M&&"resolvedImage"!==M)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,u.push({content:S,scale:null,font:null,textColor:null})}}return new Ba(u)}evaluate(t){return new Ss(this.sections.map(n=>{const a=n.content.evaluate(t);return _n(a)===Jr?new ta("",a,null,null,null):new ta(za(a),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const n of this.sections){t.push(n.content.serialize());const a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),t.push(a)}return t}}class Al{constructor(t){this.type=Jr,this.input=t}static parse(t,n){if(2!==t.length)return n.error("Expected two arguments.");const a=n.parse(t[1],1,hi);return a?new Al(a):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),a=Jn.fromString(n);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(n)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const fd={"to-boolean":si,"to-color":$s,"to-number":xe,"to-string":hi};class kl{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const a=t[0];if(("to-boolean"===a||"to-string"===a)&&2!==t.length)return n.error("Expected one argument.");const u=fd[a],m=[];for(let y=1;y<t.length;y++){const b=n.parse(t[y],y,ai);if(!b)return null;m.push(b)}return new kl(u,m)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let n,a;for(const u of this.args){if(n=u.evaluate(t),a=null,n instanceof pn)return n;if("string"==typeof n){const m=t.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Qh(n[0],n[1],n[2],n[3]),!a))return new pn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Fn(a||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const a of this.args){if(n=a.evaluate(t),null===n)return 0;const u=Number(n);if(!isNaN(u))return u}throw new Fn(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?Ss.fromString(za(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Jn.fromString(za(this.args[0].evaluate(t))):za(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ba([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Al(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(n=>{t.push(n.serialize())}),t}}var xr=kl;const Ac=["Unknown","Point","LineString","Polygon"];var Fa=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ac[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-e[0])+this.featureDistanceData.bearing[1]*(a*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=pn.parse(e)),t}};class na{constructor(t,n,a,u){this.name=t,this.type=n,this._evaluate=a,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,n){const a=t[0],u=na.definitions[a];if(!u)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(u)?u[0]:u.type,y=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,b=y.filter(([M])=>!Array.isArray(M)||M.length===t.length-1);let S=null;for(const[M,k]of b){S=new Il(n.registry,n.path,null,n.scope);const I=[];let L=!1;for(let B=1;B<t.length;B++){const F=t[B],j=Array.isArray(M)?M[B-1]:M.type,$=S.parse(F,1+I.length,j);if(!$){L=!0;break}I.push($)}if(!L)if(Array.isArray(M)&&M.length!==I.length)S.error(`Expected ${M.length} arguments, but found ${I.length} instead.`);else{for(let B=0;B<I.length;B++){const F=Array.isArray(M)?M[B]:M.type,j=I[B];S.concat(B+1).checkSubtype(F,j.type)}if(0===S.errors.length)return new na(a,m,k,I)}}if(1===b.length)n.errors.push(...S.errors);else{const M=(b.length?b:y).map(([I])=>{return L=I,Array.isArray(L)?`(${L.map(Ui).join(", ")})`:`(${Ui(L.type)}...)`;var L}).join(" | "),k=[];for(let I=1;I<t.length;I++){const L=n.parse(t[I],1+k.length);if(!L)return null;k.push(Ui(L.type))}n.error(`Expected arguments of type ${M}, but found (${k.join(", ")}) instead.`)}return null}static register(t,n){na.definitions=n;for(const a in n)t[a]=na}}var Do=na;class sa{constructor(t,n,a){this.type=Yr,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(2!==t.length)return n.error("Expected one argument.");const a=t[1];if("object"!=typeof a||Array.isArray(a))return n.error("Collator options argument must be an object.");const u=n.parse(void 0!==a["case-sensitive"]&&a["case-sensitive"],1,si);if(!u)return null;const m=n.parse(void 0!==a["diacritic-sensitive"]&&a["diacritic-sensitive"],1,si);if(!m)return null;let y=null;return a.locale&&(y=n.parse(a.locale,1,hi),!y)?null:new sa(u,m,y)}evaluate(t){return new Ec(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const vr=8192;function Ls(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Ua(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function kc(e,t){const n=(180+e[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(n*u*vr),Math.round(a*u*vr)]}function md(e,t,n){const a=e[0]-t[0],u=e[1]-t[1],m=e[0]-n[0],y=e[1]-n[1];return a*y-m*u==0&&a*m<=0&&u*y<=0}function Na(e,t){let n=!1;for(let y=0,b=t.length;y<b;y++){const S=t[y];for(let M=0,k=S.length;M<k-1;M++){if(md(e,S[M],S[M+1]))return!1;(u=S[M])[1]>(a=e)[1]!=(m=S[M+1])[1]>a[1]&&a[0]<(m[0]-u[0])*(a[1]-u[1])/(m[1]-u[1])+u[0]&&(n=!n)}}var a,u,m;return n}function gd(e,t){for(let n=0;n<t.length;n++)if(Na(e,t[n]))return!0;return!1}function Dl(e,t,n,a){const u=a[0]-n[0],m=a[1]-n[1],y=(e[0]-n[0])*m-u*(e[1]-n[1]),b=(t[0]-n[0])*m-u*(t[1]-n[1]);return y>0&&b<0||y<0&&b>0}function Po(e,t,n){for(const M of n)for(let k=0;k<M.length-1;++k)if((b=[(y=M[k+1])[0]-(m=M[k])[0],y[1]-m[1]])[0]*(S=[(u=t)[0]-(a=e)[0],u[1]-a[1]])[1]-b[1]*S[0]!=0&&Dl(a,u,m,y)&&Dl(m,y,a,u))return!0;var a,u,m,y,b,S;return!1}function Rn(e,t){for(let n=0;n<e.length;++n)if(!Na(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(Po(e[n],e[n+1],t))return!1;return!0}function br(e,t){for(let n=0;n<t.length;n++)if(Rn(e,t[n]))return!0;return!1}function Pl(e,t,n){const a=[];for(let u=0;u<e.length;u++){const m=[];for(let y=0;y<e[u].length;y++){const b=kc(e[u][y],n);Ls(t,b),m.push(b)}a.push(m)}return a}function oa(e,t,n){const a=[];for(let u=0;u<e.length;u++){const m=Pl(e[u],t,n);a.push(m)}return a}function Qo(e,t,n,a){if(e[0]<n[0]||e[0]>n[2]){const u=.5*a;let m=e[0]-n[0]>u?-a:n[0]-e[0]>u?a:0;0===m&&(m=e[0]-n[2]>u?-a:n[2]-e[0]>u?a:0),e[0]+=m}Ls(t,e)}function Cs(e,t,n,a){const u=Math.pow(2,a.z)*vr,m=[a.x*vr,a.y*vr],y=[];if(!e)return y;for(const b of e)for(const S of b){const M=[S.x+m[0],S.y+m[1]];Qo(M,t,n,u),y.push(M)}return y}function Si(e,t,n,a){const u=Math.pow(2,a.z)*vr,m=[a.x*vr,a.y*vr],y=[];if(!e)return y;for(const S of e){const M=[];for(const k of S){const I=[k.x+m[0],k.y+m[1]];Ls(t,I),M.push(I)}y.push(M)}if(t[2]-t[0]<=u/2){(b=t)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const S of y)for(const M of S)Qo(M,t,n,u)}var b;return y}class ro{constructor(t,n){this.type=si,this.geojson=t,this.geometries=n}static parse(t,n){if(2!==t.length)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ml(t[1])){const a=t[1];if("FeatureCollection"===a.type)for(let u=0;u<a.features.length;++u){const m=a.features[u].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new ro(a,a.features[u].geometry)}else if("Feature"===a.type){const u=a.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new ro(a,a.geometry)}else if("Polygon"===a.type||"MultiPolygon"===a.type)return new ro(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(n,a){const u=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(!y)return!1;if("Polygon"===a.type){const b=Pl(a.coordinates,m,y),S=Cs(n.geometry(),u,m,y);if(!Ua(u,m))return!1;for(const M of S)if(!Na(M,b))return!1}if("MultiPolygon"===a.type){const b=oa(a.coordinates,m,y),S=Cs(n.geometry(),u,m,y);if(!Ua(u,m))return!1;for(const M of S)if(!gd(M,b))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(n,a){const u=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(!y)return!1;if("Polygon"===a.type){const b=Pl(a.coordinates,m,y),S=Si(n.geometry(),u,m,y);if(!Ua(u,m))return!1;for(const M of S)if(!Rn(M,b))return!1}if("MultiPolygon"===a.type){const b=oa(a.coordinates,m,y),S=Si(n.geometry(),u,m,y);if(!Ua(u,m))return!1;for(const M of S)if(!br(M,b))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var ke=ro;function ao(e){if(e instanceof Do&&("get"===e.name&&1===e.args.length||"feature-state"===e.name||"has"===e.name&&1===e.args.length||"properties"===e.name||"geometry-type"===e.name||"id"===e.name||/^filter-/.test(e.name))||e instanceof ke)return!1;let t=!0;return e.eachChild(n=>{t&&!ao(n)&&(t=!1)}),t}function Ms(e){if(e instanceof Do&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(n=>{t&&!Ms(n)&&(t=!1)}),t}function tr(e,t){if(e instanceof Do&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild(a=>{n&&!tr(a,t)&&(n=!1)}),n}class Dc{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(2!==t.length||"string"!=typeof t[1])return n.error("'var' expression requires exactly one string literal argument.");const a=t[1];return n.scope.has(a)?new Dc(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var lo=Dc;class Rs{constructor(t,n=[],a,u=new Kh,m=[]){this.registry=t,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=u,this.errors=m,this.expectedType=a}parse(t,n,a,u,m={}){return n?this.concat(n,a,u)._parse(t,m):this._parse(t,m)}_parse(t,n){function a(u,m,y){return"assert"===y?new ko(m,[u]):"coerce"===y?new xr(m,[u]):u}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[u];if(m){let y=m.parse(t,this);if(!y)return null;if(this.expectedType){const b=this.expectedType,S=y.type;if("string"!==b.kind&&"number"!==b.kind&&"boolean"!==b.kind&&"object"!==b.kind&&"array"!==b.kind||"value"!==S.kind)if("color"!==b.kind&&"formatted"!==b.kind&&"resolvedImage"!==b.kind||"value"!==S.kind&&"string"!==S.kind){if(this.checkSubtype(b,S))return null}else y=a(y,b,n.typeAnnotation||"coerce");else y=a(y,b,n.typeAnnotation||"assert")}if(!(y instanceof Oa)&&"resolvedImage"!==y.type.kind&&An(y)){const b=new Fa;try{y=new Oa(y.type,y.evaluate(b))}catch(S){return this.error(S.message),null}}return y}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,a){const u="number"==typeof t?this.path.concat(t):this.path,m=a?this.scope.concat(a):this.scope;return new Rs(this.registry,u,n||null,m,this.errors)}error(t,...n){const a=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new Hs(a,t))}checkSubtype(t,n){const a=Ts(t,n);return a&&this.error(a),a}}var Il=Rs;function An(e){if(e instanceof lo)return An(e.boundExpression);if(e instanceof Do&&"error"===e.name||e instanceof sa||e instanceof ke)return!1;const t=e instanceof xr||e instanceof ko;let n=!0;return e.eachChild(a=>{n=t?n&&An(a):n&&a instanceof Oa}),!!n&&ao(e)&&tr(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Io(e,t){const n=e.length-1;let a,u,m=0,y=n,b=0;for(;m<=y;)if(b=Math.floor((m+y)/2),a=e[b],u=e[b+1],a<=t){if(b===n||t<u)return b;m=b+1}else{if(!(a>t))throw new Fn("Input is not a number.");y=b-1}return 0}class Ll{constructor(t,n,a){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[u,m]of a)this.labels.push(u),this.outputs.push(m)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const a=n.parse(t[1],1,xe);if(!a)return null;const u=[];let m=null;n.expectedType&&"value"!==n.expectedType.kind&&(m=n.expectedType);for(let y=1;y<t.length;y+=2){const b=1===y?-1/0:t[y],S=t[y+1],M=y,k=y+1;if("number"!=typeof b)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(u.length&&u[u.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const I=n.parse(S,k,m);if(!I)return null;m=m||I.type,u.push([b,I])}return new Ll(m,a,u)}evaluate(t){const n=this.labels,a=this.outputs;if(1===n.length)return a[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return a[0].evaluate(t);const m=n.length;return u>=n[m-1]?a[m-1].evaluate(t):a[Io(n,u)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&t.push(this.labels[n]),t.push(this.outputs[n].serialize());return t}}var Pc=Ll;function ui(e,t,n){return e*(1-n)+t*n}var Va=Object.freeze({__proto__:null,number:ui,color:function(e,t,n){return new pn(ui(e.r,t.r,n),ui(e.g,t.g,n),ui(e.b,t.b,n),ui(e.a,t.a,n))},array:function(e,t,n){return e.map((a,u)=>ui(a,t[u],n))}});const tu=.95047,eu=1.08883,Ic=4/29,Lc=6/29,Rl=3*Lc*Lc,iu=Math.PI/180,_d=180/Math.PI;function zl(e){return e>.008856451679035631?Math.pow(e,1/3):e/Rl+Ic}function ja(e){return e>Lc?e*e*e:Rl*(e-Ic)}function ra(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function aa(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function nu(e){const t=aa(e.r),n=aa(e.g),a=aa(e.b),u=zl((.4124564*t+.3575761*n+.1804375*a)/tu),m=zl((.2126729*t+.7151522*n+.072175*a)/1);return{l:116*m-16,a:500*(u-m),b:200*(m-zl((.0193339*t+.119192*n+.9503041*a)/eu)),alpha:e.a}}function su(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,a=isNaN(e.b)?t:t-e.b/200;return t=1*ja(t),n=tu*ja(n),a=eu*ja(a),new pn(ra(3.2404542*n-1.5371385*t-.4985314*a),ra(-.969266*n+1.8760108*t+.041556*a),ra(.0556434*n-.2040259*t+1.0572252*a),e.alpha)}function ou(e,t,n){const a=t-e;return e+n*(a>180||a<-180?a-360*Math.round(a/360):a)}const Za={forward:nu,reverse:su,interpolate:function(e,t,n){return{l:ui(e.l,t.l,n),a:ui(e.a,t.a,n),b:ui(e.b,t.b,n),alpha:ui(e.alpha,t.alpha,n)}}},Ga={forward:function(e){const{l:t,a:n,b:a}=nu(e),u=Math.atan2(a,n)*_d;return{h:u<0?u+360:u,c:Math.sqrt(n*n+a*a),l:t,alpha:e.a}},reverse:function(e){const t=e.h*iu,n=e.c;return su({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:ou(e.h,t.h,n),c:ui(e.c,t.c,n),l:ui(e.l,t.l,n),alpha:ui(e.alpha,t.alpha,n)}}};var ru=Object.freeze({__proto__:null,lab:Za,hcl:Ga});class la{constructor(t,n,a,u,m){this.type=t,this.operator=n,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[y,b]of m)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(t,n,a,u){let m=0;if("exponential"===t.name)m=Ol(n,t.base,a,u);else if("linear"===t.name)m=Ol(n,1,a,u);else if("cubic-bezier"===t.name){const y=t.controlPoints;m=new lt(y[0],y[1],y[2],y[3]).solve(Ol(n,1,a,u))}return m}static parse(t,n){let[a,u,m,...y]=t;if(!Array.isArray(u)||0===u.length)return n.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const M=u[1];if("number"!=typeof M)return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:M}}else{if("cubic-bezier"!==u[0])return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const M=u.slice(1);if(4!==M.length||M.some(k=>"number"!=typeof k||k<0||k>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:M}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,xe),!m)return null;const b=[];let S=null;"interpolate-hcl"===a||"interpolate-lab"===a?S=$s:n.expectedType&&"value"!==n.expectedType.kind&&(S=n.expectedType);for(let M=0;M<y.length;M+=2){const k=y[M],I=y[M+1],L=M+3,B=M+4;if("number"!=typeof k)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(b.length&&b[b.length-1][0]>=k)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const F=n.parse(I,B,S);if(!F)return null;S=S||F.type,b.push([k,F])}return"number"===S.kind||"color"===S.kind||"array"===S.kind&&"number"===S.itemType.kind&&"number"==typeof S.N?new la(S,a,u,m,b):n.error(`Type ${Ui(S)} is not interpolatable.`)}evaluate(t){const n=this.labels,a=this.outputs;if(1===n.length)return a[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return a[0].evaluate(t);const m=n.length;if(u>=n[m-1])return a[m-1].evaluate(t);const y=Io(n,u),b=la.interpolationFactor(this.interpolation,u,n[y],n[y+1]),S=a[y].evaluate(t),M=a[y+1].evaluate(t);return"interpolate"===this.operator?Va[this.type.kind.toLowerCase()](S,M,b):"interpolate-hcl"===this.operator?Ga.reverse(Ga.interpolate(Ga.forward(S),Ga.forward(M),b)):Za.reverse(Za.interpolate(Za.forward(S),Za.forward(M),b))}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,t,this.input.serialize()];for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function Ol(e,t,n,a){const u=a-n,m=e-n;return 0===u?0:1===t?m/u:(Math.pow(t,m)-1)/(Math.pow(t,u)-1)}var co=la;class ca{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let a=null;const u=n.expectedType;u&&"value"!==u.kind&&(a=u);const m=[];for(const b of t.slice(1)){const S=n.parse(b,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!S)return null;a=a||S.type,m.push(S)}const y=u&&m.some(b=>Ts(u,b.type));return new ca(y?ai:a,m)}evaluate(t){let n,a=null,u=0;for(const m of this.args){if(u++,a=m.evaluate(t),a&&a instanceof Jn&&!a.available&&(n||(n=a),a=null,u===this.args.length))return n;if(null!==a)break}return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var au=ca;class Bl{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let m=1;m<t.length-1;m+=2){const y=t[m];if("string"!=typeof y)return n.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const b=n.parse(t[m+1],m+1);if(!b)return null;a.push([y,b])}const u=n.parse(t[t.length-1],t.length-1,n.expectedType,a);return u?new Bl(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[n,a]of this.bindings)t.push(n,a.serialize());return t.push(this.result.serialize()),t}}var Rc=Bl;class Fl{constructor(t,n,a){this.type=t,this.index=n,this.input=a}static parse(t,n){if(3!==t.length)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,xe),u=n.parse(t[2],2,qn(n.expectedType||ai));return a&&u?new Fl(u.type.itemType,a,u):null}evaluate(t){const n=this.index.evaluate(t),a=this.input.evaluate(t);if(n<0)throw new Fn(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new Fn(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new Fn(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var zc=Fl;class er{constructor(t,n){this.type=si,this.needle=t,this.haystack=n}static parse(t,n){if(3!==t.length)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,ai),u=n.parse(t[2],2,ai);return a&&u?Sc(a.type,[si,hi,xe,Ao,ai])?new er(a,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ui(a.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(null==a)return!1;if(!Kr(n,["boolean","string","number","null"]))throw new Fn(`Expected first argument to be of type boolean, string, number or null, but found ${Ui(_n(n))} instead.`);if(!Kr(a,["string","array"]))throw new Fn(`Expected second argument to be of type array or string, but found ${Ui(_n(a))} instead.`);return a.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var lu=er;class ir{constructor(t,n,a){this.type=xe,this.needle=t,this.haystack=n,this.fromIndex=a}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,ai),u=n.parse(t[2],2,ai);if(!a||!u)return null;if(!Sc(a.type,[si,hi,xe,Ao,ai]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ui(a.type)} instead`);if(4===t.length){const m=n.parse(t[3],3,xe);return m?new ir(a,u,m):null}return new ir(a,u)}evaluate(t){const n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!Kr(n,["boolean","string","number","null"]))throw new Fn(`Expected first argument to be of type boolean, string, number or null, but found ${Ui(_n(n))} instead.`);if(!Kr(a,["string","array"]))throw new Fn(`Expected second argument to be of type array or string, but found ${Ui(_n(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(t);return a.indexOf(n,u)}return a.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Oc=ir;class Ul{constructor(t,n,a,u,m,y){this.inputType=t,this.type=n,this.input=a,this.cases=u,this.outputs=m,this.otherwise=y}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let a,u;n.expectedType&&"value"!==n.expectedType.kind&&(u=n.expectedType);const m={},y=[];for(let M=2;M<t.length-1;M+=2){let k=t[M];const I=t[M+1];Array.isArray(k)||(k=[k]);const L=n.concat(M);if(0===k.length)return L.error("Expected at least one branch label.");for(const F of k){if("number"!=typeof F&&"string"!=typeof F)return L.error("Branch labels must be numbers or strings.");if("number"==typeof F&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof F&&Math.floor(F)!==F)return L.error("Numeric branch labels must be integer values.");if(a){if(L.checkSubtype(a,_n(F)))return null}else a=_n(F);if(void 0!==m[String(F)])return L.error("Branch labels must be unique.");m[String(F)]=y.length}const B=n.parse(I,M,u);if(!B)return null;u=u||B.type,y.push(B)}const b=n.parse(t[1],1,ai);if(!b)return null;const S=n.parse(t[t.length-1],t.length-1,u);return S?"value"!==b.type.kind&&n.concat(1).checkSubtype(a,b.type)?null:new Ul(a,u,b,m,y,S):null}evaluate(t){const n=this.input.evaluate(t);return(_n(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],u={};for(const y of n){const b=u[this.cases[y]];void 0===b?(u[this.cases[y]]=a.length,a.push([this.cases[y],[y]])):a[b][1].push(y)}const m=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,b]of a)t.push(1===b.length?m(b[0]):b.map(m)),t.push(this.outputs[y].serialize());return t.push(this.otherwise.serialize()),t}}var yd=Ul;class nr{constructor(t,n,a){this.type=t,this.branches=n,this.otherwise=a}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&"value"!==n.expectedType.kind&&(a=n.expectedType);const u=[];for(let y=1;y<t.length-1;y+=2){const b=n.parse(t[y],y,si);if(!b)return null;const S=n.parse(t[y+1],y+1,a);if(!S)return null;u.push([b,S]),a=a||S.type}const m=n.parse(t[t.length-1],t.length-1,a);return m?new nr(a,u,m):null}evaluate(t){for(const[n,a]of this.branches)if(n.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,a]of this.branches)t(n),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var Sp=nr;class Kn{constructor(t,n,a,u){this.type=t,this.input=n,this.beginIndex=a,this.endIndex=u}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,ai),u=n.parse(t[2],2,xe);if(!a||!u)return null;if(!Sc(a.type,[qn(ai),hi,ai]))return n.error(`Expected first argument to be of type array or string, but found ${Ui(a.type)} instead`);if(4===t.length){const m=n.parse(t[3],3,xe);return m?new Kn(a.type,a,u,m):null}return new Kn(a.type,a,u)}evaluate(t){const n=this.input.evaluate(t),a=this.beginIndex.evaluate(t);if(!Kr(n,["string","array"]))throw new Fn(`Expected first argument to be of type array or string, but found ${Ui(_n(n))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(t);return n.slice(a,u)}return n.slice(a)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var cu=Kn;function Ci(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Ji(e,t,n,a){return 0===a.compare(t,n)}function di(e,t,n){const a="=="!==e&&"!="!==e;return class e_{constructor(m,y,b){this.type=si,this.lhs=m,this.rhs=y,this.collator=b,this.hasUntypedArgument="value"===m.type.kind||"value"===y.type.kind}static parse(m,y){if(3!==m.length&&4!==m.length)return y.error("Expected two or three arguments.");const b=m[0];let S=y.parse(m[1],1,ai);if(!S)return null;if(!Ci(b,S.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${Ui(S.type)}'.`);let M=y.parse(m[2],2,ai);if(!M)return null;if(!Ci(b,M.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${Ui(M.type)}'.`);if(S.type.kind!==M.type.kind&&"value"!==S.type.kind&&"value"!==M.type.kind)return y.error(`Cannot compare types '${Ui(S.type)}' and '${Ui(M.type)}'.`);a&&("value"===S.type.kind&&"value"!==M.type.kind?S=new ko(M.type,[S]):"value"!==S.type.kind&&"value"===M.type.kind&&(M=new ko(S.type,[M])));let k=null;if(4===m.length){if("string"!==S.type.kind&&"string"!==M.type.kind&&"value"!==S.type.kind&&"value"!==M.type.kind)return y.error("Cannot use collator to compare non-string types.");if(k=y.parse(m[3],3,Yr),!k)return null}return new e_(S,M,k)}evaluate(m){const y=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){const S=_n(y),M=_n(b);if(S.kind!==M.kind||"string"!==S.kind&&"number"!==S.kind)throw new Fn(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${S.kind}, ${M.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const S=_n(y),M=_n(b);if("string"!==S.kind||"string"!==M.kind)return t(m,y,b)}return this.collator?n(m,y,b,this.collator.evaluate(m)):t(m,y,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[e];return this.eachChild(y=>{m.push(y.serialize())}),m}}}const yn=di("==",function(e,t,n){return t===n},Ji),hs=di("!=",function(e,t,n){return t!==n},function(e,t,n,a){return!Ji(0,t,n,a)}),oi=di("<",function(e,t,n){return t<n},function(e,t,n,a){return a.compare(t,n)<0}),hu=di(">",function(e,t,n){return t>n},function(e,t,n,a){return a.compare(t,n)>0}),Nl=di("<=",function(e,t,n){return t<=n},function(e,t,n,a){return a.compare(t,n)<=0}),Ki=di(">=",function(e,t,n){return t>=n},function(e,t,n,a){return a.compare(t,n)>=0});class Li{constructor(t,n,a,u,m,y){this.type=hi,this.number=t,this.locale=n,this.currency=a,this.unit=u,this.minFractionDigits=m,this.maxFractionDigits=y}static parse(t,n){if(3!==t.length)return n.error("Expected two arguments.");const a=n.parse(t[1],1,xe);if(!a)return null;const u=t[2];if("object"!=typeof u||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let m=null;if(u.locale&&(m=n.parse(u.locale,1,hi),!m))return null;let y=null;if(u.currency&&(y=n.parse(u.currency,1,hi),!y))return null;let b=null;if(u.unit&&(b=n.parse(u.unit,1,hi),!b))return null;let S=null;if(u["min-fraction-digits"]&&(S=n.parse(u["min-fraction-digits"],1,xe),!S))return null;let M=null;return u["max-fraction-digits"]&&(M=n.parse(u["max-fraction-digits"],1,xe),!M)?null:new Li(a,m,y,b,S,M)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class ha{constructor(t){this.type=xe,this.input=t}static parse(t,n){if(2!==t.length)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=n.parse(t[1],1);return a?"array"!==a.type.kind&&"string"!==a.type.kind&&"value"!==a.type.kind?n.error(`Expected argument of type string or array, but found ${Ui(a.type)} instead.`):new ha(a):null}evaluate(t){const n=this.input.evaluate(t);if("string"==typeof n||Array.isArray(n))return n.length;throw new Fn(`Expected value to be of type string or array, but found ${Ui(_n(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(n=>{t.push(n.serialize())}),t}}const qa={"==":yn,"!=":hs,">":hu,"<":oi,">=":Ki,"<=":Nl,array:ko,at:zc,boolean:ko,case:Sp,coalesce:au,collator:sa,format:Ba,image:Al,in:lu,"index-of":Oc,interpolate:co,"interpolate-hcl":co,"interpolate-lab":co,length:ha,let:Rc,literal:Oa,match:yd,number:ko,"number-format":Li,object:ko,slice:cu,step:Pc,string:ko,"to-boolean":xr,"to-color":xr,"to-number":xr,"to-string":xr,var:lo,within:ke};function Bc(e,[t,n,a,u]){t=t.evaluate(e),n=n.evaluate(e),a=a.evaluate(e);const m=u?u.evaluate(e):1,y=Qh(t,n,a,m);if(y)throw new Fn(y);return new pn(t/255*m,n/255*m,a/255*m,m)}function uu(e,t){return e in t}function wr(e,t){const n=t[e];return void 0===n?null:n}function zs(e){return{type:e}}Do.register(qa,{error:[{kind:"error"},[hi],(e,[t])=>{throw new Fn(t.evaluate(e))}],typeof:[hi,[ai],(e,[t])=>Ui(_n(t.evaluate(e)))],"to-rgba":[qn(xe,4),[$s],(e,[t])=>t.evaluate(e).toArray()],rgb:[$s,[xe,xe,xe],Bc],rgba:[$s,[xe,xe,xe,xe],Bc],has:{type:si,overloads:[[[hi],(e,[t])=>uu(t.evaluate(e),e.properties())],[[hi,Ko],(e,[t,n])=>uu(t.evaluate(e),n.evaluate(e))]]},get:{type:ai,overloads:[[[hi],(e,[t])=>wr(t.evaluate(e),e.properties())],[[hi,Ko],(e,[t,n])=>wr(t.evaluate(e),n.evaluate(e))]]},"feature-state":[ai,[hi],(e,[t])=>wr(t.evaluate(e),e.featureState||{})],properties:[Ko,[],e=>e.properties()],"geometry-type":[hi,[],e=>e.geometryType()],id:[ai,[],e=>e.id()],zoom:[xe,[],e=>e.globals.zoom],pitch:[xe,[],e=>e.globals.pitch||0],"distance-from-center":[xe,[],e=>e.distanceFromCenter()],"heatmap-density":[xe,[],e=>e.globals.heatmapDensity||0],"line-progress":[xe,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[xe,[],e=>e.globals.skyRadialProgress||0],accumulated:[ai,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[xe,zs(xe),(e,t)=>{let n=0;for(const a of t)n+=a.evaluate(e);return n}],"*":[xe,zs(xe),(e,t)=>{let n=1;for(const a of t)n*=a.evaluate(e);return n}],"-":{type:xe,overloads:[[[xe,xe],(e,[t,n])=>t.evaluate(e)-n.evaluate(e)],[[xe],(e,[t])=>-t.evaluate(e)]]},"/":[xe,[xe,xe],(e,[t,n])=>t.evaluate(e)/n.evaluate(e)],"%":[xe,[xe,xe],(e,[t,n])=>t.evaluate(e)%n.evaluate(e)],ln2:[xe,[],()=>Math.LN2],pi:[xe,[],()=>Math.PI],e:[xe,[],()=>Math.E],"^":[xe,[xe,xe],(e,[t,n])=>Math.pow(t.evaluate(e),n.evaluate(e))],sqrt:[xe,[xe],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[xe,[xe],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[xe,[xe],(e,[t])=>Math.log(t.evaluate(e))],log2:[xe,[xe],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[xe,[xe],(e,[t])=>Math.sin(t.evaluate(e))],cos:[xe,[xe],(e,[t])=>Math.cos(t.evaluate(e))],tan:[xe,[xe],(e,[t])=>Math.tan(t.evaluate(e))],asin:[xe,[xe],(e,[t])=>Math.asin(t.evaluate(e))],acos:[xe,[xe],(e,[t])=>Math.acos(t.evaluate(e))],atan:[xe,[xe],(e,[t])=>Math.atan(t.evaluate(e))],min:[xe,zs(xe),(e,t)=>Math.min(...t.map(n=>n.evaluate(e)))],max:[xe,zs(xe),(e,t)=>Math.max(...t.map(n=>n.evaluate(e)))],abs:[xe,[xe],(e,[t])=>Math.abs(t.evaluate(e))],round:[xe,[xe],(e,[t])=>{const n=t.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[xe,[xe],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[xe,[xe],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[si,[hi,ai],(e,[t,n])=>e.properties()[t.value]===n.value],"filter-id-==":[si,[ai],(e,[t])=>e.id()===t.value],"filter-type-==":[si,[hi],(e,[t])=>e.geometryType()===t.value],"filter-<":[si,[hi,ai],(e,[t,n])=>{const a=e.properties()[t.value],u=n.value;return typeof a==typeof u&&a<u}],"filter-id-<":[si,[ai],(e,[t])=>{const n=e.id(),a=t.value;return typeof n==typeof a&&n<a}],"filter->":[si,[hi,ai],(e,[t,n])=>{const a=e.properties()[t.value],u=n.value;return typeof a==typeof u&&a>u}],"filter-id->":[si,[ai],(e,[t])=>{const n=e.id(),a=t.value;return typeof n==typeof a&&n>a}],"filter-<=":[si,[hi,ai],(e,[t,n])=>{const a=e.properties()[t.value],u=n.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[si,[ai],(e,[t])=>{const n=e.id(),a=t.value;return typeof n==typeof a&&n<=a}],"filter->=":[si,[hi,ai],(e,[t,n])=>{const a=e.properties()[t.value],u=n.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[si,[ai],(e,[t])=>{const n=e.id(),a=t.value;return typeof n==typeof a&&n>=a}],"filter-has":[si,[ai],(e,[t])=>t.value in e.properties()],"filter-has-id":[si,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[si,[qn(hi)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[si,[qn(ai)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[si,[hi,qn(ai)],(e,[t,n])=>n.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[si,[hi,qn(ai)],(e,[t,n])=>function(a,u,m,y){for(;m<=y;){const b=m+y>>1;if(u[b]===a)return!0;u[b]>a?y=b-1:m=b+1}return!1}(e.properties()[t.value],n.value,0,n.value.length-1)],all:{type:si,overloads:[[[si,si],(e,[t,n])=>t.evaluate(e)&&n.evaluate(e)],[zs(si),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:si,overloads:[[[si,si],(e,[t,n])=>t.evaluate(e)||n.evaluate(e)],[zs(si),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[si,[si],(e,[t])=>!t.evaluate(e)],"is-supported-script":[si,[hi],(e,[t])=>{const n=e.globals&&e.globals.isSupportedScript;return!n||n(t.evaluate(e))}],upcase:[hi,[hi],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[hi,[hi],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[hi,zs(ai),(e,t)=>t.map(n=>za(n.evaluate(e))).join("")],"resolved-locale":[hi,[Yr],(e,[t])=>t.evaluate(e).resolvedLocale()]});var ua=qa;function Vl(e){return{result:"success",value:e}}function Tr(e){return{result:"error",value:e}}function da(e){return"data-driven"===e["property-type"]}function Lo(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Ws(e){return!!e.expression&&e.expression.interpolated}function pi(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function sr(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function or(e){return e}function jl(e,t){const n="color"===t.type,a=e.stops&&"object"==typeof e.stops[0][0],u=a||!(a||void 0!==e.property),m=e.type||(Ws(t)?"exponential":"interval");if(n&&((e=ws({},e)).stops&&(e.stops=e.stops.map(M=>[M[0],pn.parse(M[1])])),e.default=pn.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!ru[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let y,b,S;if("exponential"===m)y=Zl;else if("interval"===m)y=tn;else if("categorical"===m){y=Qi,b=Object.create(null);for(const M of e.stops)b[M[0]]=M[1];S=typeof e.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);y=$a}if(a){const M={},k=[];for(let B=0;B<e.stops.length;B++){const F=e.stops[B],j=F[0].zoom;void 0===M[j]&&(M[j]={zoom:j,type:e.type,property:e.property,default:e.default,stops:[]},k.push(j)),M[j].stops.push([F[0].value,F[1]])}const I=[];for(const B of k)I.push([M[B].zoom,jl(M[B],t)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:co.interpolationFactor.bind(void 0,L),zoomStops:I.map(B=>B[0]),evaluate:({zoom:B},F)=>Zl({stops:I,base:e.base},t,B).evaluate(B,F)}}if(u){const M="exponential"===m?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:co.interpolationFactor.bind(void 0,M),zoomStops:e.stops.map(k=>k[0]),evaluate:({zoom:k})=>y(e,t,k,b,S)}}return{kind:"source",evaluate(M,k){const I=k&&k.properties?k.properties[e.property]:void 0;return void 0===I?Ha(e.default,t.default):y(e,t,I,b,S)}}}function Ha(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function Qi(e,t,n,a,u){return Ha(typeof n===u?a[n]:void 0,e.default,t.default)}function tn(e,t,n){if("number"!==pi(n))return Ha(e.default,t.default);const a=e.stops.length;if(1===a||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[a-1][0])return e.stops[a-1][1];const u=Io(e.stops.map(m=>m[0]),n);return e.stops[u][1]}function Zl(e,t,n){const a=void 0!==e.base?e.base:1;if("number"!==pi(n))return Ha(e.default,t.default);const u=e.stops.length;if(1===u||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[u-1][0])return e.stops[u-1][1];const m=Io(e.stops.map(k=>k[0]),n),y=function(k,I,L,B){const F=B-L,j=k-L;return 0===F?0:1===I?j/F:(Math.pow(I,j)-1)/(Math.pow(I,F)-1)}(n,a,e.stops[m][0],e.stops[m+1][0]),b=e.stops[m][1],S=e.stops[m+1][1];let M=Va[t.type]||or;if(e.colorSpace&&"rgb"!==e.colorSpace){const k=ru[e.colorSpace];M=(I,L)=>k.reverse(k.interpolate(k.forward(I),k.forward(L),y))}return"function"==typeof b.evaluate?{evaluate(...k){const I=b.evaluate.apply(void 0,k),L=S.evaluate.apply(void 0,k);if(void 0!==I&&void 0!==L)return M(I,L,y)}}:M(b,S,y)}function $a(e,t,n){return"color"===t.type?n=pn.parse(n):"formatted"===t.type?n=Ss.fromString(n.toString()):"resolvedImage"===t.type?n=Jn.fromString(n.toString()):pi(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),Ha(n,e.default,t.default)}class Gl{constructor(t,n){var a;this.expression=t,this._warningHistory={},this._evaluator=new Fa,this._defaultValue=n?"color"===(a=n).type&&(sr(a.default)||Array.isArray(a.default))?new pn(0,0,0,0):"color"===a.type?pn.parse(a.default)||null:void 0===a.default?null:a.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(t,n,a,u,m,y,b,S){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(t,n,a,u,m,y,b,S){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=S||null;try{const M=this.expression.evaluate(this._evaluator);if(null==M||"number"==typeof M&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Fn(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function $i(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in ua}function Os(e,t){const n=new Il(ua,[],t?function(u){const m={color:$s,string:hi,number:xe,enum:hi,boolean:si,formatted:La,resolvedImage:Jr};return"array"===u.type?qn(m[u.value]||ai,u.length):m[u.type]}(t):void 0),a=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return a?Vl(new Gl(a,t)):Tr(n.errors)}class Wa{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent="constant"!==t&&!Ms(n.expression)}evaluateWithoutErrorHandling(t,n,a,u,m,y){return this._styleExpression.evaluateWithoutErrorHandling(t,n,a,u,m,y)}evaluate(t,n,a,u,m,y){return this._styleExpression.evaluate(t,n,a,u,m,y)}}class us{constructor(t,n,a,u){this.kind=t,this.zoomStops=a,this._styleExpression=n,this.isStateDependent="camera"!==t&&!Ms(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(t,n,a,u,m,y){return this._styleExpression.evaluateWithoutErrorHandling(t,n,a,u,m,y)}evaluate(t,n,a,u,m,y){return this._styleExpression.evaluate(t,n,a,u,m,y)}interpolationFactor(t,n,a){return this.interpolationType?co.interpolationFactor(this.interpolationType,t,n,a):0}}function Hn(e,t){if("error"===(e=Os(e,t)).result)return e;const n=e.value.expression,a=ao(n);if(!a&&!da(t))return Tr([new Hs("","data expressions not supported")]);const u=tr(n,["zoom","pitch","distance-from-center"]);if(!u&&!Lo(t))return Tr([new Hs("","zoom expressions not supported")]);const m=pa(n);return m||u?m instanceof Hs?Tr([m]):m instanceof co&&!Ws(t)?Tr([new Hs("",'"interpolate" expressions cannot be used with this property')]):Vl(m?new us(a?"camera":"composite",e.value,m.labels,m instanceof co?m.interpolation:void 0):new Wa(a?"constant":"source",e.value)):Tr([new Hs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ro{constructor(t,n){this._parameters=t,this._specification=n,ws(this,jl(this._parameters,this._specification))}static deserialize(t){return new Ro(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function pa(e){let t=null;if(e instanceof Rc)t=pa(e.result);else if(e instanceof au){for(const n of e.args)if(t=pa(n),t)break}else(e instanceof Pc||e instanceof co)&&e.input instanceof Do&&"zoom"===e.input.name&&(t=e);return t instanceof Hs||e.eachChild(n=>{const a=pa(n);a instanceof Hs?t=a:!t&&a?t=new Hs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new Hs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class Te{constructor(t,n,a,u){this.message=(t?`${t}: `:"")+a,u&&(this.identifier=u),null!=n&&n.__line__&&(this.line=n.__line__)}}function Un(e){const t=e.key,n=e.value,a=e.valueSpec||{},u=e.objectElementValidators||{},m=e.style,y=e.styleSpec;let b=[];const S=pi(n);if("object"!==S)return[new Te(t,n,`object expected, ${S} found`)];for(const M in n){const k=M.split(".")[0];let L;u[k]?L=u[k]:a[k]?L=Cn:u["*"]?L=u["*"]:a["*"]&&(L=Cn),L?b=b.concat(L({key:(t&&`${t}.`)+M,value:n[M],valueSpec:a[k]||a["*"],style:m,styleSpec:y,object:n,objectKey:M},n)):b.push(new Te(t,n[M],`unknown property "${M}"`))}for(const M in a)u[M]||a[M].required&&void 0===a[M].default&&void 0===n[M]&&b.push(new Te(t,n,`missing required property "${M}"`));return b}function du(e){const t=e.value,n=e.valueSpec,a=e.style,u=e.styleSpec,m=e.key,y=e.arrayElementValidator||Cn;if("array"!==pi(t))return[new Te(m,t,`array expected, ${pi(t)} found`)];if(n.length&&t.length!==n.length)return[new Te(m,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Te(m,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let b={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};u.$version<7&&(b.function=n.function),"object"===pi(n.value)&&(b=n.value);let S=[];for(let M=0;M<t.length;M++)S=S.concat(y({array:t,arrayIndex:M,value:t[M],valueSpec:b,style:a,styleSpec:u,key:`${m}[${M}]`}));return S}function ql(e){const t=e.key,n=e.value,a=e.valueSpec;let u=pi(n);if("number"===u&&n!=n&&(u="NaN"),"number"!==u)return[new Te(t,n,`number expected, ${u} found`)];if("minimum"in a){let m=a.minimum;if("array"===pi(a.minimum)&&(m=a.minimum[e.arrayIndex]),n<m)return[new Te(t,n,`${n} is less than the minimum value ${m}`)]}if("maximum"in a){let m=a.maximum;if("array"===pi(a.maximum)&&(m=a.maximum[e.arrayIndex]),n>m)return[new Te(t,n,`${n} is greater than the maximum value ${m}`)]}return[]}function Qn(e){const t=e.valueSpec,n=gn(e.value.type);let a,u,m,y={};const b="categorical"!==n&&void 0===e.value.property,S=!b,M="array"===pi(e.value.stops)&&"array"===pi(e.value.stops[0])&&"object"===pi(e.value.stops[0][0]),k=Un({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(B){if("identity"===n)return[new Te(B.key,B.value,'identity function may not have a "stops" property')];let F=[];const j=B.value;return F=F.concat(du({key:B.key,value:j,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:I})),"array"===pi(j)&&0===j.length&&F.push(new Te(B.key,j,"array must have at least one stop")),F},default:function(B){return Cn({key:B.key,value:B.value,valueSpec:t,style:B.style,styleSpec:B.styleSpec})}}});return"identity"===n&&b&&k.push(new Te(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||k.push(new Te(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!Ws(e.valueSpec)&&k.push(new Te(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(S&&!da(e.valueSpec)?k.push(new Te(e.key,e.value,"property functions not supported")):b&&!Lo(e.valueSpec)&&k.push(new Te(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!M||void 0!==e.value.property||k.push(new Te(e.key,e.value,'"property" property is required')),k;function I(B){let F=[];const j=B.value,$=B.key;if("array"!==pi(j))return[new Te($,j,`array expected, ${pi(j)} found`)];if(2!==j.length)return[new Te($,j,`array length 2 expected, length ${j.length} found`)];if(M){if("object"!==pi(j[0]))return[new Te($,j,`object expected, ${pi(j[0])} found`)];if(void 0===j[0].zoom)return[new Te($,j,"object stop key must have zoom")];if(void 0===j[0].value)return[new Te($,j,"object stop key must have value")];const nt=gn(j[0].zoom);if("number"!=typeof nt)return[new Te($,j[0].zoom,"stop zoom values must be numbers")];if(m&&m>nt)return[new Te($,j[0].zoom,"stop zoom values must appear in ascending order")];nt!==m&&(m=nt,u=void 0,y={}),F=F.concat(Un({key:`${$}[0]`,value:j[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:ql,value:L}}))}else F=F.concat(L({key:`${$}[0]`,value:j[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},j));return $i(Eo(j[1]))?F.concat([new Te(`${$}[1]`,j[1],"expressions are not allowed in function stops.")]):F.concat(Cn({key:`${$}[1]`,value:j[1],valueSpec:t,style:B.style,styleSpec:B.styleSpec}))}function L(B,F){const j=pi(B.value),$=gn(B.value),nt=null!==B.value?B.value:F;if(a){if(j!==a)return[new Te(B.key,nt,`${j} stop domain type must match previous stop domain type ${a}`)]}else a=j;if("number"!==j&&"string"!==j&&"boolean"!==j&&"number"!=typeof $&&"string"!=typeof $&&"boolean"!=typeof $)return[new Te(B.key,nt,"stop domain value must be a number, string, or boolean")];if("number"!==j&&"categorical"!==n){let ht=`number expected, ${j} found`;return da(t)&&void 0===n&&(ht+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Te(B.key,nt,ht)]}return"categorical"!==n||"number"!==j||"number"==typeof $&&isFinite($)&&Math.floor($)===$?"categorical"!==n&&"number"===j&&"number"==typeof $&&"number"==typeof u&&void 0!==u&&$<u?[new Te(B.key,nt,"stop domain values must appear in ascending order")]:(u=$,"categorical"===n&&$ in y?[new Te(B.key,nt,"stop domain values must be unique")]:(y[$]=!0,[])):[new Te(B.key,nt,`integer expected, found ${String($)}`)]}}function rr(e){const t=("property"===e.expressionContext?Hn:Os)(Eo(e.value),e.valueSpec);if("error"===t.result)return t.value.map(a=>new Te(`${e.key}${a.key}`,e.value,a.message));const n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new Te(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Ms(n))return[new Te(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return Fc(n,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!tr(n,["zoom","feature-state"]))return[new Te(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!ao(n))return[new Te(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fc(e,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const u of t.valueSpec.expression.parameters)n.delete(u);if(0===n.size)return[];const a=[];return e instanceof Do&&n.has(e.name)?[new Te(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild(u=>{a.push(...Fc(u,t))}),a)}function Xa(e){const t=e.key,n=e.value,a=e.valueSpec,u=[];return Array.isArray(a.values)?-1===a.values.indexOf(gn(n))&&u.push(new Te(t,n,`expected one of [${a.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(a.values).indexOf(gn(n))&&u.push(new Te(t,n,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function Ya(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Ya(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Hl(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ya(e)||(e=Bs(e));const n=e;let a=!0;try{a=function(M){if(!Mi(M))return M;let k=Eo(M);return zo(k),k=Nn(k),k}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const u=Ht[`filter_${t}`],m=Os(a,u);let y=null;if("error"===m.result)throw new Error(m.value.map(M=>`${M.key}: ${M.message}`).join(", "));y=(M,k,I)=>m.value.evaluate(M,k,{},I);let b=null,S=null;if(a!==n){const M=Os(n,u);if("error"===M.result)throw new Error(M.value.map(k=>`${k.key}: ${k.message}`).join(", "));b=(k,I,L,B,F)=>M.value.evaluate(k,I,{},L,void 0,void 0,B,F),S=!ao(M.value.expression)}return{filter:y,dynamicFilter:b||void 0,needGeometry:Wl(a),needFeature:!!S}}function Nn(e){if(!Array.isArray(e))return e;const t=function(n){if($l.has(n[0]))for(let a=1;a<n.length;a++)if(Mi(n[a]))return!0;return n}(e);return!0===t?t:t.map(n=>Nn(n))}function zo(e){let t=!1;const n=[];if("case"===e[0]){for(let a=1;a<e.length-1;a+=2)t=t||Mi(e[a]),n.push(e[a+1]);n.push(e[e.length-1])}else if("match"===e[0]){t=t||Mi(e[1]);for(let a=2;a<e.length-1;a+=2)n.push(e[a+1]);n.push(e[e.length-1])}else if("step"===e[0]){t=t||Mi(e[1]);for(let a=1;a<e.length-1;a+=2)n.push(e[a+1])}t&&(e.length=0,e.push("any",...n));for(let a=1;a<e.length;a++)zo(e[a])}function Mi(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let n=1;n<e.length;n++)if(Mi(e[n]))return!0;return!1}const $l=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Oo(e,t){return e<t?-1:e>t?1:0}function Wl(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let t=1;t<e.length;t++)if(Wl(e[t]))return!0;return!1}function Bs(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Uc(e[1],e[2],"=="):"!="===t?fa(Uc(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Uc(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(Bs))):"all"===t?["all"].concat(e.slice(1).map(Bs)):"none"===t?["all"].concat(e.slice(1).map(Bs).map(fa)):"in"===t?Xl(e[1],e.slice(2)):"!in"===t?fa(Xl(e[1],e.slice(2))):"has"===t?Nc(e[1]):"!has"===t?fa(Nc(e[1])):"within"!==t||e;var n}function Uc(e,t,n){switch(e){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,e,t]}}function Xl(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",e,["literal",t.sort(Oo)]]:["filter-in-small",e,["literal",t]]}}function Nc(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function fa(e){return["!",e]}function Yl(e){return Ya(Eo(e.value))?rr(ws({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):Vc(e)}function Vc(e){const t=e.value,n=e.key;if("array"!==pi(t))return[new Te(n,t,`array expected, ${pi(t)} found`)];const a=e.styleSpec;let u,m=[];if(t.length<1)return[new Te(n,t,"filter array must have at least 1 element")];switch(m=m.concat(Xa({key:`${n}[0]`,value:t[0],valueSpec:a.filter_operator,style:e.style,styleSpec:e.styleSpec})),gn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===gn(t[1])&&m.push(new Te(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&m.push(new Te(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=pi(t[1]),"string"!==u&&m.push(new Te(`${n}[1]`,t[1],`string expected, ${u} found`)));for(let y=2;y<t.length;y++)u=pi(t[y]),"$type"===gn(t[1])?m=m.concat(Xa({key:`${n}[${y}]`,value:t[y],valueSpec:a.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&m.push(new Te(`${n}[${y}]`,t[y],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)m=m.concat(Vc({key:`${n}[${y}]`,value:t[y],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":u=pi(t[1]),2!==t.length?m.push(new Te(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==u&&m.push(new Te(`${n}[1]`,t[1],`string expected, ${u} found`));break;case"within":u=pi(t[1]),2!==t.length?m.push(new Te(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==u&&m.push(new Te(`${n}[1]`,t[1],`object expected, ${u} found`))}return m}function jc(e,t){const n=e.key,a=e.style,u=e.styleSpec,m=e.value,y=e.objectKey,b=u[`${t}_${e.layerType}`];if(!b)return[];const S=y.match(/^(.*)-transition$/);if("paint"===t&&S&&b[S[1]]&&b[S[1]].transition)return Cn({key:n,value:m,valueSpec:u.transition,style:a,styleSpec:u});const M=e.valueSpec||b[y];if(!M)return[new Te(n,m,`unknown property "${y}"`)];let k;if("string"===pi(m)&&da(M)&&!M.tokens&&(k=/^{([^}]+)}$/.exec(m)))return[new Te(n,m,`"${y}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const I=[];return"symbol"===e.layerType&&("text-field"===y&&a&&!a.glyphs&&I.push(new Te(n,m,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&sr(Eo(m))&&"identity"===gn(m.type)&&I.push(new Te(n,m,'"text-font" does not support identity functions'))),I.concat(Cn({key:e.key,value:m,valueSpec:M,style:a,styleSpec:u,expressionContext:"property",propertyType:t,propertyKey:y}))}function Zc(e){return jc(e,"paint")}function Jl(e){return jc(e,"layout")}function Gc(e){let t=[];const n=e.value,a=e.key,u=e.style,m=e.styleSpec;n.type||n.ref||t.push(new Te(a,n,'either "type" or "ref" is required'));let y=gn(n.type);const b=gn(n.ref);if(n.id){const S=gn(n.id);for(let M=0;M<e.arrayIndex;M++){const k=u.layers[M];gn(k.id)===S&&t.push(new Te(a,n.id,`duplicate layer id "${n.id}", previously used at line ${k.id.__line__}`))}}if("ref"in n){let S;["type","source","source-layer","filter","layout"].forEach(M=>{M in n&&t.push(new Te(a,n[M],`"${M}" is prohibited for ref layers`))}),u.layers.forEach(M=>{gn(M.id)===b&&(S=M)}),S?S.ref?t.push(new Te(a,n.ref,"ref cannot reference another ref layer")):y=gn(S.type):"string"==typeof b&&t.push(new Te(a,n.ref,`ref layer "${b}" not found`))}else if("background"!==y&&"sky"!==y)if(n.source){const S=u.sources&&u.sources[n.source],M=S&&gn(S.type);S?"vector"===M&&"raster"===y?t.push(new Te(a,n.source,`layer "${n.id}" requires a raster source`)):"raster"===M&&"raster"!==y?t.push(new Te(a,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==M||n["source-layer"]?"raster-dem"===M&&"hillshade"!==y?t.push(new Te(a,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===M&&S.lineMetrics||t.push(new Te(a,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Te(a,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Te(a,n.source,`source "${n.source}" not found`))}else t.push(new Te(a,n,'missing required property "source"'));return t=t.concat(Un({key:a,value:n,valueSpec:m.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Cn({key:`${a}.type`,value:n.type,valueSpec:m.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"}),filter:S=>Yl(ws({layerType:y},S)),layout:S=>Un({layer:n,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":M=>Jl(ws({layerType:y},M))}}),paint:S=>Un({layer:n,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":M=>Zc(ws({layerType:y},M))}})}})),t}function ar(e){const t=e.value,n=e.key,a=pi(t);return"string"!==a?[new Te(n,t,`string expected, ${a} found`)]:[]}const kn={promoteId:function({key:e,value:t}){if("string"===pi(t))return ar({key:e,value:t});{const n=[];for(const a in t)n.push(...ar({key:`${e}.${a}`,value:t[a]}));return n}}};function Ja(e){const t=e.value,n=e.key,a=e.styleSpec,u=e.style;if(!t.type)return[new Te(n,t,'"type" is required')];const m=gn(t.type);let y;switch(m){case"vector":case"raster":case"raster-dem":return y=Un({key:n,value:t,valueSpec:a[`source_${m.replace("-","_")}`],style:e.style,styleSpec:a,objectElementValidators:kn}),y;case"geojson":if(y=Un({key:n,value:t,valueSpec:a.source_geojson,style:u,styleSpec:a,objectElementValidators:kn}),t.cluster)for(const b in t.clusterProperties){const[S,M]=t.clusterProperties[b],k="string"==typeof S?[S,["accumulated"],["get",b]]:S;y.push(...rr({key:`${n}.${b}.map`,value:M,expressionContext:"cluster-map"})),y.push(...rr({key:`${n}.${b}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return y;case"video":return Un({key:n,value:t,valueSpec:a.source_video,style:u,styleSpec:a});case"image":return Un({key:n,value:t,valueSpec:a.source_image,style:u,styleSpec:a});case"canvas":return[new Te(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xa({key:`${n}.type`,value:t.type,valueSpec:{values:qc(a)},style:u,styleSpec:a})}}function qc(e){return e.source.reduce((t,n)=>{const a=e[n];return"enum"===a.type.type&&(t=t.concat(Object.keys(a.type.values))),t},[])}function Hc(e){const t=e.value,n=e.styleSpec,a=n.light,u=e.style;let m=[];const y=pi(t);if(void 0===t)return m;if("object"!==y)return m=m.concat([new Te("light",t,`object expected, ${y} found`)]),m;for(const b in t){const S=b.match(/^(.*)-transition$/);m=m.concat(S&&a[S[1]]&&a[S[1]].transition?Cn({key:b,value:t[b],valueSpec:n.transition,style:u,styleSpec:n}):a[b]?Cn({key:b,value:t[b],valueSpec:a[b],style:u,styleSpec:n}):[new Te(b,t[b],`unknown property "${b}"`)])}return m}function ma(e){const t=e.value,n=e.key,a=e.style,u=e.styleSpec,m=u.terrain;let y=[];const b=pi(t);if(void 0===t)return y;if("object"!==b)return y=y.concat([new Te("terrain",t,`object expected, ${b} found`)]),y;for(const S in t){const M=S.match(/^(.*)-transition$/);y=y.concat(M&&m[M[1]]&&m[M[1]].transition?Cn({key:S,value:t[S],valueSpec:u.transition,style:a,styleSpec:u}):m[S]?Cn({key:S,value:t[S],valueSpec:m[S],style:a,styleSpec:u}):[new Te(S,t[S],`unknown property "${S}"`)])}if(t.source){const S=a.sources&&a.sources[t.source],M=S&&gn(S.type);S?"raster-dem"!==M&&y.push(new Te(n,t.source,`terrain cannot be used with a source of type ${String(M)}, it only be used with a "raster-dem" source type`)):y.push(new Te(n,t.source,`source "${t.source}" not found`))}else y.push(new Te(n,t,'terrain is missing required property "source"'));return y}function $c(e){const t=e.value,n=e.style,a=e.styleSpec,u=a.fog;let m=[];const y=pi(t);if(void 0===t)return m;if("object"!==y)return m=m.concat([new Te("fog",t,`object expected, ${y} found`)]),m;for(const b in t){const S=b.match(/^(.*)-transition$/);m=m.concat(S&&u[S[1]]&&u[S[1]].transition?Cn({key:b,value:t[b],valueSpec:a.transition,style:n,styleSpec:a}):u[b]?Cn({key:b,value:t[b],valueSpec:u[b],style:n,styleSpec:a}):[new Te(b,t[b],`unknown property "${b}"`)])}return m}const Ka={"*":()=>[],array:du,boolean:function(e){const t=e.value,n=e.key,a=pi(t);return"boolean"!==a?[new Te(n,t,`boolean expected, ${a} found`)]:[]},number:ql,color:function(e){const t=e.key,n=e.value,a=pi(n);return"string"!==a?[new Te(t,n,`color expected, ${a} found`)]:null===Cc(n)?[new Te(t,n,`color expected, "${n}" found`)]:[]},enum:Xa,filter:Yl,function:Qn,layer:Gc,object:Un,source:Ja,light:Hc,terrain:ma,fog:$c,string:ar,formatted:function(e){return 0===ar(e).length?[]:rr(e)},resolvedImage:function(e){return 0===ar(e).length?[]:rr(e)},projection:function(e){const t=e.value,n=e.styleSpec,a=n.projection,u=e.style;let m=[];const y=pi(t);if("object"===y)for(const b in t)m=m.concat(Cn({key:b,value:t[b],valueSpec:a[b],style:u,styleSpec:n}));else"string"!==y&&(m=m.concat([new Te("projection",t,`object or string expected, ${y} found`)]));return m}};function Cn(e){const t=e.value,n=e.valueSpec,a=e.styleSpec;return n.expression&&sr(gn(t))?Qn(e):n.expression&&$i(Eo(t))?rr(e):n.type&&Ka[n.type]?Ka[n.type](e):Un(ws({},e,{valueSpec:n.type?a[n.type]:n}))}function Wc(e){const t=e.value,n=e.key,a=ar(e);return a.length||(-1===t.indexOf("{fontstack}")&&a.push(new Te(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&a.push(new Te(n,t,'"glyphs" url must include a "{range}" token'))),a}function Xc(e,t=Ht){return Bo(Cn({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Wc,"*":()=>[]}}))}const Yc=e=>Bo(Zc(e)),pu=e=>Bo(Jl(e));function Bo(e){return e.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function fu(e,t){let n=!1;if(t&&t.length)for(const a of t)e.fire(new Yo(new Error(a.message))),n=!0;return n}var ga=Xs;function Xs(e,t,n){var a=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var u=new Int32Array(this.arrayBuffer);e=u[0],this.d=(t=u[1])+2*(n=u[2]);for(var m=0;m<this.d*this.d;m++){var y=u[3+m],b=u[3+m+1];a.push(y===b?null:u.subarray(y,b))}var S=u[3+a.length+1];this.keys=u.subarray(u[3+a.length],S),this.bboxes=u.subarray(S),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var M=0;M<this.d*this.d;M++)a.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var k=n/t*e;this.min=-k,this.max=e+k}Xs.prototype.insert=function(e,t,n,a,u){this._forEachCell(t,n,a,u,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(u)},Xs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Xs.prototype._insertCell=function(e,t,n,a,u,m){this.cells[u].push(m)},Xs.prototype.query=function(e,t,n,a,u){var m=this.min,y=this.max;if(e<=m&&t<=m&&y<=n&&y<=a&&!u)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(e,t,n,a,this._queryCell,b,{},u),b},Xs.prototype._queryCell=function(e,t,n,a,u,m,y,b){var S=this.cells[u];if(null!==S)for(var M=this.keys,k=this.bboxes,I=0;I<S.length;I++){var L=S[I];if(void 0===y[L]){var B=4*L;(b?b(k[B+0],k[B+1],k[B+2],k[B+3]):e<=k[B+2]&&t<=k[B+3]&&n>=k[B+0]&&a>=k[B+1])?(y[L]=!0,m.push(M[L])):y[L]=!1}}},Xs.prototype._forEachCell=function(e,t,n,a,u,m,y,b){for(var S=this._convertToCellCoord(e),M=this._convertToCellCoord(t),k=this._convertToCellCoord(n),I=this._convertToCellCoord(a),L=S;L<=k;L++)for(var B=M;B<=I;B++){var F=this.d*B+L;if((!b||b(this._convertFromCellCoord(L),this._convertFromCellCoord(B),this._convertFromCellCoord(L+1),this._convertFromCellCoord(B+1)))&&u.call(this,e,t,n,a,F,m,y,b))return}},Xs.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Xs.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Xs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,n=0,a=0;a<this.cells.length;a++)n+=this.cells[a].length;var u=new Int32Array(t+n+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var m=t,y=0;y<e.length;y++){var b=e[y];u[3+y]=m,u.set(b,m),m+=b.length}return u[3+e.length]=m,u.set(this.keys,m),u[3+e.length+1]=m+=this.keys.length,u.set(this.bboxes,m),m+=this.bboxes.length,u.buffer};const Kl={};function De(e,t,n={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Kl[t]={klass:e,omit:n.omit||[]}}De(Object,"Object"),ga.serialize=function(e,t){const n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}},ga.deserialize=function(e){return new ga(e.buffer)},Object.defineProperty(ga,"name",{value:"Grid"}),De(ga,"Grid"),De(pn,"Color"),De(Error,"Error"),De(vs,"AJAXError"),De(Jn,"ResolvedImage"),De(Ro,"StylePropertyFunction"),De(Gl,"StyleExpression",{omit:["_evaluator"]}),De(us,"ZoomDependentExpression"),De(Wa,"ZoomConstantExpression"),De(Do,"CompoundExpression",{omit:["_evaluate"]});for(const e in ua)Kl[ua[e]._classRegistryKey]||De(ua[e],`Expression${e}`);function Jc(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Qa(e){return p.ImageBitmap&&e instanceof p.ImageBitmap}function lr(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Jc(e)||Qa(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const n=e;return t&&t.push(n.buffer),n}if(e instanceof p.ImageData)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const a of e)n.push(lr(a,t));return n}if("object"==typeof e){const n=e.constructor,a=n._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const u=n.serialize?n.serialize(e,t):{};if(!n.serialize){for(const m in e)e.hasOwnProperty(m)&&(Kl[a].omit.indexOf(m)>=0||(u[m]=lr(e[m],t)));e instanceof Error&&(u.message=e.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==a&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof e)}function tl(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Jc(e)||Qa(e)||ArrayBuffer.isView(e)||e instanceof p.ImageData)return e;if(Array.isArray(e))return e.map(tl);if("object"==typeof e){const t=e.$name||"Object",{klass:n}=Kl[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(e);const a=Object.create(n.prototype);for(const u of Object.keys(e))"$name"!==u&&(a[u]=tl(e[u]));return a}throw new Error("can't deserialize object of type "+typeof e)}const Ys=e=>e>=1536&&e<=1791,Ql=e=>e>=1872&&e<=1919,Sr=e=>e>=2208&&e<=2303,tc=e=>e>=11904&&e<=12031,Kc=e=>e>=12032&&e<=12255,hn=e=>e>=12272&&e<=12287,el=e=>e>=12288&&e<=12351,Cr=e=>e>=12352&&e<=12447,_a=e=>e>=12448&&e<=12543,ho=e=>e>=12544&&e<=12591,Qc=e=>e>=12704&&e<=12735,ec=e=>e>=12736&&e<=12783,ic=e=>e>=12784&&e<=12799,uo=e=>e>=12800&&e<=13055,il=e=>e>=13056&&e<=13311,nl=e=>e>=13312&&e<=19903,th=e=>e>=19968&&e<=40959,mu=e=>e>=40960&&e<=42127,gu=e=>e>=42128&&e<=42191,_u=e=>e>=44032&&e<=55215,yu=e=>e>=63744&&e<=64255,po=e=>e>=64336&&e<=65023,Fo=e=>e>=65040&&e<=65055,f=e=>e>=65072&&e<=65103,s=e=>e>=65104&&e<=65135,h=e=>e>=65136&&e<=65279,g=e=>e>=65280&&e<=65519;function v(e){for(const t of e)if(A(t.charCodeAt(0)))return!0;return!1}function w(e){for(const t of e)if(!E(t.charCodeAt(0)))return!1;return!0}function E(e){return!(Ys(e)||Ql(e)||Sr(e)||po(e)||h(e))}function A(e){return!(746!==e&&747!==e&&(e<4352||!(Qc(e)||ho(e)||f(e)&&!(e>=65097&&e<=65103)||yu(e)||il(e)||tc(e)||ec(e)||!(!el(e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||nl(e)||th(e)||uo(e)||(t=e,t>=12592&&t<=12687)||(t=>t>=43360&&t<=43391)(e)||(t=>t>=55216&&t<=55295)(e)||(t=>t>=4352&&t<=4607)(e)||_u(e)||Cr(e)||hn(e)||(t=>t>=12688&&t<=12703)(e)||Kc(e)||ic(e)||_a(e)&&12540!==e||!(!g(e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!s(e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||(t=>t>=5120&&t<=5759)(e)||(t=>t>=6320&&t<=6399)(e)||Fo(e)||(t=>t>=19904&&t<=19967)(e)||mu(e)||gu(e))));var t}function P(e){return!(A(e)||(t=e,(n=t)>=128&&n<=255&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(n=>n>=8192&&n<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(n=>n>=8448&&n<=8527)(t)||(n=>n>=8528&&n<=8591)(t)||(n=>n>=8960&&n<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(n=>n>=9216&&n<=9279)(t)&&9251!==t||(n=>n>=9280&&n<=9311)(t)||(n=>n>=9312&&n<=9471)(t)||(n=>n>=9632&&n<=9727)(t)||(n=>n>=9728&&n<=9983)(t)&&!(t>=9754&&t<=9759)||(n=>n>=11008&&n<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||el(t)||_a(t)||(n=>n>=57344&&n<=63743)(t)||f(t)||s(t)||g(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t,n}function z(e){return e>=1424&&e<=2303||po(e)||h(e)}function O(e,t){return!(!t&&z(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||(n=e,n>=6016&&n<=6143));var n}function U(e){for(const t of e)if(z(t.charCodeAt(0)))return!0;return!1}const q="deferred",W="loading",X="loaded";let Y=null,J="unavailable",G=null;const st=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(J="error"),Y&&Y(e)};function it(){rt.fire(new Ii("pluginStateChange",{pluginStatus:J,pluginURL:G}))}const rt=new Jo,pt=function(){return J},dt=function(){if(J!==q||!G)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");J=W,it(),G&&bs({url:G},e=>{e?st(e):(J=X,it())})},xt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>J===X||null!=xt.applyArabicShaping,isLoading:()=>J===W,setState(e){J=e.pluginStatus,G=e.pluginURL},isParsed:()=>null!=xt.applyArabicShaping&&null!=xt.processBidirectionalText&&null!=xt.processStyledBidirectionalText,getPluginURL:()=>G};class Et{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(t){return function(n,a){for(const u of n)if(!O(u.charCodeAt(0),a))return!1;return!0}(t,xt.isLoaded())}}class Lt{constructor(t,n){this.property=t,this.value=n,this.expression=function(a,u){if(sr(a))return new Ro(a,u);if($i(a)){const m=Hn(a,u);if("error"===m.result)throw new Error(m.value.map(y=>`${y.key}: ${y.message}`).join(", "));return m.value}{let m=a;return"string"==typeof a&&"color"===u.type&&(m=pn.parse(a)),{kind:"constant",evaluate:()=>m}}}(void 0===n?t.specification.default:n,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,n,a){return this.property.possiblyEvaluate(this,t,n,a)}}class Bt{constructor(t){this.property=t,this.value=new Lt(t,void 0)}transitioned(t,n){return new Pt(this.property,this.value,n,ni({},t.transition,this.transition),t.now)}untransitioned(){return new Pt(this.property,this.value,null,{},0)}}class fe{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return mn(this._values[t].value.value)}setValue(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new Bt(this._values[t].property)),this._values[t].value=new Lt(this._values[t].property,null===n?void 0:mn(n))}getTransition(t){return mn(this._values[t].transition)}setTransition(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new Bt(this._values[t].property)),this._values[t].transition=mn(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const a=this.getValue(n);void 0!==a&&(t[n]=a);const u=this.getTransition(n);void 0!==u&&(t[`${n}-transition`]=u)}return t}transitioned(t,n){const a=new Yt(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(t,n._values[u]);return a}untransitioned(){const t=new Yt(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class Pt{constructor(t,n,a,u,m){const y=u.delay||0,b=u.duration||0;m=m||0,this.property=t,this.value=n,this.begin=m+y,this.end=this.begin+b,t.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(t,n,a){const u=t.now||0,m=this.value.possiblyEvaluate(t,n,a),y=this.prior;if(y){if(u>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(u<this.begin)return y.possiblyEvaluate(t,n,a);{const b=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(t,n,a),m,Qe(b))}}return m}}class Yt{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,a){const u=new Ot(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].possiblyEvaluate(t,n,a);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Vt{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return mn(this._values[t].value)}setValue(t,n){this._values[t]=new Lt(this._values[t].property,null===n?void 0:mn(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const a=this.getValue(n);void 0!==a&&(t[n]=a)}return t}possiblyEvaluate(t,n,a){const u=new Ot(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].possiblyEvaluate(t,n,a);return u}}class ne{constructor(t,n,a){this.property=t,this.value=n,this.parameters=a}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,n,a,u){return this.property.evaluate(this.value,this.parameters,t,n,a,u)}}class Ot{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class wt{constructor(t){this.specification=t}possiblyEvaluate(t,n){return t.expression.evaluate(n)}interpolate(t,n,a){const u=Va[this.specification.type];return u?u(t,n,a):t}}class Nt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,a,u){return new ne(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(n,null,{},a,u)}:t.expression,n)}interpolate(t,n,a){if("constant"!==t.value.kind||"constant"!==n.value.kind)return t;if(void 0===t.value.value||void 0===n.value.value)return new ne(this,{kind:"constant",value:void 0},t.parameters);const u=Va[this.specification.type];return u?new ne(this,{kind:"constant",value:u(t.value.value,n.value.value,a)},t.parameters):t}evaluate(t,n,a,u,m,y){return"constant"===t.kind?t.value:t.evaluate(n,a,u,m,y)}}class ee{constructor(t){this.specification=t}possiblyEvaluate(t,n,a,u){return!!t.expression.evaluate(n,null,{},a,u)}interpolate(){return!1}}class se{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Et(0,{});for(const a in t){const u=t[a];u.specification.overridable&&this.overridableProperties.push(a);const m=this.defaultPropertyValues[a]=new Lt(u,void 0),y=this.defaultTransitionablePropertyValues[a]=new Bt(u);this.defaultTransitioningPropertyValues[a]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=m.possiblyEvaluate(n)}}}function Be(e,t){return 256*(e=Je(Math.floor(e),0,255))+Je(Math.floor(t),0,255)}De(Nt,"DataDrivenProperty"),De(wt,"DataConstantProperty"),De(ee,"ColorRampProperty");const ii={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ie{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ee{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ue(e,t=1){let n=0,a=0;return{members:e.map(u=>{const m=ii[u.type].BYTES_PER_ELEMENT,y=n=ri(n,Math.max(t,m)),b=u.components||1;return a=Math.max(a,m),n+=m*b,{name:u.name,type:u.type,components:b,offset:y}}),size:ri(n,Math.max(a,t)),alignment:t}}function ri(e,t){return Math.ceil(e/t)*t}class je extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const u=2*t;return this.int16[u+0]=n,this.int16[u+1]=a,t}}je.prototype.bytesPerElement=4,De(je,"StructArrayLayout2i4");class xi extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,a)}emplace(t,n,a,u){const m=3*t;return this.int16[m+0]=n,this.int16[m+1]=a,this.int16[m+2]=u,t}}xi.prototype.bytesPerElement=6,De(xi,"StructArrayLayout3i6");class Ei extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,a,u)}emplace(t,n,a,u,m){const y=4*t;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=u,this.int16[y+3]=m,t}}Ei.prototype.bytesPerElement=8,De(Ei,"StructArrayLayout4i8");class Ni extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,u,m,y,b){const S=this.length;return this.resize(S+1),this.emplace(S,t,n,a,u,m,y,b)}emplace(t,n,a,u,m,y,b,S){const M=6*t,k=12*t,I=3*t;return this.int16[M+0]=n,this.int16[M+1]=a,this.uint8[k+4]=u,this.uint8[k+5]=m,this.uint8[k+6]=y,this.uint8[k+7]=b,this.float32[I+2]=S,t}}Ni.prototype.bytesPerElement=12,De(Ni,"StructArrayLayout2i4ub1f12");class zi extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,a,u)}emplace(t,n,a,u,m){const y=4*t;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=u,this.float32[y+3]=m,t}}zi.prototype.bytesPerElement=16,De(zi,"StructArrayLayout4f16");class Wi extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,u,m)}emplace(t,n,a,u,m,y){const b=6*t,S=3*t;return this.uint16[b+0]=n,this.uint16[b+1]=a,this.uint16[b+2]=u,this.uint16[b+3]=m,this.float32[S+2]=y,t}}Wi.prototype.bytesPerElement=12,De(Wi,"StructArrayLayout4ui1f12");class ds extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,a,u)}emplace(t,n,a,u,m){const y=4*t;return this.uint16[y+0]=n,this.uint16[y+1]=a,this.uint16[y+2]=u,this.uint16[y+3]=m,t}}ds.prototype.bytesPerElement=8,De(ds,"StructArrayLayout4ui8");class Js extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,u,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,t,n,a,u,m,y)}emplace(t,n,a,u,m,y,b){const S=6*t;return this.int16[S+0]=n,this.int16[S+1]=a,this.int16[S+2]=u,this.int16[S+3]=m,this.int16[S+4]=y,this.int16[S+5]=b,t}}Js.prototype.bytesPerElement=12,De(Js,"StructArrayLayout6i12");class ts extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,u,m,y,b,S,M,k,I,L){const B=this.length;return this.resize(B+1),this.emplace(B,t,n,a,u,m,y,b,S,M,k,I,L)}emplace(t,n,a,u,m,y,b,S,M,k,I,L,B){const F=12*t;return this.int16[F+0]=n,this.int16[F+1]=a,this.int16[F+2]=u,this.int16[F+3]=m,this.uint16[F+4]=y,this.uint16[F+5]=b,this.uint16[F+6]=S,this.uint16[F+7]=M,this.int16[F+8]=k,this.int16[F+9]=I,this.int16[F+10]=L,this.int16[F+11]=B,t}}ts.prototype.bytesPerElement=24,De(ts,"StructArrayLayout4i4ui4i24");class Xi extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,u,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,t,n,a,u,m,y)}emplace(t,n,a,u,m,y,b){const S=10*t,M=5*t;return this.int16[S+0]=n,this.int16[S+1]=a,this.int16[S+2]=u,this.float32[M+2]=m,this.float32[M+3]=y,this.float32[M+4]=b,t}}Xi.prototype.bytesPerElement=20,De(Xi,"StructArrayLayout3i3f20");class Di extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}Di.prototype.bytesPerElement=4,De(Di,"StructArrayLayout1ul4");class wi extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,u,m,y,b,S,M,k,I,L,B){const F=this.length;return this.resize(F+1),this.emplace(F,t,n,a,u,m,y,b,S,M,k,I,L,B)}emplace(t,n,a,u,m,y,b,S,M,k,I,L,B,F){const j=20*t,$=10*t;return this.int16[j+0]=n,this.int16[j+1]=a,this.int16[j+2]=u,this.int16[j+3]=m,this.int16[j+4]=y,this.float32[$+3]=b,this.float32[$+4]=S,this.float32[$+5]=M,this.float32[$+6]=k,this.int16[j+14]=I,this.uint32[$+8]=L,this.uint16[j+18]=B,this.uint16[j+19]=F,t}}wi.prototype.bytesPerElement=40,De(wi,"StructArrayLayout5i4f1i1ul2ui40");class un extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,u,m,y,b){const S=this.length;return this.resize(S+1),this.emplace(S,t,n,a,u,m,y,b)}emplace(t,n,a,u,m,y,b,S){const M=8*t;return this.int16[M+0]=n,this.int16[M+1]=a,this.int16[M+2]=u,this.int16[M+4]=m,this.int16[M+5]=y,this.int16[M+6]=b,this.int16[M+7]=S,t}}un.prototype.bytesPerElement=16,De(un,"StructArrayLayout3i2i2i16");class $n extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,u,m)}emplace(t,n,a,u,m,y){const b=4*t,S=8*t;return this.float32[b+0]=n,this.float32[b+1]=a,this.float32[b+2]=u,this.int16[S+6]=m,this.int16[S+7]=y,t}}$n.prototype.bytesPerElement=16,De($n,"StructArrayLayout2f1f2i16");class Vi extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,a,u)}emplace(t,n,a,u,m){const y=12*t,b=3*t;return this.uint8[y+0]=n,this.uint8[y+1]=a,this.float32[b+1]=u,this.float32[b+2]=m,t}}Vi.prototype.bytesPerElement=12,De(Vi,"StructArrayLayout2ub2f12");class xn extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,a)}emplace(t,n,a,u){const m=3*t;return this.float32[m+0]=n,this.float32[m+1]=a,this.float32[m+2]=u,t}}xn.prototype.bytesPerElement=12,De(xn,"StructArrayLayout3f12");class Wn extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,a)}emplace(t,n,a,u){const m=3*t;return this.uint16[m+0]=n,this.uint16[m+1]=a,this.uint16[m+2]=u,t}}Wn.prototype.bytesPerElement=6,De(Wn,"StructArrayLayout3ui6");class cr extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,a,u,m,y,b,S,M,k,I,L,B,F,j,$,nt,ht,tt,at,ft){const ut=this.length;return this.resize(ut+1),this.emplace(ut,t,n,a,u,m,y,b,S,M,k,I,L,B,F,j,$,nt,ht,tt,at,ft)}emplace(t,n,a,u,m,y,b,S,M,k,I,L,B,F,j,$,nt,ht,tt,at,ft,ut){const Ft=30*t,Rt=15*t,Wt=60*t;return this.int16[Ft+0]=n,this.int16[Ft+1]=a,this.int16[Ft+2]=u,this.float32[Rt+2]=m,this.float32[Rt+3]=y,this.uint16[Ft+8]=b,this.uint16[Ft+9]=S,this.uint32[Rt+5]=M,this.uint32[Rt+6]=k,this.uint32[Rt+7]=I,this.uint16[Ft+16]=L,this.uint16[Ft+17]=B,this.uint16[Ft+18]=F,this.float32[Rt+10]=j,this.float32[Rt+11]=$,this.uint8[Wt+48]=nt,this.uint8[Wt+49]=ht,this.uint8[Wt+50]=tt,this.uint32[Rt+13]=at,this.int16[Ft+28]=ft,this.uint8[Wt+58]=ut,t}}cr.prototype.bytesPerElement=60,De(cr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ya extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,a,u,m,y,b,S,M,k,I,L,B,F,j,$,nt,ht,tt,at,ft,ut,Ft,Rt,Wt,he,jt,Kt,te,oe){const ue=this.length;return this.resize(ue+1),this.emplace(ue,t,n,a,u,m,y,b,S,M,k,I,L,B,F,j,$,nt,ht,tt,at,ft,ut,Ft,Rt,Wt,he,jt,Kt,te,oe)}emplace(t,n,a,u,m,y,b,S,M,k,I,L,B,F,j,$,nt,ht,tt,at,ft,ut,Ft,Rt,Wt,he,jt,Kt,te,oe,ue){const Gt=38*t,ve=19*t;return this.int16[Gt+0]=n,this.int16[Gt+1]=a,this.int16[Gt+2]=u,this.float32[ve+2]=m,this.float32[ve+3]=y,this.int16[Gt+8]=b,this.int16[Gt+9]=S,this.int16[Gt+10]=M,this.int16[Gt+11]=k,this.int16[Gt+12]=I,this.int16[Gt+13]=L,this.uint16[Gt+14]=B,this.uint16[Gt+15]=F,this.uint16[Gt+16]=j,this.uint16[Gt+17]=$,this.uint16[Gt+18]=nt,this.uint16[Gt+19]=ht,this.uint16[Gt+20]=tt,this.uint16[Gt+21]=at,this.uint16[Gt+22]=ft,this.uint16[Gt+23]=ut,this.uint16[Gt+24]=Ft,this.uint16[Gt+25]=Rt,this.uint16[Gt+26]=Wt,this.uint16[Gt+27]=he,this.uint16[Gt+28]=jt,this.uint32[ve+15]=Kt,this.float32[ve+16]=te,this.float32[ve+17]=oe,this.float32[ve+18]=ue,t}}ya.prototype.bytesPerElement=76,De(ya,"StructArrayLayout3i2f6i15ui1ul3f76");class Es extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Es.prototype.bytesPerElement=4,De(Es,"StructArrayLayout1f4");class Vn extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,u,m)}emplace(t,n,a,u,m,y){const b=5*t;return this.float32[b+0]=n,this.float32[b+1]=a,this.float32[b+2]=u,this.float32[b+3]=m,this.float32[b+4]=y,t}}Vn.prototype.bytesPerElement=20,De(Vn,"StructArrayLayout5f20");class fo extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,a,u)}emplace(t,n,a,u,m){const y=6*t;return this.uint32[3*t+0]=n,this.uint16[y+2]=a,this.uint16[y+3]=u,this.uint16[y+4]=m,t}}fo.prototype.bytesPerElement=12,De(fo,"StructArrayLayout1ul3ui12");class Uo extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const u=2*t;return this.uint16[u+0]=n,this.uint16[u+1]=a,t}}Uo.prototype.bytesPerElement=4,De(Uo,"StructArrayLayout2ui4");class No extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}No.prototype.bytesPerElement=2,De(No,"StructArrayLayout1ui2");class Mr extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const u=2*t;return this.float32[u+0]=n,this.float32[u+1]=a,t}}Mr.prototype.bytesPerElement=8,De(Mr,"StructArrayLayout2f8");class Cp extends Ie{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Cp.prototype.size=40;class xu extends wi{get(t){return new Cp(this,t)}}De(xu,"CollisionBoxArray");class xd extends Ie{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}xd.prototype.size=60;class Mp extends cr{get(t){return new xd(this,t)}}De(Mp,"PlacedSymbolArray");class Ep extends Ie{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Ep.prototype.size=76;class Ap extends ya{get(t){return new Ep(this,t)}}De(Ap,"SymbolInstanceArray");class vd extends Es{getoffsetX(t){return this.float32[1*t+0]}}De(vd,"GlyphOffsetArray");class kp extends je{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}De(kp,"SymbolLineVertexArray");class bd extends Ie{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}bd.prototype.size=12;class Dp extends fo{get(t){return new bd(this,t)}}De(Dp,"FeatureIndexArray");class Pp extends Uo{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}De(Pp,"FillExtrusionCentroidArray");const Er=Ue([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ip=Ue([{name:"a_dash",components:4,type:"Uint16"}]);var sl={},fm={get exports(){return sl},set exports(e){sl=e}},vu={};({get exports(){return vu},set exports(e){vu=e}}).exports=function(e,t){var n,a,u,m,y,b,S,M;for(a=e.length-(n=3&e.length),u=t,y=3432918353,b=461845907,M=0;M<a;)S=255&e.charCodeAt(M)|(255&e.charCodeAt(++M))<<8|(255&e.charCodeAt(++M))<<16|(255&e.charCodeAt(++M))<<24,++M,u=27492+(65535&(m=5*(65535&(u=(u^=S=(65535&(S=(S=(65535&S)*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(S=0,n){case 3:S^=(255&e.charCodeAt(M+2))<<16;case 2:S^=(255&e.charCodeAt(M+1))<<8;case 1:u^=S=(65535&(S=(S=(65535&(S^=255&e.charCodeAt(M)))*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var wd={};({get exports(){return wd},set exports(e){wd=e}}).exports=function(e,t){for(var n,a=e.length,u=t^a,m=0;a>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(m)|(255&e.charCodeAt(++m))<<8|(255&e.charCodeAt(++m))<<16|(255&e.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++m;switch(a){case 3:u^=(255&e.charCodeAt(m+2))<<16;case 2:u^=(255&e.charCodeAt(m+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(m)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var Lp=vu,Rp=wd;fm.exports=Lp,sl.murmur3=Lp,sl.murmur2=Rp;class bu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,a,u){this.ids.push(zp(t)),this.positions.push(n,a,u)}getPositions(t){const n=zp(t);let a=0,u=this.ids.length-1;for(;a<u;){const y=a+u>>1;this.ids[y]>=n?u=y:a=y+1}const m=[];for(;this.ids[a]===n;)m.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return m}static serialize(t,n){const a=new Float64Array(t.ids),u=new Uint32Array(t.positions);return wu(a,u,0,a.length-1),n&&n.push(a.buffer,u.buffer),{ids:a,positions:u}}static deserialize(t){const n=new bu;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function zp(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:sl(String(e))}function wu(e,t,n,a){for(;n<a;){const u=e[n+a>>1];let m=n-1,y=a+1;for(;;){do{m++}while(e[m]<u);do{y--}while(e[y]>u);if(m>=y)break;eh(e,m,y),eh(t,3*m,3*y),eh(t,3*m+1,3*y+1),eh(t,3*m+2,3*y+2)}y-n<a-y?(wu(e,t,n,y),n=y+1):(wu(e,t,y+1,a),a=y)}}function eh(e,t,n){const a=e[t];e[t]=e[n],e[n]=a}De(bu,"FeaturePositionMap");class Ar{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,n),this.initialized=!0),!!this.location}}class ih extends Ar{constructor(t){super(t),this.current=0}set(t,n,a){this.fetchUniformLocation(t,n)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Op extends Ar{constructor(t){super(t),this.current=[0,0,0,0]}set(t,n,a){this.fetchUniformLocation(t,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class Bp extends Ar{constructor(t){super(t),this.current=pn.transparent}set(t,n,a){this.fetchUniformLocation(t,n)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const mm=new Float32Array(16),Fp=new Float32Array(9),Up=new Float32Array(4);function nh(e){return[Be(255*e.r,255*e.g),Be(255*e.b,255*e.a)]}class sh{constructor(t,n,a){this.value=t,this.uniformNames=n.map(u=>`u_${u}`),this.type=a}setUniform(t,n,a,u,m){n.set(t,m,u.constantOr(this.value))}getBinding(t,n){return"color"===this.type?new Bp(t):new ih(t)}}class nc{constructor(t,n){this.uniformNames=n.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,n,a,u,m){const y="u_pattern"===m||"u_dash"===m?this.pattern:"u_pixel_ratio"===m?this.pixelRatio:null;y&&n.set(t,m,y)}getBinding(t,n){return"u_pattern"===n||"u_dash"===n?new Op(t):new ih(t)}}class Ks{constructor(t,n,a,u){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===a?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,n,a,u,m,y){const b=this.paintVertexArray.length,S=this.expression.evaluate(new Et(0),n,{},m,u,y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)}updatePaintArray(t,n,a,u,m){const y=this.expression.evaluate({zoom:0},a,u,void 0,m);this._setPaintValue(t,n,y)}_setPaintValue(t,n,a){if("color"===this.type){const u=nh(a);for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,u[0],u[1])}else{for(let u=t;u<n;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qs{constructor(t,n,a,u,m,y){this.expression=t,this.uniformNames=n.map(b=>`u_${b}_t`),this.type=a,this.useIntegerZoom=u,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===a?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(t,n,a,u,m,y){const b=this.expression.evaluate(new Et(this.zoom),n,{},m,u,y),S=this.expression.evaluate(new Et(this.zoom+1),n,{},m,u,y),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,b,S)}updatePaintArray(t,n,a,u,m){const y=this.expression.evaluate({zoom:this.zoom},a,u,void 0,m),b=this.expression.evaluate({zoom:this.zoom+1},a,u,void 0,m);this._setPaintValue(t,n,y,b)}_setPaintValue(t,n,a,u){if("color"===this.type){const m=nh(a),y=nh(u);for(let b=t;b<n;b++)this.paintVertexArray.emplace(b,m[0],m[1],y[0],y[1])}else{for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n,a,u,m){const y=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,b=Je(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);n.set(t,m,b)}getBinding(t,n){return new ih(t)}}class kr{constructor(t,n,a,u,m){this.expression=t,this.layerId=m,this.paintVertexAttributes=("array"===a?Ip:Er).members;for(let y=0;y<n.length;++y);this.paintVertexArray=new u}populatePaintArray(t,n,a){const u=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(u,t,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(t,n,a,u,m,y){this._setPaintValues(t,n,a.patterns&&a.patterns[this.layerId],y)}_setPaintValues(t,n,a,u){if(!u||!a)return;const m=u[a];if(!m)return;const{tl:y,br:b,pixelRatio:S}=m;for(let M=t;M<n;M++)this.paintVertexArray.emplace(M,y[0],y[1],b[0],b[1],S)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xa{constructor(t,n,a=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const m in t.paint._values){if(!a(m))continue;const y=t.paint.get(m);if(!(y instanceof ne&&da(y.property.specification)))continue;const b=_m(m,t.type),S=y.value,M=y.property.specification.type,k=y.property.useIntegerZoom,I="line-dasharray"===m||m.endsWith("pattern"),L="line-dasharray"===m&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==S.kind||L)if("source"===S.kind||L||I){const B=Np(m,M,"source");this.binders[m]=I?new kr(S,b,M,B,t.id):new Ks(S,b,M,B),u.push(`/a_${m}`)}else{const B=Np(m,M,"composite");this.binders[m]=new Qs(S,b,M,k,n,B),u.push(`/z_${m}`)}else this.binders[m]=I?new nc(S.value,b):new sh(S.value,b,M),u.push(`/u_${m}`)}this.cacheKey=u.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Ks||n instanceof Qs?n.maxValue:0}populatePaintArrays(t,n,a,u,m,y){for(const b in this.binders){const S=this.binders[b];(S instanceof Ks||S instanceof Qs||S instanceof kr)&&S.populatePaintArray(t,n,a,u,m,y)}}setConstantPatternPositions(t){for(const n in this.binders){const a=this.binders[n];a instanceof nc&&a.setConstantPatternPositions(t)}}updatePaintArrays(t,n,a,u,m,y){let b=!1;for(const S in t){const M=n.getPositions(S);for(const k of M){const I=a.feature(k.index);for(const L in this.binders){const B=this.binders[L];if((B instanceof Ks||B instanceof Qs||B instanceof kr)&&!0===B.expression.isStateDependent){const F=u.paint.get(L);B.expression=F.value,B.updatePaintArray(k.start,k.end,I,t[S],m,y),b=!0}}}}return b}defines(){const t=[];for(const n in this.binders){const a=this.binders[n];(a instanceof sh||a instanceof nc)&&t.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Ks||a instanceof Qs||a instanceof kr)for(let u=0;u<a.paintVertexAttributes.length;u++)t.push(a.paintVertexAttributes[u].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof sh||a instanceof nc||a instanceof Qs)for(const u of a.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const n=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof sh||u instanceof nc||u instanceof Qs)for(const m of u.uniformNames)n.push({name:m,property:a,binding:u.getBinding(t,m)})}return n}setUniforms(t,n,a,u,m){for(const{name:y,property:b,binding:S}of a)this.binders[b].setUniform(t,S,m,u.get(b),y)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const n=this.binders[t];(n instanceof Ks||n instanceof Qs||n instanceof kr)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(const n in this.binders){const a=this.binders[n];(a instanceof Ks||a instanceof Qs||a instanceof kr)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Ks||n instanceof Qs||n instanceof kr)&&n.destroy()}}}class Fs{constructor(t,n,a=(()=>!0)){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new xa(u,n,a);this.needsUpload=!1,this._featureMap=new bu,this._bufferOffset=0}populatePaintArrays(t,n,a,u,m,y,b){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,n,u,m,y,b);void 0!==n.id&&this._featureMap.add(n.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,a,u,m){for(const y of a)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(t,this._featureMap,n,y,u,m)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const gm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function _m(e,t){return gm[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const ym={"line-pattern":{source:Wi,composite:Wi},"fill-pattern":{source:Wi,composite:Wi},"fill-extrusion-pattern":{source:Wi,composite:Wi},"line-dasharray":{source:ds,composite:ds}},xm={color:{source:Mr,composite:zi},number:{source:Es,composite:Mr}};function Np(e,t,n){const a=ym[e];return a&&a[n]||xm[t][n]}De(sh,"ConstantBinder"),De(nc,"PatternConstantBinder"),De(Ks,"SourceExpressionBinder"),De(kr,"PatternCompositeBinder"),De(Qs,"CompositeExpressionBinder"),De(xa,"ProgramConfiguration",{omit:["_buffers"]}),De(Fs,"ProgramConfigurationSet");const oh="-transition";class mo extends Jo{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new Vt(n.layout)),n.paint)){this._transitionablePaint=new fe(n.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ot(n.paint)}}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,a={}){null!=n&&this._validate(pu,`layers.${this.id}.layout.${t}`,t,n,a)||("visibility"!==t?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return js(t,oh)?this._transitionablePaint.getTransition(t.slice(0,-oh.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,a={}){if(null!=n&&this._validate(Yc,`layers.${this.id}.paint.${t}`,t,n,a))return!1;if(js(t,oh))return this._transitionablePaint.setTransition(t.slice(0,-oh.length),n||void 0),!1;{const u=this._transitionablePaint._values[t],m=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value,S=b.isDataDriven(),M=js(t,"pattern")||"line-dasharray"===t;return S||m||M||this._handleOverridablePaintPropertyUpdate(t,y,b)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,n,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Hi(t,(n,a)=>!(void 0===n||"layout"===a&&!Object.keys(n).length||"paint"===a&&!Object.keys(n).length))}_validate(t,n,a,u,m={}){return(!m||!1!==m.validate)&&fu(this,t.call(Xc,{key:n,layerType:this.type,objectKey:a,value:u,styleSpec:Ht,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof ne&&da(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Hl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Td=Ue([{name:"a_pos",components:2,type:"Int16"}],4),vm=Ue([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class bn{constructor(t=[]){this.segments=t}prepareSegment(t,n,a,u){let m=this.segments[this.segments.length-1];return t>bn.MAX_VERTEX_ARRAY_LENGTH&&on(`Max vertices per segment is ${bn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!m||m.vertexLength+t>bn.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==u)&&(m={vertexOffset:n.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},void 0!==u&&(m.sortKey=u),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,a,u){return new bn([{vertexOffset:t,primitiveOffset:n,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}bn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,De(bn,"SegmentVector");var Xe=8192;class Dr{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof vi?new vi(t.lng,t.lat):vi.convert(t),this}setSouthWest(t){return this._sw=t instanceof vi?new vi(t.lng,t.lat):vi.convert(t),this}extend(t){const n=this._sw,a=this._ne;let u,m;if(t instanceof vi)u=t,m=t;else{if(!(t instanceof Dr))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Dr.convert(t)):this.extend(vi.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&t.hasOwnProperty("lon")?this.extend(vi.convert(t)):this;if(u=t._sw,m=t._ne,!u||!m)return this}return n||a?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),a.lng=Math.max(m.lng,a.lng),a.lat=Math.max(m.lat,a.lat)):(this._sw=new vi(u.lng,u.lat),this._ne=new vi(m.lng,m.lat)),this}getCenter(){return new vi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new vi(this.getWest(),this.getNorth())}getSouthEast(){return new vi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:a}=vi.convert(t);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(t){return!t||t instanceof Dr?t:new Dr(t)}}var Tu=1e-6,As=typeof Float32Array<"u"?Float32Array:Array;function Vp(){var e=new As(9);return As!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function jp(e,t,n){var a=t[0],u=t[1],m=t[2],y=t[3],b=t[4],S=t[5],M=t[6],k=t[7],I=t[8],L=n[0],B=n[1],F=n[2],j=n[3],$=n[4],nt=n[5],ht=n[6],tt=n[7],at=n[8];return e[0]=L*a+B*y+F*M,e[1]=L*u+B*b+F*k,e[2]=L*m+B*S+F*I,e[3]=j*a+$*y+nt*M,e[4]=j*u+$*b+nt*k,e[5]=j*m+$*S+nt*I,e[6]=ht*a+tt*y+at*M,e[7]=ht*u+tt*b+at*k,e[8]=ht*m+tt*S+at*I,e}function Vo(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Sd(e,t){var n=t[0],a=t[1],u=t[2],m=t[3],y=t[4],b=t[5],S=t[6],M=t[7],k=t[8],I=t[9],L=t[10],B=t[11],F=t[12],j=t[13],$=t[14],nt=t[15],ht=n*b-a*y,tt=n*S-u*y,at=n*M-m*y,ft=a*S-u*b,ut=a*M-m*b,Ft=u*M-m*S,Rt=k*j-I*F,Wt=k*$-L*F,he=k*nt-B*F,jt=I*$-L*j,Kt=I*nt-B*j,te=L*nt-B*$,oe=ht*te-tt*Kt+at*jt+ft*he-ut*Wt+Ft*Rt;return oe?(e[0]=(b*te-S*Kt+M*jt)*(oe=1/oe),e[1]=(u*Kt-a*te-m*jt)*oe,e[2]=(j*Ft-$*ut+nt*ft)*oe,e[3]=(L*ut-I*Ft-B*ft)*oe,e[4]=(S*he-y*te-M*Wt)*oe,e[5]=(n*te-u*he+m*Wt)*oe,e[6]=($*at-F*Ft-nt*tt)*oe,e[7]=(k*Ft-L*at+B*tt)*oe,e[8]=(y*Kt-b*he+M*Rt)*oe,e[9]=(a*he-n*Kt-m*Rt)*oe,e[10]=(F*ut-j*at+nt*ht)*oe,e[11]=(I*at-k*ut-B*ht)*oe,e[12]=(b*Wt-y*jt-S*Rt)*oe,e[13]=(n*jt-a*Wt+u*Rt)*oe,e[14]=(j*tt-F*ft-$*ht)*oe,e[15]=(k*ft-I*tt+L*ht)*oe,e):null}function Pr(e,t,n){var a=t[0],u=t[1],m=t[2],y=t[3],b=t[4],S=t[5],M=t[6],k=t[7],I=t[8],L=t[9],B=t[10],F=t[11],j=t[12],$=t[13],nt=t[14],ht=t[15],tt=n[0],at=n[1],ft=n[2],ut=n[3];return e[0]=tt*a+at*b+ft*I+ut*j,e[1]=tt*u+at*S+ft*L+ut*$,e[2]=tt*m+at*M+ft*B+ut*nt,e[3]=tt*y+at*k+ft*F+ut*ht,e[4]=(tt=n[4])*a+(at=n[5])*b+(ft=n[6])*I+(ut=n[7])*j,e[5]=tt*u+at*S+ft*L+ut*$,e[6]=tt*m+at*M+ft*B+ut*nt,e[7]=tt*y+at*k+ft*F+ut*ht,e[8]=(tt=n[8])*a+(at=n[9])*b+(ft=n[10])*I+(ut=n[11])*j,e[9]=tt*u+at*S+ft*L+ut*$,e[10]=tt*m+at*M+ft*B+ut*nt,e[11]=tt*y+at*k+ft*F+ut*ht,e[12]=(tt=n[12])*a+(at=n[13])*b+(ft=n[14])*I+(ut=n[15])*j,e[13]=tt*u+at*S+ft*L+ut*$,e[14]=tt*m+at*M+ft*B+ut*nt,e[15]=tt*y+at*k+ft*F+ut*ht,e}function rh(e,t,n){var a,u,m,y,b,S,M,k,I,L,B,F,j=n[0],$=n[1],nt=n[2];return t===e?(e[12]=t[0]*j+t[4]*$+t[8]*nt+t[12],e[13]=t[1]*j+t[5]*$+t[9]*nt+t[13],e[14]=t[2]*j+t[6]*$+t[10]*nt+t[14],e[15]=t[3]*j+t[7]*$+t[11]*nt+t[15]):(u=t[1],m=t[2],y=t[3],b=t[4],S=t[5],M=t[6],k=t[7],I=t[8],L=t[9],B=t[10],F=t[11],e[0]=a=t[0],e[1]=u,e[2]=m,e[3]=y,e[4]=b,e[5]=S,e[6]=M,e[7]=k,e[8]=I,e[9]=L,e[10]=B,e[11]=F,e[12]=a*j+b*$+I*nt+t[12],e[13]=u*j+S*$+L*nt+t[13],e[14]=m*j+M*$+B*nt+t[14],e[15]=y*j+k*$+F*nt+t[15]),e}function va(e,t,n){var a=n[0],u=n[1],m=n[2];return e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e[3]=t[3]*a,e[4]=t[4]*u,e[5]=t[5]*u,e[6]=t[6]*u,e[7]=t[7]*u,e[8]=t[8]*m,e[9]=t[9]*m,e[10]=t[10]*m,e[11]=t[11]*m,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Zp(e,t,n){var a=Math.sin(n),u=Math.cos(n),m=t[4],y=t[5],b=t[6],S=t[7],M=t[8],k=t[9],I=t[10],L=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=m*u+M*a,e[5]=y*u+k*a,e[6]=b*u+I*a,e[7]=S*u+L*a,e[8]=M*u-m*a,e[9]=k*u-y*a,e[10]=I*u-b*a,e[11]=L*u-S*a,e}function Cd(e,t,n){var a=Math.sin(n),u=Math.cos(n),m=t[0],y=t[1],b=t[2],S=t[3],M=t[8],k=t[9],I=t[10],L=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=m*u-M*a,e[1]=y*u-k*a,e[2]=b*u-I*a,e[3]=S*u-L*a,e[8]=m*a+M*u,e[9]=y*a+k*u,e[10]=b*a+I*u,e[11]=S*a+L*u,e}function bm(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Gp(e,t,n){var a,u,m,y=n[0],b=n[1],S=n[2],M=Math.hypot(y,b,S);return M<Tu?null:(y*=M=1/M,b*=M,S*=M,a=Math.sin(t),u=Math.cos(t),e[0]=y*y*(m=1-u)+u,e[1]=b*y*m+S*a,e[2]=S*y*m-b*a,e[3]=0,e[4]=y*b*m-S*a,e[5]=b*b*m+u,e[6]=S*b*m+y*a,e[7]=0,e[8]=y*S*m+b*a,e[9]=b*S*m-y*a,e[10]=S*S*m+u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ol=Pr;function ah(){var e=new As(3);return As!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function qp(e){var t=new As(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function lh(e){return Math.hypot(e[0],e[1],e[2])}function hr(e,t,n){var a=new As(3);return a[0]=e,a[1]=t,a[2]=n,a}function Ir(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function ch(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Hp(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function hh(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function rl(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function Us(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function uh(e,t,n,a){return e[0]=t[0]+n[0]*a,e[1]=t[1]+n[1]*a,e[2]=t[2]+n[2]*a,e}function es(e,t){var n=t[0],a=t[1],u=t[2],m=n*n+a*a+u*u;return m>0&&(m=1/Math.sqrt(m)),e[0]=t[0]*m,e[1]=t[1]*m,e[2]=t[2]*m,e}function ps(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Su(e,t,n){var a=t[0],u=t[1],m=t[2],y=n[0],b=n[1],S=n[2];return e[0]=u*S-m*b,e[1]=m*y-a*S,e[2]=a*b-u*y,e}function en(e,t,n){var a=t[0],u=t[1],m=t[2],y=n[3]*a+n[7]*u+n[11]*m+n[15];return e[0]=(n[0]*a+n[4]*u+n[8]*m+n[12])/(y=y||1),e[1]=(n[1]*a+n[5]*u+n[9]*m+n[13])/y,e[2]=(n[2]*a+n[6]*u+n[10]*m+n[14])/y,e}function $p(e,t,n){var a=n[0],u=n[1],m=n[2],y=t[0],b=t[1],S=t[2],M=u*S-m*b,k=m*y-a*S,I=a*b-u*y,L=u*I-m*k,B=m*M-a*I,F=a*k-u*M,j=2*n[3];return k*=j,I*=j,B*=2,F*=2,e[0]=y+(M*=j)+(L*=2),e[1]=b+k+B,e[2]=S+I+F,e}var dh,jo=ch,wm=Hp,Wp=lh;function Md(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Xp(e,t){var n=t[0],a=t[1],u=t[2],m=t[3],y=n*n+a*a+u*u+m*m;return y>0&&(y=1/Math.sqrt(y)),e[0]=n*y,e[1]=a*y,e[2]=u*y,e[3]=m*y,e}function al(e,t,n){var a=t[0],u=t[1],m=t[2],y=t[3];return e[0]=n[0]*a+n[4]*u+n[8]*m+n[12]*y,e[1]=n[1]*a+n[5]*u+n[9]*m+n[13]*y,e[2]=n[2]*a+n[6]*u+n[10]*m+n[14]*y,e[3]=n[3]*a+n[7]*u+n[11]*m+n[15]*y,e}function Yp(){var e=new As(4);return As!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function sc(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function ph(e,t,n){n*=.5;var a=t[0],u=t[1],m=t[2],y=t[3],b=Math.sin(n),S=Math.cos(n);return e[0]=a*S+y*b,e[1]=u*S+m*b,e[2]=m*S-u*b,e[3]=y*S-a*b,e}function Ed(e,t,n){n*=.5;var a=t[0],u=t[1],m=t[2],y=t[3],b=Math.sin(n),S=Math.cos(n);return e[0]=a*S-m*b,e[1]=u*S+y*b,e[2]=m*S+a*b,e[3]=y*S-u*b,e}ah(),dh=new As(4),As!=Float32Array&&(dh[0]=0,dh[1]=0,dh[2]=0,dh[3]=0);var fs=Xp;ah(),hr(1,0,0),hr(0,1,0),Yp(),Yp(),Vp();const Jp=Ue([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Kp}=Jp,fh=Ue([{name:"a_pos_3",components:3,type:"Int16"}]);var mh=Ue([{name:"a_pos",type:"Int16",components:2}]);class Cu{constructor(t,n){this.pos=t,this.dir=n}intersectsPlane(t,n,a){const u=ps(n,this.dir);if(Math.abs(u)<1e-6)return!1;const m=((t[0]-this.pos[0])*n[0]+(t[1]-this.pos[1])*n[1]+(t[2]-this.pos[2])*n[2])/u;return a[0]=this.pos[0]+this.dir[0]*m,a[1]=this.pos[1]+this.dir[1]*m,a[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(t,n,a){if(j=(B=this.pos)[0],$=B[1],nt=B[2],ht=(F=t)[0],tt=F[1],at=F[2],Math.abs(j-ht)<=Tu*Math.max(1,Math.abs(j),Math.abs(ht))&&Math.abs($-tt)<=Tu*Math.max(1,Math.abs($),Math.abs(tt))&&Math.abs(nt-at)<=Tu*Math.max(1,Math.abs(nt),Math.abs(at))||0===n)return a[0]=a[1]=a[2]=0,!1;var B,F,j,$,nt,ht,tt,at;const[u,m,y]=this.dir,b=this.pos[0]-t[0],S=this.pos[1]-t[1],M=this.pos[2]-t[2],k=u*u+m*m+y*y,I=2*(b*u+S*m+M*y),L=I*I-4*k*(b*b+S*S+M*M-n*n);if(L<0){const B=Math.max(-I/2,0),F=b+u*B,j=S+m*B,$=M+y*B,nt=Math.hypot(F,j,$);return a[0]=F*n/nt,a[1]=j*n/nt,a[2]=$*n/nt,!1}{const B=(-I-Math.sqrt(L))/(2*k);if(B<0){const F=Math.hypot(b,S,M);return a[0]=b*n/F,a[1]=S*n/F,a[2]=M*n/F,!1}return a[0]=b+u*B,a[1]=S+m*B,a[2]=M+y*B,!0}}}class Ad{constructor(t,n,a,u,m){this.TL=t,this.TR=n,this.BR=a,this.BL=u,this.horizon=m}static fromInvProjectionMatrix(t,n,a){const u=[-1,1,1],m=[1,1,1],y=[1,-1,1],b=[-1,-1,1],S=en(u,u,t),M=en(m,m,t),k=en(y,y,t),I=en(b,b,t);return new Ad(S,M,k,I,n/a)}}class Mu{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,a,u){const m=Math.pow(2,a),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const M=al([],S,t),k=1/M[3]/n*m;return(I=M)[0]=(L=M)[0]*(B=[k,k,u?1/M[3]:k,k])[0],I[1]=L[1]*B[1],I[2]=L[2]*B[2],I[3]=L[3]*B[3],I;var I,L,B}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const M=es([],Su([],jo([],y[S[0]],y[S[1]]),jo([],y[S[2]],y[S[1]]))),k=-ps(M,y[S[1]]);return M.concat(k)});return new Mu(y,b)}}class ms{static fromPoints(t){const n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const u of t)hh(n,n,u),rl(a,a,u);return new ms(n,a)}static applyTransform(t,n){const a=t.getCorners();for(let u=0;u<a.length;++u)en(a[u],a[u],n);return ms.fromPoints(a)}constructor(t,n){this.min=t,this.max=n,this.center=Us([],Ir([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],a=qp(this.min),u=qp(this.max);for(let m=0;m<n.length;m++)a[m]=n[m]?this.min[m]:this.center[m],u[m]=n[m]?this.center[m]:this.max[m];return u[2]=this.max[2],new ms(a,u)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,n=this.max;return[[t[0],t[1],t[2]],[n[0],t[1],t[2]],[n[0],n[1],t[2]],[t[0],n[1],t[2]],[t[0],t[1],n[2]],[n[0],t[1],n[2]],[n[0],n[1],n[2]],[t[0],n[1],n[2]]]}intersects(t){const n=this.getCorners();let a=!0;for(let u=0;u<t.planes.length;u++){const m=t.planes[u];let y=0;for(let b=0;b<n.length;b++)y+=ps(m,n[b])+m[3]>=0;if(0===y)return 0;y!==n.length&&(a=!1)}if(a)return 2;for(let u=0;u<3;u++){let m=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let b=0;b<t.points.length;b++){const S=t.points[b][u]-this.min[u];m=Math.min(m,S),y=Math.max(y,S)}if(y<0||m>this.max[u]-this.min[u])return 0}return 1}}const ur=Xe/Math.PI/2,ba=[64,32,16],go=-ur,_o=ur,gh=[new ms([go,go,go],[_o,_o,_o]),new ms([go,go,go],[0,0,_o]),new ms([0,go,go],[_o,0,_o]),new ms([go,0,go],[0,_o,_o]),new ms([0,0,go],[_o,_o,_o])];function _h(e){return e*ur/wh}function kd(e,t,n,a=!0){const u=Us([],e._camera.position,e.worldSize),m=[t,n,1,1];al(m,m,e.pixelMatrixInverse),Md(m,m,1/m[3]);const y=es([],jo([],m,u)),b=e.globeMatrix,S=[b[12],b[13],b[14]],M=jo([],S,u),k=lh(M),I=es([],M),L=e.worldSize/(2*Math.PI),B=ps(I,y),F=Math.asin(L/k);if(F<Math.acos(B)){if(!a)return null;const he=[],jt=[];Us(he,y,k/B),es(jt,jo(jt,he,M)),es(y,Ir(y,M,Us(y,jt,Math.tan(F)*k)))}const j=[];new Cu(u,y).closestPointOnSphere(S,L,j);const $=es([],Vr(b,0)),nt=es([],Vr(b,1)),ht=es([],Vr(b,2)),tt=ps($,j),at=ps(nt,j),ft=ps(ht,j),ut=le(Math.asin(-at/L));let Ft=le(Math.atan2(tt,ft));Ft=e.center.lng+function(he,jt){const Kt=(jt-he+180)%360-180;return Kt<-180?Kt+360:Kt}(e.center.lng,Ft);const Rt=gs(Ft),Wt=Je(to(ut),0,1);return new ac(Rt,Wt)}class Tm{constructor(t,n,a){this.a=jo([],t,a),this.b=jo([],n,a),this.center=a;const u=es([],this.a),m=es([],this.b);this.angle=Math.acos(ps(u,m))}}function Dd(e,t){if(0===e.angle)return null;let n;return n=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),n<0||n>1?null:function(a,u,m,y){const b=Math.sin(m);return a*(Math.sin((1-y)*m)/b)+u*(Math.sin(y*m)/b)}(e.a[t],e.b[t],e.angle,Je(n,0,1))+e.center[t]}function dr(e){if(e.z<=1)return gh[e.z+2*e.y+e.x];const t=Pd(Ns(e));return ms.fromPoints(t)}function Lr(e,t,n){return Us(e,e,1-n),uh(e,e,t,n)}function Qp(e,t){const n=cl(t.zoom);if(0===n)return dr(e);const a=Ns(e),u=Pd(a),m=gs(a.getWest())*t.worldSize,y=gs(a.getEast())*t.worldSize,b=to(a.getNorth())*t.worldSize,S=to(a.getSouth())*t.worldSize,M=[m,b,0],k=[y,b,0],I=[m,S,0],L=[y,S,0],B=Sd([],t.globeMatrix);return en(M,M,B),en(k,k,B),en(I,I,B),en(L,L,B),u[0]=Lr(u[0],I,n),u[1]=Lr(u[1],L,n),u[2]=Lr(u[2],k,n),u[3]=Lr(u[3],M,n),ms.fromPoints(u)}function tf(e,t,n){for(const a of e)en(a,a,t),Us(a,a,n)}function Ns({x:e,y:t,z:n}){const a=1/(1<<n),u=new vi(eo(e*a),Xn((t+1)*a)),m=new vi(eo((e+1)*a),Xn(t*a));return new Dr(u,m)}function Pd(e){const t=Jt(e.getNorth()),n=Jt(e.getSouth()),a=Math.cos(t),u=Math.cos(n),m=Math.sin(t),y=Math.sin(n),b=e.getWest(),S=e.getEast();return[oc(u,y,b),oc(u,y,S),oc(a,m,S),oc(a,m,b)]}function oc(e,t,n,a=ur){return n=Jt(n),[e*Math.sin(n)*a,-t*a,e*Math.cos(n)*a]}function rc(e,t,n){return oc(Math.cos(Jt(e)),Math.sin(Jt(e)),t,n)}function yh(e,t,n,a){const u=1<<n.z,m=(e/Xe+n.x)/u;return rc(Xn((t/Xe+n.y)/u),eo(m),a)}function Eu({min:e,max:t}){return 16383/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const xh=new Float64Array(16);function vh(e){const t=Eu(e),n=bm(xh,[t,t,t]);return rh(n,n,((a=[])[0]=-(u=e.min)[0],a[1]=-u[1],a[2]=-u[2],a));var a,u}function Id(e){const t=(a=e.min,(n=xh)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=a[0],n[13]=a[1],n[14]=a[2],n[15]=1,n);var n,a;const u=1/Eu(e);return va(t,t,[u,u,u])}function Ld(e,t,n,a,u){const m=function(S){const M=Xe/(2*Math.PI);return S/(2*Math.PI)/M}(n),y=[e,t,-n/(2*Math.PI)],b=Vo(new Float64Array(16));return rh(b,b,y),va(b,b,[m,m,m]),Zp(b,b,Jt(-u)),Cd(b,b,Jt(-a)),b}function cl(e){return Gn(5,6,e)}function Rd(e,t){const n=rc(t.lat,t.lng);return y=(u=ch([],function(F){const j=rc(F._center.lat,F._center.lng);let $=Su([],hr(0,1,0),j);const nt=Gp([],-F.angle,j);$=en($,$,nt),Gp(nt,-F._pitch,$);const ht=es([],j);return Us(ht,ht,_h(F.cameraToCenterDistance/F.pixelsPerMeter)),en(ht,ht,nt),Ir([],j,ht)}(e),n))[0],b=u[1],S=u[2],M=(m=n)[0],k=m[1],I=m[2],B=(L=Math.sqrt(y*y+b*b+S*S)*Math.sqrt(M*M+k*k+I*I))&&ps(u,m)/L,Math.acos(Math.min(Math.max(B,-1),1));var u,m,y,b,S,M,k,I,L,B}function zd(e,t){return Rd(e,t)>Math.PI/2*1.01}const ef=Jt(85),bh=Math.cos(ef),nf=Math.sin(ef),wh=6371008.8,sf=2*Math.PI*wh;class vi{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new vi(cn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,a=this.lat*n,u=t.lat*n,m=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((t.lng-this.lng)*n);return wh*Math.acos(Math.min(m,1))}toBounds(t=0){const n=360*t/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new Dr(new vi(this.lng-a,this.lat-n),new vi(this.lng+a,this.lat+n))}toEcef(t){const n=_h(t);return rc(this.lat,this.lng,ur+n)}static convert(t){if(t instanceof vi)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new vi(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new vi(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function Od(e){return sf*Math.cos(e*Math.PI/180)}function gs(e){return(180+e)/360}function to(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Zo(e,t){return e/Od(t)}function eo(e){return 360*e-180}function Xn(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function of(e,t){return e*Od(Xn(t))}const rn=85.051129;function rf(e){return 1/Math.cos(e*Math.PI/180)}class ac{constructor(t,n,a=0){this.x=+t,this.y=+n,this.z=+a}static fromLngLat(t,n=0){const a=vi.convert(t);return new ac(gs(a.lng),to(a.lat),Zo(n,a.lat))}toLngLat(){return new vi(eo(this.x),Xn(this.y))}toAltitude(){return of(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/sf*rf(Xn(this.y))}}function Bd(e,t,n,a,u,m,y,b,S){const M=(t+a)/2,k=(n+u)/2,I=new Mt(M,k);b(I),function(L,B,F,j,$,nt){const ht=F-$,tt=j-nt;return Math.abs((j-B)*ht-(F-L)*tt)/Math.hypot(ht,tt)}(I.x,I.y,m.x,m.y,y.x,y.y)>=S?(Bd(e,t,n,M,k,m,I,b,S),Bd(e,M,k,a,u,I,y,b,S)):e.push(y)}function af(e,t,n){let a=e[0],u=a.x,m=a.y;t(a);const y=[a];for(let b=1;b<e.length;b++){const S=e[b],{x:M,y:k}=S;t(S),Bd(y,u,m,M,k,a,S,t,n),u=M,m=k,a=S}return y}function Fd(e,t,n,a){if(a(t,n)){const u=t.add(n)._mult(.5);Fd(e,t,u,a),Fd(e,u,n,a)}else e.push(n)}function Ud(e,t){let n=e[0];const a=[n];for(let u=1;u<e.length;u++){const m=e[u];Fd(a,n,m,t),n=m}return a}const Nd=Math.pow(2,14)-1,lf=-Nd-1;function cf(e,t){const n=Math.round(e.x*t),a=Math.round(e.y*t);return e.x=Je(n,lf,Nd),e.y=Je(a,lf,Nd),(n<e.x||n>e.x+1||a<e.y||a>e.y+1)&&on("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Rr(e,t,n){const a=e.loadGeometry(),u=e.extent,m=Xe/u;if(t&&n&&n.projection.isReprojectedInTileSpace){const y=1<<t.z,{scale:b,x:S,y:M,projection:k}=n,I=L=>{const B=eo((t.x+L.x/u)/y),F=Xn((t.y+L.y/u)/y),j=k.project(B,F);L.x=(j.x*b-S)*u,L.y=(j.y*b-M)*u};for(let L=0;L<a.length;L++)if(1!==e.type)a[L]=af(a[L],I,1);else{const B=[];for(const F of a[L])F.x<0||F.x>=u||F.y<0||F.y>=u||(I(F),B.push(F));a[L]=B}}for(const y of a)for(const b of y)cf(b,m);return a}function zr(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Rr(e):[]}}function Th(e,t,n,a,u){e.emplaceBack(2*t+(a+1)/2,2*n+(u+1)/2)}function Au(e,t,n){e.emplaceBack(t.x,t.y,t.z,16384*n[0],16384*n[1],16384*n[2])}class Vd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new je,this.indexArray=new Wn,this.segments=new bn,this.programConfigurations=new Fs(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a,u){const m=this.layers[0],y=[];let b=null;"circle"===m.type&&(b=m.layout.get("circle-sort-key"));for(const{feature:M,id:k,index:I,sourceLayerIndex:L}of t){const B=this.layers[0]._featureFilter.needGeometry,F=zr(M,B);if(!this.layers[0]._featureFilter.filter(new Et(this.zoom),F,a))continue;const j=b?b.evaluate(F,{},a):void 0,$={id:k,properties:M.properties,type:M.type,sourceLayerIndex:L,index:I,geometry:B?F.geometry:Rr(M,a,u),patterns:{},sortKey:j};y.push($)}b&&y.sort((M,k)=>M.sortKey-k.sortKey);let S=null;"globe"===u.projection.name&&(this.globeExtVertexArray=new Js,S=u.projection);for(const M of y){const{geometry:k,index:I,sourceLayerIndex:L}=M,B=t[I].feature;this.addFeature(M,k,I,n.availableImages,a,S),n.featureIndex.insert(B,k,I,L,this.index)}}update(t,n,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Td.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,vm.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,n,a,u,m,y){for(const b of n)for(const S of b){const M=S.x,k=S.y;if(M<0||M>=Xe||k<0||k>=Xe)continue;if(y){const B=y.projectTilePoint(M,k,m),F=y.upVector(m,M,k),j=this.globeExtVertexArray;Au(j,B,F),Au(j,B,F),Au(j,B,F),Au(j,B,F)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),L=I.vertexLength;Th(this.layoutVertexArray,M,k,-1,-1),Th(this.layoutVertexArray,M,k,1,-1),Th(this.layoutVertexArray,M,k,1,1),Th(this.layoutVertexArray,M,k,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},u,m)}}function jd(e,t){for(let n=0;n<e.length;n++)if(ul(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(ul(e,t[n]))return!0;return!!ku(e,t)}function hf(e,t,n){return!!ul(e,t)||!!hl(t,e,n)}function uf(e,t){if(1===e.length)return Zd(t,e[0]);for(let n=0;n<t.length;n++){const a=t[n];for(let u=0;u<a.length;u++)if(ul(e,a[u]))return!0}for(let n=0;n<e.length;n++)if(Zd(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(ku(e,t[n]))return!0;return!1}function df(e,t,n){if(e.length>1){if(ku(e,t))return!0;for(let a=0;a<t.length;a++)if(hl(t[a],e,n))return!0}for(let a=0;a<e.length;a++)if(hl(e[a],t,n))return!0;return!1}function ku(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const a=e[n],u=e[n+1];for(let m=0;m<t.length-1;m++)if(Du(a,u,t[m],t[m+1]))return!0}return!1}function Du(e,t,n,a){return Zs(e,n,a)!==Zs(t,n,a)&&Zs(e,t,n)!==Zs(e,t,a)}function hl(e,t,n){const a=n*n;if(1===t.length)return e.distSqr(t[0])<a;for(let u=1;u<t.length;u++)if(pf(e,t[u-1],t[u])<a)return!0;return!1}function pf(e,t,n){const a=t.distSqr(n);if(0===a)return e.distSqr(t);const u=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/a;return e.distSqr(u<0?t:u>1?n:n.sub(t)._mult(u)._add(t))}function Zd(e,t){let n,a,u,m=!1;for(let y=0;y<e.length;y++){n=e[y];for(let b=0,S=n.length-1;b<n.length;S=b++)a=n[b],u=n[S],a.y>t.y!=u.y>t.y&&t.x<(u.x-a.x)*(t.y-a.y)/(u.y-a.y)+a.x&&(m=!m)}return m}function ul(e,t){let n=!1;for(let a=0,u=e.length-1;a<e.length;u=a++){const m=e[a],y=e[u];m.y>t.y!=y.y>t.y&&t.x<(y.x-m.x)*(t.y-m.y)/(y.y-m.y)+m.x&&(n=!n)}return n}function ff(e,t,n,a,u){for(const y of e)if(t<=y.x&&n<=y.y&&a>=y.x&&u>=y.y)return!0;const m=[new Mt(t,n),new Mt(t,u),new Mt(a,u),new Mt(a,n)];if(e.length>2)for(const y of m)if(ul(e,y))return!0;for(let y=0;y<e.length-1;y++)if(Cm(e[y],e[y+1],m))return!0;return!1}function Cm(e,t,n){const a=n[0],u=n[2];if(e.x<a.x&&t.x<a.x||e.x>u.x&&t.x>u.x||e.y<a.y&&t.y<a.y||e.y>u.y&&t.y>u.y)return!1;const m=Zs(e,t,n[0]);return m!==Zs(e,t,n[1])||m!==Zs(e,t,n[2])||m!==Zs(e,t,n[3])}function lc(e,t,n){const a=t.paint.get(e).value;return"constant"===a.kind?a.value:n.programConfigurations.get(t.id).getMaxValue(e)}function Sh(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Gd(e,t,n,a,u){if(!t[0]&&!t[1])return e;const m=Mt.convert(t)._mult(u);"viewport"===n&&m._rotate(-a);const y=[];for(let b=0;b<e.length;b++)y.push(e[b].sub(m));return y}function qd(e,t,n,a){const u=Mt.convert(e)._mult(a);return"viewport"===t&&u._rotate(-n),u}De(Vd,"CircleBucket",{omit:["layers"]});const Mm=new se({"circle-sort-key":new Nt(Ht.layout_circle["circle-sort-key"])});var mf={paint:new se({"circle-radius":new Nt(Ht.paint_circle["circle-radius"]),"circle-color":new Nt(Ht.paint_circle["circle-color"]),"circle-blur":new Nt(Ht.paint_circle["circle-blur"]),"circle-opacity":new Nt(Ht.paint_circle["circle-opacity"]),"circle-translate":new wt(Ht.paint_circle["circle-translate"]),"circle-translate-anchor":new wt(Ht.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wt(Ht.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wt(Ht.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Nt(Ht.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Nt(Ht.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Nt(Ht.paint_circle["circle-stroke-opacity"])}),layout:Mm};function Ch(e,t,n,a,u,m,y,b,S){if(m&&e.queryGeometry.isAboveHorizon)return!1;m&&(S*=e.pixelToTileUnitsFactor);const M=e.tileID.canonical,k=n.projection.upVectorScale(M,n.center.lat,n.worldSize).metersToTile;for(const I of t)for(const L of I){const B=L.add(b),F=u&&n.elevation?n.elevation.exaggeration()*u.getElevationAt(B.x,B.y,!0):0,j=n.projection.projectTilePoint(B.x,B.y,M);if(F>0){const tt=n.projection.upVector(M,B.x,B.y);j.x+=tt[0]*k*F,j.y+=tt[1]*k*F,j.z+=tt[2]*k*F}const $=m?B:gf(j.x,j.y,j.z,a),nt=m?e.tilespaceRays.map(tt=>Am(tt,F)):e.queryGeometry.screenGeometry,ht=al([],[j.x,j.y,j.z,1],a);if(!y&&m?S*=ht[3]/n.cameraToCenterDistance:y&&!m&&(S*=n.cameraToCenterDistance/ht[3]),m){const tt=Xn((L.y/Xe+M.y)/(1<<M.z));S/=n.projection.pixelsPerMeter(tt,1)/Zo(1,tt)}if(hf(nt,$,S))return!0}return!1}function gf(e,t,n,a){const u=al([],[e,t,n,1],a);return new Mt(u[0]/u[3],u[1]/u[3])}const _f=hr(0,0,0),Em=hr(0,0,1);function Am(e,t){const n=ah();return _f[2]=t,e.intersectsPlane(_f,Em,n),new Mt(n[0],n[1])}class wa extends Vd{}function Hd(e,{width:t,height:n},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*n*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(t*n*a);return e.width=t,e.height=n,e.data=u,e}function yf(e,t,n){const{width:a,height:u}=t;a===e.width&&u===e.height||($d(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,a),height:Math.min(e.height,u)},n),e.width=a,e.height=u,e.data=t.data)}function $d(e,t,n,a,u,m){if(0===u.width||0===u.height)return t;if(u.width>e.width||u.height>e.height||n.x>e.width-u.width||n.y>e.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||a.x>t.width-u.width||a.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const y=e.data,b=t.data;for(let S=0;S<u.height;S++){const M=((n.y+S)*e.width+n.x)*m,k=((a.y+S)*t.width+a.x)*m;for(let I=0;I<u.width*m;I++)b[k+I]=y[M+I]}return t}De(wa,"HeatmapBucket",{omit:["layers"]});class Or{constructor(t,n){Hd(this,t,1,n)}resize(t){yf(this,new Or(t),1)}clone(){return new Or({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,a,u,m){$d(t,n,a,u,m,1)}}class jn{constructor(t,n){Hd(this,t,4,n)}resize(t){yf(this,new jn(t),4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new jn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,a,u,m){$d(t,n,a,u,m,4)}}De(Or,"AlphaImage"),De(jn,"RGBAImage");var Pu={paint:new se({"heatmap-radius":new Nt(Ht.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Nt(Ht.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wt(Ht.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ee(Ht.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wt(Ht.paint_heatmap["heatmap-opacity"])})};function Wd(e){const t={},n=e.resolution||256,a=e.clips?e.clips.length:1,u=e.image||new jn({width:n,height:a}),m=(y,b,S)=>{t[e.evaluationKey]=S;const M=e.expression.evaluate(t);u.data[y+b+0]=Math.floor(255*M.r/M.a),u.data[y+b+1]=Math.floor(255*M.g/M.a),u.data[y+b+2]=Math.floor(255*M.b/M.a),u.data[y+b+3]=Math.floor(255*M.a)};if(e.clips)for(let y=0,b=0;y<a;++y,b+=4*n)for(let S=0,M=0;S<n;S++,M+=4){const k=S/(n-1),{start:I,end:L}=e.clips[y];m(b,M,I*(1-k)+L*k)}else for(let y=0,b=0;y<n;y++,b+=4)m(0,b,y/(n-1));return u}var km={paint:new se({"hillshade-illumination-direction":new wt(Ht.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new wt(Ht.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wt(Ht.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wt(Ht.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wt(Ht.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wt(Ht.paint_hillshade["hillshade-accent-color"])})};const Mh=Ue([{name:"a_pos",components:2,type:"Int16"}],4),{members:xf}=Mh;var cc={};function Iu(e,t,n){n=n||2;var a,u,m,y,b,S,M,k=t&&t.length,I=k?t[0]*n:e.length,L=Xd(e,0,I,n,!0),B=[];if(!L||L.next===L.prev)return B;if(k&&(L=function(j,$,nt,ht){var tt,at,ft,ut=[];for(tt=0,at=$.length;tt<at;tt++)(ft=Xd(j,$[tt]*ht,tt<at-1?$[tt+1]*ht:j.length,ht,!1))===ft.next&&(ft.steiner=!0),ut.push(zm(ft));for(ut.sort(Lm),tt=0;tt<ut.length;tt++)nt=Rm(ut[tt],nt);return nt}(e,t,L,n)),e.length>80*n){a=m=e[0],u=y=e[1];for(var F=n;F<I;F+=n)(b=e[F])<a&&(a=b),(S=e[F+1])<u&&(u=S),b>m&&(m=b),S>y&&(y=S);M=0!==(M=Math.max(m-a,y-u))?32767/M:0}return Eh(L,B,n,a,u,M,0),B}function Xd(e,t,n,a,u){var m,y;if(u===Fu(e,t,n,a)>0)for(m=t;m<n;m+=a)y=kh(m,e[m],e[m+1],y);else for(m=n-a;m>=t;m-=a)y=kh(m,e[m],e[m+1],y);return y&&zu(y,y.next)&&(Dh(y),y=y.next),y}function dl(e,t){if(!e)return e;t||(t=e);var n,a=e;do{if(n=!1,a.steiner||!zu(a,a.next)&&0!==wn(a.prev,a,a.next))a=a.next;else{if(Dh(a),(a=t=a.prev)===a.next)break;n=!0}}while(n||a!==t);return t}function Eh(e,t,n,a,u,m,y){if(e){!y&&m&&function(k,I,L,B){var F=k;do{0===F.z&&(F.z=Ru(F.x,F.y,I,L,B)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next}while(F!==k);F.prevZ.nextZ=null,F.prevZ=null,function(j){var $,nt,ht,tt,at,ft,ut,Ft,Rt=1;do{for(nt=j,j=null,at=null,ft=0;nt;){for(ft++,ht=nt,ut=0,$=0;$<Rt&&(ut++,ht=ht.nextZ);$++);for(Ft=Rt;ut>0||Ft>0&&ht;)0!==ut&&(0===Ft||!ht||nt.z<=ht.z)?(tt=nt,nt=nt.nextZ,ut--):(tt=ht,ht=ht.nextZ,Ft--),at?at.nextZ=tt:j=tt,tt.prevZ=at,at=tt;nt=ht}at.nextZ=null,Rt*=2}while(ft>1)}(F)}(e,a,u,m);for(var b,S,M=e;e.prev!==e.next;)if(b=e.prev,S=e.next,m?Dm(e,a,u,m):Yd(e))t.push(b.i/n|0),t.push(e.i/n|0),t.push(S.i/n|0),Dh(e),e=S.next,M=S.next;else if((e=S)===M){y?1===y?Eh(e=Pm(dl(e),t,n),t,n,a,u,m,2):2===y&&Im(e,t,n,a,u,m):Eh(dl(e),t,n,a,u,m,1);break}}}function Yd(e){var t=e.prev,n=e,a=e.next;if(wn(t,n,a)>=0)return!1;for(var u=t.x,m=n.x,y=a.x,b=t.y,S=n.y,M=a.y,k=u<m?u<y?u:y:m<y?m:y,I=b<S?b<M?b:M:S<M?S:M,L=u>m?u>y?u:y:m>y?m:y,B=b>S?b>M?b:M:S>M?S:M,F=a.next;F!==t;){if(F.x>=k&&F.x<=L&&F.y>=I&&F.y<=B&&pl(u,b,m,S,y,M,F.x,F.y)&&wn(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function Dm(e,t,n,a){var u=e.prev,m=e,y=e.next;if(wn(u,m,y)>=0)return!1;for(var b=u.x,S=m.x,M=y.x,k=u.y,I=m.y,L=y.y,B=b<S?b<M?b:M:S<M?S:M,F=k<I?k<L?k:L:I<L?I:L,j=b>S?b>M?b:M:S>M?S:M,$=k>I?k>L?k:L:I>L?I:L,nt=Ru(B,F,t,n,a),ht=Ru(j,$,t,n,a),tt=e.prevZ,at=e.nextZ;tt&&tt.z>=nt&&at&&at.z<=ht;){if(tt.x>=B&&tt.x<=j&&tt.y>=F&&tt.y<=$&&tt!==u&&tt!==y&&pl(b,k,S,I,M,L,tt.x,tt.y)&&wn(tt.prev,tt,tt.next)>=0||(tt=tt.prevZ,at.x>=B&&at.x<=j&&at.y>=F&&at.y<=$&&at!==u&&at!==y&&pl(b,k,S,I,M,L,at.x,at.y)&&wn(at.prev,at,at.next)>=0))return!1;at=at.nextZ}for(;tt&&tt.z>=nt;){if(tt.x>=B&&tt.x<=j&&tt.y>=F&&tt.y<=$&&tt!==u&&tt!==y&&pl(b,k,S,I,M,L,tt.x,tt.y)&&wn(tt.prev,tt,tt.next)>=0)return!1;tt=tt.prevZ}for(;at&&at.z<=ht;){if(at.x>=B&&at.x<=j&&at.y>=F&&at.y<=$&&at!==u&&at!==y&&pl(b,k,S,I,M,L,at.x,at.y)&&wn(at.prev,at,at.next)>=0)return!1;at=at.nextZ}return!0}function Pm(e,t,n){var a=e;do{var u=a.prev,m=a.next.next;!zu(u,m)&&vf(u,a,a.next,m)&&Ah(u,m)&&Ah(m,u)&&(t.push(u.i/n|0),t.push(a.i/n|0),t.push(m.i/n|0),Dh(a),Dh(a.next),a=e=m),a=a.next}while(a!==e);return dl(a)}function Im(e,t,n,a,u,m){var y=e;do{for(var b=y.next.next;b!==y.prev;){if(y.i!==b.i&&Ta(y,b)){var S=Bu(y,b);return y=dl(y,y.next),S=dl(S,S.next),Eh(y,t,n,a,u,m,0),void Eh(S,t,n,a,u,m,0)}b=b.next}y=y.next}while(y!==e)}function Lm(e,t){return e.x-t.x}function Rm(e,t){var n=function(u,m){var y,b=m,S=u.x,M=u.y,k=-1/0;do{if(M<=b.y&&M>=b.next.y&&b.next.y!==b.y){var I=b.x+(M-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(I<=S&&I>k&&(k=I,y=b.x<b.next.x?b:b.next,I===S))return y}b=b.next}while(b!==m);if(!y)return null;var L,B=y,F=y.x,j=y.y,$=1/0;b=y;do{S>=b.x&&b.x>=F&&S!==b.x&&pl(M<j?S:k,M,F,j,M<j?k:S,M,b.x,b.y)&&(L=Math.abs(M-b.y)/(S-b.x),Ah(b,u)&&(L<$||L===$&&(b.x>y.x||b.x===y.x&&Lu(y,b)))&&(y=b,$=L)),b=b.next}while(b!==B);return y}(e,t);if(!n)return t;var a=Bu(n,e);return dl(a,a.next),dl(n,n.next)}function Lu(e,t){return wn(e.prev,e,t.prev)<0&&wn(t.next,e,e.next)<0}function Ru(e,t,n,a,u){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function zm(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function pl(e,t,n,a,u,m,y,b){return(u-y)*(t-b)>=(e-y)*(m-b)&&(e-y)*(a-b)>=(n-y)*(t-b)&&(n-y)*(m-b)>=(u-y)*(a-b)}function Ta(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(n,a){var u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==a.i&&u.next.i!==a.i&&vf(u,u.next,n,a))return!0;u=u.next}while(u!==n);return!1}(e,t)&&(Ah(e,t)&&Ah(t,e)&&function(n,a){var u=n,m=!1,y=(n.x+a.x)/2,b=(n.y+a.y)/2;do{u.y>b!=u.next.y>b&&u.next.y!==u.y&&y<(u.next.x-u.x)*(b-u.y)/(u.next.y-u.y)+u.x&&(m=!m),u=u.next}while(u!==n);return m}(e,t)&&(wn(e.prev,e,t.prev)||wn(e,t.prev,t))||zu(e,t)&&wn(e.prev,e,e.next)>0&&wn(t.prev,t,t.next)>0)}function wn(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function zu(e,t){return e.x===t.x&&e.y===t.y}function vf(e,t,n,a){var u=Ou(wn(e,t,n)),m=Ou(wn(e,t,a)),y=Ou(wn(n,a,e)),b=Ou(wn(n,a,t));return u!==m&&y!==b||!(0!==u||!hc(e,n,t))||!(0!==m||!hc(e,a,t))||!(0!==y||!hc(n,e,a))||!(0!==b||!hc(n,t,a))}function hc(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Ou(e){return e>0?1:e<0?-1:0}function Ah(e,t){return wn(e.prev,e,e.next)<0?wn(e,t,e.next)>=0&&wn(e,e.prev,t)>=0:wn(e,t,e.prev)<0||wn(e,e.next,t)<0}function Bu(e,t){var n=new Ph(e.i,e.x,e.y),a=new Ph(t.i,t.x,t.y),u=e.next,m=t.prev;return e.next=t,t.prev=e,n.next=u,u.prev=n,a.next=n,n.prev=a,m.next=a,a.prev=m,a}function kh(e,t,n,a){var u=new Ph(e,t,n);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Dh(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ph(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Fu(e,t,n,a){for(var u=0,m=t,y=n-a;m<n;m+=a)u+=(e[y]-e[m])*(e[m+1]+e[y+1]),y=m;return u}function bf(e,t,n,a,u){Jd(e,t,n||0,a||e.length-1,u||Om)}function Jd(e,t,n,a,u){for(;a>n;){if(a-n>600){var m=a-n+1,y=t-n+1,b=Math.log(m),S=.5*Math.exp(2*b/3),M=.5*Math.sqrt(b*S*(m-S)/m)*(y-m/2<0?-1:1);Jd(e,t,Math.max(n,Math.floor(t-y*S/m+M)),Math.min(a,Math.floor(t+(m-y)*S/m+M)),u)}var k=e[t],I=n,L=a;for(Ih(e,n,t),u(e[a],k)>0&&Ih(e,n,a);I<L;){for(Ih(e,I,L),I++,L--;u(e[I],k)<0;)I++;for(;u(e[L],k)>0;)L--}0===u(e[n],k)?Ih(e,n,L):Ih(e,++L,a),L<=t&&(n=L+1),t<=L&&(a=L-1)}}function Ih(e,t,n){var a=e[t];e[t]=e[n],e[n]=a}function Om(e,t){return e<t?-1:e>t?1:0}function Kd(e,t){const n=e.length;if(n<=1)return[e];const a=[];let u,m;for(let y=0;y<n;y++){const b=Ti(e[y]);0!==b&&(e[y].area=Math.abs(b),void 0===m&&(m=b<0),m===b<0?(u&&a.push(u),u=[e[y]]):u.push(e[y]))}if(u&&a.push(u),t>1)for(let y=0;y<a.length;y++)a[y].length<=t||(bf(a[y],t,1,a[y].length-1,Bm),a[y]=a[y].slice(0,t));return a}function Bm(e,t){return t.area-e.area}function Uu(e,t,n){const a=n.patternDependencies;let u=!1;for(const m of t){const y=m.paint.get(`${e}-pattern`);y.isConstant()||(u=!0);const b=y.constantOr(null);b&&(u=!0,a[b]=!0)}return u}function Qd(e,t,n,a,u){const m=u.patternDependencies;for(const y of t){const b=y.paint.get(`${e}-pattern`).value;if("constant"!==b.kind){let S=b.evaluate({zoom:a},n,{},u.availableImages);S=S&&S.name?S.name:S,m[S]=!0,n.patterns[y.id]=S}}return n}({get exports(){return cc},set exports(e){cc=e}}).exports=Iu,cc.default=Iu,Iu.deviation=function(e,t,n,a){var u=t&&t.length,m=Math.abs(Fu(e,0,u?t[0]*n:e.length,n));if(u)for(var y=0,b=t.length;y<b;y++)m-=Math.abs(Fu(e,t[y]*n,y<b-1?t[y+1]*n:e.length,n));var S=0;for(y=0;y<a.length;y+=3){var M=a[y]*n,k=a[y+1]*n,I=a[y+2]*n;S+=Math.abs((e[M]-e[I])*(e[k+1]-e[M+1])-(e[M]-e[k])*(e[I+1]-e[M+1]))}return 0===m&&0===S?0:Math.abs((S-m)/m)},Iu.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},a=0,u=0;u<e.length;u++){for(var m=0;m<e[u].length;m++)for(var y=0;y<t;y++)n.vertices.push(e[u][m][y]);u>0&&n.holes.push(a+=e[u-1].length)}return n};class Nu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new je,this.indexArray=new Wn,this.indexArray2=new Uo,this.programConfigurations=new Fs(t.layers,t.zoom),this.segments=new bn,this.segments2=new bn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=t.projection}populate(t,n,a,u){this.hasPattern=Uu("fill",this.layers,n);const m=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:b,id:S,index:M,sourceLayerIndex:k}of t){const I=this.layers[0]._featureFilter.needGeometry,L=zr(b,I);if(!this.layers[0]._featureFilter.filter(new Et(this.zoom),L,a))continue;const B=m?m.evaluate(L,{},a,n.availableImages):void 0,F={id:S,properties:b.properties,type:b.type,sourceLayerIndex:k,index:M,geometry:I?L.geometry:Rr(b,a,u),patterns:{},sortKey:B};y.push(F)}m&&y.sort((b,S)=>b.sortKey-S.sortKey);for(const b of y){const{geometry:S,index:M,sourceLayerIndex:k}=b;if(this.hasPattern){const I=Qd("fill",this.layers,b,this.zoom,n);this.patternFeatures.push(I)}else this.addFeature(b,S,M,a,{},n.availableImages);n.featureIndex.insert(t[M].feature,S,M,k,this.index)}}update(t,n,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a,u)}addFeatures(t,n,a,u,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xf),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,a,u,m,y=[]){for(const b of Kd(n,500)){let S=0;for(const F of b)S+=F.length;const M=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray),k=M.vertexLength,I=[],L=[];for(const F of b){if(0===F.length)continue;F!==b[0]&&L.push(I.length/2);const j=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),$=j.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack($+F.length-1,$),I.push(F[0].x),I.push(F[0].y);for(let nt=1;nt<F.length;nt++)this.layoutVertexArray.emplaceBack(F[nt].x,F[nt].y),this.indexArray2.emplaceBack($+nt-1,$+nt),I.push(F[nt].x),I.push(F[nt].y);j.vertexLength+=F.length,j.primitiveLength+=F.length}const B=cc(I,L);for(let F=0;F<B.length;F+=3)this.indexArray.emplaceBack(k+B[F],k+B[F+1],k+B[F+2]);M.vertexLength+=S,M.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,y,u)}}De(Nu,"FillBucket",{omit:["layers","patternFeatures"]});const Fm=new se({"fill-sort-key":new Nt(Ht.layout_fill["fill-sort-key"])});var Um={paint:new se({"fill-antialias":new wt(Ht.paint_fill["fill-antialias"]),"fill-opacity":new Nt(Ht.paint_fill["fill-opacity"]),"fill-color":new Nt(Ht.paint_fill["fill-color"]),"fill-outline-color":new Nt(Ht.paint_fill["fill-outline-color"]),"fill-translate":new wt(Ht.paint_fill["fill-translate"]),"fill-translate-anchor":new wt(Ht.paint_fill["fill-translate-anchor"]),"fill-pattern":new Nt(Ht.paint_fill["fill-pattern"])}),layout:Fm};const wf=Ue([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Tf=Ue([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Nm=Ue([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Vm}=wf;var Vu={},tp=Mt,Sf=Sa;function Sa(e,t,n,a,u){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=a,this._values=u,e.readFields(Cf,this,t)}function Cf(e,t,n){1==e?t.id=n.readVarint():2==e?function(a,u){for(var m=a.readVarint()+a.pos;a.pos<m;){var y=u._keys[a.readVarint()],b=u._values[a.readVarint()];u.properties[y]=b}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function Mf(e){for(var t,n,a=0,u=0,m=e.length,y=m-1;u<m;y=u++)a+=((n=e[y]).x-(t=e[u]).x)*(t.y+n.y);return a}Sa.types=["Unknown","Point","LineString","Polygon"],Sa.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,a=1,u=0,m=0,y=0,b=[];e.pos<n;){if(u<=0){var S=e.readVarint();a=7&S,u=S>>3}if(u--,1===a||2===a)m+=e.readSVarint(),y+=e.readSVarint(),1===a&&(t&&b.push(t),t=[]),t.push(new tp(m,y));else{if(7!==a)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&b.push(t),b},Sa.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,a=0,u=0,m=0,y=1/0,b=-1/0,S=1/0,M=-1/0;e.pos<t;){if(a<=0){var k=e.readVarint();n=7&k,a=k>>3}if(a--,1===n||2===n)(u+=e.readSVarint())<y&&(y=u),u>b&&(b=u),(m+=e.readSVarint())<S&&(S=m),m>M&&(M=m);else if(7!==n)throw new Error("unknown command "+n)}return[y,S,b,M]},Sa.prototype.toGeoJSON=function(e,t,n){var a,u,m=this.extent*Math.pow(2,n),y=this.extent*e,b=this.extent*t,S=this.loadGeometry(),M=Sa.types[this.type];function k(B){for(var F=0;F<B.length;F++){var j=B[F];B[F]=[360*(j.x+y)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(a=0;a<S.length;a++)I[a]=S[a][0];k(S=I);break;case 2:for(a=0;a<S.length;a++)k(S[a]);break;case 3:for(S=function(B){var F=B.length;if(F<=1)return[B];for(var j,$,nt=[],ht=0;ht<F;ht++){var tt=Mf(B[ht]);0!==tt&&(void 0===$&&($=tt<0),$===tt<0?(j&&nt.push(j),j=[B[ht]]):j.push(B[ht]))}return j&&nt.push(j),nt}(S),a=0;a<S.length;a++)for(u=0;u<S[a].length;u++)k(S[a][u])}1===S.length?S=S[0]:M="Multi"+M;var L={type:"Feature",geometry:{type:M,coordinates:S},properties:this.properties};return"id"in this&&(L.id=this.id),L};var Ef=Sf,Af=kf;function kf(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(jm,this,t),this.length=this._features.length}function jm(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(a){for(var u=null,m=a.readVarint()+a.pos;a.pos<m;){var y=a.readVarint()>>3;u=1===y?a.readString():2===y?a.readFloat():3===y?a.readDouble():4===y?a.readVarint64():5===y?a.readVarint():6===y?a.readSVarint():7===y?a.readBoolean():null}return u}(n))}kf.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Ef(this._pbf,t,this.extent,this._keys,this._values)};var Zm=Af;function Gm(e,t,n){if(3===e){var a=new Zm(n,n.readVarint()+n.pos);a.length&&(t[a.name]=a)}}var ep=Vu.VectorTile=function(e,t){this.layers=e.readFields(Gm,{},t)},ju=Vu.VectorTileFeature=Sf;function Zu(e,t,n,a){const u=[],m=0===a?(y,b,S,M,k,I)=>{y.push(new Mt(I,S+(I-b)/(M-b)*(k-S)))}:(y,b,S,M,k,I)=>{y.push(new Mt(b+(I-S)/(k-S)*(M-b),I))};for(const y of e){const b=[];for(const S of y){if(S.length<=2)continue;const M=[];for(let L=0;L<S.length-1;L++){const B=S[L].x,F=S[L].y,j=S[L+1].x,$=S[L+1].y,nt=0===a?B:F,ht=0===a?j:$;nt<t?ht>t&&m(M,B,F,j,$,t):nt>n?ht<n&&m(M,B,F,j,$,n):M.push(S[L]),ht<t&&nt>=t&&m(M,B,F,j,$,t),ht>n&&nt<=n&&m(M,B,F,j,$,n)}let k=S[S.length-1];const I=0===a?k.x:k.y;I>=t&&I<=n&&M.push(k),M.length&&(k=M[M.length-1],M[0].x===k.x&&M[0].y===k.y||M.push(M[0]),b.push(M))}b.length&&u.push(b)}return u}Vu.VectorTileLayer=Af;const qm=ju.types,Hm=Math.pow(2,13);function uc(e,t,n,a,u,m,y,b){e.emplaceBack((t<<1)+y,(n<<1)+m,(Math.floor(a*Hm)<<1)+u,Math.round(b))}function Lh(e,t,n){e.emplaceBack(t.x,t.y,t.z,16384*n[0],16384*n[1],16384*n[2])}class Df{constructor(){this.acc=new Mt(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Mt(t.x,t.y),this.max=new Mt(t.x,t.y))}append(t,n){this.currentPolyCount.edges++,this.acc._add(t);const a=this.min,u=this.max;t.x<a.x?a.x=t.x:t.x>u.x&&(u.x=t.x),t.y<a.y?a.y=t.y:t.y>u.y&&(u.y=t.y),((0===t.x||t.x===Xe)&&t.x===n.x)!=((0===t.y||t.y===Xe)&&t.y===n.y)&&this.processBorderOverlap(t,n),n.x<0!=t.x<0&&this.addBorderIntersection(0,ui(n.y,t.y,(0-n.x)/(t.x-n.x))),n.x>Xe!=t.x>Xe&&this.addBorderIntersection(1,ui(n.y,t.y,(Xe-n.x)/(t.x-n.x))),n.y<0!=t.y<0&&this.addBorderIntersection(2,ui(n.x,t.x,(0-n.y)/(t.y-n.y))),n.y>Xe!=t.y>Xe&&this.addBorderIntersection(3,ui(n.x,t.x,(Xe-n.y)/(t.y-n.y)))}addBorderIntersection(t,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[t];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(t,n){if(t.x===n.x){if(t.y===n.y)return;const a=0===t.x?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,t.y)}else{const a=0===t.y?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,t.x)}}centroid(){const t=this.polyCount.reduce((n,a)=>n+a.edges,0);return 0!==t?this.acc.div(t)._round():new Mt(0,0)}span(){return new Mt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,n)=>t+ +(n[0]!==Number.MAX_VALUE),0)}}class Rh{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new Ei,this.centroidVertexArray=new Pp,this.indexArray=new Wn,this.programConfigurations=new Fs(t.layers,t.zoom),this.segments=new bn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=t.enableTerrain}populate(t,n,a,u){this.features=[],this.hasPattern=Uu("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(m){const y=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*y/(y*y+1)/Xe/(1<<m.z)}(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:m,id:y,index:b,sourceLayerIndex:S}of t){const M=this.layers[0]._featureFilter.needGeometry,k=zr(m,M);if(!this.layers[0]._featureFilter.filter(new Et(this.zoom),k,a))continue;const I={id:y,sourceLayerIndex:S,index:b,geometry:M?k.geometry:Rr(m,a,u),properties:m.properties,type:m.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(Qd("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,b,a,{},n.availableImages,u),n.featureIndex.insert(m,I.geometry,b,S,this.index,L)}this.sortBorders()}addFeatures(t,n,a,u,m){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,n,a,u,m)}this.sortBorders()}update(t,n,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vm),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Nm.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Tf.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,a,u,m,y,b){const S=[new Mt(0,0),new Mt(Xe,Xe)],M=b.projection,k="globe"===M.name,I=this.enableTerrain&&!k?new Df:null,L="Polygon"===qm[t.type];k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Js);const B=Kd(n,500);for(let nt=B.length-1;nt>=0;nt--){const ht=B[nt];(0===ht.length||(F=ht[0]).every(tt=>tt.x<=0)||F.every(tt=>tt.x>=Xe)||F.every(tt=>tt.y<=0)||F.every(tt=>tt.y>=Xe))&&B.splice(nt,1)}var F;let j;if(k)j=sp(B,S,u);else{j=[];for(const nt of B)j.push({polygon:nt,bounds:S})}const $=L?this.edgeRadius:0;for(const{polygon:nt,bounds:ht}of j){let tt=0,at=0;for(const ut of nt)L&&!ut[0].equals(ut[ut.length-1])&&ut.push(ut[0]),at+=L?ut.length-1:ut.length;const ft=this.segments.prepareSegment((L?5:4)*at,this.layoutVertexArray,this.indexArray);if(L){const ut=[],Ft=[];tt=ft.vertexLength;for(const Wt of nt){let he,jt;Wt.length&&Wt!==nt[0]&&Ft.push(ut.length/2),he=Wt[1].sub(Wt[0])._perp()._unit();for(let Kt=1;Kt<Wt.length;Kt++){const te=Wt[Kt],oe=Wt[Kt===Wt.length-1?1:Kt+1];let{x:ue,y:Gt}=te;if($){jt=oe.sub(te)._perp()._unit();const ve=he.add(jt)._unit(),$e=$*Math.min(4,1/(he.x*ve.x+he.y*ve.y));ue+=$e*ve.x,Gt+=$e*ve.y,he=jt}uc(this.layoutVertexArray,ue,Gt,0,0,1,1,0),ft.vertexLength++,ut.push(te.x,te.y),k&&Lh(this.layoutVertexExtArray,M.projectTilePoint(ue,Gt,u),M.upVector(u,ue,Gt))}}const Rt=cc(ut,Ft);for(let Wt=0;Wt<Rt.length;Wt+=3)this.indexArray.emplaceBack(tt+Rt[Wt],tt+Rt[Wt+2],tt+Rt[Wt+1]),ft.primitiveLength++}for(const ut of nt){I&&ut.length&&I.startRing(ut[0]);let Ft,Rt,Wt,he=ut.length>4&&ip(ut[ut.length-2],ut[0],ut[1]),jt=$?$m(ut[ut.length-2],ut[0],ut[1],$):0;Rt=ut[1].sub(ut[0])._perp()._unit();let Kt=!0;for(let te=1,oe=0;te<ut.length;te++){let ue=ut[te-1],Gt=ut[te];const ve=ut[te===ut.length-1?1:te+1];if(I&&L&&I.currentPolyCount.top++,If(Gt,ue,ht)){$&&(Rt=ve.sub(Gt)._perp()._unit(),Kt=!Kt);continue}I&&I.append(Gt,ue);const $e=Gt.sub(ue)._perp(),Se=$e.x/(Math.abs($e.x)+Math.abs($e.y)),Oe=$e.y>0?1:0,be=ue.dist(Gt);if(oe+be>32768&&(oe=0),$){Wt=ve.sub(Gt)._perp()._unit();let ci=Gu(ue,Gt,ve,Pf(Rt,Wt),$);isNaN(ci)&&(ci=0);const Ke=Gt.sub(ue)._unit();ue=ue.add(Ke.mult(jt))._round(),Gt=Gt.add(Ke.mult(-ci))._round(),jt=ci,Rt=Wt}const Ye=ft.vertexLength,mi=ut.length>4&&ip(ue,Gt,ve);let fi=np(oe,he,Kt);if(uc(this.layoutVertexArray,ue.x,ue.y,Se,Oe,0,0,fi),uc(this.layoutVertexArray,ue.x,ue.y,Se,Oe,0,1,fi),oe+=be,fi=np(oe,mi,!Kt),he=mi,uc(this.layoutVertexArray,Gt.x,Gt.y,Se,Oe,0,0,fi),uc(this.layoutVertexArray,Gt.x,Gt.y,Se,Oe,0,1,fi),ft.vertexLength+=4,this.indexArray.emplaceBack(Ye+0,Ye+1,Ye+2),this.indexArray.emplaceBack(Ye+1,Ye+3,Ye+2),ft.primitiveLength+=2,$){const ci=tt+(1===te?ut.length-2:te-2),Ke=1===te?tt:ci+1;if(this.indexArray.emplaceBack(Ye+1,ci,Ye+3),this.indexArray.emplaceBack(ci,Ke,Ye+3),ft.primitiveLength+=2,void 0===Ft&&(Ft=Ye),!If(ve,ut[te],ht)){const Bi=te===ut.length-1?Ft:ft.vertexLength;this.indexArray.emplaceBack(Ye+2,Ye+3,Bi),this.indexArray.emplaceBack(Ye+3,Bi+1,Bi),this.indexArray.emplaceBack(Ye+3,Ke,Bi+1),ft.primitiveLength+=3}Kt=!Kt}if(k){const ci=this.layoutVertexExtArray,Ke=M.projectTilePoint(ue.x,ue.y,u),Bi=M.projectTilePoint(Gt.x,Gt.y,u),ti=M.upVector(u,ue.x,ue.y),gi=M.upVector(u,Gt.x,Gt.y);Lh(ci,Ke,ti),Lh(ci,Ke,ti),Lh(ci,Bi,gi),Lh(ci,Bi,gi)}}L&&(tt+=ut.length-1)}}if(I&&I.polyCount.length>0){if(I.borders){I.vertexArrayOffset=this.centroidVertexArray.length;const nt=I.borders,ht=this.featuresOnBorder.push(I)-1;for(let tt=0;tt<4;tt++)nt[tt][0]!==Number.MAX_VALUE&&this.borders[tt].push(ht)}this.encodeCentroid(I.borders?void 0:I.centroid(),I)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,y,u)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((n,a)=>this.featuresOnBorder[n].borders[t][0]-this.featuresOnBorder[a].borders[t][0])}encodeCentroid(t,n,a=!0){let u,m;if(t)if(0!==t.y){const b=n.span()._mult(this.tileToMeter);u=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(b.x/10)),m=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(b.y/10))}else u=Math.ceil(7*(t.x+450)),m=0;else u=0,m=+a;let y=a?this.centroidVertexArray.length:n.vertexArrayOffset;for(const b of n.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*b.edges+b.top);for(let S=0;S<b.top;S++)this.centroidVertexArray.emplace(y++,u,m);for(let S=0;S<2*b.edges;S++)this.centroidVertexArray.emplace(y++,0,m),this.centroidVertexArray.emplace(y++,u,m)}}}function Pf(e,t){const n=e.add(t)._unit();return e.x*n.x+e.y*n.y}function $m(e,t,n,a){const u=t.sub(e)._perp()._unit(),m=n.sub(t)._perp()._unit();return Gu(e,t,n,Pf(u,m),a)}function Gu(e,t,n,a,u){const m=Math.sqrt(1-a*a);return Math.min(e.dist(t)/3,t.dist(n)/3,u*m/a)}function If(e,t,n){return e.x<n[0].x&&t.x<n[0].x||e.x>n[1].x&&t.x>n[1].x||e.y<n[0].y&&t.y<n[0].y||e.y>n[1].y&&t.y>n[1].y}function ip(e,t,n){if(e.x<0||e.x>=Xe||t.x<0||t.x>=Xe||n.x<0||n.x>=Xe)return!1;const a=n.sub(t),u=a.perp(),m=e.sub(t);return(a.x*m.x+a.y*m.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(m.x*m.x+m.y*m.y))>-.866&&u.x*m.x+u.y*m.y<0}function np(e,t,n){const a=t?2|e:-3&e;return n?1|a:-2&a}function Lf(){const e=Math.PI/32,t=Math.tan(e),n=wh;return n*Math.sqrt(1+2*t*t)-n}function sp(e,t,n){const a=1<<n.z,u=eo(n.x/a),m=eo((n.x+1)/a),y=Xn(n.y/a),b=Xn((n.y+1)/a);return function(S,M,k,I,L=0,B){const F=[];if(!S.length||!k||!I)return F;const j=(ut,Ft)=>{for(const Rt of ut)F.push({polygon:Rt,bounds:Ft})},$=Math.ceil(Math.log2(k)),nt=Math.ceil(Math.log2(I)),ht=$-nt,tt=[];for(let ut=0;ut<Math.abs(ht);ut++)tt.push(ht>0?0:1);for(let ut=0;ut<Math.min($,nt);ut++)tt.push(0),tt.push(1);let at=S;if(at=Zu(at,M[0].y-L,M[1].y+L,1),at=Zu(at,M[0].x-L,M[1].x+L,0),!at.length)return F;const ft=[];for(tt.length?ft.push({polygons:at,bounds:M,depth:0}):j(at,M);ft.length;){const ut=ft.pop(),Ft=ut.depth,Rt=tt[Ft],Wt=ut.bounds[0],he=ut.bounds[1],jt=0===Rt?Wt.x:Wt.y,Kt=0===Rt?he.x:he.y,te=B?B(Rt,jt,Kt):.5*(jt+Kt),oe=Zu(ut.polygons,jt-L,te+L,Rt),ue=Zu(ut.polygons,te-L,Kt+L,Rt);if(oe.length){const Gt=[Wt,new Mt(0===Rt?te:he.x,1===Rt?te:he.y)];tt.length>Ft+1?ft.push({polygons:oe,bounds:Gt,depth:Ft+1}):j(oe,Gt)}if(ue.length){const Gt=[new Mt(0===Rt?te:Wt.x,1===Rt?te:Wt.y),he];tt.length>Ft+1?ft.push({polygons:ue,bounds:Gt,depth:Ft+1}):j(ue,Gt)}}return F}(e,t,Math.ceil((m-u)/11.25),Math.ceil((y-b)/11.25),1,(S,M,k)=>{if(0===S)return.5*(M+k);{const I=Xn((n.y+M/Xe)/a);return(to(.5*(Xn((n.y+k/Xe)/a)+I))*a-n.y)*Xe}})}De(Rh,"FillExtrusionBucket",{omit:["layers","features"]}),De(Df,"PartMetadata");const Wm=new se({"fill-extrusion-edge-radius":new wt(Ht["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Rf={paint:new se({"fill-extrusion-opacity":new wt(Ht["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Nt(Ht["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wt(Ht["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wt(Ht["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Nt(Ht["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Nt(Ht["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Nt(Ht["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new wt(Ht["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new wt(Ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new wt(Ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Wm};function zf(e,t,n){var a=2*Math.PI*6378137/256/Math.pow(2,n);return[e*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class zh{constructor(t,n,a){this.z=t,this.x=n,this.y=a,this.key=Oh(0,t,t,n,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n){const a=(y=this.y,b=this.z,S=zf(256*(m=this.x),256*(y=Math.pow(2,b)-y-1),b),M=zf(256*(m+1),256*(y+1),b),S[0]+","+S[1]+","+M[0]+","+M[1]),u=function(m,y,b){let S,M="";for(let k=m;k>0;k--)S=1<<k-1,M+=(y&S?1:0)+(b&S?2:0);return M}(this.z,this.x,this.y);var m,y,b,S,M;return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Of{constructor(t,n){this.wrap=t,this.canonical=n,this.key=Oh(t,n.z,n.z,n.x,n.y)}}class _s{constructor(t,n,a,u,m){this.overscaledZ=t,this.wrap=n,this.canonical=new zh(a,+u,+m),this.key=0===n&&t===a?this.canonical.key:Oh(n,t,a,u,m)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const n=this.canonical.z-t;return t>this.canonical.z?new _s(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _s(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n=!0){if(this.overscaledZ===t&&n)return this.key;if(t>this.canonical.z)return Oh(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-t;return Oh(this.wrap*+n,t,t,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new _s(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new _s(n,this.wrap,n,a,u),new _s(n,this.wrap,n,a+1,u),new _s(n,this.wrap,n,a,u+1),new _s(n,this.wrap,n,a+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new _s(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new _s(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Of(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Oh(e,t,n,a,u){const m=1<<Math.min(n,22);let y=m*(u%m)+a%m;return e&&n<22&&(y+=m*m*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*y+n)+(t-n)}De(zh,"CanonicalTileID"),De(_s,"OverscaledTileID",{omit:["projMatrix"]});class fl extends Mt{constructor(t,n,a){super(t,n),this.z=a}}function Bh(e,t){return e.x*t.x+e.y*t.y}function Bf(e,t){if(1===e.length){let n=0;const a=t[n++];let u;for(;!u||a.equals(u);)if(u=t[n++],!u)return 1/0;for(;n<t.length;n++){const m=t[n],y=e[0],b=u.sub(a),S=m.sub(a),M=y.sub(a),k=Bh(b,b),I=Bh(b,S),L=Bh(S,S),B=Bh(M,b),F=Bh(M,S),j=k*L-I*I,$=(L*B-I*F)/j,nt=(k*F-I*B)/j,ht=a.z*(1-$-nt)+u.z*$+m.z*nt;if(isFinite(ht))return ht}return 1/0}{let n=1/0;for(const a of t)n=Math.min(n,a.z);return n}}function qu(e,t,n,a,u,m,y,b){const S=y*u.getElevationAt(e,t,!0,!0),M=0!==m[0],k=M?0===m[1]?y*(m[0]/7-450):y*function(I,L,B){const F=Math.floor(L[0]/8),j=Math.floor(L[1]/8),$=10*(L[0]-8*F),nt=10*(L[1]-8*j),ht=I.getElevationAt(F,j,!0,!0),tt=I.getMeterToDEM(B),at=Math.floor(.5*($*tt-1)),ft=Math.floor(.5*(nt*tt-1)),ut=I.tileCoordToPixel(F,j),Ft=2*at+1,Rt=2*ft+1,Wt=($e=Ft,Se=Rt,[(ue=I).getElevationAtPixel(Gt=ut.x-at,ve=ut.y-ft,!0),ue.getElevationAtPixel(Gt+Se,ve,!0),ue.getElevationAtPixel(Gt,ve+Se,!0),ue.getElevationAtPixel(Gt+$e,ve+Se,!0)]),he=Math.abs(Wt[0]-Wt[1]),jt=Math.abs(Wt[2]-Wt[3]),Kt=Math.abs(Wt[0]-Wt[2])+Math.abs(Wt[1]-Wt[3]),te=Math.min(.25,.5*tt*(he+jt)/Ft),oe=Math.min(.25,.5*tt*Kt/Rt);var ue,Gt,ve,$e,Se;return ht+Math.max(te*$,oe*nt)}(u,m,b):S;return{base:S+(0===n)?-1:n,top:M?Math.max(k+a,S+n+2):S+a}}const Xm=Ue([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Ym}=Xm,Hu=Ue([{name:"a_packed",components:4,type:"Float32"}]),{members:Jm}=Hu,Fh=ju.types,pr=Math.cos(Math.PI/180*37.5);class yo{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Ni,this.layoutVertexArray2=new zi,this.indexArray=new Wn,this.programConfigurations=new Fs(t.layers,t.zoom),this.segments=new bn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a,u){this.hasPattern=Uu("line",this.layers,n);const m=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:k,id:I,index:L,sourceLayerIndex:B}of t){const F=this.layers[0]._featureFilter.needGeometry,j=zr(k,F);if(!this.layers[0]._featureFilter.filter(new Et(this.zoom),j,a))continue;const $=m?m.evaluate(j,{},a):void 0,nt={id:I,properties:k.properties,type:k.type,sourceLayerIndex:B,index:L,geometry:F?j.geometry:Rr(k,a,u),patterns:{},sortKey:$};y.push(nt)}m&&y.sort((k,I)=>k.sortKey-I.sortKey);const{lineAtlas:b,featureIndex:S}=n,M=this.addConstantDashes(b);for(const k of y){const{geometry:I,index:L,sourceLayerIndex:B}=k;if(M&&this.addFeatureDashes(k,b),this.hasPattern){const F=Qd("line",this.layers,k,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(k,I,L,a,b.positions,n.availableImages);S.insert(t[L].feature,I,L,B,this.index)}}addConstantDashes(t){let n=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,m=a.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==m.kind)n=!0;else{const y=m.value,b=u.value;if(!b)continue;t.addDash(b,y)}}return n}addFeatureDashes(t,n){const a=this.zoom;for(const u of this.layers){const m=u.paint.get("line-dasharray").value,y=u.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===y.kind)continue;let b,S;if("constant"===m.kind){if(b=m.value,!b)continue}else b=m.evaluate({zoom:a},t);S="constant"===y.kind?y.value:y.evaluate({zoom:a},t),n.addDash(b,S),t.patterns[u.id]=n.getKey(b,S)}}update(t,n,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a,u)}addFeatures(t,n,a,u,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Jm)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ym),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,a,u,m,y){const b=this.layers[0].layout,S=b.get("line-join").evaluate(t,{}),M=b.get("line-cap").evaluate(t,{}),k=b.get("line-miter-limit"),I=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const L of n)this.addLine(L,t,S,M,k,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,y,u)}addLine(t,n,a,u,m,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let nt=0;nt<t.length-1;nt++)this.totalDistance+=t[nt].dist(t[nt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b="Polygon"===Fh[n.type];let S=t.length;for(;S>=2&&t[S-1].equals(t[S-2]);)S--;let M=0;for(;M<S-1&&t[M].equals(t[M+1]);)M++;if(S<(b?3:2))return;"bevel"===a&&(m=1.05);const k=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let L,B,F,j,$;this.e1=this.e2=-1,b&&(L=t[S-2],$=t[M].sub(L)._unit()._perp());for(let nt=M;nt<S;nt++){if(F=nt===S-1?b?t[M+1]:void 0:t[nt+1],F&&t[nt].equals(F))continue;$&&(j=$),L&&(B=L),L=t[nt],$=F?F.sub(L)._unit()._perp():j,j=j||$;let ht=j.add($);0===ht.x&&0===ht.y||ht._unit();const tt=j.x*$.x+j.y*$.y,at=ht.x*$.x+ht.y*$.y,ft=0!==at?1/at:1/0,ut=2*Math.sqrt(2-2*at),Ft=at<pr&&B&&F,Rt=j.x*$.y-j.y*$.x>0;if(Ft&&nt>M){const jt=L.dist(B);if(jt>2*k){const Kt=L.sub(L.sub(B)._mult(k/jt)._round());this.updateDistance(B,Kt),this.addCurrentVertex(Kt,j,0,0,I),B=Kt}}const Wt=B&&F;let he=Wt?a:b?"butt":u;if(Wt&&"round"===he&&(ft<y?he="miter":ft<=2&&(he="fakeround")),"miter"===he&&ft>m&&(he="bevel"),"bevel"===he&&(ft>2&&(he="flipbevel"),ft<m&&(he="miter")),B&&this.updateDistance(B,L),"miter"===he)ht._mult(ft),this.addCurrentVertex(L,ht,0,0,I);else if("flipbevel"===he){if(ft>100)ht=$.mult(-1);else{const jt=ft*j.add($).mag()/j.sub($).mag();ht._perp()._mult(jt*(Rt?-1:1))}this.addCurrentVertex(L,ht,0,0,I),this.addCurrentVertex(L,ht.mult(-1),0,0,I)}else if("bevel"===he||"fakeround"===he){const jt=-Math.sqrt(ft*ft-1),Kt=Rt?jt:0,te=Rt?0:jt;if(B&&this.addCurrentVertex(L,j,Kt,te,I),"fakeround"===he){const oe=Math.round(180*ut/Math.PI/20);for(let ue=1;ue<oe;ue++){let Gt=ue/oe;if(.5!==Gt){const $e=Gt-.5;Gt+=Gt*$e*(Gt-1)*((1.0904+tt*(tt*(3.55645-1.43519*tt)-3.2452))*$e*$e+(.848013+tt*(.215638*tt-1.06021)))}const ve=$.sub(j)._mult(Gt)._add(j)._unit()._mult(Rt?-1:1);this.addHalfVertex(L,ve.x,ve.y,!1,Rt,0,I)}}F&&this.addCurrentVertex(L,$,-Kt,-te,I)}else if("butt"===he)this.addCurrentVertex(L,ht,0,0,I);else if("square"===he){const jt=B?1:-1;B||this.addCurrentVertex(L,ht,jt,jt,I),this.addCurrentVertex(L,ht,0,0,I),B&&this.addCurrentVertex(L,ht,jt,jt,I)}else"round"===he&&(B&&(this.addCurrentVertex(L,j,0,0,I),this.addCurrentVertex(L,j,1,1,I,!0)),F&&(this.addCurrentVertex(L,$,-1,-1,I,!0),this.addCurrentVertex(L,$,0,0,I)));if(Ft&&nt<S-1){const jt=L.dist(F);if(jt>2*k){const Kt=L.add(F.sub(L)._mult(k/jt)._round());this.updateDistance(L,Kt),this.addCurrentVertex(Kt,$,0,0,I),L=Kt}}}}addCurrentVertex(t,n,a,u,m,y=!1){const b=n.y*u-n.x,S=-n.y-n.x*u;this.addHalfVertex(t,n.x+n.y*a,n.y-n.x*a,y,!1,a,m),this.addHalfVertex(t,b,S,y,!0,-u,m)}addHalfVertex({x:t,y:n},a,u,m,y,b,S){this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(n<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(0===b?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const M=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),S.primitiveLength++),y?this.e2=M:this.e1=M}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}De(yo,"LineBucket",{omit:["layers","patternFeatures"]});const Km=new se({"line-cap":new Nt(Ht.layout_line["line-cap"]),"line-join":new Nt(Ht.layout_line["line-join"]),"line-miter-limit":new wt(Ht.layout_line["line-miter-limit"]),"line-round-limit":new wt(Ht.layout_line["line-round-limit"]),"line-sort-key":new Nt(Ht.layout_line["line-sort-key"])});var op={paint:new se({"line-opacity":new Nt(Ht.paint_line["line-opacity"]),"line-color":new Nt(Ht.paint_line["line-color"]),"line-translate":new wt(Ht.paint_line["line-translate"]),"line-translate-anchor":new wt(Ht.paint_line["line-translate-anchor"]),"line-width":new Nt(Ht.paint_line["line-width"]),"line-gap-width":new Nt(Ht.paint_line["line-gap-width"]),"line-offset":new Nt(Ht.paint_line["line-offset"]),"line-blur":new Nt(Ht.paint_line["line-blur"]),"line-dasharray":new Nt(Ht.paint_line["line-dasharray"]),"line-pattern":new Nt(Ht.paint_line["line-pattern"]),"line-gradient":new ee(Ht.paint_line["line-gradient"]),"line-trim-offset":new wt(Ht.paint_line["line-trim-offset"])}),layout:Km};const Ff=new class extends Nt{possiblyEvaluate(e,t){return t=new Et(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,a){return t=ni({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,a)}}(op.paint.properties["line-width"].specification);function Uf(e,t){return t>0?t+2*e:e}Ff.useIntegerZoom=!0;const Qm=Ue([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Nf=Ue([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),tg=Ue([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ue([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const eg=Ue([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Vf=Ue([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ue([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Uh=Ue([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),jf=Ue([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ue([{name:"triangle",components:3,type:"Uint16"}]),Ue([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ue([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ue([{type:"Float32",name:"offsetX"}]),Ue([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Yn=24;const Go=128;function $u(e,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Et(e+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:a,interpolationType:u}=n;let m=0;for(;m<a.length&&a[m]<=e;)m++;m=Math.max(0,m-1);let y=m;for(;y<a.length&&a[y]<e+1;)y++;y=Math.min(a.length-1,y);const b=a[m],S=a[y];return"composite"===n.kind?{kind:"composite",minZoom:b,maxZoom:S,interpolationType:u}:{kind:"camera",minZoom:b,maxZoom:S,minSize:n.evaluate(new Et(b)),maxSize:n.evaluate(new Et(S)),interpolationType:u}}}function is(e,{uSize:t,uSizeT:n},{lowerSize:a,upperSize:u}){return"source"===e.kind?a/Go:"composite"===e.kind?ui(a/Go,u/Go,n):t}function ml(e,t){let n=0,a=0;if("constant"===e.kind)a=e.layoutSize;else if("source"!==e.kind){const{interpolationType:u,minZoom:m,maxZoom:y}=e,b=u?Je(co.interpolationFactor(u,t,m,y),0,1):0;"camera"===e.kind?a=ui(e.minSize,e.maxSize,b):n=b}return{uSizeT:n,uSize:a}}var ig=Object.freeze({__proto__:null,getSizeData:$u,evaluateSizeForFeature:is,evaluateSizeForZoom:ml,SIZE_PACK_FACTOR:Go});function ng(e,t,n){return e.sections.forEach(a=>{a.text=function(u,m,y){const b=m.layout.get("text-transform").evaluate(y,{});return"uppercase"===b?u=u.toLocaleUpperCase():"lowercase"===b&&(u=u.toLocaleLowerCase()),xt.applyArabicShaping&&(u=xt.applyArabicShaping(u)),u}(a.text,t,n)}),e}const Nh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function sg(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function og(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}var dc=Oi,Zf=function(e,t,n,a,u){var m,y,b=8*u-a-1,S=(1<<b)-1,M=S>>1,k=-7,I=n?u-1:0,L=n?-1:1,B=e[t+I];for(I+=L,m=B&(1<<-k)-1,B>>=-k,k+=b;k>0;m=256*m+e[t+I],I+=L,k-=8);for(y=m&(1<<-k)-1,m>>=-k,k+=a;k>0;y=256*y+e[t+I],I+=L,k-=8);if(0===m)m=1-M;else{if(m===S)return y?NaN:1/0*(B?-1:1);y+=Math.pow(2,a),m-=M}return(B?-1:1)*y*Math.pow(2,m-a)},Gf=function(e,t,n,a,u,m){var y,b,S,M=8*m-u-1,k=(1<<M)-1,I=k>>1,L=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,B=a?0:m-1,F=a?1:-1,j=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(b=isNaN(t)?1:0,y=k):(y=Math.floor(Math.log(t)/Math.LN2),t*(S=Math.pow(2,-y))<1&&(y--,S*=2),(t+=y+I>=1?L/S:L*Math.pow(2,1-I))*S>=2&&(y++,S/=2),y+I>=k?(b=0,y=k):y+I>=1?(b=(t*S-1)*Math.pow(2,u),y+=I):(b=t*Math.pow(2,I-1)*Math.pow(2,u),y=0));u>=8;e[n+B]=255&b,B+=F,b/=256,u-=8);for(y=y<<u|b,M+=u;M>0;e[n+B]=255&y,B+=F,y/=256,M-=8);e[n+B-F]|=128*j};function Oi(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Oi.Varint=0,Oi.Fixed64=1,Oi.Bytes=2,Oi.Fixed32=5;var pc=4294967296,Wu=1/pc,fc=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ks(e){return e.type===Oi.Bytes?e.readVarint()+e.pos:e.pos+1}function rp(e,t,n){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(a);for(var u=n.pos-1;u>=e;u--)n.buf[u+a]=n.buf[u]}function rg(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function ag(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function ap(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function lp(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function lg(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function qf(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function cg(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function hg(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function ug(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function Xu(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function mc(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function Hf(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function dg(e,t,n){t.glyphs=[],1===e&&n.readMessage(pg,t)}function pg(e,t,n){if(3===e){const{id:a,bitmap:u,width:m,height:y,left:b,top:S,advance:M}=n.readMessage(fg,{});t.glyphs.push({id:a,bitmap:new Or({width:m+6,height:y+6},u),metrics:{width:m,height:y,left:b,top:S,advance:M}})}else 4===e?t.ascender=n.readSVarint():5===e&&(t.descender=n.readSVarint())}function fg(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}function cp(e){let t=0,n=0;for(const y of e)t+=y.w*y.h,n=Math.max(n,y.w);e.sort((y,b)=>b.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let u=0,m=0;for(const y of e)for(let b=a.length-1;b>=0;b--){const S=a[b];if(!(y.w>S.w||y.h>S.h)){if(y.x=S.x,y.y=S.y,m=Math.max(m,y.y+y.h),u=Math.max(u,y.x+y.w),y.w===S.w&&y.h===S.h){const M=a.pop();b<a.length&&(a[b]=M)}else y.h===S.h?(S.x+=y.w,S.w-=y.w):y.w===S.w?(S.y+=y.h,S.h-=y.h):(a.push({x:S.x+y.w,y:S.y,w:S.w-y.w,h:y.h}),S.y+=y.h,S.h-=y.h);break}}return{w:u,h:m,fill:t/(u*m)||0}}Oi.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),u=a>>3,m=this.pos;this.type=7&a,e(u,t,this),this.pos===m&&this.skip(a)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Xu(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Hf(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Xu(this.buf,this.pos)+Xu(this.buf,this.pos+4)*pc;return this.pos+=8,e},readSFixed64:function(){var e=Xu(this.buf,this.pos)+Hf(this.buf,this.pos+4)*pc;return this.pos+=8,e},readFloat:function(){var e=Zf(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Zf(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,a=this.buf;return t=127&(n=a[this.pos++]),n<128?t:(t|=(127&(n=a[this.pos++]))<<7,n<128?t:(t|=(127&(n=a[this.pos++]))<<14,n<128?t:(t|=(127&(n=a[this.pos++]))<<21,n<128?t:function(u,m,y){var b,S,M=y.buf;if(b=(112&(S=M[y.pos++]))>>4,S<128||(b|=(127&(S=M[y.pos++]))<<3,S<128)||(b|=(127&(S=M[y.pos++]))<<10,S<128)||(b|=(127&(S=M[y.pos++]))<<17,S<128)||(b|=(127&(S=M[y.pos++]))<<24,S<128)||(b|=(1&(S=M[y.pos++]))<<31,S<128))return function gl(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}(u,b,m);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=a[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&fc?fc.decode(this.buf.subarray(t,e)):function(n,a,u){for(var m="",y=a;y<u;){var b,S,M,k=n[y],I=null,L=k>239?4:k>223?3:k>191?2:1;if(y+L>u)break;1===L?k<128&&(I=k):2===L?128==(192&(b=n[y+1]))&&(I=(31&k)<<6|63&b)<=127&&(I=null):3===L?(S=n[y+2],128==(192&(b=n[y+1]))&&128==(192&S)&&((I=(15&k)<<12|(63&b)<<6|63&S)<=2047||I>=55296&&I<=57343)&&(I=null)):4===L&&(S=n[y+2],M=n[y+3],128==(192&(b=n[y+1]))&&128==(192&S)&&128==(192&M)&&((I=(15&k)<<18|(63&b)<<12|(63&S)<<6|63&M)<=65535||I>=1114112)&&(I=null)),null===I?(I=65533,L=1):I>65535&&(I-=65536,m+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),m+=String.fromCharCode(I),y+=L}return m}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Oi.Bytes)return e.push(this.readVarint(t));var n=ks(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Oi.Bytes)return e.push(this.readSVarint());var t=ks(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Oi.Bytes)return e.push(this.readBoolean());var t=ks(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Oi.Bytes)return e.push(this.readFloat());var t=ks(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Oi.Bytes)return e.push(this.readDouble());var t=ks(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Oi.Bytes)return e.push(this.readFixed32());var t=ks(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Oi.Bytes)return e.push(this.readSFixed32());var t=ks(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Oi.Bytes)return e.push(this.readFixed64());var t=ks(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Oi.Bytes)return e.push(this.readSFixed64());var t=ks(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Oi.Varint)for(;this.buf[this.pos++]>127;);else if(t===Oi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Oi.Fixed32)this.pos+=4;else{if(t!==Oi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),mc(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),mc(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),mc(this.buf,-1&e,this.pos),mc(this.buf,Math.floor(e*Wu),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),mc(this.buf,-1&e,this.pos),mc(this.buf,Math.floor(e*Wu),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,n){var a,u,m,b;if(t>=0?(a=t%4294967296|0,u=t/4294967296|0):(u=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,u=u+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),m=a,(b=n).buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7),function(m,y){var b=(7&m)<<4;y.buf[y.pos++]|=b|((m>>>=3)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m)))))}(u,n)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(a,u,m){for(var y,b,S=0;S<u.length;S++){if((y=u.charCodeAt(S))>55295&&y<57344){if(!b){y>56319||S+1===u.length?(a[m++]=239,a[m++]=191,a[m++]=189):b=y;continue}if(y<56320){a[m++]=239,a[m++]=191,a[m++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(a[m++]=239,a[m++]=191,a[m++]=189,b=null);y<128?a[m++]=y:(y<2048?a[m++]=y>>6|192:(y<65536?a[m++]=y>>12|224:(a[m++]=y>>18|240,a[m++]=y>>12&63|128),a[m++]=y>>6&63|128),a[m++]=63&y|128)}return m}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&rp(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),Gf(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Gf(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var a=this.pos-n;a>=128&&rp(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(e,t,n){this.writeTag(e,Oi.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,rg,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,ag,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,lg,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,ap,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,lp,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,qf,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,cg,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,hg,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,ug,t)},writeBytesField:function(e,t){this.writeTag(e,Oi.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Oi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Oi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Oi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Oi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Oi.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Oi.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Oi.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Oi.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Oi.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};class Yu{constructor(t,{pixelRatio:n,version:a,stretchX:u,stretchY:m,content:y}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=u,this.stretchY=m,this.content=y,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class $f{constructor(t,n){const a={},u={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,a,m),this.addImages(n,u,m);const{w:y,h:b}=cp(m),S=new jn({width:y||1,height:b||1});for(const M in t){const k=t[M],I=a[M].paddedRect;jn.copy(k.data,S,{x:0,y:0},{x:I.x+1,y:I.y+1},k.data)}for(const M in n){const k=n[M],I=u[M].paddedRect,L=I.x+1,B=I.y+1,F=k.data.width,j=k.data.height;jn.copy(k.data,S,{x:0,y:0},{x:L,y:B},k.data),jn.copy(k.data,S,{x:0,y:j-1},{x:L,y:B-1},{width:F,height:1}),jn.copy(k.data,S,{x:0,y:0},{x:L,y:B+j},{width:F,height:1}),jn.copy(k.data,S,{x:F-1,y:0},{x:L-1,y:B},{width:1,height:j}),jn.copy(k.data,S,{x:0,y:0},{x:L+F,y:B},{width:1,height:j})}this.image=S,this.iconPositions=a,this.patternPositions=u}addImages(t,n,a){for(const u in t){const m=t[u],y={x:0,y:0,w:m.data.width+2,h:m.data.height+2};a.push(y),n[u]=new Yu(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>t.hasImage(a)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),n),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),n)}patchUpdatedImage(t,n,a){if(!t||!n||t.version===n.version)return;t.version=n.version;const[u,m]=t.tl;a.update(n.data,void 0,{x:u,y:m})}}De(Yu,"ImagePosition"),De($f,"ImageAtlas");const io={horizontal:1,vertical:2,horizontalOnly:3};class Br{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const a=new Br;return a.scale=t||1,a.fontStack=n,a}static forImage(t){const n=new Br;return n.imageName=t,n}}class Fr{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const a=new Fr;for(let u=0;u<t.sections.length;u++){const m=t.sections[u];m.image?a.addImageSection(m):a.addTextSection(m,n)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(n,a){let u="";for(let m=0;m<n.length;m++){const y=n.charCodeAt(m+1)||null,b=n.charCodeAt(m-1)||null;u+=!a&&(y&&P(y)&&!Nh[n[m+1]]||b&&P(b)&&!Nh[n[m-1]])||!Nh[n[m]]?n[m]:Nh[n[m]]}return u}(this.text,t)}trim(){let t=0;for(let a=0;a<this.text.length&&Ju[this.text.charCodeAt(a)];a++)t++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&Ju[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const a=new Fr;return a.text=this.text.substring(t,n),a.sectionIndex=this.sectionIndex.slice(t,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(Br.forText(t.scale,t.fontStack||n));const a=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(a)}addImageSection(t){const n=t.image?t.image.name:"";if(0===n.length)return void on("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Br.forImage(n)),this.sectionIndex.push(this.sections.length-1)):on("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ys(e,t,n,a,u,m,y,b,S,M,k,I,L,B,F){const j=Fr.fromFeature(e,u);I===io.vertical&&j.verticalizePunctuation(L);let $=[];const nt=function(ut,Ft,Rt,Wt,he,jt){if(!ut)return[];const Kt=[],te=function(ve,$e,Se,Oe,be,Ye){let mi=0;for(let fi=0;fi<ve.length();fi++){const ci=ve.getSection(fi);mi+=hp(ve.getCharCode(fi),ci,Oe,be,$e,Ye)}return mi/Math.max(1,Math.ceil(mi/Se))}(ut,Ft,Rt,Wt,he,jt),oe=ut.text.indexOf("\u200b")>=0;let ue=0;for(let ve=0;ve<ut.length();ve++){const $e=ut.getSection(ve),Se=ut.getCharCode(ve);if(Ju[Se]||(ue+=hp(Se,$e,Wt,he,Ft,jt)),ve<ut.length()-1){const Oe=!((Gt=Se)<11904||!(Qc(Gt)||ho(Gt)||f(Gt)||yu(Gt)||il(Gt)||tc(Gt)||ec(Gt)||el(Gt)||nl(Gt)||th(Gt)||uo(Gt)||g(Gt)||Cr(Gt)||hn(Gt)||Kc(Gt)||ic(Gt)||_a(Gt)||Fo(Gt)||gu(Gt)||mu(Gt)));(Wf[Se]||Oe||$e.imageName)&&Kt.push(up(ve+1,ue,te,Kt,mg(Se,ut.getCharCode(ve+1),Oe&&oe),!1))}}var Gt;return Yf(up(ut.length(),ue,te,Kt,0,!0))}(j,M,m,t,a,B),{processBidirectionalText:ht,processStyledBidirectionalText:tt}=xt;if(ht&&1===j.sections.length){const ut=ht(j.toString(),nt);for(const Ft of ut){const Rt=new Fr;Rt.text=Ft,Rt.sections=j.sections;for(let Wt=0;Wt<Ft.length;Wt++)Rt.sectionIndex.push(0);$.push(Rt)}}else if(tt){const ut=tt(j.text,j.sectionIndex,nt);for(const Ft of ut){const Rt=new Fr;Rt.text=Ft[0],Rt.sectionIndex=Ft[1],Rt.sections=j.sections,$.push(Rt)}}else $=function(ut,Ft){const Rt=[],Wt=ut.text;let he=0;for(const jt of Ft)Rt.push(ut.substring(he,jt)),he=jt;return he<Wt.length&&Rt.push(ut.substring(he,Wt.length)),Rt}(j,nt);const at=[],ft={positionedLines:at,text:j.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ut,Ft,Rt,Wt,he,jt,Kt,te,oe,ue,Gt,ve){let $e=0,Se=0,Oe=0;const be="right"===te?1:"left"===te?0:.5;let Ye=!1;for(const ti of he){const gi=ti.getSections();for(const ji of gi){if(ji.imageName)continue;const nn=Ft[ji.fontStack];if(nn&&(Ye=void 0!==nn.ascender&&void 0!==nn.descender,!Ye))break}if(!Ye)break}let mi=0;for(const ti of he){ti.trim();const gi=ti.getMaxScale(),ji=(gi-1)*Yn,nn={positionedGlyphs:[],lineOffset:0};ut.positionedLines[mi]=nn;const Yi=nn.positionedGlyphs;let sn=0;if(!ti.length()){Se+=jt,++mi;continue}let an=0,Sn=0;for(let Fi=0;Fi<ti.length();Fi++){const zn=ti.getSection(Fi),Dn=ti.getSectionIndex(Fi),ki=ti.getCharCode(Fi);let fn=zn.scale,Zn=null,Zi=null,En=null,Ps=Yn,os=0;const rs=!(oe===io.horizontal||!Gt&&!A(ki)||Gt&&(Ju[ki]||(fi=ki,Ys(fi)||Ql(fi)||Sr(fi)||po(fi)||h(fi))));if(zn.imageName){const Vs=Wt[zn.imageName];if(!Vs)continue;En=zn.imageName,ut.iconsInText=ut.iconsInText||!0,Zi=Vs.paddedRect;const as=Vs.displaySize;fn=fn*Yn/ve,Zn={width:as[0],height:as[1],left:1,top:-3,advance:rs?as[1]:as[0],localGlyph:!1},os=Ye?-Zn.height*fn:gi*Yn-17-as[1]*fn,Ps=Zn.advance;const vl=(rs?as[0]:as[1])*fn-Yn*gi;vl>0&&vl>sn&&(sn=vl)}else{const Vs=Rt[zn.fontStack];if(!Vs)continue;Vs[ki]&&(Zi=Vs[ki]);const as=Ft[zn.fontStack];if(!as)continue;const vl=as.glyphs[ki];if(!vl)continue;if(Zn=vl.metrics,Ps=8203!==ki?Yn:0,Ye){const pd=void 0!==as.ascender?Math.abs(as.ascender):0,bp=void 0!==as.descender?Math.abs(as.descender):0,wp=(pd+bp)*fn;an<wp&&(an=wp,Sn=(pd-bp)/2*fn),os=-pd*fn}else os=(gi-fn)*Yn-17}rs?(ut.verticalizable=!0,Yi.push({glyph:ki,imageName:En,x:$e,y:Se+os,vertical:rs,scale:fn,localGlyph:Zn.localGlyph,fontStack:zn.fontStack,sectionIndex:Dn,metrics:Zn,rect:Zi}),$e+=Ps*fn+ue):(Yi.push({glyph:ki,imageName:En,x:$e,y:Se+os,vertical:rs,scale:fn,localGlyph:Zn.localGlyph,fontStack:zn.fontStack,sectionIndex:Dn,metrics:Zn,rect:Zi}),$e+=Zn.advance*fn+ue)}0!==Yi.length&&(Oe=Math.max($e-ue,Oe),Ye?Qu(Yi,be,sn,Sn,jt*gi/2):Qu(Yi,be,sn,0,jt/2)),$e=0;const ss=jt*gi+sn;nn.lineOffset=Math.max(sn,ji),Se+=ss,++mi}var fi;const ci=Se,{horizontalAlign:Ke,verticalAlign:Bi}=Ku(Kt);(function(ti,gi,ji,nn,Yi,sn){const an=(gi-ji)*Yi,Sn=-sn*nn;for(const ss of ti)for(const Fi of ss.positionedGlyphs)Fi.x+=an,Fi.y+=Sn})(ut.positionedLines,be,Ke,Bi,Oe,ci),ut.top+=-Bi*ci,ut.bottom=ut.top+ci,ut.left+=-Ke*Oe,ut.right=ut.left+Oe,ut.hasBaseline=Ye}(ft,t,n,a,$,y,b,S,I,M,L,F),!function(ut){for(const Ft of ut)if(0!==Ft.positionedGlyphs.length)return!1;return!0}(at)&&ft}const Ju={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Wf={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hp(e,t,n,a,u,m){if(t.imageName){const y=a[t.imageName];return y?y.displaySize[0]*t.scale*Yn/m+u:0}{const y=n[t.fontStack],b=y&&y.glyphs[e];return b?b.metrics.advance*t.scale+u:0}}function Xf(e,t,n,a){const u=Math.pow(e-t,2);return a?e<t?u/2:2*u:u+Math.abs(n)*n}function mg(e,t,n){let a=0;return 10===e&&(a-=1e4),n&&(a+=150),40!==e&&65288!==e||(a+=50),41!==t&&65289!==t||(a+=50),a}function up(e,t,n,a,u,m){let y=null,b=Xf(t,n,u,m);for(const S of a){const M=Xf(t-S.x,n,u,m)+S.badness;M<=b&&(y=S,b=M)}return{index:e,x:t,priorBreak:y,badness:b}}function Yf(e){return e?Yf(e.priorBreak).concat(e.index):[]}function Ku(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Qu(e,t,n,a,u){if(!(t||n||a||u))return;const m=e.length-1,y=e[m],b=(y.x+y.metrics.advance*y.scale)*t;for(let S=0;S<=m;S++)e[S].x-=b,e[S].y+=n+a+u}function td(e,t,n){const{horizontalAlign:a,verticalAlign:u}=Ku(n),m=t[0]-e.displaySize[0]*a,y=t[1]-e.displaySize[1]*u;return{image:e,top:y,bottom:y+e.displaySize[1],left:m,right:m+e.displaySize[0]}}function ed(e,t,n,a,u,m){const y=e.image;let b;if(y.content){const $=y.content,nt=y.pixelRatio||1;b=[$[0]/nt,$[1]/nt,y.displaySize[0]-$[2]/nt,y.displaySize[1]-$[3]/nt]}const S=t.left*m,M=t.right*m;let k,I,L,B;"width"===n||"both"===n?(B=u[0]+S-a[3],I=u[0]+M+a[1]):(B=u[0]+(S+M-y.displaySize[0])/2,I=B+y.displaySize[0]);const F=t.top*m,j=t.bottom*m;return"height"===n||"both"===n?(k=u[1]+F-a[0],L=u[1]+j+a[2]):(k=u[1]+(F+j-y.displaySize[1])/2,L=k+y.displaySize[1]),{image:y,top:k,right:I,bottom:L,left:B,collisionPadding:b}}class Ur extends Mt{constructor(t,n,a,u,m){super(t,n),this.angle=u,this.z=a,void 0!==m&&(this.segment=m)}clone(){return new Ur(this.x,this.y,this.z,this.angle,this.segment)}}function dp(e,t,n,a,u){if(void 0===t.segment)return!0;let m=t,y=t.segment+1,b=0;for(;b>-n/2;){if(y--,y<0)return!1;b-=e[y].dist(m),m=e[y]}b+=e[y].dist(e[y+1]),y++;const S=[];let M=0;for(;b<n/2;){const k=e[y],I=e[y+1];if(!I)return!1;let L=e[y-1].angleTo(k)-k.angleTo(I);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:b,angleDelta:L}),M+=L;b-S[0].distance>a;)M-=S.shift().angleDelta;if(M>u)return!1;y++,b+=k.dist(I)}return!0}function _l(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function Vh(e,t,n){return e?.6*t*n:0}function gc(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function jh(e,t,n,a,u,m){const y=Vh(n,u,m),b=gc(n,a)*m;let S=0;const M=_l(e)/2;for(let k=0;k<e.length-1;k++){const I=e[k],L=e[k+1],B=I.dist(L);if(S+B>M){const F=(M-S)/B,j=ui(I.x,L.x,F),$=ui(I.y,L.y,F),nt=new Ur(j,$,0,L.angleTo(I),k);return!y||dp(e,nt,b,y,t)?nt:void 0}S+=B}}function gg(e,t,n,a,u,m,y,b,S){const M=Vh(a,m,y),k=gc(a,u),I=k*y,L=0===e[0].x||e[0].x===S||0===e[0].y||e[0].y===S;return t-I<t/4&&(t=I+t/4),Jf(e,L?t/2*b%t:(k/2+2*m)*y*b%t,t,M,n,I,L,!1,S)}function Jf(e,t,n,a,u,m,y,b,S){const M=m/2,k=_l(e);let I=0,L=t-n,B=[];for(let F=0;F<e.length-1;F++){const j=e[F],$=e[F+1],nt=j.dist($),ht=$.angleTo(j);for(;L+n<I+nt;){L+=n;const tt=(L-I)/nt,at=ui(j.x,$.x,tt),ft=ui(j.y,$.y,tt);if(at>=0&&at<S&&ft>=0&&ft<S&&L-M>=0&&L+M<=k){const ut=new Ur(at,ft,0,ht,F);ut._round(),a&&!dp(e,ut,m,a,u)||B.push(ut)}}I+=nt}return b||B.length||y||(B=Jf(e,I/2,n,a,u,m,y,!0,S)),B}function Kf(e,t,n,a,u){const m=[];for(let y=0;y<e.length;y++){const b=e[y];let S;for(let M=0;M<b.length-1;M++){let k=b[M],I=b[M+1];k.x<t&&I.x<t||(k.x<t?k=new Mt(t,k.y+(t-k.x)/(I.x-k.x)*(I.y-k.y))._round():I.x<t&&(I=new Mt(t,k.y+(t-k.x)/(I.x-k.x)*(I.y-k.y))._round()),k.y<n&&I.y<n||(k.y<n?k=new Mt(k.x+(n-k.y)/(I.y-k.y)*(I.x-k.x),n)._round():I.y<n&&(I=new Mt(k.x+(n-k.y)/(I.y-k.y)*(I.x-k.x),n)._round()),k.x>=a&&I.x>=a||(k.x>=a?k=new Mt(a,k.y+(a-k.x)/(I.x-k.x)*(I.y-k.y))._round():I.x>=a&&(I=new Mt(a,k.y+(a-k.x)/(I.x-k.x)*(I.y-k.y))._round()),k.y>=u&&I.y>=u||(k.y>=u?k=new Mt(k.x+(u-k.y)/(I.y-k.y)*(I.x-k.x),u)._round():I.y>=u&&(I=new Mt(k.x+(u-k.y)/(I.y-k.y)*(I.x-k.x),u)._round()),S&&k.equals(S[S.length-1])||(S=[k],m.push(S)),S.push(I)))))}}return m}De(Ur,"Anchor");const Zh=1e20;function Qf(e,t,n,a,u,m,y,b,S){for(let M=t;M<t+a;M++)tm(e,n*m+M,m,u,y,b,S);for(let M=n;M<n+u;M++)tm(e,M*m+t,1,a,y,b,S)}function tm(e,t,n,a,u,m,y){m[0]=0,y[0]=-Zh,y[1]=Zh,u[0]=e[t];for(let b=1,S=0,M=0;b<a;b++){u[b]=e[t+b*n];const k=b*b;do{const I=m[S];M=(u[b]-u[I]+k-I*I)/(b-I)/2}while(M<=y[S]&&--S>-1);S++,m[S]=b,y[S]=M,y[S+1]=Zh}for(let b=0,S=0;b<a;b++){for(;y[S+1]<b;)S++;const M=m[S],k=b-M;e[t+b*n]=u[M]+k*k}}const pp={none:0,ideographs:1,all:2};class _c{constructor(t,n,a){this.requestManager=t,this.localGlyphMode=n,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,n){const a=[];for(const u in t)for(const m of t[u])a.push({stack:u,id:m});vn(a,({stack:u,id:m},y)=>{let b=this.entries[u];b||(b=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=b.glyphs[m];if(void 0!==S)return void y(null,{stack:u,id:m,glyph:S});if(S=this._tinySDF(b,u,m),S)return b.glyphs[m]=S,void y(null,{stack:u,id:m,glyph:S});const M=Math.floor(m/256);if(256*M>65535)return void y(new Error("glyphs > 65535 not supported"));if(b.ranges[M])return void y(null,{stack:u,id:m,glyph:S});let k=b.requests[M];k||(k=b.requests[M]=[],_c.loadGlyphRange(u,M,this.url,this.requestManager,(I,L)=>{if(L){b.ascender=L.ascender,b.descender=L.descender;for(const B in L.glyphs)this._doesCharSupportLocalGlyph(+B)||(b.glyphs[+B]=L.glyphs[+B]);b.ranges[M]=!0}for(const B of k)B(I,L);delete b.requests[M]})),k.push((I,L)=>{I?y(I):L&&y(null,{stack:u,id:m,glyph:L.glyphs[m]||null})})},(u,m)=>{if(u)n(u);else if(m){const y={};for(const{stack:b,id:S,glyph:M}of m)void 0===y[b]&&(y[b]={}),void 0===y[b].glyphs&&(y[b].glyphs={}),y[b].glyphs[S]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;n(null,y)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==pp.none&&(this.localGlyphMode===pp.all?!!this.localFontFamily:!!this.localFontFamily&&(th(t)||_u(t)||Cr(t)||_a(t)||el(t)))}_tinySDF(t,n,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let m=t.tinySDF;if(!m){let j="400";/bold/i.test(n)?j="900":/medium/i.test(n)?j="500":/light/i.test(n)&&(j="200"),m=t.tinySDF=new _c.TinySDF({fontFamily:u,fontWeight:j,fontSize:48,buffer:6,radius:16}),m.fontWeight=j}if(this.localGlyphs[m.fontWeight][a])return this.localGlyphs[m.fontWeight][a];const y=String.fromCharCode(a),{data:b,width:S,height:M,glyphWidth:k,glyphHeight:I,glyphLeft:L,glyphTop:B,glyphAdvance:F}=m.draw(y);return this.localGlyphs[m.fontWeight][a]={id:a,bitmap:new Or({width:S,height:M},b),metrics:{width:k/2,height:I/2,left:L/2,top:B/2-27,advance:F/2,localGlyph:!0}}}}function em(e,t,n,a){const u=[],m=e.image,y=m.pixelRatio,b=m.paddedRect.w-2,S=m.paddedRect.h-2,M=e.right-e.left,k=e.bottom-e.top,I=m.stretchX||[[0,b]],L=m.stretchY||[[0,S]],B=(jt,Kt)=>jt+Kt[1]-Kt[0],F=I.reduce(B,0),j=L.reduce(B,0),$=b-F,nt=S-j;let ht=0,tt=F,at=0,ft=j,ut=0,Ft=$,Rt=0,Wt=nt;if(m.content&&a){const jt=m.content;ht=id(I,0,jt[0]),at=id(L,0,jt[1]),tt=id(I,jt[0],jt[2]),ft=id(L,jt[1],jt[3]),ut=jt[0]-ht,Rt=jt[1]-at,Ft=jt[2]-jt[0]-tt,Wt=jt[3]-jt[1]-ft}const he=(jt,Kt,te,oe)=>{const ue=nd(jt.stretch-ht,tt,M,e.left),Gt=sd(jt.fixed-ut,Ft,jt.stretch,F),ve=nd(Kt.stretch-at,ft,k,e.top),$e=sd(Kt.fixed-Rt,Wt,Kt.stretch,j),Se=nd(te.stretch-ht,tt,M,e.left),Oe=sd(te.fixed-ut,Ft,te.stretch,F),be=nd(oe.stretch-at,ft,k,e.top),Ye=sd(oe.fixed-Rt,Wt,oe.stretch,j),mi=new Mt(ue,ve),fi=new Mt(Se,ve),ci=new Mt(Se,be),Ke=new Mt(ue,be),Bi=new Mt(Gt/y,$e/y),ti=new Mt(Oe/y,Ye/y),gi=t*Math.PI/180;if(gi){const Yi=Math.sin(gi),sn=Math.cos(gi),an=[sn,-Yi,Yi,sn];mi._matMult(an),fi._matMult(an),Ke._matMult(an),ci._matMult(an)}const ji=jt.stretch+jt.fixed,nn=Kt.stretch+Kt.fixed;return{tl:mi,tr:fi,bl:Ke,br:ci,tex:{x:m.paddedRect.x+1+ji,y:m.paddedRect.y+1+nn,w:te.stretch+te.fixed-ji,h:oe.stretch+oe.fixed-nn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Bi,pixelOffsetBR:ti,minFontScaleX:Ft/y/M,minFontScaleY:Wt/y/k,isSDF:n}};if(a&&(m.stretchX||m.stretchY)){const jt=im(I,$,F),Kt=im(L,nt,j);for(let te=0;te<jt.length-1;te++){const oe=jt[te],ue=jt[te+1];for(let Gt=0;Gt<Kt.length-1;Gt++)u.push(he(oe,Kt[Gt],ue,Kt[Gt+1]))}}else u.push(he({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return u}function id(e,t,n){let a=0;for(const u of e)a+=Math.max(t,Math.min(n,u[1]))-Math.max(t,Math.min(n,u[0]));return a}function im(e,t,n){const a=[{fixed:-1,stretch:0}];for(const[u,m]of e){const y=a[a.length-1];a.push({fixed:u-y.stretch,stretch:y.stretch}),a.push({fixed:u-y.stretch,stretch:y.stretch+(m-u)})}return a.push({fixed:t+1,stretch:n}),a}function nd(e,t,n,a){return e/t*n+a}function sd(e,t,n,a){return e-t*n/a}function _g(e,t,n,a){const u=t+e.positionedLines[a].lineOffset;return 0===a?n+u/2:n+(u+(t+e.positionedLines[a-1].lineOffset))/2}_c.loadGlyphRange=function(e,t,n,a,u){const m=256*t,y=m+255,b=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}",`${m}-${y}`),qr.Glyphs);bs(b,(S,M)=>{if(S)u(S);else if(M){const k={},I=new dc(M).readFields(dg,{});for(const L of I.glyphs)k[L.id]=L;u(null,{glyphs:k,ascender:I.ascender,descender:I.descender})}})},_c.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:m="normal",fontStyle:y="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=n;const b=this.size=e+4*t,S=this._createCanvas(b),M=this.ctx=S.getContext("2d",{willReadFrequently:!0});M.font=`${y} ${m} ${e}px ${u}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:m}=this.ctx.measureText(e),y=Math.ceil(n),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-u))),S=Math.min(this.size-this.buffer,y+Math.ceil(a)),M=b+2*this.buffer,k=S+2*this.buffer,I=Math.max(M*k,0),L=new Uint8ClampedArray(I),B={data:L,width:M,height:k,glyphWidth:b,glyphHeight:S,glyphTop:y,glyphLeft:0,glyphAdvance:t};if(0===b||0===S)return B;const{ctx:F,buffer:j,gridInner:$,gridOuter:nt}=this;F.clearRect(j,j,b,S),F.fillText(e,j,j+y);const ht=F.getImageData(j,j,b,S);nt.fill(Zh,0,I),$.fill(0,0,I);for(let tt=0;tt<S;tt++)for(let at=0;at<b;at++){const ft=ht.data[4*(tt*b+at)+3]/255;if(0===ft)continue;const ut=(tt+j)*M+at+j;if(1===ft)nt[ut]=0,$[ut]=Zh;else{const Ft=.5-ft;nt[ut]=Ft>0?Ft*Ft:0,$[ut]=Ft<0?Ft*Ft:0}}Qf(nt,0,0,M,k,M,this.f,this.v,this.z),Qf($,j,j,b,S,M,this.f,this.v,this.z);for(let tt=0;tt<I;tt++){const at=Math.sqrt(nt[tt])-Math.sqrt($[tt]);L[tt]=Math.round(255-255*(at/this.radius+this.cutoff))}return B}};class yg{constructor(t=[],n=xg){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:a}=this,u=n[t];for(;t>0;){const m=t-1>>1,y=n[m];if(a(u,y)>=0)break;n[t]=y,t=m}n[t]=u}_down(t){const{data:n,compare:a}=this,u=this.length>>1,m=n[t];for(;t<u;){let y=1+(t<<1),b=n[y];const S=y+1;if(S<this.length&&a(n[S],b)<0&&(y=S,b=n[S]),a(b,m)>=0)break;n[t]=b,t=y}n[t]=m}}function xg(e,t){return e<t?-1:e>t?1:0}function vg(e,t=1,n=!1){let a=1/0,u=1/0,m=-1/0,y=-1/0;const b=e[0];for(let B=0;B<b.length;B++){const F=b[B];(!B||F.x<a)&&(a=F.x),(!B||F.y<u)&&(u=F.y),(!B||F.x>m)&&(m=F.x),(!B||F.y>y)&&(y=F.y)}const S=Math.min(m-a,y-u);let M=S/2;const k=new yg([],bg);if(0===S)return new Mt(a,u);for(let B=a;B<m;B+=S)for(let F=u;F<y;F+=S)k.push(new yc(B+M,F+M,M,e));let I=function(B){let F=0,j=0,$=0;const nt=B[0];for(let ht=0,tt=nt.length,at=tt-1;ht<tt;at=ht++){const ft=nt[ht],ut=nt[at],Ft=ft.x*ut.y-ut.x*ft.y;j+=(ft.x+ut.x)*Ft,$+=(ft.y+ut.y)*Ft,F+=3*Ft}return new yc(j/F,$/F,0,B)}(e),L=k.length;for(;k.length;){const B=k.pop();(B.d>I.d||!I.d)&&(I=B,n&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,L)),B.max-I.d<=t||(M=B.h/2,k.push(new yc(B.p.x-M,B.p.y-M,M,e)),k.push(new yc(B.p.x+M,B.p.y-M,M,e)),k.push(new yc(B.p.x-M,B.p.y+M,M,e)),k.push(new yc(B.p.x+M,B.p.y+M,M,e)),L+=4)}return n&&(console.log(`num probes: ${L}`),console.log(`best distance: ${I.d}`)),I.p}function bg(e,t){return t.max-e.max}function yc(e,t,n,a){this.p=new Mt(e,t),this.h=n,this.d=function(u,m){let y=!1,b=1/0;for(let S=0;S<m.length;S++){const M=m[S];for(let k=0,I=M.length,L=I-1;k<I;L=k++){const B=M[k],F=M[L];B.y>u.y!=F.y>u.y&&u.x<(F.x-B.x)*(u.y-B.y)/(F.y-B.y)+B.x&&(y=!y),b=Math.min(b,pf(u,B,F))}}return(y?1:-1)*Math.sqrt(b)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const fp=Number.POSITIVE_INFINITY,wg=Math.sqrt(2);function nm(e,[t,n]){let a=0,u=0;if(n===fp){t<0&&(t=0);const m=t/wg;switch(e){case"top-right":case"top-left":u=m-7;break;case"bottom-right":case"bottom-left":u=7-m;break;case"bottom":u=7-t;break;case"top":u=t-7}switch(e){case"top-right":case"bottom-right":a=-m;break;case"top-left":case"bottom-left":a=m;break;case"left":a=t;break;case"right":a=-t}}else{switch(t=Math.abs(t),n=Math.abs(n),e){case"top-right":case"top-left":case"top":u=n-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-n}switch(e){case"top-right":case"bottom-right":case"right":a=-t;break;case"top-left":case"bottom-left":case"left":a=t}}return[a,u]}function Tg(e,t,n,a,u,m,y,b,S,M){e.createArrays(),e.tilePixelRatio=Xe/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const k=e.layers[0].layout,I=e.layers[0]._unevaluatedLayout._values,L={};if("composite"===e.textSizeData.kind){const{minZoom:j,maxZoom:$}=e.textSizeData;L.compositeTextSizes=[I["text-size"].possiblyEvaluate(new Et(j),b),I["text-size"].possiblyEvaluate(new Et($),b)]}if("composite"===e.iconSizeData.kind){const{minZoom:j,maxZoom:$}=e.iconSizeData;L.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new Et(j),b),I["icon-size"].possiblyEvaluate(new Et($),b)]}L.layoutTextSize=I["text-size"].possiblyEvaluate(new Et(S+1),b),L.layoutIconSize=I["icon-size"].possiblyEvaluate(new Et(S+1),b),L.textMaxSize=I["text-size"].possiblyEvaluate(new Et(18),b);const B="map"===k.get("text-rotation-alignment")&&"point"!==k.get("symbol-placement"),F=k.get("text-size");for(const j of e.features){const $=k.get("text-font").evaluate(j,{},b).join(","),nt=F.evaluate(j,{},b),ht=L.layoutTextSize.evaluate(j,{},b),tt=(L.layoutIconSize.evaluate(j,{},b),{horizontal:{},vertical:void 0}),at=j.text;let ft,ut=[0,0];if(at){const Wt=at.toString(),he=k.get("text-letter-spacing").evaluate(j,{},b)*Yn,jt=k.get("text-line-height").evaluate(j,{},b)*Yn,Kt=w(Wt)?he:0,te=k.get("text-anchor").evaluate(j,{},b),oe=k.get("text-variable-anchor");if(!oe){const Se=k.get("text-radial-offset").evaluate(j,{},b);ut=Se?nm(te,[Se*Yn,fp]):k.get("text-offset").evaluate(j,{},b).map(Oe=>Oe*Yn)}let ue=B?"center":k.get("text-justify").evaluate(j,{},b);const Gt="point"===k.get("symbol-placement"),ve=Gt?k.get("text-max-width").evaluate(j,{},b)*Yn:1/0,$e=Se=>{e.allowVerticalPlacement&&v(Wt)&&(tt.vertical=ys(at,t,n,u,$,ve,jt,te,Se,Kt,ut,io.vertical,!0,ht,nt))};if(!B&&oe){const Se="auto"===ue?oe.map(be=>mp(be)):[ue];let Oe=!1;for(let be=0;be<Se.length;be++){const Ye=Se[be];if(!tt.horizontal[Ye])if(Oe)tt.horizontal[Ye]=tt.horizontal[0];else{const mi=ys(at,t,n,u,$,ve,jt,"center",Ye,Kt,ut,io.horizontal,!1,ht,nt);mi&&(tt.horizontal[Ye]=mi,Oe=1===mi.positionedLines.length)}}$e("left")}else{if("auto"===ue&&(ue=mp(te)),Gt||k.get("text-writing-mode").indexOf("horizontal")>=0||!v(Wt)){const Se=ys(at,t,n,u,$,ve,jt,te,ue,Kt,ut,io.horizontal,!1,ht,nt);Se&&(tt.horizontal[ue]=Se)}$e(Gt?"left":ue)}}let Ft=!1;if(j.icon&&j.icon.name){const Wt=a[j.icon.name];Wt&&(ft=td(u[j.icon.name],k.get("icon-offset").evaluate(j,{},b),k.get("icon-anchor").evaluate(j,{},b)),Ft=Wt.sdf,void 0===e.sdfIcons?e.sdfIcons=Wt.sdf:e.sdfIcons!==Wt.sdf&&on("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Wt.pixelRatio!==e.pixelRatio||0!==k.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const Rt=om(tt.horizontal)||tt.vertical;e.iconsInText||(e.iconsInText=!!Rt&&Rt.iconsInText),(Rt||ft)&&Sg(e,j,tt,ft,a,L,ht,0,ut,Ft,y,b,M)}m&&e.generateCollisionDebugBuffers(S,e.collisionBoxArray)}function mp(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Sg(e,t,n,a,u,m,y,b,S,M,k,I,L){let B=m.textMaxSize.evaluate(t,{},I);void 0===B&&(B=y);const F=e.layers[0].layout,j=F.get("icon-offset").evaluate(t,{},I),$=om(n.horizontal)||n.vertical,nt="globe"===L.name,ht=y/24,tt=e.tilePixelRatio*B/24,at=(Kt=e.overscaling,e.zoom>18&&Kt>2&&(Kt>>=1),Math.max(Xe/(512*Kt),1)*F.get("symbol-spacing")),ft=F.get("text-padding")*e.tilePixelRatio,ut=F.get("icon-padding")*e.tilePixelRatio,Ft=Jt(F.get("text-max-angle")),Rt="map"===F.get("text-rotation-alignment")&&"point"!==F.get("symbol-placement"),Wt="map"===F.get("icon-rotation-alignment")&&"point"!==F.get("symbol-placement"),he=F.get("symbol-placement"),jt=at/2;var Kt;const te=F.get("icon-text-fit");let oe;a&&"none"!==te&&(e.allowVerticalPlacement&&n.vertical&&(oe=ed(a,n.vertical,te,F.get("icon-text-fit-padding"),j,ht)),$&&(a=ed(a,$,te,F.get("icon-text-fit-padding"),j,ht)));const ue=(Gt,ve,$e)=>{if(ve.x<0||ve.x>=Xe||ve.y<0||ve.y>=Xe)return;let Se=null;if(nt){const{x:Oe,y:be,z:Ye}=L.projectTilePoint(ve.x,ve.y,$e);Se={anchor:new Ur(Oe,be,Ye,0,void 0),up:L.upVector($e,ve.x,ve.y)}}!function(Oe,be,Ye,mi,fi,ci,Ke,Bi,ti,gi,ji,nn,Yi,sn,an,Sn,ss,Fi,zn,Dn,ki,fn,Zn,Zi,En){const Ps=Oe.addToLineVertexArray(be,mi);let os,rs,Vs,as,vl,pd,bp,wp=0,Yg=0,Jg=0,Kg=0,Ng=-1,Vg=-1;const ka={};let Qg=sl("");const Xh=Ye?Ye.anchor:be;let jg=0,Zg=0;if(void 0===ti._unevaluatedLayout.getValue("text-radial-offset")?[jg,Zg]=ti.layout.get("text-offset").evaluate(ki,{},En).map(vo=>vo*Yn):(jg=ti.layout.get("text-radial-offset").evaluate(ki,{},En)*Yn,Zg=fp),Oe.allowVerticalPlacement&&fi.vertical){const vo=fi.vertical;if(an)pd=gp(vo),Bi&&(bp=gp(Bi));else{const bo=ti.layout.get("text-rotate").evaluate(ki,{},En)+90;Vs=od(gi,Xh,be,ji,nn,Yi,vo,sn,bo,Sn),Bi&&(as=od(gi,Xh,be,ji,nn,Yi,Bi,Fi,bo))}}if(ci){const vo=ti.layout.get("icon-rotate").evaluate(ki,{},En),bo="none"!==ti.layout.get("icon-text-fit"),Tp=em(ci,vo,Zn,bo),qg=Bi?em(Bi,vo,Zn,bo):void 0;rs=od(gi,Xh,be,ji,nn,Yi,ci,Fi,vo),wp=4*Tp.length;const t_=Oe.iconSizeData;let Yh=null;"source"===t_.kind?(Yh=[Go*ti.layout.get("icon-size").evaluate(ki,{},En)],Yh[0]>Ca&&on(`${Oe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===t_.kind&&(Yh=[Go*fn.compositeIconSizes[0].evaluate(ki,{},En),Go*fn.compositeIconSizes[1].evaluate(ki,{},En)],(Yh[0]>Ca||Yh[1]>Ca)&&on(`${Oe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Oe.addSymbols(Oe.icon,Tp,Yh,Dn,zn,ki,!1,Ye,be,Ps.lineStartIndex,Ps.lineLength,-1,Zi,En),Ng=Oe.icon.placedSymbolArray.length-1,qg&&(Yg=4*qg.length,Oe.addSymbols(Oe.icon,qg,Yh,Dn,zn,ki,io.vertical,Ye,be,Ps.lineStartIndex,Ps.lineLength,-1,Zi,En),Vg=Oe.icon.placedSymbolArray.length-1)}for(const vo in fi.horizontal){const bo=fi.horizontal[vo];os||(Qg=sl(bo.text),an?vl=gp(bo):os=od(gi,Xh,be,ji,nn,Yi,bo,sn,ti.layout.get("text-rotate").evaluate(ki,{},En),Sn));const Tp=1===bo.positionedLines.length;if(Jg+=sm(Oe,Ye,be,bo,Ke,ti,an,ki,Sn,Ps,fi.vertical?io.horizontal:io.horizontalOnly,Tp?Object.keys(fi.horizontal):[vo],ka,Ng,fn,Zi,En),Tp)break}fi.vertical&&(Kg+=sm(Oe,Ye,be,fi.vertical,Ke,ti,an,ki,Sn,Ps,io.vertical,["vertical"],ka,Vg,fn,Zi,En));let wc=-1;const Gg=(vo,bo)=>vo?Math.max(vo,bo):bo;wc=Gg(vl,wc),wc=Gg(pd,wc),wc=Gg(bp,wc);const s_=wc>-1?1:0;Oe.glyphOffsetArray.length>=ns.MAX_GLYPHS&&on("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ki.sortKey&&Oe.addToSortKeyRanges(Oe.symbolInstances.length,ki.sortKey),Oe.symbolInstances.emplaceBack(Xh.x,Xh.y,Xh.z,be.x,be.y,ka.right>=0?ka.right:-1,ka.center>=0?ka.center:-1,ka.left>=0?ka.left:-1,ka.vertical>=0?ka.vertical:-1,Ng,Vg,Qg,void 0!==os?os:Oe.collisionBoxArray.length,void 0!==os?os+1:Oe.collisionBoxArray.length,void 0!==Vs?Vs:Oe.collisionBoxArray.length,void 0!==Vs?Vs+1:Oe.collisionBoxArray.length,void 0!==rs?rs:Oe.collisionBoxArray.length,void 0!==rs?rs+1:Oe.collisionBoxArray.length,as||Oe.collisionBoxArray.length,as?as+1:Oe.collisionBoxArray.length,ji,Jg,Kg,wp,Yg,s_,0,jg,Zg,wc)}(e,ve,Se,Gt,n,a,u,oe,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,ft,Rt,S,0,ut,Wt,j,t,m,M,k,I)};if("line"===he)for(const Gt of Kf(t.geometry,0,0,Xe,Xe)){const ve=gg(Gt,at,Ft,n.vertical||$,a,24,tt,e.overscaling,Xe);for(const $e of ve)$&&Cg(e,$.text,jt,$e)||ue(Gt,$e,I)}else if("line-center"===he){for(const Gt of t.geometry)if(Gt.length>1){const ve=jh(Gt,Ft,n.vertical||$,a,24,tt);ve&&ue(Gt,ve,I)}}else if("Polygon"===t.type)for(const Gt of Kd(t.geometry,0)){const ve=vg(Gt,16);ue(Gt[0],new Ur(ve.x,ve.y,0,0,void 0),I)}else if("LineString"===t.type)for(const Gt of t.geometry)ue(Gt,new Ur(Gt[0].x,Gt[0].y,0,0,void 0),I);else if("Point"===t.type)for(const Gt of t.geometry)for(const ve of Gt)ue([ve],new Ur(ve.x,ve.y,0,0,void 0),I)}const Ca=32640;function sm(e,t,n,a,u,m,y,b,S,M,k,I,L,B,F,j,$){const nt=function(at,ft,ut,Ft,Rt,Wt,he,jt){const Kt=[];if(0===ft.positionedLines.length)return Kt;const te=Ft.layout.get("text-rotate").evaluate(Wt,{})*Math.PI/180,oe=function(Se){const Oe=Se[0],be=Se[1],Ye=Oe*be;return Ye>0?[Oe,-be]:Ye<0?[-Oe,be]:0===Oe?[be,Oe]:[be,-Oe]}(ut);let ue=Math.abs(ft.top-ft.bottom);for(const Se of ft.positionedLines)ue-=Se.lineOffset;const Gt=ft.positionedLines.length,ve=ue/Gt;let $e=ft.top-ut[1];for(let Se=0;Se<Gt;++Se){const Oe=ft.positionedLines[Se];$e=_g(ft,ve,$e,Se);for(const be of Oe.positionedGlyphs){if(!be.rect)continue;const Ye=be.rect||{};let mi=4,fi=!0,ci=1,Ke=0;if(be.imageName){const Zi=he[be.imageName];if(!Zi)continue;if(Zi.sdf){on("SDF images are not supported in formatted text and will be ignored.");continue}fi=!1,ci=Zi.pixelRatio,mi=1/ci}const Bi=(Rt||jt)&&be.vertical,ti=be.metrics.advance*be.scale/2,gi=be.metrics,ji=be.rect;if(null===ji)continue;jt&&ft.verticalizable&&(Ke=be.imageName?ti-be.metrics.width*be.scale/2:0);const nn=Rt?[be.x+ti,be.y]:[0,0];let Yi=[0,0],sn=[0,0],an=!1;Rt||(Bi?(sn=[be.x+ti+oe[0],be.y+oe[1]-Ke],an=!0):Yi=[be.x+ti+ut[0],be.y+ut[1]-Ke]);const Sn=ji.w*be.scale/(ci*(be.localGlyph?2:1)),ss=ji.h*be.scale/(ci*(be.localGlyph?2:1));let Fi,zn,Dn,ki;if(Bi){const Zi=be.y-$e,En=new Mt(-ti,ti-Zi),Ps=-Math.PI/2,os=new Mt(...sn);Fi=new Mt(-ti+Yi[0],Yi[1]),Fi._rotateAround(Ps,En)._add(os),Fi.x+=-Zi+ti,Fi.y-=(gi.left-mi)*be.scale;const rs=be.imageName?gi.advance*be.scale:Yn*be.scale,Vs=String.fromCharCode(be.glyph);sg(Vs)?Fi.x+=(1-mi)*be.scale:og(Vs)?Fi.x+=rs-gi.height*be.scale+(-mi-1)*be.scale:Fi.x+=be.imageName||gi.width+2*mi===ji.w&&gi.height+2*mi===ji.h?(rs-ss)/2:(rs-(gi.height+2*mi)*be.scale)/2,zn=new Mt(Fi.x,Fi.y-Sn),Dn=new Mt(Fi.x+ss,Fi.y),ki=new Mt(Fi.x+ss,Fi.y-Sn)}else{const Zi=(gi.left-mi)*be.scale-ti+Yi[0],En=(-gi.top-mi)*be.scale+Yi[1],Ps=Zi+Sn,os=En+ss;Fi=new Mt(Zi,En),zn=new Mt(Ps,En),Dn=new Mt(Zi,os),ki=new Mt(Ps,os)}if(te){let Zi;Zi=Rt?new Mt(0,0):an?new Mt(oe[0],oe[1]):new Mt(ut[0],ut[1]),Fi._rotateAround(te,Zi),zn._rotateAround(te,Zi),Dn._rotateAround(te,Zi),ki._rotateAround(te,Zi)}const fn=new Mt(0,0),Zn=new Mt(0,0);Kt.push({tl:Fi,tr:zn,bl:Dn,br:ki,tex:Ye,writingMode:ft.writingMode,glyphOffset:nn,sectionIndex:be.sectionIndex,isSDF:fi,pixelOffsetTL:fn,pixelOffsetBR:Zn,minFontScaleX:0,minFontScaleY:0})}}return Kt}(0,a,S,m,y,b,u,e.allowVerticalPlacement),ht=e.textSizeData;let tt=null;"source"===ht.kind?(tt=[Go*m.layout.get("text-size").evaluate(b,{},$)],tt[0]>Ca&&on(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ht.kind&&(tt=[Go*F.compositeTextSizes[0].evaluate(b,{},$),Go*F.compositeTextSizes[1].evaluate(b,{},$)],(tt[0]>Ca||tt[1]>Ca)&&on(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,nt,tt,S,y,b,k,t,n,M.lineStartIndex,M.lineLength,B,j,$);for(const at of I)L[at]=e.text.placedSymbolArray.length-1;return 4*nt.length}function om(e){for(const t in e)return e[t];return null}function od(e,t,n,a,u,m,y,b,S,M){let k=y.top,I=y.bottom,L=y.left,B=y.right;const F=y.collisionPadding;if(F&&(L-=F[0],k-=F[1],B+=F[2],I+=F[3]),S){const j=new Mt(L,k),$=new Mt(B,k),nt=new Mt(L,I),ht=new Mt(B,I),tt=Jt(S);let at=new Mt(0,0);M&&(at=new Mt(M[0],M[1])),j._rotateAround(tt,at),$._rotateAround(tt,at),nt._rotateAround(tt,at),ht._rotateAround(tt,at),L=Math.min(j.x,$.x,nt.x,ht.x),B=Math.max(j.x,$.x,nt.x,ht.x),k=Math.min(j.y,$.y,nt.y,ht.y),I=Math.max(j.y,$.y,nt.y,ht.y)}return e.emplaceBack(t.x,t.y,t.z,n.x,n.y,L,k,B,I,b,a,u,m),e.length-1}function gp(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function Cg(e,t,n,a){const u=e.compareText;if(t in u){const m=u[t];for(let y=m.length-1;y>=0;y--)if(a.dist(m[y])<n)return!0}else u[t]=[];return u[t].push(a),!1}function rm(e,t){const n=e.fovAboveCenter,a=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,u=(e._camera.position[2]*e.worldSize-a)/Math.cos(e._pitch),m=Math.sin(n)*u/Math.sin(Math.max(Math.PI/2-e._pitch-n,.01)),y=Math.sin(e._pitch)*m+u;return Math.min(1.01*y,u*(1/e._horizonShift))}function yl(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const n=Math.pow(2,-e.z),a=e.x*n,u=(e.x+1)*n,m=e.y*n,y=(e.y+1)*n,b=eo(a),S=eo(u),M=Xn(m),k=Xn(y),I=t.project(b,M),L=t.project(S,M),B=t.project(S,k),F=t.project(b,k);let j=Math.min(I.x,L.x,B.x,F.x),$=Math.min(I.y,L.y,B.y,F.y),nt=Math.max(I.x,L.x,B.x,F.x),ht=Math.max(I.y,L.y,B.y,F.y);const tt=n/16;function at(ut,Ft,Rt,Wt,he,jt){const Kt=(Rt+he)/2,te=(Wt+jt)/2,oe=t.project(eo(Kt),Xn(te)),ue=Math.max(0,j-oe.x,$-oe.y,oe.x-nt,oe.y-ht);j=Math.min(j,oe.x),nt=Math.max(nt,oe.x),$=Math.min($,oe.y),ht=Math.max(ht,oe.y),ue>tt&&(at(ut,oe,Rt,Wt,Kt,te),at(oe,Ft,Kt,te,he,jt))}at(I,L,a,m,u,m),at(L,B,u,m,u,y),at(B,F,u,y,a,y),at(F,I,a,y,a,m),j-=tt,$-=tt,nt+=tt,ht+=tt;const ft=1/Math.max(nt-j,ht-$);return{scale:ft,x:j*ft,y:$*ft,x2:nt*ft,y2:ht*ft,projection:t}}const Mg=Vo(new Float32Array(16));class Ma{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,n){return{x:0,y:0,z:0}}unproject(t,n){return new vi(0,0)}projectTilePoint(t,n,a){return{x:t,y:n,z:0}}locationPoint(t,n,a=!0){return t._coordinatePoint(t.locationCoordinate(n),a)}pixelsPerMeter(t,n){return Zo(1,t)*n}pixelSpaceConversion(t,n,a){return 1}farthestPixelDistance(t){return rm(t,t.pixelsPerMeter)}pointCoordinate(t,n,a,u){const m=t.horizonLineFromTop(!1),y=new Mt(n,Math.max(m,a));return t.rayIntersectionCoordinate(t.pointRayIntersection(y,u))}pointCoordinate3D(t,n,a){const u=new Mt(n,a);if(t.elevation)return t.elevation.pointCoordinate(u);{const m=this.pointCoordinate(t,u.x,u.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(t,n){if(t.elevation)return!this.pointCoordinate3D(t,n.x,n.y);const a=t.horizonLineFromTop();return n.y<a}createInversionMatrix(t,n){return Mg}createTileMatrix(t,n,a){let u,m,y;const b=a.canonical,S=Vo(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=yl(b,this);u=1,m=M.x+a.wrap*M.scale,y=M.y,va(S,S,[u/M.scale,u/M.scale,t.pixelsPerMeter/n])}else u=n/t.zoomScale(b.z),m=(b.x+Math.pow(2,b.z)*a.wrap)*u,y=b.y*u;return rh(S,S,[m,y,0]),va(S,S,[u/Xe,u/Xe,1]),S}upVector(t,n,a){return[0,0,1]}upVectorScale(t,n,a){return{metersToTile:1}}}class Eg extends Ma{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[n,a]=this.parallels=t.parallels||[29.5,45.5],u=Math.sin(Jt(n));this.n=(u+Math.sin(Jt(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(t,n){const{n:a,c:u,r0:m}=this,y=Jt(t-this.center[0]),b=Jt(n),S=Math.sqrt(u-2*a*Math.sin(b))/a;return{x:S*Math.sin(y*a),y:S*Math.cos(y*a)-m,z:0}}unproject(t,n){const{n:a,c:u,r0:m}=this,y=m+n;let b=Math.atan2(t,Math.abs(y))*Math.sign(y);y*a<0&&(b-=Math.PI*Math.sign(t)*Math.sign(y));const S=Jt(this.center[0])*a;b=cn(b,-Math.PI-S,Math.PI-S);const M=Je(le(b/a)+this.center[0],-180,180),k=Math.asin(Je((u-(t*t+y*y)*a*a)/(2*a),-1,1)),I=Je(le(k),-rn,rn);return new vi(M,I)}}const Gh=1.340264,qh=-.081106,Hh=893e-6,$h=.003796,rd=Math.sqrt(3)/2;class Ag extends Ma{project(t,n){n=n/180*Math.PI,t=t/180*Math.PI;const a=Math.asin(rd*Math.sin(n)),u=a*a,m=u*u*u;return{x:.5*(t*Math.cos(a)/(rd*(Gh+3*qh*u+m*(7*Hh+9*$h*u)))/Math.PI+.5),y:1-.5*(a*(Gh+qh*u+m*(Hh+$h*u))/Math.PI+1),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,u=a*a,m=u*u*u;for(let k,I,L,B=0;B<12&&(I=a*(Gh+qh*u+m*(Hh+$h*u))-n,L=Gh+3*qh*u+m*(7*Hh+9*$h*u),k=I/L,a=Je(a-k,-Math.PI/3,Math.PI/3),u=a*a,m=u*u*u,!(Math.abs(k)<1e-12));++B);const y=rd*t*(Gh+3*qh*u+m*(7*Hh+9*$h*u))/Math.cos(a),b=Math.asin(Math.sin(a)/rd),S=Je(180*y/Math.PI,-180,180),M=Je(180*b/Math.PI,-rn,rn);return new vi(S,M)}}class kg extends Ma{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,n){return{x:.5+t/360,y:.5-n/360,z:0}}unproject(t,n){const a=360*(t-.5),u=Je(360*(.5-n),-rn,rn);return new vi(a,u)}}const xc=Math.PI/2;function ad(e){return Math.tan((xc+e)/2)}class Dg extends Ma{constructor(t){super(t),this.center=t.center||[0,30];const[n,a]=this.parallels=t.parallels||[30,30];let u=Jt(n),m=Jt(a);this.southernCenter=u+m<0,this.southernCenter&&(u=-u,m=-m);const y=Math.cos(u),b=ad(u);this.n=u===m?Math.sin(u):Math.log(y/Math.cos(m))/Math.log(ad(m)/b),this.f=y*Math.pow(ad(u),this.n)/this.n}project(t,n){n=Jt(n),this.southernCenter&&(n=-n),t=Jt(t-this.center[0]);const a=1e-6,{n:u,f:m}=this;m>0?n<-xc+a&&(n=-xc+a):n>xc-a&&(n=xc-a);const y=m/Math.pow(ad(n),u);let b=y*Math.sin(u*t),S=m-y*Math.cos(u*t);return b=.5*(b/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:b,y:this.southernCenter?S:1-S,z:0}}unproject(t,n){t=(2*t-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:a,f:u}=this,m=u-n,y=Math.sign(m),b=Math.sign(a)*Math.sqrt(t*t+m*m);let S=Math.atan2(t,Math.abs(m))*y;m*a<0&&(S-=Math.PI*Math.sign(t)*y);const M=Je(le(S/a)+this.center[0],-180,180),k=Je(le(2*Math.atan(Math.pow(u/b,1/a))-xc),-rn,rn);return new vi(M,this.southernCenter?-k:k)}}class am extends Ma{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,n){return{x:gs(t),y:to(n),z:0}}unproject(t,n){const a=eo(t),u=Xn(n);return new vi(a,u)}}const _p=Jt(rn);class Pg extends Ma{project(t,n){const a=(n=Jt(n))*n,u=a*a;return{x:.5*((t=Jt(t))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,u=25,m=0,y=a*a;do{y=a*a;const M=y*y;m=(a*(1.007226+y*(.015085+M*(.028874*y-.044475-.005916*M)))-n)/(1.007226+y*(.045255+M*(.259866*y-.311325-.005916*11*M))),a=Je(a-m,-_p,_p)}while(Math.abs(m)>1e-6&&--u>0);y=a*a;const b=Je(le(t/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),S=le(a);return new vi(b,S)}}const lm=Jt(rn);class Ig extends Ma{project(t,n){n=Jt(n),t=Jt(t);const a=Math.cos(n),u=2/Math.PI,m=Math.acos(a*Math.cos(t/2)),y=Math.sin(m)/m,b=.5*(t*u+2*a*Math.sin(t/2)/y)||0,S=.5*(n+Math.sin(n)/y)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(t,n){let a=t=(2*t-.5)*Math.PI,u=n=(2*(1-n)-1)*Math.PI,m=25;const y=1e-6;let b=0,S=0;do{const M=Math.cos(u),k=Math.sin(u),I=2*k*M,L=k*k,B=M*M,F=Math.cos(a/2),j=Math.sin(a/2),$=2*F*j,nt=j*j,ht=1-B*F*F,tt=ht?1/ht:0,at=ht?Math.acos(M*F)*Math.sqrt(1/ht):0,ft=.5*(2*at*M*j+2*a/Math.PI)-t,ut=.5*(at*k+u)-n,Ft=.5*tt*(B*nt+at*M*F*L)+1/Math.PI,Rt=tt*($*I/4-at*k*j),Wt=.125*tt*(I*j-at*k*B*$),he=.5*tt*(L*F+at*nt*M)+.5,jt=Rt*Wt-he*Ft;b=(ut*Rt-ft*he)/jt,S=(ft*Wt-ut*Ft)/jt,a=Je(a-b,-Math.PI,Math.PI),u=Je(u-S,-lm,lm)}while((Math.abs(b)>y||Math.abs(S)>y)&&--m>0);return new vi(le(a),le(u))}}class cm extends Ma{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Jt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,n){const{scale:a,cosPhi:u}=this;return{x:Jt(t)*u*a+.5,y:-Math.sin(Jt(n))/u*a+.5,z:0}}unproject(t,n){const{scale:a,cosPhi:u}=this,m=-(n-.5)/a,y=Je(le((t-.5)/a)/u,-180,180),b=Math.asin(Je(m*u,-1,1)),S=Je(le(b),-rn,rn);return new vi(y,S)}}class Lg extends am{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,n,a){const u=yh(t,n,a);return en(u,u,vh(dr(a))),{x:u[0],y:u[1],z:u[2]}}locationPoint(t,n){const a=rc(n.lat,n.lng),u=es([],a),m=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(n),t._centerAltitude):t._centerAltitude;uh(a,a,u,Zo(1,0)*Xe*m);const y=Vo(new Float64Array(16));return Pr(y,t.pixelMatrix,t.globeMatrix),en(a,a,y),new Mt(a[0],a[1])}pixelsPerMeter(t,n){return Zo(1,0)*n}pixelSpaceConversion(t,n,a){const u=Zo(1,t)*n,m=ui(Zo(1,45)*n,u,a);return this.pixelsPerMeter(t,n)/m}createTileMatrix(t,n,a){const u=Id(dr(a.canonical));return Pr(new Float64Array(16),t.globeMatrix,u)}createInversionMatrix(t,n){const{center:a}=t,u=vh(dr(n));return Cd(u,u,Jt(a.lng)),Zp(u,u,Jt(a.lat)),va(u,u,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(t,n,a,u){return kd(t,n,a,!0)||new ac(0,0)}pointCoordinate3D(t,n,a){const u=this.pointCoordinate(t,n,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(t,n){return!kd(t,n.x,n.y,!1)}farthestPixelDistance(t){const n=function(u,m){const y=u.cameraToCenterDistance,b=u._centerAltitude*m,S=u._camera,M=u._camera.forward(),k=Ir([],Us([],M,-y),[0,0,b]),I=u.worldSize/(2*Math.PI),L=[0,0,-I],B=u.width/u.height,F=Math.tan(u.fovAboveCenter),j=Us([],S.up(),F),$=Us([],S.right(),F*B),nt=es([],Ir([],Ir([],M,j),$)),ht=[];let tt;if(new Cu(k,nt).closestPointOnSphere(L,I,ht)){const at=Ir([],ht,L),ft=jo([],at,k);tt=Math.cos(u.fovAboveCenter)*lh(ft)}else{const at=jo([],k,L),ft=jo([],L,k);es(ft,ft);const ut=lh(at)-I;tt=Math.sqrt(ut*(ut+2*I));const Ft=Math.acos(tt/(I+ut))-Math.acos(ps(M,ft));tt*=Math.cos(Ft)}return 1.01*tt}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),a=cl(t.zoom);if(a>0){const u=rm(t,Zo(1,t.center.lat)*t.worldSize),m=t.worldSize/(2*Math.PI),y=Math.max(t.width,t.height)/t.worldSize*Math.PI;return ui(n,u+m*(1-Math.cos(y)),Math.pow(a,10))}return n}upVector(t,n,a){return yh(n,a,t,1)}upVectorScale(t){return{metersToTile:_h(Eu(dr(t)))}}}function hm(e){const t=e.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new am(e);case"equirectangular":return new kg(e);case"naturalEarth":return new Pg(e);case"equalEarth":return new Ag(e);case"winkelTripel":return new Ig(e);case"albers":return n?new cm(e):new Eg(e);case"lambertConformalConic":return n?new cm(e):new Dg(e);case"globe":return new Lg(e)}throw new Error(`Invalid projection name: ${e.name}`)}const Rg=ju.types,zg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ld(e,t,n,a,u,m,y,b,S,M,k,I,L){const B=b?Math.min(Ca,Math.round(b[0])):0,F=b?Math.min(Ca,Math.round(b[1])):0;e.emplaceBack(t,n,Math.round(32*a),Math.round(32*u),m,y,(B<<1)+(S?1:0),F,16*M,16*k,256*I,256*L)}function cd(e,t,n,a,u,m,y){e.emplaceBack(t,n,a,u,m,y)}function hd(e,t,n,a,u){e.emplaceBack(t,n,a,u),e.emplaceBack(t,n,a,u),e.emplaceBack(t,n,a,u),e.emplaceBack(t,n,a,u)}function um(e){for(const t of e.sections)if(U(t.text))return!0;return!1}class yp{constructor(t){this.layoutVertexArray=new ts,this.indexArray=new Wn,this.programConfigurations=t,this.segments=new bn,this.dynamicLayoutVertexArray=new zi,this.opacityVertexArray=new Di,this.placedSymbolArray=new Mp,this.globeExtVertexArray=new Xi}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,n,a,u){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Qm.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,tg.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,zg,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Nf.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}De(yp,"SymbolBuffers");class xp{constructor(t,n,a){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new a,this.segments=new bn,this.collisionVertexArray=new Vi,this.collisionVertexArrayExt=new xn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,eg.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Vf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}De(xp,"CollisionBuffers");class ns{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(y=>y.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vo([]),this.placementViewportMatrix=Vo([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=$u(this.zoom,n["text-size"]),this.iconSizeData=$u(this.zoom,n["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(y=>io[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new yp(new Fs(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new yp(new Fs(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new vd,this.lineVertexArray=new kp,this.symbolInstances=new Ap}calculateGlyphDependencies(t,n,a,u,m){for(let y=0;y<t.length;y++)if(n[t.charCodeAt(y)]=!0,u&&m){const b=Nh[t.charAt(y)];b&&(n[b.charCodeAt(0)]=!0)}}populate(t,n,a,u){const m=this.layers[0],y=m.layout,b="globe"===this.projection.name,S=y.get("text-font"),M=y.get("text-field"),k=y.get("icon-image"),I=("constant"!==M.value.kind||M.value.value instanceof Ss&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&("constant"!==S.value.kind||S.value.value.length>0),L="constant"!==k.value.kind||!!k.value.value||Object.keys(k.parameters).length>0,B=y.get("symbol-sort-key");if(this.features=[],!I&&!L)return;const F=n.iconDependencies,j=n.glyphDependencies,$=n.availableImages,nt=new Et(this.zoom);for(const{feature:ht,id:tt,index:at,sourceLayerIndex:ft}of t){const ut=m._featureFilter.needGeometry,Ft=zr(ht,ut);if(!m._featureFilter.filter(nt,Ft,a))continue;if(ut||(Ft.geometry=Rr(ht,a,u)),b&&1!==ht.type&&a.z<=5){const jt=Ft.geometry,Kt=.98078528056,te=(oe,ue)=>ps(yh(oe.x,oe.y,a,1),yh(ue.x,ue.y,a,1))<Kt;for(let oe=0;oe<jt.length;oe++)jt[oe]=Ud(jt[oe],te)}let Rt,Wt;if(I){const jt=m.getValueAndResolveTokens("text-field",Ft,a,$),Kt=Ss.factory(jt);um(Kt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===pt()||this.hasRTLText&&xt.isParsed())&&(Rt=ng(Kt,m,Ft))}if(L){const jt=m.getValueAndResolveTokens("icon-image",Ft,a,$);Wt=jt instanceof Jn?jt:Jn.fromString(jt)}if(!Rt&&!Wt)continue;const he=this.sortFeaturesByKey?B.evaluate(Ft,{},a):void 0;if(this.features.push({id:tt,text:Rt,icon:Wt,index:at,sourceLayerIndex:ft,geometry:Ft.geometry,properties:ht.properties,type:Rg[ht.type],sortKey:he}),Wt&&(F[Wt.name]=!0),Rt){const jt=S.evaluate(Ft,{},a).join(","),Kt="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(io.vertical)>=0;for(const te of Rt.sections)if(te.image)F[te.image.name]=!0;else{const oe=v(Rt.toString()),ue=te.fontStack||jt,Gt=j[ue]=j[ue]||{};this.calculateGlyphDependencies(te.text,Gt,Kt,this.allowVerticalPlacement,oe)}}}"line"===y.get("symbol-placement")&&(this.features=function(ht){const tt={},at={},ft=[];let ut=0;function Ft(jt){ft.push(ht[jt]),ut++}function Rt(jt,Kt,te){const oe=at[jt];return delete at[jt],at[Kt]=oe,ft[oe].geometry[0].pop(),ft[oe].geometry[0]=ft[oe].geometry[0].concat(te[0]),oe}function Wt(jt,Kt,te){const oe=tt[Kt];return delete tt[Kt],tt[jt]=oe,ft[oe].geometry[0].shift(),ft[oe].geometry[0]=te[0].concat(ft[oe].geometry[0]),oe}function he(jt,Kt,te){const oe=te?Kt[0][Kt[0].length-1]:Kt[0][0];return`${jt}:${oe.x}:${oe.y}`}for(let jt=0;jt<ht.length;jt++){const Kt=ht[jt],te=Kt.geometry,oe=Kt.text?Kt.text.toString():null;if(!oe){Ft(jt);continue}const ue=he(oe,te),Gt=he(oe,te,!0);if(ue in at&&Gt in tt&&at[ue]!==tt[Gt]){const ve=Wt(ue,Gt,te),$e=Rt(ue,Gt,ft[ve].geometry);delete tt[ue],delete at[Gt],at[he(oe,ft[$e].geometry,!0)]=$e,ft[ve].geometry=null}else ue in at?Rt(ue,Gt,te):Gt in tt?Wt(ue,Gt,te):(Ft(jt),tt[ue]=ut-1,at[Gt]=ut-1)}return ft.filter(jt=>jt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ht,tt)=>ht.sortKey-tt.sortKey)}update(t,n,a,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,a,u),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,a,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=hm(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const a=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:u,y:m}of n)this.lineVertexArray.emplaceBack(u,m);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,n,a,u,m,y,b,S,M,k,I,L,B,F){const j=t.indexArray,$=t.layoutVertexArray,nt=t.globeExtVertexArray,ht=t.segments.prepareSegment(4*n.length,$,j,this.canOverlap?y.sortKey:void 0),tt=this.glyphOffsetArray.length,at=ht.vertexLength,ft=this.allowVerticalPlacement&&b===io.vertical?Math.PI/2:0,ut=y.text&&y.text.sections;for(let Rt=0;Rt<n.length;Rt++){const{tl:Wt,tr:he,bl:jt,br:Kt,tex:te,pixelOffsetTL:oe,pixelOffsetBR:ue,minFontScaleX:Gt,minFontScaleY:ve,glyphOffset:$e,isSDF:Se,sectionIndex:Oe}=n[Rt],be=ht.vertexLength,Ye=$e[1];if(ld($,M.x,M.y,Wt.x,Ye+Wt.y,te.x,te.y,a,Se,oe.x,oe.y,Gt,ve),ld($,M.x,M.y,he.x,Ye+he.y,te.x+te.w,te.y,a,Se,ue.x,oe.y,Gt,ve),ld($,M.x,M.y,jt.x,Ye+jt.y,te.x,te.y+te.h,a,Se,oe.x,ue.y,Gt,ve),ld($,M.x,M.y,Kt.x,Ye+Kt.y,te.x+te.w,te.y+te.h,a,Se,ue.x,ue.y,Gt,ve),S){const{x:mi,y:fi,z:ci}=S.anchor,[Ke,Bi,ti]=S.up;cd(nt,mi,fi,ci,Ke,Bi,ti),cd(nt,mi,fi,ci,Ke,Bi,ti),cd(nt,mi,fi,ci,Ke,Bi,ti),cd(nt,mi,fi,ci,Ke,Bi,ti),hd(t.dynamicLayoutVertexArray,mi,fi,ci,ft)}else hd(t.dynamicLayoutVertexArray,M.x,M.y,M.z,ft);j.emplaceBack(be,be+1,be+2),j.emplaceBack(be+1,be+2,be+3),ht.vertexLength+=4,ht.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($e[0]),Rt!==n.length-1&&Oe===n[Rt+1].sectionIndex||t.programConfigurations.populatePaintArrays($.length,y,y.index,{},B,F,ut&&ut[Oe])}const Ft=S?S.anchor:M;t.placedSymbolArray.emplaceBack(Ft.x,Ft.y,Ft.z,M.x,M.y,tt,this.glyphOffsetArray.length-tt,at,k,I,M.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],b,0,!1,0,L,0)}_commitLayoutVertex(t,n,a,u,m,y,b){t.emplaceBack(n,a,u,m,y,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(t,n,a,u,m,y,b){const S=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),M=S.vertexLength,k=b.tileAnchorX,I=b.tileAnchorY;for(let B=0;B<4;B++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(n,-t.padding,-t.padding),a.collisionVertexArrayExt.emplaceBack(n,t.padding,-t.padding),a.collisionVertexArrayExt.emplaceBack(n,t.padding,t.padding),a.collisionVertexArrayExt.emplaceBack(n,-t.padding,t.padding),this._commitLayoutVertex(a.layoutVertexArray,u,m,y,k,I,new Mt(t.x1,t.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,m,y,k,I,new Mt(t.x2,t.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,m,y,k,I,new Mt(t.x2,t.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,m,y,k,I,new Mt(t.x1,t.y2)),S.vertexLength+=4;const L=a.indexArray;L.emplaceBack(M,M+1),L.emplaceBack(M+1,M+2),L.emplaceBack(M+2,M+3),L.emplaceBack(M+3,M),S.primitiveLength+=4}_addTextDebugCollisionBoxes(t,n,a,u,m,y){for(let b=u;b<m;b++){const S=a.get(b),M=this.getSymbolInstanceTextSize(t,y,n,b);this._addCollisionDebugVertices(S,M,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(t,n,a,u,m,y){for(let b=u;b<m;b++){const S=a.get(b),M=this.getSymbolInstanceIconSize(t,n,y.placedIconSymbolIndex);this._addCollisionDebugVertices(S,M,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,y)}}generateCollisionDebugBuffers(t,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new xp(un,Uh.members,Uo),this.iconCollisionBox=new xp(un,Uh.members,Uo);const a=ml(this.iconSizeData,t),u=ml(this.textSizeData,t);for(let m=0;m<this.symbolInstances.length;m++){const y=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(u,t,n,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(u,t,n,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(a,t,n,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(a,t,n,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(t,n,a,u){const m=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:u),y=is(this.textSizeData,t,m)/Yn;return this.tilePixelRatio*y}getSymbolInstanceIconSize(t,n,a){const u=this.icon.placedSymbolArray.get(a),m=is(this.iconSizeData,t,u);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(t,n,a){t.emplaceBack(n,-a,-a),t.emplaceBack(n,a,-a),t.emplaceBack(n,a,a),t.emplaceBack(n,-a,a)}_updateTextDebugCollisionBoxes(t,n,a,u,m,y){for(let b=u;b<m;b++){const S=a.get(b),M=this.getSymbolInstanceTextSize(t,y,n,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,S.padding)}}_updateIconDebugCollisionBoxes(t,n,a,u,m,y){for(let b=u;b<m;b++){const S=a.get(b),M=this.getSymbolInstanceIconSize(t,n,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,S.padding)}}updateCollisionDebugBuffers(t,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=ml(this.iconSizeData,t),u=ml(this.textSizeData,t);for(let m=0;m<this.symbolInstances.length;m++){const y=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(u,t,n,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(u,t,n,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(a,t,n,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(a,t,n,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,n,a,u,m,y,b,S,M){const k={};if(n<a){const{x1:I,y1:L,x2:B,y2:F,padding:j,projectedAnchorX:$,projectedAnchorY:nt,projectedAnchorZ:ht,tileAnchorX:tt,tileAnchorY:at,featureIndex:ft}=t.get(n);k.textBox={x1:I,y1:L,x2:B,y2:F,padding:j,projectedAnchorX:$,projectedAnchorY:nt,projectedAnchorZ:ht,tileAnchorX:tt,tileAnchorY:at},k.textFeatureIndex=ft}if(u<m){const{x1:I,y1:L,x2:B,y2:F,padding:j,projectedAnchorX:$,projectedAnchorY:nt,projectedAnchorZ:ht,tileAnchorX:tt,tileAnchorY:at,featureIndex:ft}=t.get(u);k.verticalTextBox={x1:I,y1:L,x2:B,y2:F,padding:j,projectedAnchorX:$,projectedAnchorY:nt,projectedAnchorZ:ht,tileAnchorX:tt,tileAnchorY:at},k.verticalTextFeatureIndex=ft}if(y<b){const{x1:I,y1:L,x2:B,y2:F,padding:j,projectedAnchorX:$,projectedAnchorY:nt,projectedAnchorZ:ht,tileAnchorX:tt,tileAnchorY:at,featureIndex:ft}=t.get(y);k.iconBox={x1:I,y1:L,x2:B,y2:F,padding:j,projectedAnchorX:$,projectedAnchorY:nt,projectedAnchorZ:ht,tileAnchorX:tt,tileAnchorY:at},k.iconFeatureIndex=ft}if(S<M){const{x1:I,y1:L,x2:B,y2:F,padding:j,projectedAnchorX:$,projectedAnchorY:nt,projectedAnchorZ:ht,tileAnchorX:tt,tileAnchorY:at,featureIndex:ft}=t.get(S);k.verticalIconBox={x1:I,y1:L,x2:B,y2:F,padding:j,projectedAnchorX:$,projectedAnchorY:nt,projectedAnchorZ:ht,tileAnchorX:tt,tileAnchorY:at},k.verticalIconFeatureIndex=ft}return k}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const a=t.placedSymbolArray.get(n),u=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<u;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(t),a=Math.cos(t),u=[],m=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const S=this.symbolInstances.get(b);u.push(0|Math.round(n*S.tileAnchorX+a*S.tileAnchorY)),m.push(S.featureIndex)}return y.sort((b,S)=>u[b]-u[S]||m[S]-m[b]),y}addToSortKeyRanges(t,n){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:M}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),m>=0&&m!==u&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&y!==m&&y!==u&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}De(ns,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ns.MAX_GLYPHS=65535,ns.addDynamicAttributes=hd;const Og=new se({"symbol-placement":new wt(Ht.layout_symbol["symbol-placement"]),"symbol-spacing":new wt(Ht.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wt(Ht.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Nt(Ht.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wt(Ht.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new wt(Ht.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new wt(Ht.layout_symbol["icon-ignore-placement"]),"icon-optional":new wt(Ht.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wt(Ht.layout_symbol["icon-rotation-alignment"]),"icon-size":new Nt(Ht.layout_symbol["icon-size"]),"icon-text-fit":new wt(Ht.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new wt(Ht.layout_symbol["icon-text-fit-padding"]),"icon-image":new Nt(Ht.layout_symbol["icon-image"]),"icon-rotate":new Nt(Ht.layout_symbol["icon-rotate"]),"icon-padding":new wt(Ht.layout_symbol["icon-padding"]),"icon-keep-upright":new wt(Ht.layout_symbol["icon-keep-upright"]),"icon-offset":new Nt(Ht.layout_symbol["icon-offset"]),"icon-anchor":new Nt(Ht.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wt(Ht.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wt(Ht.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wt(Ht.layout_symbol["text-rotation-alignment"]),"text-field":new Nt(Ht.layout_symbol["text-field"]),"text-font":new Nt(Ht.layout_symbol["text-font"]),"text-size":new Nt(Ht.layout_symbol["text-size"]),"text-max-width":new Nt(Ht.layout_symbol["text-max-width"]),"text-line-height":new Nt(Ht.layout_symbol["text-line-height"]),"text-letter-spacing":new Nt(Ht.layout_symbol["text-letter-spacing"]),"text-justify":new Nt(Ht.layout_symbol["text-justify"]),"text-radial-offset":new Nt(Ht.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wt(Ht.layout_symbol["text-variable-anchor"]),"text-anchor":new Nt(Ht.layout_symbol["text-anchor"]),"text-max-angle":new wt(Ht.layout_symbol["text-max-angle"]),"text-writing-mode":new wt(Ht.layout_symbol["text-writing-mode"]),"text-rotate":new Nt(Ht.layout_symbol["text-rotate"]),"text-padding":new wt(Ht.layout_symbol["text-padding"]),"text-keep-upright":new wt(Ht.layout_symbol["text-keep-upright"]),"text-transform":new Nt(Ht.layout_symbol["text-transform"]),"text-offset":new Nt(Ht.layout_symbol["text-offset"]),"text-allow-overlap":new wt(Ht.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new wt(Ht.layout_symbol["text-ignore-placement"]),"text-optional":new wt(Ht.layout_symbol["text-optional"])});var vp={paint:new se({"icon-opacity":new Nt(Ht.paint_symbol["icon-opacity"]),"icon-color":new Nt(Ht.paint_symbol["icon-color"]),"icon-halo-color":new Nt(Ht.paint_symbol["icon-halo-color"]),"icon-halo-width":new Nt(Ht.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Nt(Ht.paint_symbol["icon-halo-blur"]),"icon-translate":new wt(Ht.paint_symbol["icon-translate"]),"icon-translate-anchor":new wt(Ht.paint_symbol["icon-translate-anchor"]),"text-opacity":new Nt(Ht.paint_symbol["text-opacity"]),"text-color":new Nt(Ht.paint_symbol["text-color"],{runtimeType:$s,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Nt(Ht.paint_symbol["text-halo-color"]),"text-halo-width":new Nt(Ht.paint_symbol["text-halo-width"]),"text-halo-blur":new Nt(Ht.paint_symbol["text-halo-blur"]),"text-translate":new wt(Ht.paint_symbol["text-translate"]),"text-translate-anchor":new wt(Ht.paint_symbol["text-translate-anchor"])}),layout:Og};class dm{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ao,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}De(dm,"FormatSectionOverride",{omit:["defaultValue"]});class ud extends mo{constructor(t){super(t,vp)}recalculate(t,n){super.recalculate(t,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const m of a)u.indexOf(m)<0&&u.push(m);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,n,a,u){const m=this.layout.get(t).evaluate(n,{},a,u),y=this._unevaluatedLayout._values[t];return y.isDataDriven()||$i(y.value)||!m?m:(b=n.properties,m.replace(/{([^{}]+)}/g,(M,k)=>k in b?String(b[k]):""));var b}createBucket(t){return new ns(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of vp.paint.overridableProperties){if(!ud.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),a=new dm(n),u=new Gl(a,n.property.specification);let m=null;m="constant"===n.value.kind||"source"===n.value.kind?new Wa("source",u):new us("composite",u,n.value.zoomStops,n.value._interpolationType),this.paint._values[t]=new ne(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&ud.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const a=t.get("text-field"),u=vp.paint.properties[n];let m=!1;const y=b=>{for(const S of b)if(u.overrides&&u.overrides.hasOverride(S))return void(m=!0)};if("constant"===a.value.kind&&a.value.value instanceof Ss)y(a.value.value.sections);else if("source"===a.value.kind){const b=M=>{m||(M instanceof Oa&&_n(M.value)===La?y(M.value.sections):M instanceof Ba?y(M.sections):M.eachChild(b))},S=a.value;S._styleExpression&&b(S._styleExpression.expression)}return m}getProgramConfiguration(t){return new xa(this,t)}}var Bg={paint:new se({"background-color":new wt(Ht.paint_background["background-color"]),"background-pattern":new wt(Ht.paint_background["background-pattern"]),"background-opacity":new wt(Ht.paint_background["background-opacity"])})},Ea={paint:new se({"raster-opacity":new wt(Ht.paint_raster["raster-opacity"]),"raster-hue-rotate":new wt(Ht.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wt(Ht.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wt(Ht.paint_raster["raster-brightness-max"]),"raster-saturation":new wt(Ht.paint_raster["raster-saturation"]),"raster-contrast":new wt(Ht.paint_raster["raster-contrast"]),"raster-resampling":new wt(Ht.paint_raster["raster-resampling"]),"raster-fade-duration":new wt(Ht.paint_raster["raster-fade-duration"])})};class Fg extends mo{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var pm={paint:new se({"sky-type":new wt(Ht.paint_sky["sky-type"]),"sky-atmosphere-sun":new wt(Ht.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new wt(Ht.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new wt(Ht.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new wt(Ht.paint_sky["sky-gradient-radius"]),"sky-gradient":new ee(Ht.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new wt(Ht.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new wt(Ht.paint_sky["sky-atmosphere-color"]),"sky-opacity":new wt(Ht.paint_sky["sky-opacity"])})};function dd(e,t,n){const a=[0,0,1],u=sc([]);return Ed(u,u,n?-Jt(e)+Math.PI:Jt(e)),ph(u,u,-Jt(t)),$p(a,a,u),es(a,a)}const l={circle:class extends mo{constructor(e){super(e,mf)}createBucket(e){return new Vd(e)}queryRadius(e){const t=e;return lc("circle-radius",this,t)+lc("circle-stroke-width",this,t)+Sh(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,a,u,m,y,b){const S=qd(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,e.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return Ch(e,a,m,y,b,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),S,M)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new xa(this,e)}},heatmap:class extends mo{createBucket(e){return new wa(e)}constructor(e){super(e,Pu),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Wd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return lc("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,a,u,m,y,b){const S=this.paint.get("heatmap-radius").evaluate(t,n);return Ch(e,a,m,y,b,!0,!0,new Mt(0,0),S)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new xa(this,e)}},hillshade:class extends mo{constructor(e){super(e,km)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends mo{constructor(e){super(e,Um)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(e){return new xa(this,e)}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Nu(e)}queryRadius(){return Sh(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,a,u,m){return!e.queryGeometry.isAboveHorizon&&uf(Gd(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,e.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends mo{constructor(e){super(e,Rf)}createBucket(e){return new Rh(e)}queryRadius(){return Sh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new xa(this,e)}queryIntersectsFeature(e,t,n,a,u,m,y,b,S){const M=qd(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,e.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(t,n),I=this.paint.get("fill-extrusion-base").evaluate(t,n),L=[0,0],B=b&&m.elevation,F=m.elevation?m.elevation.exaggeration():1,j=e.tile.getBucket(this);if(B&&j instanceof Rh){const at=j.centroidVertexArray,ft=S+1;ft<at.length&&(L[0]=at.geta_centroid_pos0(ft),L[1]=at.geta_centroid_pos1(ft))}if(0===L[0]&&1===L[1])return!1;"globe"===m.projection.name&&(a=sp([a],[new Mt(0,0),new Mt(Xe,Xe)],e.tileID.canonical).map(at=>at.polygon).flat());const $=B?b:null,[nt,ht]=(ft=a,ut=I,Ft=k,Rt=M,Wt=y,he=$,jt=L,Kt=F,te=m.center.lat,"globe"===(at=m).projection.name?function(ue,Gt,ve,$e,Se,Oe,be,Ye,mi,fi,ci){const Ke=[],Bi=[],ti=ue.projection.upVectorScale(ci,ue.center.lat,ue.worldSize).metersToTile,gi=[0,0,0,1],ji=[0,0,0,1],nn=(sn,an,Sn,ss)=>{sn[0]=an,sn[1]=Sn,sn[2]=ss,sn[3]=1},Yi=Lf();ve>0&&(ve+=Yi),$e+=Yi;for(const sn of Gt){const an=[],Sn=[];for(const ss of sn){const Fi=ss.x+Se.x,zn=ss.y+Se.y,Dn=ue.projection.projectTilePoint(Fi,zn,ci),ki=ue.projection.upVector(ci,ss.x,ss.y);let fn=ve,Zn=$e;if(be){const Zi=qu(Fi,zn,ve,$e,be,Ye,mi,fi);fn+=Zi.base,Zn+=Zi.top}0!==ve?nn(gi,Dn.x+ki[0]*ti*fn,Dn.y+ki[1]*ti*fn,Dn.z+ki[2]*ti*fn):nn(gi,Dn.x,Dn.y,Dn.z),nn(ji,Dn.x+ki[0]*ti*Zn,Dn.y+ki[1]*ti*Zn,Dn.z+ki[2]*ti*Zn),en(gi,gi,Oe),en(ji,ji,Oe),an.push(new fl(gi[0],gi[1],gi[2])),Sn.push(new fl(ji[0],ji[1],ji[2]))}Ke.push(an),Bi.push(Sn)}return[Ke,Bi]}(at,ft,ut,Ft,Rt,Wt,he,jt,Kt,te,e.tileID.canonical):he?function(ue,Gt,ve,$e,Se,Oe,be,Ye,mi){const fi=[],ci=[],Ke=[0,0,0,1];for(const Bi of ue){const ti=[],gi=[];for(const ji of Bi){const nn=ji.x+$e.x,Yi=ji.y+$e.y,sn=qu(nn,Yi,Gt,ve,Oe,be,Ye,mi);Ke[0]=nn,Ke[1]=Yi,Ke[2]=sn.base,Ke[3]=1,al(Ke,Ke,Se),Ke[3]=Math.max(Ke[3],1e-5);const an=new fl(Ke[0]/Ke[3],Ke[1]/Ke[3],Ke[2]/Ke[3]);Ke[0]=nn,Ke[1]=Yi,Ke[2]=sn.top,Ke[3]=1,al(Ke,Ke,Se),Ke[3]=Math.max(Ke[3],1e-5);const Sn=new fl(Ke[0]/Ke[3],Ke[1]/Ke[3],Ke[2]/Ke[3]);ti.push(an),gi.push(Sn)}fi.push(ti),ci.push(gi)}return[fi,ci]}(ft,ut,Ft,Rt,Wt,he,jt,Kt,te):function(ue,Gt,ve,$e,Se){const Oe=[],be=[],Ye=Se[8]*Gt,mi=Se[9]*Gt,fi=Se[10]*Gt,ci=Se[11]*Gt,Ke=Se[8]*ve,Bi=Se[9]*ve,ti=Se[10]*ve,gi=Se[11]*ve;for(const ji of ue){const nn=[],Yi=[];for(const sn of ji){const an=sn.x+$e.x,Sn=sn.y+$e.y,ss=Se[0]*an+Se[4]*Sn+Se[12],Fi=Se[1]*an+Se[5]*Sn+Se[13],zn=Se[2]*an+Se[6]*Sn+Se[14],Dn=Se[3]*an+Se[7]*Sn+Se[15],ki=ss+Ye,fn=Fi+mi,Zn=zn+fi,Zi=Math.max(Dn+ci,1e-5),En=ss+Ke,Ps=Fi+Bi,os=zn+ti,rs=Math.max(Dn+gi,1e-5);nn.push(new fl(ki/Zi,fn/Zi,Zn/Zi)),Yi.push(new fl(En/rs,Ps/rs,os/rs))}Oe.push(nn),be.push(Yi)}return[Oe,be]}(ft,ut,Ft,Rt,Wt)),tt=e.queryGeometry;var at,ft,ut,Ft,Rt,Wt,he,jt,Kt,te;return function(at,ft,ut){let Ft=1/0;uf(ut,ft)&&(Ft=Bf(ut,ft[0]));for(let Rt=0;Rt<ft.length;Rt++){const Wt=ft[Rt],he=at[Rt];for(let jt=0;jt<Wt.length-1;jt++){const Kt=Wt[jt],te=[Kt,Wt[jt+1],he[jt+1],he[jt],Kt];jd(ut,te)&&(Ft=Math.min(Ft,Bf(ut,te)))}}return Ft!==1/0&&Ft}(nt,ht,tt.isPointQuery()?tt.screenBounds:tt.screenGeometry)}},line:class extends mo{constructor(e){super(e,op),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Pc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Ff.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new yo(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new xa(this,e)}queryRadius(e){const t=e,n=Uf(lc("line-width",this,t),lc("line-gap-width",this,t)),a=lc("line-offset",this,t);return n/2+Math.abs(a)+Sh(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,a,u,m){if(e.queryGeometry.isAboveHorizon)return!1;const y=Gd(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,e.pixelToTileUnitsFactor),b=e.pixelToTileUnitsFactor/2*Uf(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),S=this.paint.get("line-offset").evaluate(t,n);return S&&(a=function(M,k){const I=[],L=new Mt(0,0);for(let B=0;B<M.length;B++){const F=M[B],j=[];for(let $=0;$<F.length;$++){const ht=F[$],tt=F[$+1],at=0===$?L:ht.sub(F[$-1])._unit()._perp(),ft=$===F.length-1?L:tt.sub(ht)._unit()._perp(),ut=at._add(ft)._unit();ut._mult(1/(ut.x*ft.x+ut.y*ft.y)),j.push(ut._mult(k)._add(ht))}I.push(j)}return I}(a,S*e.pixelToTileUnitsFactor)),function(M,k,I){for(let L=0;L<k.length;L++){const B=k[L];if(M.length>=3)for(let F=0;F<B.length;F++)if(ul(M,B[F]))return!0;if(df(M,B,I))return!0}return!1}(y,a,b)}isTileClipped(){return!0}},symbol:ud,background:class extends mo{constructor(e){super(e,Bg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends mo{constructor(e){super(e,Ea)}getProgramIds(){return["raster"]}},sky:class extends mo{constructor(e){super(e,pm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Wd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const a=this.paint.get("sky-atmosphere-sun"),u=!a,m=e.style.light,y=m.properties.get("position");return u&&"viewport"===m.properties.get("anchor")&&on("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?dd(y.azimuthal,90-y.polar,t):dd(a[0],90-a[1],t)}const n=this.paint.get("sky-gradient-center");return dd(n[0],90-n[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}};class r{constructor(t,n,a,u){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(n,u)}update(t,n,a){const{width:u,height:m}=t,{context:y}=this,{gl:b}=y,{HTMLImageElement:S,HTMLCanvasElement:M,HTMLVideoElement:k,ImageData:I,ImageBitmap:L}=p;if(b.bindTexture(b.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!n||!1!==n.premultiply)),a||this.size&&this.size[0]===u&&this.size[1]===m){const{x:B,y:F}=a||{x:0,y:0};t instanceof S||t instanceof M||t instanceof k||t instanceof I||L&&t instanceof L?b.texSubImage2D(b.TEXTURE_2D,0,B,F,b.RGBA,b.UNSIGNED_BYTE,t):b.texSubImage2D(b.TEXTURE_2D,0,B,F,u,m,b.RGBA,b.UNSIGNED_BYTE,t.data)}else this.size=[u,m],t instanceof S||t instanceof M||t instanceof k||t instanceof I||L&&t instanceof L?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,t):b.texImage2D(b.TEXTURE_2D,0,this.format,u,m,0,this.format,b.UNSIGNED_BYTE,t.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(t,n){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),t!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,t),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?t===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:t),this.filter=t),n!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class i{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class o{constructor(){this.tasks={},this.taskQueue=[],Me(["process"],this),this.invoker=new i(this.process),this.nextId=0}add(t,n){const a=this.nextId++,u=function({type:m,isSymbolTile:y,zoom:b}){return b=b||0,"message"===m?0:"maybePrepare"!==m||y?"parseTile"!==m||y?"parseTile"===m&&y?300-b:"maybePrepare"===m&&y?400-b:500:200-b:100-b}(n);if(0===u){Gs();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:t,metadata:n,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Gs();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const n=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let t=null,n=1/0;for(let u=0;u<this.taskQueue.length;u++){const m=this.tasks[this.taskQueue[u]];m.priority<n&&(n=m.priority,t=u)}if(null===t)return null;const a=this.taskQueue[t];return this.taskQueue.splice(t,1),a}remove(){this.invoker.remove()}}class d{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const a=t[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const _=["tile","layer","source","sourceLayer","state"];class x{constructor(t,n,a,u,m){this.type="Feature",this._vectorTileFeature=t,this._z=n,this._x=a,this._y=u,this.properties=t.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const n of _)void 0!==this[n]&&(t[n]=this[n]);return t}}const T=32,C=33,D=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,n=0,a=0,u=0,m=0,y=0,b=0;for(1&t?u=m=y=T:n=a=b=T;(t>>=1)>1;){const M=n+u>>1,k=a+m>>1;1&t?(u=n,m=a,n=y,a=b):(n=u,a=m,u=y,m=b),y=M,b=k}const S=4*e;D[S+0]=n,D[S+1]=a,D[S+2]=u,D[S+3]=m}const R=new Uint16Array(2178),V=new Uint8Array(1089),H=new Uint16Array(1089);function K(e){return 0===e?-.03125:32===e?.03125:0}var ct=Ue([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const gt={type:2,extent:Xe,loadGeometry:()=>[[new Mt(0,0),new Mt(8193,0),new Mt(8193,8193),new Mt(0,8193),new Mt(0,0)]]};class _t{constructor(t,n,a,u,m){this.tileID=t,this.uid=Is(),this.uses=0,this.tileSize=n,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<bi.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=yl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,a){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,m){const y={};if(!m)return y;for(const b of u){const S=b.layerIds.map(M=>m.getLayer(M)).filter(Boolean);if(0!==S.length){b.layers=S,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(M=>S.filter(k=>k.id===M)[0]));for(const M of S)y[M.id]=b}}return y}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const m=this.buckets[u];if(m instanceof ns){if(this.hasSymbolBuckets=!0,!a)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const m=this.buckets[u];if(m instanceof ns&&m.hasRTLText){this.hasRTLText=!0,xt.isLoading()||xt.isLoaded()||"deferred"!==pt()||dt();break}}this.queryPadding=0;for(const u in this.buckets){const m=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(u).queryRadius(m))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new xu}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const u=this.buckets[a];u.uploadPending()&&u.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new r(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r(t,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,a,u,m,y,b,S){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:b,transform:y,params:m,tileTransform:this.tileTransform},t,n,a):{}}querySourceFeatures(t,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),m=n?n.sourceLayer:"",y=u._geojsonTileLayer||u[m];if(!y)return;const b=Hl(n&&n.filter),{z:S,x:M,y:k}=this.tileID.canonical,I={z:S,x:M,y:k};for(let L=0;L<y.length;L++){const B=y.feature(L);if(b.needGeometry){const $=zr(B,!0);if(!b.filter(new Et(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!b.filter(new Et(this.tileID.overscaledZ),B))continue;const F=a.getId(B,m),j=new x(B,S,M,k,F);j.tile=I,t.push(j)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const a=qo(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{const m=this.expirationTime-n;m?this.expirationTime=a+Math.max(m,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length||!n)return;const a=this.latestFeatureIndex.loadVTLayers(),u=n.style.listImages();for(const m in this.buckets){if(!n.style.hasLayer(m))continue;const y=this.buckets[m],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=a[b],M=t[b];if(!S||!M||0===Object.keys(M).length)continue;if(y.update(M,S,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof yo||y instanceof Nu){const I=n.style._getSourceCache(y.layers[0].source);n._terrain&&n._terrain.enabled&&I&&y.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(I.id,this.tileID)}const k=n&&n.style&&n.style.getLayer(m);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<bi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=bi.now()+t}setTexture(t,n){const a=n.context,u=a.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new r(a,t,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),a.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax))}setDependencies(t,n){const a={};for(const u of n)a[u]=!0;this.dependencies[t]=a}hasDependency(t,n){for(const a of t){const u=this.dependencies[a];if(u)for(const m of n)if(u[m])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const a=Rr(gt,this.tileID.canonical,this.tileTransform)[0],u=new je,m=new No;for(let y=0;y<a.length;y++){const{x:b,y:S}=a[y];u.emplaceBack(b,S),m.emplaceBack(y)}m.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(m),this._tileDebugBuffer=t.createVertexBuffer(u,mh.members),this._tileDebugSegments=bn.simpleSegment(0,0,u.length,m.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const a=Rr(gt,this.tileID.canonical,this.tileTransform)[0];let u,m;if(this.isRaster){const y=function(b,S){const M=yl(b,S),k=Math.pow(2,b.z);for(let $=0;$<C;$++)for(let nt=0;nt<C;nt++){const ht=eo((b.x+(nt+K(nt))/T)/k),tt=Xn((b.y+($+K($))/T)/k),at=S.project(ht,tt),ft=$*C+nt;R[2*ft+0]=Math.round((at.x*M.scale-M.x)*Xe),R[2*ft+1]=Math.round((at.y*M.scale-M.y)*Xe)}V.fill(0),H.fill(0);for(let $=2045;$>=0;$--){const nt=4*$,ht=D[nt+0],tt=D[nt+1],at=D[nt+2],ft=D[nt+3],ut=ht+at>>1,Ft=tt+ft>>1,Rt=ut+Ft-tt,Wt=Ft+ht-ut,he=tt*C+ht,jt=ft*C+at,Kt=Ft*C+ut,te=Math.hypot((R[2*he+0]+R[2*jt+0])/2-R[2*Kt+0],(R[2*he+1]+R[2*jt+1])/2-R[2*Kt+1])>=16;V[Kt]=V[Kt]||(te?1:0),$<1022&&(V[Kt]=V[Kt]||V[(tt+Wt>>1)*C+(ht+Rt>>1)]||V[(ft+Wt>>1)*C+(at+Rt>>1)])}const I=new Ei,L=new Wn;let B=0;function F($,nt){const ht=nt*C+$;return 0===H[ht]&&(I.emplaceBack(R[2*ht+0],R[2*ht+1],$*Xe/T,nt*Xe/T),H[ht]=++B),H[ht]-1}function j($,nt,ht,tt,at,ft){const ut=$+ht>>1,Ft=nt+tt>>1;if(Math.abs($-at)+Math.abs(nt-ft)>1&&V[Ft*C+ut])j(at,ft,$,nt,ut,Ft),j(ht,tt,at,ft,ut,Ft);else{const Rt=F($,nt),Wt=F(ht,tt),he=F(at,ft);L.emplaceBack(Rt,Wt,he)}}return j(0,0,T,T,T,0),j(T,T,0,0,0,T),{vertices:I,indices:L}}(this.tileID.canonical,n);u=y.vertices,m=y.indices}else{u=new Ei,m=new Wn;for(const{x:b,y:S}of a)u.emplaceBack(b,S,0,0);const y=cc(u.int16,void 0,4);for(let b=0;b<y.length;b+=3)m.emplaceBack(y[b],y[b+1],y[b+2])}this._tileBoundsBuffer=t.createVertexBuffer(u,ct.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(m),this._tileBoundsSegments=bn.simpleSegment(0,0,u.length,m.length)}_makeGlobeTileDebugBuffers(t,n){const a=n.projection;if(!a||"globe"!==a.name||n.freezeTileCoverage)return;const u=this.tileID.canonical,m=vh(Qp(u,n)),y=cl(n.zoom);let b;y>0&&(b=Sd(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,u,n,m,b,y),this._makeGlobeTileDebugTextBuffer(t,u,n,m,b,y)}_globePoint(t,n,a,u,m,y,b){let S=yh(t,n,a);if(y){const M=1<<a.z,k=gs(u.center.lng),I=to(u.center.lat),L=(a.x+.5)/M-k;let B=0;L>.5?B=-1:L<-.5&&(B=1);let F=(t/Xe+a.x)/M+B,j=(n/Xe+a.y)/M;F=(F-k)*u._pixelsPerMercatorPixel+k,j=(j-I)*u._pixelsPerMercatorPixel+I;const $=[F*u.worldSize,j*u.worldSize,0];en($,$,y),S=Lr(S,$,b)}return en(S,S,m)}_makeGlobeTileDebugBorderBuffer(t,n,a,u,m,y){const b=new je,S=new No,M=new xi,k=(L,B,F,j,$)=>{const nt=(F-L)/($-1),ht=(j-B)/($-1),tt=b.length;for(let at=0;at<$;at++){const ft=L+at*nt,ut=B+at*ht;b.emplaceBack(ft,ut);const Ft=this._globePoint(ft,ut,n,a,u,m,y);M.emplaceBack(Ft[0],Ft[1],Ft[2]),S.emplaceBack(tt+at)}},I=Xe;k(0,0,I,0,16),k(I,0,I,I,16),k(I,I,0,I,16),k(0,I,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(S),this._tileDebugBuffer=t.createVertexBuffer(b,mh.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(M,fh.members),this._tileDebugSegments=bn.simpleSegment(0,0,b.length,S.length)}_makeGlobeTileDebugTextBuffer(t,n,a,u,m,y){const b=new je,S=new Wn,M=new xi,k=25;S.reserve(32),b.reserve(k),M.reserve(k);const I=(L,B)=>k*L+B;for(let L=0;L<k;L++){const B=2048*L;for(let F=0;F<k;F++){const j=2048*F;b.emplaceBack(j,B);const $=this._globePoint(j,B,n,a,u,m,y);M.emplaceBack($[0],$[1],$[2])}}for(let L=0;L<4;L++)for(let B=0;B<4;B++){const F=I(L,B),j=I(L,B+1),$=I(L+1,B),nt=I(L+1,B+1);S.emplaceBack(F,j,$),S.emplaceBack($,j,nt)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(S),this._tileDebugTextBuffer=t.createVertexBuffer(b,mh.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(M,fh.members),this._tileDebugTextSegments=bn.simpleSegment(0,0,k,32)}}class Xt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,a){const u=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},ni(this.stateChanges[t][u],a),null===this.deletedStates[t]){this.deletedStates[t]={};for(const m in this.state[t])m!==u&&(this.deletedStates[t][m]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][u]){this.deletedStates[t][u]={};for(const m in this.state[t][u])a[m]||(this.deletedStates[t][u][m]=null)}else for(const m in a)this.deletedStates[t]&&this.deletedStates[t][u]&&null===this.deletedStates[t][u][m]&&delete this.deletedStates[t][u][m]}removeFeatureState(t,n,a){if(null===this.deletedStates[t])return;const u=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&void 0!==n)null!==this.deletedStates[t][u]&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][a]=null);else if(void 0!==n)if(this.stateChanges[t]&&this.stateChanges[t][u])for(a in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][a]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,n){const a=String(n),u=ni({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const m=this.deletedStates[t][n];if(null===m)return{};for(const y in m)delete u[y]}return u}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const m={};for(const y in this.stateChanges[u])this.state[u][y]||(this.state[u][y]={}),ni(this.state[u][y],this.stateChanges[u][y]),m[y]=this.state[u][y];a[u]=m}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const m={};if(null===this.deletedStates[u])for(const y in this.state[u])m[y]={},this.state[u][y]={};else for(const y in this.deletedStates[u]){if(null===this.deletedStates[u][y])this.state[u][y]={};else if(this.state[u][y])for(const b of Object.keys(this.deletedStates[u][y]))delete this.state[u][y][b];m[y]=this.state[u][y]}a[u]=a[u]||{},ni(a[u],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(a).length)for(const u in t)t[u].setFeatureState(a,n)}}class $t{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,n){const a=this.toIdx(t,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(t,n){return this.leaves[this.toIdx(t,n)]}toIdx(t,n){return n*this.size+t}}function me(e,t,n,a){let u=0,m=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(a[y])<1e-15){if(n[y]<e[y]||n[y]>t[y])return null}else{const b=1/a[y];let S=(e[y]-n[y])*b,M=(t[y]-n[y])*b;if(S>M){const k=S;S=M,M=k}if(S>u&&(u=S),M<m&&(m=M),u>m)return null}return u}function ge(e,t,n,a,u,m,y,b,S,M,k){const I=a-e,L=u-t,B=m-n,F=y-e,j=b-t,$=S-n,nt=k[1]*$-k[2]*j,ht=k[2]*F-k[0]*$,tt=k[0]*j-k[1]*F,at=I*nt+L*ht+B*tt;if(Math.abs(at)<1e-15)return null;const ft=1/at,ut=M[0]-e,Ft=M[1]-t,Rt=M[2]-n,Wt=(ut*nt+Ft*ht+Rt*tt)*ft;if(Wt<0||Wt>1)return null;const he=Ft*B-Rt*L,jt=Rt*I-ut*B,Kt=ut*L-Ft*I,te=(k[0]*he+k[1]*jt+k[2]*Kt)*ft;return te<0||Wt+te>1?null:(F*he+j*jt+$*Kt)*ft}function ce(e,t,n){return(e-t)/(n-t)}function _e(e,t,n,a,u,m,y,b,S){const M=1<<n,k=m-a,I=y-u,L=(e+1)/M*k+a,B=(t+0)/M*I+u,F=(t+1)/M*I+u;b[0]=(e+0)/M*k+a,b[1]=B,S[0]=L,S[1]=F}class Ve{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(m){const y=Math.ceil(Math.log2(m.dim/8)),b=[];let S=Math.ceil(Math.pow(2,y));const M=1/S,k=(B,F,j,$,nt)=>{const ht=$?1:0,tt=(B+1)*j-ht,at=F*j,ft=(F+1)*j-ht;nt[0]=B*j,nt[1]=at,nt[2]=tt,nt[3]=ft};let I=new $t(S);const L=[];for(let B=0;B<S*S;B++){k(B%S,Math.floor(B/S),M,!1,L);const F=qe(L[0],L[1],m),j=qe(L[2],L[1],m),$=qe(L[2],L[3],m),nt=qe(L[0],L[3],m);I.minimums.push(Math.min(F,j,$,nt)),I.maximums.push(Math.max(F,j,$,nt)),I.leaves.push(1)}for(b.push(I),S/=2;S>=1;S/=2){const B=b[b.length-1];I=new $t(S);for(let F=0;F<S*S;F++){k(F%S,Math.floor(F/S),2,!0,L);const j=B.getElevation(L[0],L[1]),$=B.getElevation(L[2],L[1]),nt=B.getElevation(L[2],L[3]),ht=B.getElevation(L[0],L[3]),tt=B.isLeaf(L[0],L[1]),at=B.isLeaf(L[2],L[1]),ft=B.isLeaf(L[2],L[3]),ut=B.isLeaf(L[0],L[3]),Ft=Math.min(j.min,$.min,nt.min,ht.min),Rt=Math.max(j.max,$.max,nt.max,ht.max),Wt=tt&&at&&ft&&ut;I.maximums.push(Rt),I.minimums.push(Ft),I.leaves.push(Rt-Ft<=5&&Wt?1:0)}b.push(I)}return b}(this.dem),a=n.length-1,u=n[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(t,n,a,u,m,y,b=1){return me([t,n,-100],[a,u,this.maximums[0]*b],m,y)}raycast(t,n,a,u,m,y,b=1){if(!this.nodeCount)return null;const S=this.raycastRoot(t,n,a,u,m,y,b);if(null==S)return null;const M=[],k=[],I=[],L=[],B=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:F,t:j,nodex:$,nodey:nt,depth:ht}=B.pop();if(this.leaves[F]){_e($,nt,ht,t,n,a,u,I,L);const at=1<<ht,ft=($+0)/at,ut=($+1)/at,Ft=(nt+0)/at,Rt=(nt+1)/at,Wt=qe(ft,Ft,this.dem)*b,he=qe(ut,Ft,this.dem)*b,jt=qe(ut,Rt,this.dem)*b,Kt=qe(ft,Rt,this.dem)*b,te=ge(I[0],I[1],Wt,L[0],I[1],he,L[0],L[1],jt,m,y),oe=ge(L[0],L[1],jt,I[0],L[1],Kt,I[0],I[1],Wt,m,y),ue=Math.min(null!==te?te:Number.MAX_VALUE,null!==oe?oe:Number.MAX_VALUE);if(ue!==Number.MAX_VALUE)return ue;{const Gt=uh([],m,y,j);if(Pe(Wt,he,Kt,jt,ce(Gt[0],I[0],L[0]),ce(Gt[1],I[1],L[1]))>=Gt[2])return j}continue}let tt=0;for(let at=0;at<this._siblingOffset.length;at++){_e(($<<1)+this._siblingOffset[at][0],(nt<<1)+this._siblingOffset[at][1],ht+1,t,n,a,u,I,L),I[2]=-100,L[2]=this.maximums[this.childOffsets[F]+at]*b;const ft=me(I,L,m,y);if(null!=ft){const ut=ft;M[at]=ut;let Ft=!1;for(let Rt=0;Rt<tt&&!Ft;Rt++)ut>=M[k[Rt]]&&(k.splice(Rt,0,at),Ft=!0);Ft||(k[tt]=at),tt++}}for(let at=0;at<tt;at++){const ft=k[at];B.push({idx:this.childOffsets[F]+ft,t:M[ft],nodex:($<<1)+this._siblingOffset[ft][0],nodey:(nt<<1)+this._siblingOffset[ft][1],depth:ht+1})}}return null}_addNode(t,n,a){return this.minimums.push(t),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(t,n,a,u,m){if(1===t[u].isLeaf(n,a))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const y=u-1,b=t[y];let S=0,M=0;for(let k=0;k<this._siblingOffset.length;k++){const I=2*n+this._siblingOffset[k][0],L=2*a+this._siblingOffset[k][1],B=b.getElevation(I,L),F=b.isLeaf(I,L),j=this._addNode(B.min,B.max,F);F&&(S|=1<<k),M||(M=j)}for(let k=0;k<this._siblingOffset.length;k++)S&1<<k||this._construct(t,2*n+this._siblingOffset[k][0],2*a+this._siblingOffset[k][1],y,M+k)}}function Pe(e,t,n,a,u,m){return ui(ui(e,n,m),ui(t,a,m),u)}function qe(e,t,n){const a=n.dim,u=Je(e*a-.5,0,a-1),m=Je(t*a-.5,0,a-1),y=Math.floor(u),b=Math.floor(m),S=Math.min(y+1,a-1),M=Math.min(b+1,a-1);return Pe(n.get(y,b),n.get(S,b),n.get(y,M),n.get(S,M),u-y,m-b)}const yi={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class li{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,n,a,u=!1,m=!1){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&"mapbox"!==a&&"terrarium"!==a)return on(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const y=this.dim=n.height-2,b=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=a||"mapbox",this.borderReady=u,!u){for(let S=0;S<y;S++)b[this._idx(-1,S)]=b[this._idx(0,S)],b[this._idx(y,S)]=b[this._idx(y-1,S)],b[this._idx(S,-1)]=b[this._idx(S,0)],b[this._idx(S,y)]=b[this._idx(S,y-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(y,-1)]=b[this._idx(y-1,0)],b[this._idx(-1,y)]=b[this._idx(0,y-1)],b[this._idx(y,y)]=b[this._idx(y-1,y-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Ve(this)}get(t,n,a=!1){a&&(t=Je(t,-1,this.dim),n=Je(n,-1,this.dim));const u=4*this._idx(t,n);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(t){return yi[t]}get unpackVector(){return yi[this.encoding]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}_unpackMapbox(t,n,a){return(256*t*256+256*n+a)/10-1e4}_unpackTerrarium(t,n,a){return 256*t+n+a/256-32768}static pack(t,n){const a=[0,0,0,0],u=li.getUnpackVector(n);let m=Math.floor((t+u[3])/u[2]);return a[2]=m%256,m=Math.floor(m/256),a[1]=m%256,m=Math.floor(m/256),a[0]=m,a}getPixels(){return new jn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,n,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,m=n*this.dim+this.dim,y=a*this.dim,b=a*this.dim+this.dim;switch(n){case-1:u=m-1;break;case 1:m=u+1}switch(a){case-1:y=b-1;break;case 1:b=y+1}const S=-n*this.dim,M=-a*this.dim;for(let k=y;k<b;k++)for(let I=u;I<m;I++){const L=4*this._idx(I,k),B=4*this._idx(I+S,k+M);this.pixels[L+0]=t.pixels[B+0],this.pixels[L+1]=t.pixels[B+1],this.pixels[L+2]=t.pixels[B+2],this.pixels[L+3]=t.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}De(li,"DEMData"),De(Ve,"DemMinMaxQuadTree",{omit:["dem"]});class Ai{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,a){const u=t.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const m={value:n,timeout:void 0};if(void 0!==a&&(m.timeout=setTimeout(()=>{this.remove(t,m)},a)),this.data[u].push(m),this.order.push(u),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const a=t.wrapped().key,u=void 0===n?0:this.data[a].indexOf(n),m=this.data[a][u];return this.data[a].splice(u,1),m.timeout&&clearTimeout(m.timeout),0===this.data[a].length&&delete this.data[a],this.onRemove(m.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const a in this.data)for(const u of this.data[a])t(u.value)||n.push(u);for(const a of n)this.remove(a.value.tileID,a)}}class Mn{constructor(t,n,a){this.func=t,this.mask=n,this.range=a}}Mn.ReadOnly=!1,Mn.ReadWrite=!0,Mn.disabled=new Mn(519,Mn.ReadOnly,[0,1]);class qi{constructor(t,n,a,u,m,y){this.test=t,this.ref=n,this.mask=a,this.fail=u,this.depthFail=m,this.pass=y}}qi.disabled=new qi({func:519,mask:0},0,0,7680,7680,7680);class Ri{constructor(t,n,a){this.blendFunction=t,this.blendColor=n,this.mask=a}}Ri.Replace=[1,0],Ri.disabled=new Ri(Ri.Replace,pn.transparent,[!1,!1,!1,!1]),Ri.unblended=new Ri(Ri.Replace,pn.transparent,[!0,!0,!0,!0]),Ri.alphaBlended=new Ri([1,771],pn.transparent,[!0,!0,!0,!0]);class dn{constructor(t,n,a){this.enable=t,this.mode=n,this.frontFace=a}}dn.disabled=new dn(!1,1029,2305),dn.backCCW=new dn(!0,1029,2305),dn.backCW=new dn(!0,1029,2304),dn.frontCW=new dn(!0,1028,2304),dn.frontCCW=new dn(!0,1028,2305);class xo extends Jo{constructor(t,n,a){super(),this.id=t,this._onlySymbols=a,n.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Ai(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Xt,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if("loaded"!==n.state&&"errored"!==n.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return _i(this._tiles).map(t=>t.tileID).sort(Wh).map(t=>t.key)}getRenderableIds(t){const n=[];for(const a in this._tiles)this._isIdRenderable(+a,t)&&n.push(this._tiles[a]);return t?n.sort((a,u)=>{const m=a.tileID,y=u.tileID,b=new Mt(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),S=new Mt(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-y.overscaledZ||S.y-b.y||S.x-b.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(Wh).map(a=>a.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const a=this._tiles[t];a&&("loading"!==a.state&&(a.state=n),this._loadTile(a,this._tileLoaded.bind(this,a,t,n)))}_tileLoaded(t,n,a,u){if(u)if(t.state="errored",404!==u.status)this._source.fire(new Yo(u,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=bi.now(),"expired"===a&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Ii("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let u=0;u<n.length;u++){const m=n[u];if(t.neighboringTiles&&t.neighboringTiles[m]){const y=this.getTileByID(m);a(t,y),a(y,t)}}function a(u,m){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let y=m.tileID.canonical.x-u.tileID.canonical.x;const b=m.tileID.canonical.y-u.tileID.canonical.y,S=Math.pow(2,u.tileID.canonical.z),M=m.tileID.key;0===y&&0===b||Math.abs(b)>1||(Math.abs(y)>1&&(1===Math.abs(y+S)?y+=S:1===Math.abs(y-S)&&(y-=S)),m.dem&&u.dem&&(u.dem.backfillBorder(m.dem,y,b),u.neighboringTiles&&u.neighboringTiles[M]&&(u.neighboringTiles[M].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,a,u){for(const m in this._tiles){let y=this._tiles[m];if(u[m]||!y.hasData()||y.tileID.overscaledZ<=n||y.tileID.overscaledZ>a)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>n+1;){const M=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[M.key],y&&y.hasData()&&(b=M)}let S=b;for(;S.overscaledZ>n;)if(S=S.scaledTo(S.overscaledZ-1),t[S.key]){u[b.key]=b;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=t.overscaledZ-1;a>=n;a--){const u=t.scaledTo(a),m=this._getLoadedTile(u);if(m)return m}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const a=Math.ceil(t.width/n)+1,u=Math.ceil(t.height/n)+1,m=Math.floor(a*u*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,m):m,b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(b)}handleWrapJump(t){const n=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,n){const a={};for(const u in this._tiles){const m=this._tiles[u];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+n),a[m.tileID.key]=m}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(t,n,a){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let u;this.updateCacheSize(t,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new _s(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(u=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(b=>this._source.hasTile(b)))):u=[];const m=this._updateRetainedTiles(u);if(xl(this._source.type)&&0!==u.length){const b={},S={},M=Object.keys(m);for(const I of M){const L=m[I],B=this._tiles[I];if(!B||B.fadeEndTime&&B.fadeEndTime<=bi.now())continue;const F=this.findLoadedParent(L,Math.max(L.overscaledZ-xo.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),b[F.tileID.key]=F.tileID),S[I]=L}const k=u[u.length-1].overscaledZ;for(const I in this._tiles){const L=this._tiles[I];if(m[I]||!L.hasData())continue;let B=L.tileID;for(;B.overscaledZ>k;){B=B.scaledTo(B.overscaledZ-1);const F=this._tiles[B.key];if(F&&F.hasData()&&S[B.key]){m[I]=L.tileID;break}}}for(const I in b)m[I]||(this._coveredTiles[I]=!0,m[I]=b[I])}for(const b in m)this._tiles[b].clearFadeHold();const y=function(b,S){const M=[];for(const k in b)k in S||M.push(k);return M}(this._tiles,m);for(const b of y){const S=this._tiles[b];S.hasSymbolBuckets&&!S.holdingForFade()?S.setHoldDuration(this.map._fadeDuration):S.hasSymbolBuckets&&!S.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(0===t.length)return n;const a={},u=t.reduce((M,k)=>Math.min(M,k.overscaledZ),1/0),m=t[0].overscaledZ,y=Math.max(m-xo.maxOverzooming,this._source.minzoom),b=Math.max(m+xo.maxUnderzooming,this._source.minzoom),S={};for(const M of t){const k=this._addTile(M);n[M.key]=M,k.hasData()||u<this._source.maxzoom&&(S[M.key]=M)}this._retainLoadedChildren(S,u,b,n);for(const M of t){let k=this._tiles[M.key];if(k.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const L=M.children(this._source.maxzoom)[0],B=this.getTile(L);if(B&&B.hasData()){n[L.key]=L;continue}}else{const L=M.children(this._source.maxzoom);if(n[L[0].key]&&n[L[1].key]&&n[L[2].key]&&n[L[3].key])continue}let I=k.wasRequested();for(let L=M.overscaledZ-1;L>=y;--L){const B=M.scaledTo(L);if(a[B.key]||(a[B.key]=!0,k=this.getTile(B),!k&&I&&(k=this._addTile(B)),k&&(n[B.key]=B,I=k.wasRequested(),k.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let a,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}n.push(u.key);const m=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(m),a)break;u=m}for(const m of n)this._loadedParentTiles[m]=a}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const a=Boolean(n);if(!a){const u=this.map?this.map.painter:null;n=new _t(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n?(n.uses++,this._tiles[t.key]=n,a||this._source.fire(new Ii("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=n.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,a){const u=[],m=this.transform;if(!m)return u;const y="globe"===m.projection.name,b=gs(m.center.lng);for(const S in this._tiles){const M=this._tiles[S];if(a&&M.clearQueryDebugViz(),M.holdingForFade())continue;let k;if(y){const I=M.tileID.canonical;if(0===I.z){const L=[Math.abs(Je(b,...Nr(I,-1))-b),Math.abs(Je(b,...Nr(I,1))-b)];k=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs(Je(b,...Nr(I,-1))-b),Math.abs(Je(b,...Nr(I,0))-b),Math.abs(Je(b,...Nr(I,1))-b)];k=[L.indexOf(Math.min(...L))-1]}}else k=[0];for(const I of k){const L=t.containsTile(M,m,n,I);L&&u.push(L)}}return u}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(const a of n)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(xl(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=bi.now())return!0}return!1}setFeatureState(t,n,a){this._state.updateState(t=t||"_geojsonTileLayer",n,a)}removeFeatureState(t,n,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,a)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,a){const u=this._tiles[t];u&&u.setDependencies(n,a)}reloadTilesForDependencies(t,n){for(const a in this._tiles)this._tiles[a].hasDependency(t,n)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(t,n))}_preloadTiles(t,n){const a=new Map,u=Array.isArray(t)?t:[t],m=this.map.painter.terrain,y=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const b of u){const S=b.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const M of S)a.set(M.key,M);this.usedForTerrain&&b.updateElevation(!1)}vn(Array.from(a.values()),(b,S)=>{const M=new _t(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(M,k=>{"raster-dem"===this._source.type&&M.dem&&this._backfillDEM(M),S(k,M)})},n)}}function Wh(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||a-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function xl(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Nr(e,t){const n=1<<e.z;return[e.x/n+t,(e.x+1)/n+t]}xo.maxOverzooming=10,xo.maxUnderzooming=3;class Aa{constructor(t,n,a){this._demTile=t,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(t,n,a){const u=a||t.findDEMTileFor(n);if(!u||!u.dem)return;const m=u.dem,y=u.tileID,b=1<<n.canonical.z-y.canonical.z;return new Aa(u,u.tileSize/Xe/b,[(n.canonical.x/b-y.canonical.x)*m.dim,(n.canonical.y/b-y.canonical.y)*m.dim])}tileCoordToPixel(t,n){const a=n*this._scale+this._offset[1],u=Math.floor(t*this._scale+this._offset[0]),m=Math.floor(a);return new Mt(u,m)}getElevationAt(t,n,a,u){const m=t*this._scale+this._offset[0],y=n*this._scale+this._offset[1],b=Math.floor(m),S=Math.floor(y),M=this._dem;return u=!!u,a?ui(ui(M.get(b,S,u),M.get(b,S+1,u),y-S),ui(M.get(b+1,S,u),M.get(b+1,S+1,u),y-S),m-b):M.get(b,S,u)}getElevationAtPixel(t,n,a){return this._dem.get(t,n,!!a)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Zo(1,t)*this._dem.stride}}class vc{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ga(Xe,16,0),this.featureIndexArray=new Dp,this.promoteId=n}insert(t,n,a,u,m,y=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,m,y);const S=this.grid;for(let M=0;M<n.length;M++){const k=n[M],I=[1/0,1/0,-1/0,-1/0];for(let L=0;L<k.length;L++){const B=k[L];I[0]=Math.min(I[0],B.x),I[1]=Math.min(I[1],B.y),I[2]=Math.max(I[2],B.x),I[3]=Math.max(I[3],B.y)}I[0]<Xe&&I[1]<Xe&&I[2]>=0&&I[3]>=0&&S.insert(b,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ep(new dc(this.rawTileData)).layers,this.sourceLayerCoder=new d(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,n,a,u){this.loadVTLayers();const m=t.params||{},y=Hl(m.filter),b=t.tileResult,S=t.transform,M=b.bufferedTilespaceBounds,k=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(F,j,$,nt)=>ff(b.bufferedTilespaceGeometry,F,j,$,nt));k.sort(i_);let I=null;S.elevation&&k.length>0&&(I=Aa.create(S.elevation,this.tileID));const L={};let B;for(let F=0;F<k.length;F++){const j=k[F];if(j===B)continue;B=j;const $=this.featureIndexArray.get(j);let nt=null;this.loadMatchingFeature(L,$,y,m.layers,m.availableImages,n,a,u,(ht,tt,at,ft=0)=>(nt||(nt=Rr(ht,this.tileID.canonical,t.tileTransform)),tt.queryIntersectsFeature(b,ht,at,nt,this.z,t.transform,t.pixelPosMatrix,I,ft)))}return L}loadMatchingFeature(t,n,a,u,m,y,b,S,M){const{featureIndex:k,bucketIndex:I,sourceLayerIndex:L,layoutVertexArrayOffset:B}=n,F=this.bucketLayerIDs[I];if(u&&!function(ht,tt){for(let at=0;at<ht.length;at++)if(tt.indexOf(ht[at])>=0)return!0;return!1}(u,F))return;const j=this.sourceLayerCoder.decode(L),$=this.vtLayers[j].feature(k);if(a.needGeometry){const ht=zr($,!0);if(!a.filter(new Et(this.tileID.overscaledZ),ht,this.tileID.canonical))return}else if(!a.filter(new Et(this.tileID.overscaledZ),$))return;const nt=this.getId($,j);for(let ht=0;ht<F.length;ht++){const tt=F[ht];if(u&&u.indexOf(tt)<0)continue;const at=y[tt];if(!at)continue;let ft={};void 0!==nt&&S&&(ft=S.getState(at.sourceLayer||"_geojsonTileLayer",nt));const ut=ni({},b[tt]);ut.paint=bc(ut.paint,at.paint,$,ft,m),ut.layout=bc(ut.layout,at.layout,$,ft,m);const Ft=!M||M($,at,ft,B);if(!Ft)continue;const Rt=new x($,this.z,this.x,this.y,nt);Rt.layer=ut;let Wt=t[tt];void 0===Wt&&(Wt=t[tt]=[]),Wt.push({featureIndex:k,feature:Rt,intersectionZ:Ft})}}lookupSymbolFeatures(t,n,a,u,m,y,b,S){const M={};this.loadVTLayers();const k=Hl(m);for(const I of t)this.loadMatchingFeature(M,{bucketIndex:a,sourceLayerIndex:u,featureIndex:I,layoutVertexArrayOffset:0},k,y,b,S,n);return M}loadFeature(t){const{featureIndex:n,sourceLayerIndex:a}=t;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),m=this.vtFeatures[u];if(m[n])return m[n];const y=this.vtLayers[u].feature(n);return m[n]=y,y}hasLayer(t){for(const n of this.bucketLayerIDs)for(const a of n)if(t===a)return!0;return!1}getId(t,n){let a=t.id;if(this.promoteId){const u="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=u&&(a=t.properties[u]),"boolean"==typeof a&&(a=Number(a))}return a}}function bc(e,t,n,a,u){return xs(e,(m,y)=>{const b=t instanceof Ot?t.get(y):null;return b&&b.evaluate?b.evaluate(n,a,u):b})}function i_(e,t){return t-e}De(vc,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Hg{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.image=new Or({width:t,height:n}),this.positions={},this.uploaded=!1}getDash(t,n){const a=this.getKey(t,n);return this.positions[a]}trim(){const t=this.width,n=this.height=Pn(this.nextRow);this.image.resize({width:t,height:n})}getKey(t,n){return t.join(",")+n}getDashRanges(t,n,a){const u=[];let m=t.length%2==1?-t[t.length-1]*a:0,y=t[0]*a,b=!0;u.push({left:m,right:y,isDash:b,zeroLength:0===t[0]});let S=t[0];for(let M=1;M<t.length;M++){b=!b;const k=t[M];m=S*a,S+=k,y=S*a,u.push({left:m,right:y,isDash:b,zeroLength:0===k})}return u}addRoundDash(t,n,a){const u=n/2;for(let m=-a;m<=a;m++){const y=this.width*(this.nextRow+a+m);let b=0,S=t[b];for(let M=0;M<this.width;M++){M/S.right>1&&(S=t[++b]);const k=Math.abs(M-S.left),I=Math.abs(M-S.right),L=Math.min(k,I);let B;const F=m/a*(u+1);if(S.isDash){const j=u-Math.abs(F);B=Math.sqrt(L*L+j*j)}else B=u-Math.sqrt(L*L+F*F);this.image.data[y+M]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(t,n){for(let S=t.length-1;S>=0;--S){const M=t[S],k=t[S+1];M.zeroLength?t.splice(S,1):k&&k.isDash===M.isDash&&(k.left=M.left,t.splice(S,1))}const a=t[0],u=t[t.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const m=this.width*this.nextRow;let y=0,b=t[y];for(let S=0;S<this.width;S++){S/b.right>1&&(b=t[++y]);const M=Math.abs(S-b.left),k=Math.abs(S-b.right),I=Math.min(M,k);this.image.data[m+S]=Math.max(0,Math.min(255,(b.isDash?I:-I)+n+128))}}addDash(t,n){const a=this.getKey(t,n);if(this.positions[a])return this.positions[a];const u="round"===n,m=u?7:0,y=2*m+1;if(this.nextRow+y>this.height)return on("LineAtlas out of space"),null;0===t.length&&t.push(1);let b=0;for(let k=0;k<t.length;k++)t[k]<0&&(on("Negative value is found in line dasharray, replacing values with 0"),t[k]=0),b+=t[k];if(0!==b){const k=this.width/b,I=this.getDashRanges(t,this.width,k);u?this.addRoundDash(I,k,m):this.addRegularDash(I,"square"===n?.5*k:0)}const S=this.nextRow+m;this.nextRow+=y;const M={tl:[S,m],br:[b,0]};return this.positions[a]=M,M}}De(Hg,"LineAtlas");class $g{constructor(t){const n={},a=[];for(const b in t){const S=t[b],M=n[b]={};for(const k in S.glyphs){const I=S.glyphs[+k];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const L=I.metrics.localGlyph?2:1,B={x:0,y:0,w:I.bitmap.width+2*L,h:I.bitmap.height+2*L};a.push(B),M[k]=B}}const{w:u,h:m}=cp(a),y=new Or({width:u||1,height:m||1});for(const b in t){const S=t[b];for(const M in S.glyphs){const k=S.glyphs[+M];if(!k||0===k.bitmap.width||0===k.bitmap.height)continue;const I=n[b][M],L=k.metrics.localGlyph?2:1;Or.copy(k.bitmap,y,{x:0,y:0},{x:I.x+L,y:I.y+L},k.bitmap)}}this.image=y,this.positions=n}}De($g,"GlyphAtlas");class n_{constructor(t){this.tileID=new _s(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=yl(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,n,a,u,m){this.status="parsing",this.data=t,this.collisionBoxArray=new xu;const y=new d(Object.keys(t.layers).sort()),b=new vc(this.tileID,this.promoteId);b.bucketLayerIDs=[];const S={},M=new Hg(256,256),k={featureIndex:b,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:M,availableImages:a},I=n.familiesBySource[this.source];for(const ft in I){const ut=t.layers[ft];if(!ut)continue;let Ft=!1,Rt=!1;for(const jt of I[ft])"symbol"===jt[0].type?Ft=!0:Rt=!0;if(!0===this.isSymbolTile&&!Ft||!1===this.isSymbolTile&&!Rt)continue;1===ut.version&&on(`Vector tile source "${this.source}" layer "${ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Wt=y.encode(ft),he=[];for(let jt=0;jt<ut.length;jt++){const Kt=ut.feature(jt),te=b.getId(Kt,ft);he.push({feature:Kt,id:te,index:jt,sourceLayerIndex:Wt})}for(const jt of I[ft]){const Kt=jt[0];void 0!==this.isSymbolTile&&"symbol"===Kt.type!==this.isSymbolTile||Kt.minzoom&&this.zoom<Math.floor(Kt.minzoom)||Kt.maxzoom&&this.zoom>=Kt.maxzoom||"none"!==Kt.visibility&&(Ug(jt,this.zoom,a),(S[Kt.id]=Kt.createBucket({index:b.bucketLayerIDs.length,layers:jt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:a})).populate(he,k,this.tileID.canonical,this.tileTransform),b.bucketLayerIDs.push(jt.map(te=>te.id)))}}let L,B,F,j;M.trim();const $={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},nt=xs(k.glyphDependencies,ft=>Object.keys(ft).map(Number));Object.keys(nt).length?u.send("getGlyphs",{uid:this.uid,stacks:nt},(ft,ut)=>{L||(L=ft,B=ut,at.call(this))},void 0,!1,$):B={};const ht=Object.keys(k.iconDependencies);ht.length?u.send("getImages",{icons:ht,source:this.source,tileID:this.tileID,type:"icons"},(ft,ut)=>{L||(L=ft,F=ut,at.call(this))},void 0,!1,$):F={};const tt=Object.keys(k.patternDependencies);function at(){if(L)return m(L);if(B&&F&&j){const ft=new $g(B),ut=new $f(F,j);for(const Ft in S){const Rt=S[Ft];Rt instanceof ns?(Ug(Rt.layers,this.zoom,a),Tg(Rt,B,ft.positions,F,ut.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):Rt.hasPattern&&(Rt instanceof yo||Rt instanceof Nu||Rt instanceof Rh)&&(Ug(Rt.layers,this.zoom,a),Rt.addFeatures(k,this.tileID.canonical,ut.patternPositions,a,this.tileTransform))}this.status="done",m(null,{buckets:_i(S).filter(Ft=>!Ft.isEmpty()),featureIndex:b,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ft.image,lineAtlas:M,imageAtlas:ut,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?F:null,glyphPositions:this.returnDependencies?ft.positions:null})}}tt.length?u.send("getImages",{icons:tt,source:this.source,tileID:this.tileID,type:"patterns"},(ft,ut)=>{L||(L=ft,j=ut,at.call(this))},void 0,!1,$):j={},at.call(this)}}function Ug(e,t,n){const a=new Et(t);for(const u of e)u.recalculate(a,n)}class Wg{constructor(t){this.entries={},this.scheduler=t}request(t,n,a,u){const m=this.entries[t]=this.entries[t]||{callbacks:[]};if(m.result){const[y,b]=m.result;return this.scheduler?this.scheduler.add(()=>{u(y,b)},n):u(y,b),()=>{}}return m.callbacks.push(u),m.cancel||(m.cancel=a((y,b)=>{m.result=[y,b];for(const S of m.callbacks)this.scheduler?this.scheduler.add(()=>{S(y,b)},n):S(y,b);setTimeout(()=>delete this.entries[t],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(y=>y!==u),m.callbacks.length||(m.cancel(),delete this.entries[t]))}}}function Xg(e,t,n){const a=JSON.stringify(e.request);return e.data&&(this.deduped.entries[a]={result:[null,e.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},u=>{const m=bs(e.request,(y,b,S,M)=>{y?u(y):b&&u(null,{vectorTile:n?void 0:new ep(new dc(b)),rawData:b,cacheControl:S,expires:M})});return()=>{m.cancel(),u()}},t)}c.ARRAY_TYPE=As,c.AUTH_ERR_MSG=To,c.Aabb=ms,c.Actor=class{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Me(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Gs()?e:p,this.scheduler=new o}send(e,t,n,a,u=!1,m){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=m,this.callbacks[y]=n);const b=Ho(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:e,hasCallback:!!n,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:lr(t,b)},b),{cancel:()=>{n&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const t=e.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const a=this.cancelCallbacks[n];delete this.cancelCallbacks[n],a&&a.cancel()}else if(t.mustQueue||Gs()){const a=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,t),a&&a.metadata||{type:"message"})}else this.processTask(n,t)}processTask(e,t){if("<response>"===t.type){const n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(tl(t.error)):n(null,tl(t.data)))}else{const n=Ho(this.globalScope)?void 0:[],a=t.hasCallback?(m,y)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?lr(m):null,data:lr(y,n)},n)}:m=>{},u=tl(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,u,a);else if(this.parent.getWorkerSource){const m=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,m[0],u.source)[m[1]](u,a)}else a(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.CanonicalTileID=zh,c.Color=pn,c.ColorMode=Ri,c.CullFaceMode=dn,c.DEMData=li,c.DataConstantProperty=wt,c.DedupedRequest=Wg,c.DepthMode=Mn,c.EXTENT=Xe,c.Elevation=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const n=t.getSource().maxzoom,a=1<<n,u=Math.floor(e.x),m=Math.floor((e.x-u)*a),y=Math.floor(e.y*a),b=this.findDEMTileFor(new _s(n,u,n,m,y));return!(!b||!b.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,n=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);const a=this._source();if(!a||e.y<0||e.y>1)return t;const u=a.getSource().maxzoom,m=1<<u,y=Math.floor(e.x),b=e.x-y,S=new _s(u,y,u,Math.floor(b*m),Math.floor(e.y*m)),M=this.findDEMTileFor(S);if(!M||!M.dem)return t;const k=M.dem,I=1<<M.tileID.canonical.z,L=(b*I-M.tileID.canonical.x)*k.dim,B=(e.y*I-M.tileID.canonical.y)*k.dim,F=Math.floor(L),j=Math.floor(B);return(n?this.exaggeration():1)*ui(ui(k.get(F,j),k.get(F,j+1),B-j),ui(k.get(F+1,j),k.get(F+1,j+1),B-j),L-F)}getAtTileOffset(e,t,n){const a=1<<e.canonical.z;return this.getAtPointOrZero(new ac(e.wrap+(e.canonical.x+t/Xe)/a,(e.canonical.y+n/Xe)/a))}getAtTileOffsetFunc(e,t,n,a){return u=>{const m=this.getAtTileOffset(e,u.x,u.y),y=a.upVector(e.canonical,u.x,u.y);return Us(y,y,m*a.upVectorScale(e.canonical,t,n).metersToTile),y}}getForTilePoints(e,t,n,a){if(this.isUsingMockSource())return!1;const u=Aa.create(this,e,a);return!!u&&(t.forEach(m=>{m[2]=this.exaggeration()*u.getElevationAt(m[0],m[1],n)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const n=t.dem.tree,a=t.tileID,u=1<<e.canonical.z-a.canonical.z;let m=e.canonical.x/u-a.canonical.x,y=e.canonical.y/u-a.canonical.y,b=0;for(let S=0;S<e.canonical.z-a.canonical.z&&!n.leaves[b];S++){m*=2,y*=2;const M=2*Math.floor(y)+Math.floor(m);b=n.childOffsets[b]+M,m%=1,y%=1}return{min:this.exaggeration()*n.minimums[b],max:this.exaggeration()*n.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,n){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},c.ErrorEvent=Yo,c.EvaluationParameters=Et,c.Event=Ii,c.Evented=Jo,c.FillExtrusionBucket=Rh,c.Frustum=Mu,c.FrustumCorners=Ad,c.GLOBE_RADIUS=ur,c.GLOBE_SCALE_MATCH_LATITUDE=45,c.GLOBE_ZOOM_THRESHOLD_MAX=6,c.GLOBE_ZOOM_THRESHOLD_MIN=5,c.GlobeSharedBuffers=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const e of this._wireframeSegments)e.destroy()}}_fillGridMeshWithLods(e,t){const n=new je,a=new Wn,u=[],m=e+1+2,y=t[0]+1,b=t[0]+1+(1+t.length),S=(M,k,I)=>{let L=M===m-1?M-2:0===M?M:M-1;return L+=I?24575:0,[L,k]};for(let M=0;M<m;++M)n.emplaceBack(...S(M,0,!0));for(let M=0;M<y;++M)for(let k=0;k<m;++k)n.emplaceBack(...S(k,M,(0===k||k===m-1)&&!0));for(let M=0;M<t.length;++M){const k=t[M];for(let I=0;I<m;++I)n.emplaceBack(...S(I,k,!0))}for(let M=0;M<t.length;++M){const k=a.length,I=t[M]+1+2,L=new Wn;for(let j=0;j<I-1;j++){const $=j===I-2,nt=$?m*(b-t.length+M-j):m;for(let ht=0;ht<m-1;ht++){const tt=j*m+ht;0===j||$||0===ht||ht===m-2?(L.emplaceBack(tt+1,tt,tt+nt),L.emplaceBack(tt+nt,tt+nt+1,tt+1)):(a.emplaceBack(tt+1,tt,tt+nt),a.emplaceBack(tt+nt,tt+nt+1,tt+1))}}const B=bn.simpleSegment(0,k,n.length,a.length-k);for(let j=0;j<L.uint16.length;j+=3)a.emplaceBack(L.uint16[j],L.uint16[j+1],L.uint16[j+2]);const F=bn.simpleSegment(0,k,n.length,a.length-k);u.push({withoutSkirts:B,withSkirts:F})}return{vertices:n,indices:a,segments:u}}_createGrid(e){const t=this._fillGridMeshWithLods(64,ba);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,mh.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new Wn;for(let u=0;u<=64;u++)t.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const n=new Vn,a=new Vn;this._poleSegments=[];for(let u=0,m=0;u<5;u++){const y=360/(1<<u);n.emplaceBack(0,-ur,0,.5,0),a.emplaceBack(0,-ur,0,.5,1);for(let b=0;b<=64;b++){const S=b/64,M=ui(0,y,S),[k,I,L]=oc(bh,nf,M,ur);n.emplaceBack(k,I,L,S,0),a.emplaceBack(k,I,L,S,1)}this._poleSegments.push(bn.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(n,Kp,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(a,Kp,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}getWirefameBuffers(e,t){if(!this._wireframeSegments){const n=new Uo,a=64,u=a+1+2,m=1;this._wireframeSegments=[];for(let y=0,b=0;y<ba.length;y++){const S=ba[y];for(let k=m;k<S+m;k++)for(let I=m;I<a+m;I++){const L=k*u+I;n.emplaceBack(L,L+1),n.emplaceBack(L,L+u),n.emplaceBack(L,L+u+1)}const M=S*a*3;this._wireframeSegments.push(bn.simpleSegment(0,b,(S+1)*u,M)),b+=M}this._wireframeIndexBuffer=e.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},c.GlyphManager=_c,c.ImagePosition=Yu,c.LivePerformanceUtils=ie,c.LngLat=vi,c.LngLatBounds=Dr,c.LocalGlyphMode=pp,c.MAX_MERCATOR_LATITUDE=rn,c.MercatorCoordinate=ac,c.ONE_EM=Yn,c.OverscaledTileID=_s,c.PerformanceMarkers=It,c.Properties=se,c.RGBAImage=jn,c.Ray=Cu,c.RequestManager=class{constructor(e,t,n){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const e=function(){let t="";for(let n=0;n<10;n++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",pe,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!qs(e))return e;const n=Ln(e);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!qs(e))return e;const n=Ln(e);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeSourceURL(e,t,n,a){if(!qs(e))return e;const u=Ln(e);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),n&&u.params.push(`language=${n}`),a&&u.params.push(`worldview=${a}`),this._makeAPIURL(u,this._customAccessToken||t)}normalizeSpriteURL(e,t,n,a){const u=Ln(e);return qs(e)?(u.path=`/styles/v1${u.path}/sprite${t}${n}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${t}${n}`,Mo(u))}normalizeTileURL(e,t,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!qs(e))return e;const a=Ln(e);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||n&&"raster"!==a.authority&&512===n?"@2x":""}${zt.supported?".webp":"$1"}`),"raster"===a.authority?a.path=`/${St.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${St.TILE_URL_VERSION}${a.path}`);const u=this._customAccessToken||function(m){for(const y of m){const b=y.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(a.params)||St.ACCESS_TOKEN;return St.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(e,t){const n=Ln(e);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return e;let a="mapbox://";n.path.match(/^\/raster\/v1\//)?a+=`raster/${n.path.replace(`/${St.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${n.path.replace(`/${St.TILE_URL_VERSION}/`,"")}`;let u=n.params;return t&&(u=u.filter(m=>!m.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(e,t){const n=!!t&&qs(t),a=[];for(const u of e.tiles||[])So(u)?a.push(this.canonicalizeTileURL(u,n)):a.push(u);return a}_makeAPIURL(e,t){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=Ln(St.API_URL);if(e.protocol=a.protocol,e.authority=a.authority,"http"===e.protocol){const u=e.params.indexOf("secure");u>=0&&e.params.splice(u,1)}if("/"!==a.path&&(e.path=`${a.path}${e.path}`),!St.REQUIRE_ACCESS_TOKEN)return Mo(e);if(t=t||St.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return e.params=e.params.filter(u=>-1===u.indexOf("access_token")),e.params.push(`access_token=${t||""}`),Mo(e)}},c.ResourceType=qr,c.SegmentVector=bn,c.SourceCache=xo,c.StencilMode=qi,c.StructArrayLayout1ui2=No,c.StructArrayLayout2f1f2i16=$n,c.StructArrayLayout2i4=je,c.StructArrayLayout2ui4=Uo,c.StructArrayLayout3f12=xn,c.StructArrayLayout3ui6=Wn,c.StructArrayLayout4i8=Ei,c.StructArrayLayout5f20=Vn,c.Texture=r,c.Tile=_t,c.Transitionable=fe,c.Uniform1f=ih,c.Uniform1i=class extends Ar{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},c.Uniform2f=class extends Ar{constructor(e){super(e),this.current=[0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},c.Uniform3f=class extends Ar{constructor(e){super(e),this.current=[0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},c.Uniform4f=Op,c.UniformColor=Bp,c.UniformMatrix2f=class extends Ar{constructor(e){super(e),this.current=Up}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let a=0;a<4;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},c.UniformMatrix3f=class extends Ar{constructor(e){super(e),this.current=Fp}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},c.UniformMatrix4f=class extends Ar{constructor(e){super(e),this.current=mm}set(e,t,n){if(this.fetchUniformLocation(e,t)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let a=1;a<16;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},c.UnwrappedTileID=Of,c.ValidationError=Te,c.VectorTileFeature=ju,c.VectorTileWorkerSource=class extends Jo{constructor(e,t,n,a,u){super(),this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=u||Xg,this.loading={},this.loaded={},this.deduped=new Wg(e.scheduler),this.isSpriteLoaded=a,this.scheduler=e.scheduler}loadTile(e,t){const n=e.uid,a=e&&e.request,u=a&&a.collectResourceTiming,m=this.loading[n]=new n_(e);m.abort=this.loadVectorData(e,(y,b)=>{const S=!this.loading[n];if(delete this.loading[n],S||y||!b)return m.status="done",S||(this.loaded[n]=m),t(y);const M=b.rawData,k={};b.expires&&(k.expires=b.expires),b.cacheControl&&(k.cacheControl=b.cacheControl),m.vectorTile=b.vectorTile||new ep(new dc(M));const I=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(L,B)=>{if(L||!B)return t(L);const F={};if(u){const j=Ze(a);j.length>0&&(F.resourceTiming=JSON.parse(JSON.stringify(j)))}t(null,ni({rawTileData:M.slice(0)},B,k,F))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[n]=m})}reloadTile(e,t){const n=this.loaded,a=e.uid,u=this;if(n&&n[a]){const m=n[a];m.showCollisionBoxes=e.showCollisionBoxes,m.enableTerrain=!!e.enableTerrain,m.projection=e.projection,m.tileTransform=yl(e.tileID.canonical,e.projection);const y=(b,S)=>{const M=m.reloadCallback;M&&(delete m.reloadCallback,m.parse(m.vectorTile,u.layerIndex,this.availableImages,u.actor,M)),t(b,S)};"parsing"===m.status?m.reloadCallback=y:"done"===m.status&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(e,t){const n=e.uid,a=this.loading[n];a&&(a.abort&&a.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,a=e.uid;n&&n[a]&&delete n[a],t()}},c.WritingMode=io,c.ZoomDependentExpression=us,c.add=Ir,c.addDynamicAttributes=hd,c.adjoint=function(e,t){var n=t[0],a=t[1],u=t[2],m=t[3],y=t[4],b=t[5],S=t[6],M=t[7],k=t[8];return e[0]=y*k-b*M,e[1]=u*M-a*k,e[2]=a*b-u*y,e[3]=b*S-m*k,e[4]=n*k-u*S,e[5]=u*m-n*b,e[6]=m*M-y*S,e[7]=a*S-n*M,e[8]=n*y-a*m,e},c.asyncAll=vn,c.bezier=Gi,c.bindAll=Me,c.boundsAttributes=ct,c.bufferConvexPolygon=function(e,t){const n=[];for(let a=0;a<e.length;a++){const u=cn(a-1,-1,e.length-1),m=cn(a+1,-1,e.length-1),y=e[a],b=e[m],S=e[u].sub(y).unit(),M=b.sub(y).unit(),k=M.angleWithSep(S.x,S.y),I=S.add(M).unit().mult(-1*t/Math.sin(k/2));n.push(y.add(I))}return n},c.cacheEntryPossiblyAdded=function(e){Gr++,Gr>Pa&&(e.getActor().send("enforceCacheSizeLimit",jr),Gr=0)},c.calculateGlobeLabelMatrix=function(e,t){const{x:n,y:a}=e.point,u=Ld(n,a,e.worldSize/e._pixelsPerMercatorPixel,0,0);return Pr(u,u,Id(dr(t)))},c.calculateGlobeMatrix=function(e){const{x:t,y:n}=e.point,{lng:a,lat:u}=e._center;return Ld(t,n,e.worldSize,a,u)},c.calculateGlobeMercatorMatrix=function(e){const t=e.pixelsPerMeter,n=t/Zo(1,e.center.lat),a=Vo(new Float64Array(16));return rh(a,a,[e.point.x,e.point.y,0]),va(a,a,[n,n,t]),Float32Array.from(a)},c.circumferenceAtLatitude=Od,c.clamp=Je,c.clearTileCache=function(e){if(!Tl())return;const t=p.caches.delete(Da);e&&t.catch(e).then(()=>e())},c.clipLine=Kf,c.clone=function(e){var t=new As(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},c.clone$1=mn,c.collisionCircleLayout=jf,c.config=St,c.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},c.create=function(){var e=new As(16);return As!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},c.create$1=Vp,c.createExpression=Os,c.createLayout=Ue,c.createStyleLayer=function(e){return"custom"===e.type?new Fg(e):new l[e.type](e)},c.cross=Su,c.degToRad=Jt,c.distance=function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},c.div=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},c.dot=ps,c.earthRadius=wh,c.ease=ln,c.easeCubicInOut=Qe,c.ecefToLatLng=function([e,t,n]){const a=Math.hypot(e,t,n),u=Math.atan2(e,n),m=.5*Math.PI-Math.acos(-t/a);return new vi(le(u),le(m))},c.emitValidationErrors=fu,c.endsWith=js,c.enforceCacheSizeLimit=function(e){$o(),so&&so.then(t=>{t.keys().then(n=>{for(let a=0;a<n.length-e;a++)t.delete(n[a])})})},c.evaluateSizeForFeature=is,c.evaluateSizeForZoom=ml,c.evaluateVariableOffset=nm,c.evented=rt,c.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},c.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},c.exported=bi,c.exported$1=zt,c.extend=ni,c.extend$1=ws,c.fillExtrusionHeightLift=Lf,c.filterObject=Hi,c.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},c.fromQuat=function(e,t){var n=t[0],a=t[1],u=t[2],m=t[3],y=n+n,b=a+a,S=u+u,M=n*y,k=a*y,I=a*b,L=u*y,B=u*b,F=u*S,j=m*y,$=m*b,nt=m*S;return e[0]=1-I-F,e[1]=k+nt,e[2]=L-$,e[3]=0,e[4]=k-nt,e[5]=1-M-F,e[6]=B+j,e[7]=0,e[8]=L+$,e[9]=B-j,e[10]=1-M-I,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.fromRotation=function(e,t){var n=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=n,e[2]=0,e[3]=-n,e[4]=a,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},c.fromScaling=bm,c.furthestTileCorner=function(e){const t=Math.round((e+45+360)%360/90)%4;return ze[t]},c.getAABBPointSquareDist=function(e,t,n){let a=0;for(let u=0;u<2;++u){const m=n?n[u]:0;e[u]>m&&(a+=(e[u]-m)*(e[u]-m)),t[u]<m&&(a+=(m-t[u])*(m-t[u]))}return a},c.getAnchorAlignment=Ku,c.getAnchorJustification=mp,c.getBounds=function(e){let t=1/0,n=1/0,a=-1/0,u=-1/0;for(const m of e)t=Math.min(t,m.x),n=Math.min(n,m.y),a=Math.max(a,m.x),u=Math.max(u,m.y);return{min:new Mt(t,n),max:new Mt(a,u)}},c.getColumn=Vr,c.getGridMatrix=function(e,t,n,a){const u=t.getNorth(),m=t.getSouth(),y=t.getWest(),b=t.getEast(),S=1<<e.z,M=b-y,k=u-m,I=M/64,L=-k/ba[n],B=[0,I,0,L,0,0,u,y,0];if(e.z>0){const F=180/a;jp(B,B,[F/M+1,0,0,0,F/k+1,0,-.5*F/I,.5*F/L,1])}return B[2]=S,B[5]=e.x,B[8]=e.y,B},c.getImage=Xr,c.getJSON=function(e,t){return Wo(ni(e,{type:"json"}),t)},c.getLatitudinalLod=function(e){const t=rn-5;e=Je(e,-t,t)/t*90;const n=Math.pow(Math.abs(Math.sin(Jt(e))),3);return Math.round(n*(ba.length-1))},c.getMapSessionAPI=At,c.getPerformanceMeasurement=Ze,c.getProjection=hm,c.getRTLTextPluginStatus=pt,c.getReferrer=Hr,c.getTilePoint=function(e,{x:t,y:n},a=0){return new Mt(((t-a)*e.scale-e.x)*Xe,(n*e.scale-e.y)*Xe)},c.getTileVec3=function(e,t,n=0){return hr(((t.x-n)*e.scale-e.x)*Xe,(t.y*e.scale-e.y)*Xe,of(t.z,t.y))},c.getVideo=function(e,t){const n=p.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let a=0;a<e.length;a++){const u=p.document.createElement("source");Ia(e[a])||(n.crossOrigin="Anonymous"),u.src=e[a],n.appendChild(u)}return{cancel:()=>{}}},c.globeCenterToScreenPoint=function(e){const t=[0,0,0],n=Vo(new Float64Array(16));return Pr(n,e.pixelMatrix,e.globeMatrix),en(t,t,n),new Mt(t[0],t[1])},c.globeDenormalizeECEF=Id,c.globeECEFOrigin=function(e,t){const n=[0,0,0];return en(n,n,vh(dr(t.canonical))),en(n,n,e),n},c.globeMetersToEcef=_h,c.globeNormalizeECEF=vh,c.globePixelsToTileUnits=function(e,t){return Xe/(512*Math.pow(2,e))*Eu(dr(t))},c.globePoleMatrixForTile=function(e,t,n){const a=Vo(new Float64Array(16)),u=(t/(1<<e)-.5)*Math.PI*2;return Cd(a,n.globeMatrix,u),Float32Array.from(a)},c.globeTileBounds=dr,c.globeTiltAtLngLat=Rd,c.globeToMercatorTransition=cl,c.globeUseCustomAntiAliasing=function(e,t,n){const a=cl(n.zoom),u=e.style.map._antialias,m=!!t.extStandardDerivatives,y=t.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===a&&!u&&!y&&m},c.identity=Vo,c.identity$1=sc,c.invert=Sd,c.isFullscreen=function(){return!!p.document.fullscreenElement||!!p.document.webkitFullscreenElement},c.isLngLatBehindGlobe=zd,c.isMapAuthenticated=function(e){return vt.has(e)},c.isMapboxURL=qs,c.isSafariWithAntialiasingBug=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!Ho(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},c.latFromMercatorY=Xn,c.latLngToECEF=rc,c.len=Wp,c.length=lh,c.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},c.lngFromMercatorX=eo,c.loadVectorTile=Xg,c.makeRequest=Wo,c.mapValue=function(e,t,n,a,u){return Je((e-t)/(n-t)*(u-a)+a,a,u)},c.mercatorScale=rf,c.mercatorXfromLng=gs,c.mercatorYfromLat=to,c.mercatorZfromAltitude=Zo,c.mul=ol,c.mul$1=wm,c.multiply=Pr,c.multiply$1=jp,c.multiply$2=Hp,c.nextPowerOfTwo=Pn,c.normalize=es,c.normalize$1=fs,c.normalize$2=Xp,c.number=ui,c.ortho=function(e,t,n,a,u,m,y){var b=1/(t-n),S=1/(a-u),M=1/(m-y);return e[0]=-2*b,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*S,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*M,e[11]=0,e[12]=(t+n)*b,e[13]=(u+a)*S,e[14]=(y+m)*M,e[15]=1,e},c.pbf=dc,c.perspective=function(e,t,n,a,u){var m,y=1/Math.tan(t/2);return e[0]=y/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=u&&u!==1/0?(e[10]=(u+a)*(m=1/(a-u)),e[14]=2*u*a*m):(e[10]=-1,e[14]=-2*a),e},c.pick=function(e,t){const n={};for(let a=0;a<t.length;a++){const u=t[a];u in e&&(n[u]=e[u])}return n},c.plugin=xt,c.pointGeometry=Mt,c.polesInViewport=function(e){const t=Vo(new Float64Array(16));Pr(t,e.pixelMatrix,e.globeMatrix);const n=[0,go,0],a=[0,_o,0];return en(n,n,t),en(a,a,t),[n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!zd(e,new vi(e.center.lat,90)),a[0]>0&&a[0]<=e.width&&a[1]>0&&a[1]<=e.height&&!zd(e,new vi(e.center.lat,-90))]},c.polygonContainsPoint=ul,c.polygonIntersectsBox=ff,c.polygonIntersectsPolygon=jd,c.polygonizeBounds=function(e,t,n=0,a=!0){const u=new Mt(n,n),m=e.sub(u),y=t.add(u),b=[m,new Mt(y.x,m.y),y,new Mt(m.x,y.y)];return a&&b.push(m.clone()),b},c.posAttributes=mh,c.postMapLoadEvent=Q,c.postPerformanceEvent=yt,c.postTurnstileEvent=N,c.potpack=cp,c.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},c.radToDeg=le,c.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.registerForPluginStateChange=function(e){return e({pluginStatus:J,pluginURL:G}),rt.on("pluginStateChange",e),e},c.removeAuthState=function(e){vt.delete(e)},c.renderColorRamp=Wd,c.resample=af,c.rotateX=Zp,c.rotateX$1=ph,c.rotateY=Cd,c.rotateY$1=Ed,c.rotateZ=function(e,t,n){var a=Math.sin(n),u=Math.cos(n),m=t[0],y=t[1],b=t[2],S=t[3],M=t[4],k=t[5],I=t[6],L=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=m*u+M*a,e[1]=y*u+k*a,e[2]=b*u+I*a,e[3]=S*u+L*a,e[4]=M*u-m*a,e[5]=k*u-y*a,e[6]=I*u-b*a,e[7]=L*u-S*a,e},c.rotateZ$1=function(e,t,n){n*=.5;var a=t[0],u=t[1],m=t[2],y=t[3],b=Math.sin(n),S=Math.cos(n);return e[0]=a*S+u*b,e[1]=u*S-a*b,e[2]=m*S+y*b,e[3]=y*S-m*b,e},c.scale=va,c.scale$1=Md,c.scale$2=Us,c.scaleAndAdd=uh,c.set=function(e,t,n,a){return e[0]=t,e[1]=n,e[2]=a,e},c.setCacheLimits=function(e,t){jr=e,Pa=t},c.setColumn=function(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},c.setRTLTextPlugin=function(e,t,n=!1){if(J===q||J===W||J===X)throw new Error("setRTLTextPlugin cannot be called multiple times.");G=bi.resolveURL(e),J=q,Y=t,it(),n||dt()},c.smoothstep=Gn,c.spec=Ht,c.squaredLength=function(e){var t=e[0],n=e[1],a=e[2];return t*t+n*n+a*a},c.storeAuthState=function(e,t){t?vt.add(e):vt.delete(e)},c.sub=jo,c.subtract=ch,c.symbolSize=ig,c.tileAABB=function(e,t,n,a,u,m,y,b,S){if("globe"===S.name)return function Sm(e,t,n){const a=t/e.worldSize,u=e.globeMatrix;if(n.z<=1){const Rt=dr(n).getCorners();return tf(Rt,u,a),ms.fromPoints(Rt)}const m=Ns(n),y=Pd(m);tf(y,u,a);const b=Number.MAX_VALUE,S=[-b,-b,-b],M=[b,b,b];if(m.contains(e.center)){for(const he of y)hh(M,M,he),rl(S,S,he);S[2]=0;const Rt=e.point,Wt=[Rt.x*a,Rt.y*a,0];return hh(M,M,Wt),rl(S,S,Wt),new ms(M,S)}const k=[u[12]*a,u[13]*a,u[14]*a],I=m.getCenter(),L=Je(e.center.lat,-rn,rn),B=Je(I.lat,-rn,rn),F=gs(e.center.lng),j=to(L);let $=F-gs(I.lng);const nt=j-to(B);$>.5?$-=1:$<-.5&&($+=1);let ht=0;Math.abs($)>Math.abs(nt)?ht=$>=0?1:3:(ht=nt>=0?0:2,uh(k,k,[u[4]*a,u[5]*a,u[6]*a],-Math.sin(Jt(nt>=0?m.getSouth():m.getNorth()))*ur));const tt=y[ht],at=y[(ht+1)%4],ft=new Tm(tt,at,k),ut=[Dd(ft,0)||tt[0],Dd(ft,1)||tt[1],Dd(ft,2)||tt[2]],Ft=cl(e.zoom);if(Ft>0){const Rt=function({x:he,y:jt,z:Kt},te,oe,ue,Gt){const ve=1/(1<<Kt);let $e=he*ve,Se=$e+ve,Oe=jt*ve,be=Oe+ve,Ye=0;const mi=($e+Se)/2-ue;return mi>.5?Ye=-1:mi<-.5&&(Ye=1),$e=(($e+Ye)*te-(ue*=te))*oe+ue,Se=((Se+Ye)*te-ue)*oe+ue,Oe=(Oe*te-(Gt*=te))*oe+Gt,be=(be*te-Gt)*oe+Gt,[[$e,be,0],[Se,be,0],[Se,Oe,0],[$e,Oe,0]]}(n,t,e._pixelsPerMercatorPixel,F,j);for(let he=0;he<y.length;he++)Lr(y[he],Rt[he],Ft);const Wt=Ir([],Rt[ht],Rt[(ht+1)%4]);Us(Wt,Wt,.5),Lr(ut,Wt,Ft)}for(const Rt of y)hh(M,M,Rt),rl(S,S,Rt);return M[2]=Math.min(tt[2],at[2]),hh(M,M,ut),rl(S,S,ut),new ms(M,S)}(e,t,new zh(n,a,u));const M=yl({z:n,x:a,y:u},S);return new ms([(m+M.x/M.scale)*t,t*(M.y/M.scale),y],[(m+M.x2/M.scale)*t,t*(M.y2/M.scale),b])},c.tileCornersToBounds=Ns,c.tileTransform=yl,c.transformMat3=function(e,t,n){var a=t[0],u=t[1],m=t[2];return e[0]=a*n[0]+u*n[3]+m*n[6],e[1]=a*n[1]+u*n[4]+m*n[7],e[2]=a*n[2]+u*n[5]+m*n[8],e},c.transformMat4=en,c.transformMat4$1=al,c.transformQuat=$p,c.transitionTileAABBinECEF=Qp,c.translate=rh,c.transpose=function(e,t){if(e===t){var n=t[1],a=t[2],u=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=a,e[7]=u}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},c.triggerPluginCompletionEvent=st,c.uniqueId=Is,c.updateGlobeVertexNormal=function(e,t,n,a,u){const m=5*t+2;e.float32[m+0]=n,e.float32[m+1]=a,e.float32[m+2]=u},c.validateCustomStyleLayer=function(e){const t=[],n=e.id;return void 0===n&&t.push({message:`layers.${n}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${n}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},c.validateFilter=e=>Bo(Yl(e)),c.validateFog=e=>Bo($c(e)),c.validateLayer=e=>Bo(Gc(e)),c.validateLight=e=>Bo(Hc(e)),c.validateSource=e=>Bo(Ja(e)),c.validateStyle=Xc,c.validateTerrain=e=>Bo(ma(e)),c.values=_i,c.vectorTile=Vu,c.version=Tt,c.warnOnce=on,c.window=p,c.wrap=cn}),Zt(0,function(c){function p(et){if("number"==typeof et||"boolean"==typeof et||"string"==typeof et||null==et)return JSON.stringify(et);if(Array.isArray(et)){let Z="[";for(const Q of et)Z+=`${p(Q)},`;return`${Z}]`}let N="{";for(const Z of Object.keys(et).sort())N+=`${Z}:${p(et[Z])},`;return`${N}}`}function Tt(et){let N="";for(const Z of c.refProperties)N+=`/${p(et[Z])}`;return N}class mt{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,Z){for(const ot of N)this._layerConfigs[ot.id]=ot,(this._layers[ot.id]=c.createStyleLayer(ot)).compileFilter(),this.keyCache[ot.id]&&delete this.keyCache[ot.id];for(const ot of Z)delete this.keyCache[ot],delete this._layerConfigs[ot],delete this._layers[ot];this.familiesBySource={};const Q=function(ot,yt){const kt={};for(let vt=0;vt<ot.length;vt++){const It=yt&&yt[ot[vt].id]||Tt(ot[vt]);yt&&(yt[ot[vt].id]=It);let ie=kt[It];ie||(ie=kt[It]=[]),ie.push(ot[vt])}const At=[];for(const vt in kt)At.push(kt[vt]);return At}(c.values(this._layerConfigs),this.keyCache);for(const ot of Q){const yt=ot.map(we=>this._layers[we.id]),kt=yt[0];if("none"===kt.visibility)continue;const At=kt.source||"";let vt=this.familiesBySource[At];vt||(vt=this.familiesBySource[At]={});const It=kt.sourceLayer||"_geojsonTileLayer";let ie=vt[It];ie||(ie=vt[It]=[]),ie.push(yt)}}}class St{loadTile(N,Z){const{uid:Q,encoding:ot,rawImageData:yt,padding:kt,buildQuadTree:At}=N,vt=c.window.ImageBitmap&&yt instanceof c.window.ImageBitmap?this.getImageData(yt,kt):yt;Z(null,new c.DEMData(Q,vt,ot,kt<1,At))}getImageData(N,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(N.width,N.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=N.width,this.offscreenCanvas.height=N.height,this.offscreenCanvasContext.drawImage(N,0,0,N.width,N.height);const Q=this.offscreenCanvasContext.getImageData(-Z,-Z,N.width+2*Z,N.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Q}}var zt=function et(N,Z){var Q,ot=N&&N.type;if("FeatureCollection"===ot)for(Q=0;Q<N.features.length;Q++)et(N.features[Q],Z);else if("GeometryCollection"===ot)for(Q=0;Q<N.geometries.length;Q++)et(N.geometries[Q],Z);else if("Feature"===ot)et(N.geometry,Z);else if("Polygon"===ot)de(N.coordinates,Z);else if("MultiPolygon"===ot)for(Q=0;Q<N.coordinates.length;Q++)de(N.coordinates[Q],Z);return N};function de(et,N){if(0!==et.length){Fe(et[0],N);for(var Z=1;Z<et.length;Z++)Fe(et[Z],!N)}}function Fe(et,N){for(var Z=0,Q=0,ot=0,yt=et.length,kt=yt-1;ot<yt;kt=ot++){var At=(et[ot][0]-et[kt][0])*(et[kt][1]+et[ot][1]),vt=Z+At;Q+=Math.abs(Z)>=Math.abs(At)?Z-vt+At:At-vt+Z,Z=vt}Z+Q>=0!=!!N&&et.reverse()}const Ce=c.VectorTileFeature.prototype.toGeoJSON;class Re{constructor(N){this._feature=N,this.extent=c.EXTENT,this.type=N.type,this.properties=N.tags,"id"in N&&!isNaN(N.id)&&(this.id=parseInt(N.id,10))}loadGeometry(){if(1===this._feature.type){const N=[];for(const Z of this._feature.geometry)N.push([new c.pointGeometry(Z[0],Z[1])]);return N}{const N=[];for(const Z of this._feature.geometry){const Q=[];for(const ot of Z)Q.push(new c.pointGeometry(ot[0],ot[1]));N.push(Q)}return N}}toGeoJSON(N,Z,Q){return Ce.call(this,N,Z,Q)}}class ye{constructor(N){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.EXTENT,this.length=N.length,this._features=N}feature(N){return new Re(this._features[N])}}var pe={},lt={get exports(){return pe},set exports(et){pe=et}},qt=c.pointGeometry,Mt=c.vectorTile.VectorTileFeature,Ut=Dt;function Dt(et,N){this.options=N||{},this.features=et,this.length=et.length}function Qt(et,N){this.id="number"==typeof et.id?et.id:void 0,this.type=et.type,this.rawGeometry=1===et.type?[et.geometry]:et.geometry,this.properties=et.tags,this.extent=N||4096}Dt.prototype.feature=function(et){return new Qt(this.features[et],this.options.extent)},Qt.prototype.loadGeometry=function(){var et=this.rawGeometry;this.geometry=[];for(var N=0;N<et.length;N++){for(var Z=et[N],Q=[],ot=0;ot<Z.length;ot++)Q.push(new qt(Z[ot][0],Z[ot][1]));this.geometry.push(Q)}return this.geometry},Qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var et=this.geometry,N=1/0,Z=-1/0,Q=1/0,ot=-1/0,yt=0;yt<et.length;yt++)for(var kt=et[yt],At=0;At<kt.length;At++){var vt=kt[At];N=Math.min(N,vt.x),Z=Math.max(Z,vt.x),Q=Math.min(Q,vt.y),ot=Math.max(ot,vt.y)}return[N,Q,Z,ot]},Qt.prototype.toGeoJSON=Mt.prototype.toGeoJSON;var Jt=c.pbf,le=Ut;function ze(et){var N=new Jt;return function(Z,Q){for(var ot in Z.layers)Q.writeMessage(3,Qe,Z.layers[ot])}(et,N),N.finish()}function Qe(et,N){var Z;N.writeVarintField(15,et.version||1),N.writeStringField(1,et.name||""),N.writeVarintField(5,et.extent||4096);var Q={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<et.length;Z++)Q.feature=et.feature(Z),N.writeMessage(2,Gi,Q);var ot=Q.keys;for(Z=0;Z<ot.length;Z++)N.writeStringField(3,ot[Z]);var yt=Q.values;for(Z=0;Z<yt.length;Z++)N.writeMessage(4,vn,yt[Z])}function Gi(et,N){var Z=et.feature;void 0!==Z.id&&N.writeVarintField(1,Z.id),N.writeMessage(2,ln,et),N.writeVarintField(3,Z.type),N.writeMessage(4,cn,Z)}function ln(et,N){var Z=et.feature,Q=et.keys,ot=et.values,yt=et.keycache,kt=et.valuecache;for(var At in Z.properties){var vt=Z.properties[At],It=yt[At];if(null!==vt){void 0===It&&(Q.push(At),yt[At]=It=Q.length-1),N.writeVarint(It);var ie=typeof vt;"string"!==ie&&"boolean"!==ie&&"number"!==ie&&(vt=JSON.stringify(vt));var we=ie+":"+vt,re=kt[we];void 0===re&&(ot.push(vt),kt[we]=re=ot.length-1),N.writeVarint(re)}}}function Je(et,N){return(N<<3)+(7&et)}function Gn(et){return et<<1^et>>31}function cn(et,N){for(var Z=et.loadGeometry(),Q=et.type,ot=0,yt=0,kt=Z.length,At=0;At<kt;At++){var vt=Z[At],It=1;1===Q&&(It=vt.length),N.writeVarint(Je(1,It));for(var ie=3===Q?vt.length-1:vt.length,we=0;we<ie;we++){1===we&&1!==Q&&N.writeVarint(Je(2,ie-1));var re=vt[we].x-ot,Ze=vt[we].y-yt;N.writeVarint(Gn(re)),N.writeVarint(Gn(Ze)),ot+=re,yt+=Ze}3===Q&&N.writeVarint(Je(7,1))}}function vn(et,N){var Z=typeof et;"string"===Z?N.writeStringField(1,et):"boolean"===Z?N.writeBooleanField(7,et):"number"===Z&&(et%1!=0?N.writeDoubleField(3,et):et<0?N.writeSVarintField(6,et):N.writeVarintField(5,et))}function _i(et,N,Z,Q,ot,yt){if(ot-Q<=Z)return;const kt=Q+ot>>1;ni(et,N,kt,Q,ot,yt%2),_i(et,N,Z,Q,kt-1,yt+1),_i(et,N,Z,kt+1,ot,yt+1)}function ni(et,N,Z,Q,ot,yt){for(;ot>Q;){if(ot-Q>600){const It=ot-Q+1,ie=Z-Q+1,we=Math.log(It),re=.5*Math.exp(2*we/3),Ze=.5*Math.sqrt(we*re*(It-re)/It)*(ie-It/2<0?-1:1);ni(et,N,Z,Math.max(Q,Math.floor(Z-ie*re/It+Ze)),Math.min(ot,Math.floor(Z+(It-ie)*re/It+Ze)),yt)}const kt=N[2*Z+yt];let At=Q,vt=ot;for(On(et,N,Q,Z),N[2*ot+yt]>kt&&On(et,N,Q,ot);At<vt;){for(On(et,N,At,vt),At++,vt--;N[2*At+yt]<kt;)At++;for(;N[2*vt+yt]>kt;)vt--}N[2*Q+yt]===kt?On(et,N,Q,vt):(vt++,On(et,N,vt,ot)),vt<=Z&&(Q=vt+1),Z<=vt&&(ot=vt-1)}}function On(et,N,Z,Q){Is(et,Z,Q),Is(N,2*Z,2*Q),Is(N,2*Z+1,2*Q+1)}function Is(et,N,Z){const Q=et[N];et[N]=et[Z],et[Z]=Q}function Bn(et,N,Z,Q){const ot=et-Z,yt=N-Q;return ot*ot+yt*yt}lt.exports=ze,pe.fromVectorTileJs=ze,pe.fromGeojsonVt=function(et,N){N=N||{};var Z={};for(var Q in et)Z[Q]=new le(et[Q].features,N),Z[Q].name=Q,Z[Q].version=N.version,Z[Q].extent=N.extent;return ze({layers:Z})},pe.GeoJSONWrapper=le;const Pn=et=>et[0],In=et=>et[1];class Me{constructor(N,Z=Pn,Q=In,ot=64,yt=Float64Array){this.nodeSize=ot,this.points=N;const kt=N.length<65536?Uint16Array:Uint32Array,At=this.ids=new kt(N.length),vt=this.coords=new yt(2*N.length);for(let It=0;It<N.length;It++)At[It]=It,vt[2*It]=Z(N[It]),vt[2*It+1]=Q(N[It]);_i(At,vt,ot,0,At.length-1,0)}range(N,Z,Q,ot){return function(yt,kt,At,vt,It,ie,we){const re=[0,yt.length-1,0],Ze=[];let Ge,Ne;for(;re.length;){const We=re.pop(),ei=re.pop(),bi=re.pop();if(ei-bi<=we){for(let Ii=bi;Ii<=ei;Ii++)Ge=kt[2*Ii],Ne=kt[2*Ii+1],Ge>=At&&Ge<=It&&Ne>=vt&&Ne<=ie&&Ze.push(yt[Ii]);continue}const He=Math.floor((bi+ei)/2);Ge=kt[2*He],Ne=kt[2*He+1],Ge>=At&&Ge<=It&&Ne>=vt&&Ne<=ie&&Ze.push(yt[He]);const Pi=(We+1)%2;(0===We?At<=Ge:vt<=Ne)&&(re.push(bi),re.push(He-1),re.push(Pi)),(0===We?It>=Ge:ie>=Ne)&&(re.push(He+1),re.push(ei),re.push(Pi))}return Ze}(this.ids,this.coords,N,Z,Q,ot,this.nodeSize)}within(N,Z,Q){return function(ot,yt,kt,At,vt,It){const ie=[0,ot.length-1,0],we=[],re=vt*vt;for(;ie.length;){const Ze=ie.pop(),Ge=ie.pop(),Ne=ie.pop();if(Ge-Ne<=It){for(let Pi=Ne;Pi<=Ge;Pi++)Bn(yt[2*Pi],yt[2*Pi+1],kt,At)<=re&&we.push(ot[Pi]);continue}const We=Math.floor((Ne+Ge)/2),ei=yt[2*We],bi=yt[2*We+1];Bn(ei,bi,kt,At)<=re&&we.push(ot[We]);const He=(Ze+1)%2;(0===Ze?kt-vt<=ei:At-vt<=bi)&&(ie.push(Ne),ie.push(We-1),ie.push(He)),(0===Ze?kt+vt>=ei:At+vt>=bi)&&(ie.push(We+1),ie.push(Ge),ie.push(He))}return we}(this.ids,this.coords,N,Z,Q,this.nodeSize)}}const js={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:et=>et},xs=Math.fround||(Hi=new Float32Array(1),et=>(Hi[0]=+et,Hi[0]));var Hi;class mn{constructor(N){this.options=Ho(Object.create(js),N),this.trees=new Array(this.options.maxZoom+1)}load(N){const{log:Z,minZoom:Q,maxZoom:ot,nodeSize:yt}=this.options;Z&&console.time("total time");const kt=`prepare ${N.length} points`;Z&&console.time(kt),this.points=N;let At=[];for(let vt=0;vt<N.length;vt++)N[vt].geometry&&At.push(on(N[vt],vt));this.trees[ot+1]=new Me(At,wl,Vr,yt,Float32Array),Z&&console.timeEnd(kt);for(let vt=ot;vt>=Q;vt--){const It=+Date.now();At=this._cluster(At,vt),this.trees[vt]=new Me(At,wl,Vr,yt,Float32Array),Z&&console.log("z%d: %d clusters in %dms",vt,At.length,+Date.now()-It)}return Z&&console.timeEnd("total time"),this}getClusters(N,Z){let Q=((N[0]+180)%360+360)%360-180;const ot=Math.max(-90,Math.min(90,N[1]));let yt=180===N[2]?180:((N[2]+180)%360+360)%360-180;const kt=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)Q=-180,yt=180;else if(Q>yt){const ie=this.getClusters([Q,ot,180,kt],Z),we=this.getClusters([-180,ot,yt,kt],Z);return ie.concat(we)}const At=this.trees[this._limitZoom(Z)],vt=At.range(Gs(Q),qo(kt),Gs(yt),qo(ot)),It=[];for(const ie of vt){const we=At.points[ie];It.push(we.numPoints?Zs(we):this.points[we.index])}return It}getChildren(N){const Z=this._getOriginId(N),Q=this._getOriginZoom(N),ot="No cluster with the specified id.",yt=this.trees[Q];if(!yt)throw new Error(ot);const kt=yt.points[Z];if(!kt)throw new Error(ot);const At=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),vt=yt.within(kt.x,kt.y,At),It=[];for(const ie of vt){const we=yt.points[ie];we.parentId===N&&It.push(we.numPoints?Zs(we):this.points[we.index])}if(0===It.length)throw new Error(ot);return It}getLeaves(N,Z,Q){const ot=[];return this._appendLeaves(ot,N,Z=Z||10,Q=Q||0,0),ot}getTile(N,Z,Q){const ot=this.trees[this._limitZoom(N)],yt=Math.pow(2,N),{extent:kt,radius:At}=this.options,vt=At/kt,It=(Q-vt)/yt,ie=(Q+1+vt)/yt,we={features:[]};return this._addTileFeatures(ot.range((Z-vt)/yt,It,(Z+1+vt)/yt,ie),ot.points,Z,Q,yt,we),0===Z&&this._addTileFeatures(ot.range(1-vt/yt,It,1,ie),ot.points,yt,Q,yt,we),Z===yt-1&&this._addTileFeatures(ot.range(0,It,vt/yt,ie),ot.points,-1,Q,yt,we),we.features.length?we:null}getClusterExpansionZoom(N){let Z=this._getOriginZoom(N)-1;for(;Z<=this.options.maxZoom;){const Q=this.getChildren(N);if(Z++,1!==Q.length)break;N=Q[0].properties.cluster_id}return Z}_appendLeaves(N,Z,Q,ot,yt){const kt=this.getChildren(Z);for(const At of kt){const vt=At.properties;if(vt&&vt.cluster?yt+vt.point_count<=ot?yt+=vt.point_count:yt=this._appendLeaves(N,vt.cluster_id,Q,ot,yt):yt<ot?yt++:N.push(At),N.length===Q)break}return yt}_addTileFeatures(N,Z,Q,ot,yt,kt){for(const At of N){const vt=Z[At],It=vt.numPoints;let ie,we,re;if(It)ie=Ti(vt),we=vt.x,re=vt.y;else{const Ne=this.points[vt.index];ie=Ne.properties,we=Gs(Ne.geometry.coordinates[0]),re=qo(Ne.geometry.coordinates[1])}const Ze={type:1,geometry:[[Math.round(this.options.extent*(we*yt-Q)),Math.round(this.options.extent*(re*yt-ot))]],tags:ie};let Ge;It?Ge=vt.id:this.options.generateId?Ge=vt.index:this.points[vt.index].id&&(Ge=this.points[vt.index].id),void 0!==Ge&&(Ze.id=Ge),kt.features.push(Ze)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(Math.floor(+N),this.options.maxZoom+1))}_cluster(N,Z){const Q=[],{radius:ot,extent:yt,reduce:kt,minPoints:At}=this.options,vt=ot/(yt*Math.pow(2,Z));for(let It=0;It<N.length;It++){const ie=N[It];if(ie.zoom<=Z)continue;ie.zoom=Z;const we=this.trees[Z+1],re=we.within(ie.x,ie.y,vt),Ze=ie.numPoints||1;let Ge=Ze;for(const Ne of re){const We=we.points[Ne];We.zoom>Z&&(Ge+=We.numPoints||1)}if(Ge>Ze&&Ge>=At){let Ne=ie.x*Ze,We=ie.y*Ze,ei=kt&&Ze>1?this._map(ie,!0):null;const bi=(It<<5)+(Z+1)+this.points.length;for(const He of re){const Pi=we.points[He];if(Pi.zoom<=Z)continue;Pi.zoom=Z;const Ii=Pi.numPoints||1;Ne+=Pi.x*Ii,We+=Pi.y*Ii,Pi.parentId=bi,kt&&(ei||(ei=this._map(ie,!0)),kt(ei,this._map(Pi)))}ie.parentId=bi,Q.push(wo(Ne/Ge,We/Ge,bi,Ge,ei))}else if(Q.push(ie),Ge>1)for(const Ne of re){const We=we.points[Ne];We.zoom<=Z||(We.zoom=Z,Q.push(We))}}return Q}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,Z){if(N.numPoints)return Z?Ho({},N.properties):N.properties;const Q=this.points[N.index].properties,ot=this.options.map(Q);return Z&&ot===Q?Ho({},ot):ot}}function wo(et,N,Z,Q,ot){return{x:xs(et),y:xs(N),zoom:1/0,id:Z,parentId:-1,numPoints:Q,properties:ot}}function on(et,N){const[Z,Q]=et.geometry.coordinates;return{x:xs(Gs(Z)),y:xs(qo(Q)),zoom:1/0,index:N,parentId:-1}}function Zs(et){return{type:"Feature",id:et.id,properties:Ti(et),geometry:{type:"Point",coordinates:[(N=et.x,360*(N-.5)),bl(et.y)]}};var N}function Ti(et){const N=et.numPoints,Z=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N;return Ho(Ho({},et.properties),{cluster:!0,cluster_id:et.id,point_count:N,point_count_abbreviated:Z})}function Gs(et){return et/360+.5}function qo(et){const N=Math.sin(et*Math.PI/180),Z=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return Z<0?0:Z>1?1:Z}function bl(et){const N=(180-360*et)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function Ho(et,N){for(const Z in N)et[Z]=N[Z];return et}function wl(et){return et.x}function Vr(et){return et.y}function Da(et,N,Z,Q){for(var ot,yt=Q,kt=Z-N>>1,At=Z-N,vt=et[N],It=et[N+1],ie=et[Z],we=et[Z+1],re=N+3;re<Z;re+=3){var Ze=so(et[re],et[re+1],vt,It,ie,we);if(Ze>yt)ot=re,yt=Ze;else if(Ze===yt){var Ge=Math.abs(re-kt);Ge<At&&(ot=re,At=Ge)}}yt>Q&&(ot-N>3&&Da(et,N,ot,Q),et[ot+2]=yt,Z-ot>3&&Da(et,ot,Z,Q))}function so(et,N,Z,Q,ot,yt){var kt=ot-Z,At=yt-Q;if(0!==kt||0!==At){var vt=((et-Z)*kt+(N-Q)*At)/(kt*kt+At*At);vt>1?(Z=ot,Q=yt):vt>0&&(Z+=kt*vt,Q+=At*vt)}return(kt=et-Z)*kt+(At=N-Q)*At}function oo(et,N,Z,Q){var ot={id:void 0===et?null:et,type:N,geometry:Z,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(yt){var kt=yt.geometry,At=yt.type;if("Point"===At||"MultiPoint"===At||"LineString"===At)jr(yt,kt);else if("Polygon"===At||"MultiLineString"===At)for(var vt=0;vt<kt.length;vt++)jr(yt,kt[vt]);else if("MultiPolygon"===At)for(vt=0;vt<kt.length;vt++)for(var It=0;It<kt[vt].length;It++)jr(yt,kt[vt][It])}(ot),ot}function jr(et,N){for(var Z=0;Z<N.length;Z+=3)et.minX=Math.min(et.minX,N[Z]),et.minY=Math.min(et.minY,N[Z+1]),et.maxX=Math.max(et.maxX,N[Z]),et.maxY=Math.max(et.maxY,N[Z+1])}function Pa(et,N,Z,Q){if(N.geometry){var ot=N.geometry.coordinates,yt=N.geometry.type,kt=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),At=[],vt=N.id;if(Z.promoteId?vt=N.properties[Z.promoteId]:Z.generateId&&(vt=Q||0),"Point"===yt)Tl(ot,At);else if("MultiPoint"===yt)for(var It=0;It<ot.length;It++)Tl(ot[It],At);else if("LineString"===yt)$o(ot,At,kt,!1);else if("MultiLineString"===yt){if(Z.lineMetrics){for(It=0;It<ot.length;It++)$o(ot[It],At=[],kt,!1),et.push(oo(vt,"LineString",At,N.properties));return}Zr(ot,At,kt,!1)}else if("Polygon"===yt)Zr(ot,At,kt,!0);else{if("MultiPolygon"!==yt){if("GeometryCollection"===yt){for(It=0;It<N.geometry.geometries.length;It++)Pa(et,{id:vt,geometry:N.geometry.geometries[It],properties:N.properties},Z,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(It=0;It<ot.length;It++){var ie=[];Zr(ot[It],ie,kt,!0),At.push(ie)}}et.push(oo(vt,yt,At,N.properties))}}function Tl(et,N){N.push(Gr(et[0])),N.push(qr(et[1])),N.push(0)}function $o(et,N,Z,Q){for(var ot,yt,kt=0,At=0;At<et.length;At++){var vt=Gr(et[At][0]),It=qr(et[At][1]);N.push(vt),N.push(It),N.push(0),At>0&&(kt+=Q?(ot*It-vt*yt)/2:Math.sqrt(Math.pow(vt-ot,2)+Math.pow(It-yt,2))),ot=vt,yt=It}var ie=N.length-3;N[2]=1,Da(N,0,ie,Z),N[ie+2]=1,N.size=Math.abs(kt),N.start=0,N.end=N.size}function Zr(et,N,Z,Q){for(var ot=0;ot<et.length;ot++){var yt=[];$o(et[ot],yt,Z,Q),N.push(yt)}}function Gr(et){return et/360+.5}function qr(et){var N=Math.sin(et*Math.PI/180),Z=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return Z<0?0:Z>1?1:Z}function vs(et,N,Z,Q,ot,yt,kt,At){if(Q/=N,yt>=(Z/=N)&&kt<Q)return et;if(kt<Z||yt>=Q)return null;for(var vt=[],It=0;It<et.length;It++){var ie=et[It],we=ie.geometry,re=ie.type,Ze=0===ot?ie.minX:ie.minY,Ge=0===ot?ie.maxX:ie.maxY;if(Ze>=Z&&Ge<Q)vt.push(ie);else if(!(Ge<Z||Ze>=Q)){var Ne=[];if("Point"===re||"MultiPoint"===re)Hr(we,Ne,Z,Q,ot);else if("LineString"===re)Wo(we,Ne,Z,Q,ot,!1,At.lineMetrics);else if("MultiLineString"===re)Ia(we,Ne,Z,Q,ot,!1);else if("Polygon"===re)Ia(we,Ne,Z,Q,ot,!0);else if("MultiPolygon"===re)for(var We=0;We<we.length;We++){var ei=[];Ia(we[We],ei,Z,Q,ot,!0),ei.length&&Ne.push(ei)}if(Ne.length){if(At.lineMetrics&&"LineString"===re){for(We=0;We<Ne.length;We++)vt.push(oo(ie.id,re,Ne[We],ie.tags));continue}"LineString"!==re&&"MultiLineString"!==re||(1===Ne.length?(re="LineString",Ne=Ne[0]):re="MultiLineString"),"Point"!==re&&"MultiPoint"!==re||(re=3===Ne.length?"Point":"MultiPoint"),vt.push(oo(ie.id,re,Ne,ie.tags))}}}return vt.length?vt:null}function Hr(et,N,Z,Q,ot){for(var yt=0;yt<et.length;yt+=3){var kt=et[yt+ot];kt>=Z&&kt<=Q&&(N.push(et[yt]),N.push(et[yt+1]),N.push(et[yt+2]))}}function Wo(et,N,Z,Q,ot,yt,kt){for(var At,vt,It=bs(et),ie=0===ot?Wr:fr,we=et.start,re=0;re<et.length-3;re+=3){var Ze=et[re],Ge=et[re+1],Ne=et[re+2],We=et[re+3],ei=et[re+4],bi=0===ot?Ze:Ge,He=0===ot?We:ei,Pi=!1;kt&&(At=Math.sqrt(Math.pow(Ze-We,2)+Math.pow(Ge-ei,2))),bi<Z?He>Z&&(vt=ie(It,Ze,Ge,We,ei,Z),kt&&(It.start=we+At*vt)):bi>Q?He<Q&&(vt=ie(It,Ze,Ge,We,ei,Q),kt&&(It.start=we+At*vt)):$r(It,Ze,Ge,Ne),He<Z&&bi>=Z&&(vt=ie(It,Ze,Ge,We,ei,Z),Pi=!0),He>Q&&bi<=Q&&(vt=ie(It,Ze,Ge,We,ei,Q),Pi=!0),!yt&&Pi&&(kt&&(It.end=we+At*vt),N.push(It),It=bs(et)),kt&&(we+=At)}var Ii=et.length-3;Ze=et[Ii],Ge=et[Ii+1],Ne=et[Ii+2],(bi=0===ot?Ze:Ge)>=Z&&bi<=Q&&$r(It,Ze,Ge,Ne),Ii=It.length-3,yt&&Ii>=3&&(It[Ii]!==It[0]||It[Ii+1]!==It[1])&&$r(It,It[0],It[1],It[2]),It.length&&N.push(It)}function bs(et){var N=[];return N.size=et.size,N.start=et.start,N.end=et.end,N}function Ia(et,N,Z,Q,ot,yt){for(var kt=0;kt<et.length;kt++)Wo(et[kt],N,Z,Q,ot,yt,!1)}function $r(et,N,Z,Q){et.push(N),et.push(Z),et.push(Q)}function Wr(et,N,Z,Q,ot,yt){var kt=(yt-N)/(Q-N);return et.push(yt),et.push(Z+(ot-Z)*kt),et.push(1),kt}function fr(et,N,Z,Q,ot,yt){var kt=(yt-Z)/(ot-Z);return et.push(N+(Q-N)*kt),et.push(yt),et.push(1),kt}function Xr(et,N){for(var Z=[],Q=0;Q<et.length;Q++){var ot,yt=et[Q],kt=yt.type;if("Point"===kt||"MultiPoint"===kt||"LineString"===kt)ot=To(yt.geometry,N);else if("MultiLineString"===kt||"Polygon"===kt){ot=[];for(var At=0;At<yt.geometry.length;At++)ot.push(To(yt.geometry[At],N))}else if("MultiPolygon"===kt)for(ot=[],At=0;At<yt.geometry.length;At++){for(var vt=[],It=0;It<yt.geometry[At].length;It++)vt.push(To(yt.geometry[At][It],N));ot.push(vt)}Z.push(oo(yt.id,kt,ot,yt.tags))}return Z}function To(et,N){var Z=[];Z.size=et.size,void 0!==et.start&&(Z.start=et.start,Z.end=et.end);for(var Q=0;Q<et.length;Q+=3)Z.push(et[Q]+N,et[Q+1],et[Q+2]);return Z}function qs(et,N){if(et.transformed)return et;var Z,Q,ot,yt=1<<et.z,kt=et.x,At=et.y;for(Z=0;Z<et.features.length;Z++){var vt=et.features[Z],It=vt.geometry,ie=vt.type;if(vt.geometry=[],1===ie)for(Q=0;Q<It.length;Q+=2)vt.geometry.push(So(It[Q],It[Q+1],N,yt,kt,At));else for(Q=0;Q<It.length;Q++){var we=[];for(ot=0;ot<It[Q].length;ot+=2)we.push(So(It[Q][ot],It[Q][ot+1],N,yt,kt,At));vt.geometry.push(we)}}return et.transformed=!0,et}function So(et,N,Z,Q,ot,yt){return[Math.round(Z*(et*Q-ot)),Math.round(Z*(N*Q-yt))]}function Sl(et,N,Z,Q,ot){for(var yt=N===ot.maxZoom?0:ot.tolerance/((1<<N)*ot.extent),kt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:Q,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},At=0;At<et.length;At++){kt.numFeatures++,Cl(kt,et[At],yt,ot);var vt=et[At].minX,It=et[At].minY,ie=et[At].maxX,we=et[At].maxY;vt<kt.minX&&(kt.minX=vt),It<kt.minY&&(kt.minY=It),ie>kt.maxX&&(kt.maxX=ie),we>kt.maxY&&(kt.maxY=we)}return kt}function Cl(et,N,Z,Q){var ot=N.geometry,yt=N.type,kt=[];if("Point"===yt||"MultiPoint"===yt)for(var At=0;At<ot.length;At+=3)kt.push(ot[At]),kt.push(ot[At+1]),et.numPoints++,et.numSimplified++;else if("LineString"===yt)mr(kt,ot,et,Z,!1,!1);else if("MultiLineString"===yt||"Polygon"===yt)for(At=0;At<ot.length;At++)mr(kt,ot[At],et,Z,"Polygon"===yt,0===At);else if("MultiPolygon"===yt)for(var vt=0;vt<ot.length;vt++){var It=ot[vt];for(At=0;At<It.length;At++)mr(kt,It[At],et,Z,!0,0===At)}if(kt.length){var ie=N.tags||null;if("LineString"===yt&&Q.lineMetrics){for(var we in ie={},N.tags)ie[we]=N.tags[we];ie.mapbox_clip_start=ot.start/ot.size,ie.mapbox_clip_end=ot.end/ot.size}var re={geometry:kt,type:"Polygon"===yt||"MultiPolygon"===yt?3:"LineString"===yt||"MultiLineString"===yt?2:1,tags:ie};null!==N.id&&(re.id=N.id),et.features.push(re)}}function mr(et,N,Z,Q,ot,yt){var kt=Q*Q;if(Q>0&&N.size<(ot?kt:Q))Z.numPoints+=N.length/3;else{for(var At=[],vt=0;vt<N.length;vt+=3)(0===Q||N[vt+2]>kt)&&(Z.numSimplified++,At.push(N[vt]),At.push(N[vt+1])),Z.numPoints++;ot&&function(It,ie){for(var we=0,re=0,Ze=It.length,Ge=Ze-2;re<Ze;Ge=re,re+=2)we+=(It[re]-It[Ge])*(It[re+1]+It[Ge+1]);if(we>0===ie)for(re=0,Ze=It.length;re<Ze/2;re+=2){var Ne=It[re],We=It[re+1];It[re]=It[Ze-2-re],It[re+1]=It[Ze-1-re],It[Ze-2-re]=Ne,It[Ze-1-re]=We}}(At,yt),et.push(At)}}function Co(et,N){var Z=(N=this.options=function(ot,yt){for(var kt in yt)ot[kt]=yt[kt];return ot}(Object.create(this.options),N)).debug;if(Z&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var ot,yt,kt,At,vt,It,Q=function(ot,yt){var kt=[];if("FeatureCollection"===ot.type)for(var At=0;At<ot.features.length;At++)Pa(kt,ot.features[At],yt,At);else Pa(kt,"Feature"===ot.type?ot:{geometry:ot},yt);return kt}(et,N);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),At=ot=Q,vt=vs(ot,1,-1-(kt=(yt=N).buffer/yt.extent),kt,0,-1,2,yt),It=vs(ot,1,1-kt,2+kt,0,-1,2,yt),(vt||It)&&(At=vs(ot,1,-kt,1+kt,0,-1,2,yt)||[],vt&&(At=Xr(vt,1).concat(At)),It&&(At=At.concat(Xr(It,-1)))),(Q=At).length&&this.splitTile(Q,0,0,0),Z&&(Q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ln(et,N,Z){return 32*((1<<et)*Z+N)+et}function Mo(et,N){const Z=et.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);const Q=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!Q)return N(null,null);const ot=new ye(Q.features);let yt=pe(ot);0===yt.byteOffset&&yt.byteLength===yt.buffer.byteLength||(yt=new Uint8Array(yt)),N(null,{vectorTile:ot,rawData:yt.buffer})}Co.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Co.prototype.splitTile=function(et,N,Z,Q,ot,yt,kt){for(var At=[et,N,Z,Q],vt=this.options,It=vt.debug;At.length;){Q=At.pop(),Z=At.pop(),N=At.pop(),et=At.pop();var ie=1<<N,we=Ln(N,Z,Q),re=this.tiles[we];if(!re&&(It>1&&console.time("creation"),re=this.tiles[we]=Sl(et,N,Z,Q,vt),this.tileCoords.push({z:N,x:Z,y:Q}),It)){It>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,Z,Q,re.numFeatures,re.numPoints,re.numSimplified),console.timeEnd("creation"));var Ze="z"+N;this.stats[Ze]=(this.stats[Ze]||0)+1,this.total++}if(re.source=et,ot){if(N===vt.maxZoom||N===ot)continue;var Ge=1<<ot-N;if(Z!==Math.floor(yt/Ge)||Q!==Math.floor(kt/Ge))continue}else if(N===vt.indexMaxZoom||re.numPoints<=vt.indexMaxPoints)continue;if(re.source=null,0!==et.length){It>1&&console.time("clipping");var Ne,We,ei,bi,He,Pi,Ii=.5*vt.buffer/vt.extent,Yo=.5-Ii,Jo=.5+Ii,Ht=1+Ii;Ne=We=ei=bi=null,He=vs(et,ie,Z-Ii,Z+Jo,0,re.minX,re.maxX,vt),Pi=vs(et,ie,Z+Yo,Z+Ht,0,re.minX,re.maxX,vt),et=null,He&&(Ne=vs(He,ie,Q-Ii,Q+Jo,1,re.minY,re.maxY,vt),We=vs(He,ie,Q+Yo,Q+Ht,1,re.minY,re.maxY,vt),He=null),Pi&&(ei=vs(Pi,ie,Q-Ii,Q+Jo,1,re.minY,re.maxY,vt),bi=vs(Pi,ie,Q+Yo,Q+Ht,1,re.minY,re.maxY,vt),Pi=null),It>1&&console.timeEnd("clipping"),At.push(Ne||[],N+1,2*Z,2*Q),At.push(We||[],N+1,2*Z,2*Q+1),At.push(ei||[],N+1,2*Z+1,2*Q),At.push(bi||[],N+1,2*Z+1,2*Q+1)}}},Co.prototype.getTile=function(et,N,Z){var Q=this.options,ot=Q.extent,yt=Q.debug;if(et<0||et>24)return null;var kt=1<<et,At=Ln(et,N=(N%kt+kt)%kt,Z);if(this.tiles[At])return qs(this.tiles[At],ot);yt>1&&console.log("drilling down to z%d-%d-%d",et,N,Z);for(var vt,It=et,ie=N,we=Z;!vt&&It>0;)It--,ie=Math.floor(ie/2),we=Math.floor(we/2),vt=this.tiles[Ln(It,ie,we)];return vt&&vt.source?(yt>1&&console.log("found parent tile z%d-%d-%d",It,ie,we),yt>1&&console.time("drilling down"),this.splitTile(vt.source,It,ie,we,et,N,Z),yt>1&&console.timeEnd("drilling down"),this.tiles[At]?qs(this.tiles[At],ot):null):null};class gr extends c.VectorTileWorkerSource{constructor(N,Z,Q,ot,yt){super(N,Z,Q,ot,Mo),yt&&(this.loadGeoJSON=yt)}loadData(N,Z){const Q=N&&N.request,ot=Q&&Q.collectResourceTiming;this.loadGeoJSON(N,(yt,kt)=>{if(yt||!kt)return Z(yt);if("object"!=typeof kt)return Z(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));{zt(kt,!0);try{if(N.filter){const vt=c.createExpression(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===vt.result)throw new Error(vt.value.map(ie=>`${ie.key}: ${ie.message}`).join(", "));kt={type:"FeatureCollection",features:kt.features.filter(ie=>vt.value.evaluate({zoom:0},ie))}}this._geoJSONIndex=N.cluster?new mn(function({superclusterOptions:vt,clusterProperties:It}){if(!It||!vt)return vt;const ie={},we={},re={accumulated:null,zoom:0},Ze={properties:null},Ge=Object.keys(It);for(const Ne of Ge){const[We,ei]=It[Ne],bi=c.createExpression(ei),He=c.createExpression("string"==typeof We?[We,["accumulated"],["get",Ne]]:We);ie[Ne]=bi.value,we[Ne]=He.value}return vt.map=Ne=>{Ze.properties=Ne;const We={};for(const ei of Ge)We[ei]=ie[ei].evaluate(re,Ze);return We},vt.reduce=(Ne,We)=>{Ze.properties=We;for(const ei of Ge)re.accumulated=Ne[ei],Ne[ei]=we[ei].evaluate(re,Ze)},vt}(N)).load(kt.features):new Co(vt=kt,N.geojsonVtOptions)}catch(vt){return Z(vt)}this.loaded={};const At={};if(ot){const vt=c.getPerformanceMeasurement(Q);vt&&(At.resourceTiming={},At.resourceTiming[N.source]=JSON.parse(JSON.stringify(vt)))}Z(null,At)}var vt})}reloadTile(N,Z){const Q=this.loaded;return Q&&Q[N.uid]?super.reloadTile(N,Z):this.loadTile(N,Z)}loadGeoJSON(N,Z){if(N.request)c.getJSON(N.request,Z);else{if("string"!=typeof N.data)return Z(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse(N.data))}catch{return Z(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(N,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(N.clusterId))}catch(Q){Z(Q)}}getClusterChildren(N,Z){try{Z(null,this._geoJSONIndex.getChildren(N.clusterId))}catch(Q){Z(Q)}}getClusterLeaves(N,Z){try{Z(null,this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset))}catch(Q){Z(Q)}}}class Xo{constructor(N){this.self=N,this.actor=new c.Actor(N,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=c.getProjection({name:"mercator"}),this.workerSourceTypes={vector:c.VectorTileWorkerSource,geojson:gr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,Q)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=Q},this.self.registerRTLTextPlugin=Z=>{if(c.plugin.isParsed())throw new Error("RTL text plugin already registered.");c.plugin.applyArabicShaping=Z.applyArabicShaping,c.plugin.processBidirectionalText=Z.processBidirectionalText,c.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches(N,Z,Q){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N],Q()}checkIfReady(N,Z,Q){Q()}setReferrer(N,Z){this.referrer=Z}spriteLoaded(N,Z){this.isSpriteLoaded[N]=Z;for(const Q in this.workerSources[N]){const ot=this.workerSources[N][Q];for(const yt in ot)ot[yt]instanceof c.VectorTileWorkerSource&&(ot[yt].isSpriteLoaded=Z,ot[yt].fire(new c.Event("isSpriteLoaded")))}}setImages(N,Z,Q){this.availableImages[N]=Z;for(const ot in this.workerSources[N]){const yt=this.workerSources[N][ot];for(const kt in yt)yt[kt].availableImages=Z}Q()}enableTerrain(N,Z,Q){this.terrain=Z,Q()}setProjection(N,Z){this.projections[N]=c.getProjection(Z)}setLayers(N,Z,Q){this.getLayerIndex(N).replace(Z),Q()}updateLayers(N,Z,Q){this.getLayerIndex(N).update(Z.layers,Z.removedIds),Q()}loadTile(N,Z,Q){const ot=this.enableTerrain?c.extend({enableTerrain:this.terrain},Z):Z;ot.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,Z.type,Z.source).loadTile(ot,Q)}loadDEMTile(N,Z,Q){const ot=this.enableTerrain?c.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource(N,Z.source).loadTile(ot,Q)}reloadTile(N,Z,Q){const ot=this.enableTerrain?c.extend({enableTerrain:this.terrain},Z):Z;ot.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,Z.type,Z.source).reloadTile(ot,Q)}abortTile(N,Z,Q){this.getWorkerSource(N,Z.type,Z.source).abortTile(Z,Q)}removeTile(N,Z,Q){this.getWorkerSource(N,Z.type,Z.source).removeTile(Z,Q)}removeSource(N,Z,Q){if(!this.workerSources[N]||!this.workerSources[N][Z.type]||!this.workerSources[N][Z.type][Z.source])return;const ot=this.workerSources[N][Z.type][Z.source];delete this.workerSources[N][Z.type][Z.source],void 0!==ot.removeSource?ot.removeSource(Z,Q):Q()}loadWorkerSource(N,Z,Q){try{this.self.importScripts(Z.url),Q()}catch(ot){Q(ot.toString())}}syncRTLPluginState(N,Z,Q){try{c.plugin.setState(Z);const ot=c.plugin.getPluginURL();if(c.plugin.isLoaded()&&!c.plugin.isParsed()&&null!=ot){this.self.importScripts(ot);const yt=c.plugin.isParsed();Q(yt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ot}`),yt)}}catch(ot){Q(ot.toString())}}getAvailableImages(N){let Z=this.availableImages[N];return Z||(Z=[]),Z}getLayerIndex(N){let Z=this.layerIndexes[N];return Z||(Z=this.layerIndexes[N]=new mt),Z}getWorkerSource(N,Z,Q){return this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][Z]||(this.workerSources[N][Z]={}),this.workerSources[N][Z][Q]||(this.workerSources[N][Z][Q]=new this.workerSourceTypes[Z]({send:(yt,kt,At,vt,It,ie)=>{this.actor.send(yt,kt,At,N,It,ie)},scheduler:this.actor.scheduler},this.getLayerIndex(N),this.getAvailableImages(N),this.isSpriteLoaded[N])),this.workerSources[N][Z][Q]}getDEMWorkerSource(N,Z){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][Z]||(this.demWorkerSources[N][Z]=new St),this.demWorkerSources[N][Z]}enforceCacheSizeLimit(N,Z){c.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics(N,Z,Q){Q(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Xo(self)),Xo}),Zt(0,function(c){function p(f,s){if(Array.isArray(f)){if(!Array.isArray(s)||f.length!==s.length)return!1;for(let h=0;h<f.length;h++)if(!p(f[h],s[h]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==s){if("object"!=typeof s||Object.keys(f).length!==Object.keys(s).length)return!1;for(const h in f)if(!p(f[h],s[h]))return!1;return!0}return f===s}var Tt=mt;function mt(f){return s=f,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,w=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(w);try{v=new Worker(E),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(E),g}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var w=v.getImageData(0,0,1,1);return w&&w.width===g.width}()||(void 0===St[h=s&&s.failIfMajorPerformanceCaveat]&&(St[h]=function(g){var v,E,A,P,w=(E=g,A=document.createElement("canvas"),(P=Object.create(mt.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,A.getContext("webgl",P)||A.getContext("experimental-webgl",P));if(!w)return!1;try{v=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!v||w.isContextLost())&&(w.shaderSource(v,"void main() {}"),w.compileShader(v),!0===w.getShaderParameter(v,w.COMPILE_STATUS))}(h)),!St[h]||document.documentMode));var s,h}var St={};function zt(f,s,h){const g=c.window.document.createElement(f);return void 0!==s&&(g.className=s),h&&h.appendChild(g),g}function de(f,s,h){const g=c.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const v of Object.keys(s))g.setAttributeNS(null,v,s[v]);return h&&h.appendChild(g),g}mt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Fe=c.window.document&&c.window.document.documentElement.style,Ce=Fe&&void 0!==Fe.userSelect?"userSelect":"WebkitUserSelect";let Re;function ye(){Fe&&Ce&&(Re=Fe[Ce],Fe[Ce]="none")}function pe(){Fe&&Ce&&(Fe[Ce]=Re)}function lt(f){f.preventDefault(),f.stopPropagation(),c.window.removeEventListener("click",lt,!0)}function qt(){c.window.addEventListener("click",lt,!0),c.window.setTimeout(()=>{c.window.removeEventListener("click",lt,!0)},0)}function Mt(f,s){const h=f.getBoundingClientRect();return Qt(f,h,s)}function Ut(f,s){const h=f.getBoundingClientRect(),g=[];for(let v=0;v<s.length;v++)g.push(Qt(f,h,s[v]));return g}function Dt(f){return void 0!==c.window.InstallTrigger&&2===f.button&&f.ctrlKey&&c.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function Qt(f,s,h){const g=f.offsetWidth===s.width?1:f.offsetWidth/s.width;return new c.pointGeometry((h.clientX-s.left)*g,(h.clientY-s.top)*g)}function Jt(f,s){var h=s[0],g=s[1],v=s[2],w=s[3],E=h*w-v*g;return E?(f[0]=w*(E=1/E),f[1]=-g*E,f[2]=-v*E,f[3]=h*E,f):null}function le(f){const{userImage:s}=f;return!!(s&&s.render&&s.render())&&(f.data.replace(new Uint8Array(s.data.buffer)),!0)}class ze extends c.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,callback:g}of this.requestors)this._notify(h,g);this.requestors=[]}}hasImage(s){return!!this.getImage(s)}getImage(s){return this.images[s]}addImage(s,h){this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new c.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new c.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new c.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),g=!1),g}_validateStretch(s,h){if(!s)return!0;let g=0;for(const v of s){if(v[0]<g||v[1]<v[0]||h<v[1])return!1;g=v[1]}return!0}_validateContent(s,h){return!(s&&(4!==s.length||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h){h.version=this.images[s].version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let g=!0;if(!this.isLoaded())for(const v of s)this.images[v]||(g=!1);this.isLoaded()||g?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){const g={};for(const v of s){this.images[v]||this.fire(new c.Event("styleimagemissing",{id:v}));const w=this.images[v];w?g[v]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:Boolean(w.userImage&&w.userImage.render)}:c.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,g)}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],g=this.getImage(s);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{const v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},w=new c.ImagePosition(v,g);this.patterns[s]={bin:v,position:w}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.Texture(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const w in this.patterns)s.push(this.patterns[w].bin);const{w:h,h:g}=c.potpack(s),v=this.atlasImage;v.resize({width:h||1,height:g||1});for(const w in this.patterns){const{bin:E}=this.patterns[w],A=E.x+1,P=E.y+1,z=this.images[w].data,O=z.width,U=z.height;c.RGBAImage.copy(z,v,{x:0,y:0},{x:A,y:P},{width:O,height:U}),c.RGBAImage.copy(z,v,{x:0,y:U-1},{x:A,y:P-1},{width:O,height:1}),c.RGBAImage.copy(z,v,{x:0,y:0},{x:A,y:P+U},{width:O,height:1}),c.RGBAImage.copy(z,v,{x:O-1,y:0},{x:A-1,y:P},{width:1,height:U}),c.RGBAImage.copy(z,v,{x:0,y:0},{x:A+O,y:P},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const g=this.images[h];le(g)&&this.updateImage(h,g)}}}const Qe=new c.Properties({anchor:new c.DataConstantProperty(c.spec.light.anchor),position:new class{constructor(){this.specification=c.spec.light.position}possiblyEvaluate(f,s){return function([h,g,v]){const w=c.degToRad(g+90),E=c.degToRad(v);return{x:h*Math.cos(w)*Math.sin(E),y:h*Math.sin(w)*Math.sin(E),z:h*Math.cos(E),azimuthal:g,polar:v}}(f.expression.evaluate(s))}interpolate(f,s,h){return{x:c.number(f.x,s.x,h),y:c.number(f.y,s.y,h),z:c.number(f.z,s.z,h),azimuthal:c.number(f.azimuthal,s.azimuthal,h),polar:c.number(f.polar,s.polar,h)}}},color:new c.DataConstantProperty(c.spec.light.color),intensity:new c.DataConstantProperty(c.spec.light.intensity)}),Gi="-transition";class ln extends c.Evented{constructor(s){super(),this._transitionable=new c.Transitionable(Qe),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(c.validateLight,s,h))for(const g in s){const v=s[g];c.endsWith(g,Gi)?this._transitionable.setTransition(g.slice(0,-Gi.length),v):this._transitionable.setValue(g,v)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||!1!==g.validate)&&c.emitValidationErrors(this,s.call(c.validateStyle,c.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}const Je=new c.Properties({source:new c.DataConstantProperty(c.spec.terrain.source),exaggeration:new c.DataConstantProperty(c.spec.terrain.exaggeration)}),Gn="-transition";class cn extends c.Evented{constructor(s,h){super(),this._transitionable=new c.Transitionable(Je),this.set(s),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(s){for(const h in s){const g=s[h];c.endsWith(h,Gn)?this._transitionable.setTransition(h.slice(0,-Gn.length),g):this._transitionable.setValue(h,g)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}}function vn(f,s,h,g){const v=c.smoothstep(45,65,h),[w,E]=_i(f,g),A=c.length(s);let P=1-Math.min(1,Math.exp((A-w)/(E-w)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*v*f.alpha}function _i(f,s){const h=.5/Math.tan(.5*s);return[f.range[0]+h,f.range[1]+h]}const ni=new c.Properties({range:new c.DataConstantProperty(c.spec.fog.range),color:new c.DataConstantProperty(c.spec.fog.color),"high-color":new c.DataConstantProperty(c.spec.fog["high-color"]),"space-color":new c.DataConstantProperty(c.spec.fog["space-color"]),"horizon-blend":new c.DataConstantProperty(c.spec.fog["horizon-blend"]),"star-intensity":new c.DataConstantProperty(c.spec.fog["star-intensity"])}),On="-transition";class Is extends c.Evented{constructor(s,h){super(),this._transitionable=new c.Transitionable(ni),this.set(s),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const s=this._transform,h="globe"===s.projection.name,g=c.globeToMercatorTransition(s.zoom),v=this.properties.get("range"),w=[.5,3];return{range:h?[c.number(w[0],v[0],g),c.number(w[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,h={}){if(!this._validate(c.validateFog,s,h)){for(const g of Object.keys(c.spec.fog))s&&void 0===s[g]&&(s[g]=c.spec.fog[g].default);for(const g in s){const v=s[g];c.endsWith(g,On)?this._transitionable.setTransition(g.slice(0,-On.length),v):this._transitionable.setValue(g,v)}}}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:c.smoothstep(45,65,s))*h.a}getOpacityAtLatLng(s,h){return this._transform.projection.supportsFog?function(g,v,w){const E=c.MercatorCoordinate.fromLngLat(v),A=w.elevation?w.elevation.getAtPointOrZero(E):0,P=[E.x,E.y,A];return c.transformMat4(P,P,w.mercatorFogMatrix),vn(g,P,w.pitch,w._fov)}(this.state,s,h):0}getFovAdjustedRange(s){return this._transform.projection.supportsFog?_i(this.state,s):[0,1]}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||!1!==g.validate)&&c.emitValidationErrors(this,s.call(c.validateStyle,c.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}class Bn{constructor(s,h){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=c.uniqueId();const g=this.workerPool.acquire(this.id);for(let v=0;v<g.length;v++){const w=new Bn.Actor(g[v],h,this.id);w.name=`Worker ${v}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,h,g){c.asyncAll(this.actors,(v,w)=>{v.send(s,h,w)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Pn(f,s,h){return s*(c.EXTENT/(f.tileSize*Math.pow(2,h-f.tileID.overscaledZ)))}Bn.Actor=c.Actor;class In{constructor(s,h,g,v){this.screenBounds=s,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(s,h){let g,v;if(s instanceof c.pointGeometry||"number"==typeof s[0]){const w=c.pointGeometry.convert(s);g=[w],v=h.isPointAboveHorizon(w)}else{const w=c.pointGeometry.convert(s[0]),E=c.pointGeometry.convert(s[1]);g=[w,E],v=c.polygonizeBounds(w,E).every(A=>h.isPointAboveHorizon(A))}return new In(g,h.getCameraPoint(),v,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(s){return c.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const h=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],v=c.polygonizeBounds(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(v[3]=this.cameraPoint)),c.bufferConvexPolygon(v,s)}bufferedCameraGeometryGlobe(s){const h=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],v=c.polygonizeBounds(h,g,s),w=this.cameraPoint.clone();switch(3*((w.y>h.y)+(w.y>g.y))+((w.x>h.x)+(w.x>g.x))){case 0:v[0]=w,v[4]=w.clone();break;case 1:v.splice(1,0,w);break;case 2:v[1]=w;break;case 3:v.splice(4,0,w);break;case 5:v.splice(2,0,w);break;case 6:v[3]=w;break;case 7:v.splice(3,0,w);break;case 8:v[2]=w}return v}containsTile(s,h,g,v=0){const w=s.queryPadding/h._pixelsPerMercatorPixel+1,E=g?this._bufferedCameraMercator(w,h):this._bufferedScreenMercator(w,h);let A=s.tileID.wrap+(E.unwrapped?v:0);const P=E.polygon.map(J=>c.getTilePoint(s.tileTransform,J,A));if(!c.polygonIntersectsBox(P,0,0,c.EXTENT,c.EXTENT))return;A=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const z=this.screenGeometryMercator.polygon.map(J=>c.getTileVec3(s.tileTransform,J,A)),O=z.map(J=>new c.pointGeometry(J[0],J[1])),U=h.getFreeCameraOptions().position||new c.MercatorCoordinate(0,0,0),q=c.getTileVec3(s.tileTransform,U,A),W=z.map(J=>{const G=c.sub(J,J,q);return c.normalize(G,G),new c.Ray(q,G)}),X=Pn(s,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:W,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(Y=c.getBounds(P),Y.min.x=c.clamp(Y.min.x,0,c.EXTENT),Y.min.y=c.clamp(Y.min.y,0,c.EXTENT),Y.max.x=c.clamp(Y.max.x,0,c.EXTENT),Y.max.y=c.clamp(Y.max.y,0,c.EXTENT),Y),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:X};var Y}_bufferedScreenMercator(s,h){const g=xs(s);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(s),h):{polygon:this.bufferedScreenGeometry(s).map(w=>h.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(s,h){const g=xs(s);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),h):{polygon:this.bufferedCameraGeometry(s).map(w=>h.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(s,h){const g=function(w,E){const A=c.multiply([],E.pixelMatrix,E.globeMatrix),P=[0,-c.GLOBE_RADIUS,0,1],z=[0,c.GLOBE_RADIUS,0,1],O=[0,0,0,1];c.transformMat4$1(P,P,A),c.transformMat4$1(z,z,A),c.transformMat4$1(O,O,A);const U=new c.pointGeometry(P[0]/P[3],P[1]/P[3]),q=new c.pointGeometry(z[0]/z[3],z[1]/z[3]),W=c.polygonContainsPoint(w,U)&&P[3]<O[3],X=c.polygonContainsPoint(w,q)&&z[3]<O[3];if(!W&&!X)return null;const Y=function(xt,Et,Lt){for(let Bt=1;Bt<xt.length;Bt++){const fe=js(Et.pointCoordinate3D(xt[Bt-1]).x),Pt=js(Et.pointCoordinate3D(xt[Bt]).x);if(Lt<0){if(fe<Pt)return{idx:Bt,t:-fe/(Pt-1-fe)}}else if(Pt<fe)return{idx:Bt,t:(1-fe)/(Pt+1-fe)}}return null}(w,E,W?-1:1);if(!Y)return null;const{idx:J,t:G}=Y;let st=J>1?Me(w.slice(0,J),E):[],it=J<w.length?Me(w.slice(J),E):[];st=st.map(xt=>new c.pointGeometry(js(xt.x),xt.y)),it=it.map(xt=>new c.pointGeometry(js(xt.x),xt.y));const rt=[...st];0===rt.length&&rt.push(it[it.length-1]);const pt=c.number(rt[rt.length-1].y,(0===it.length?st[0]:it[0]).y,G);let dt;return dt=W?[new c.pointGeometry(0,pt),new c.pointGeometry(0,0),new c.pointGeometry(1,0),new c.pointGeometry(1,pt)]:[new c.pointGeometry(1,pt),new c.pointGeometry(1,1),new c.pointGeometry(0,1),new c.pointGeometry(0,pt)],rt.push(...dt),0===it.length?rt.push(st[0]):rt.push(...it),{polygon:rt.map(xt=>new c.MercatorCoordinate(xt.x,xt.y)),unwrapped:!1}}(s,h);if(g)return g;const v=function(w,E){let A=!1,P=-1/0,z=0;for(let U=0;U<w.length-1;U++)w[U].x>P&&(P=w[U].x,z=U);for(let U=0;U<w.length-1;U++){const q=(z+U)%(w.length-1),W=w[q],X=w[q+1];Math.abs(W.x-X.x)>.5&&(W.x<X.x?(W.x+=1,0===q&&(w[w.length-1].x+=1)):(X.x+=1,q+1===w.length-1&&(w[0].x+=1)),A=!0)}const O=c.mercatorXfromLng(E.center.lng);return A&&O<Math.abs(O-1)&&w.forEach(U=>{U.x-=1}),{polygon:w,unwrapped:A}}(Me(s,h).map(w=>new c.pointGeometry(js(w.x),w.y)),h);return{polygon:v.polygon.map(w=>new c.MercatorCoordinate(w.x,w.y)),unwrapped:v.unwrapped}}}function Me(f,s){return c.resample(f,h=>{const g=s.pointCoordinate3D(h);h.x=g.x,h.y=g.y},1/256)}function js(f){return f<0?1+f%1:f%1}function xs(f){return 100*f|0}function Hi(f,s,h,g,v){const w=function(E,A){if(E)return v(E);if(A){f.url&&A.tiles&&f.tiles&&delete f.tiles;const P=c.pick(c.extend(A,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(P.vectorLayers=A.vector_layers,P.vectorLayerIds=P.vectorLayers.map(z=>z.id)),P.tiles=s.canonicalizeTileset(P,f.url),v(null,P)}};return f.url?c.getJSON(s.transformRequest(s.normalizeSourceURL(f.url,null,h,g),c.ResourceType.Source),w):c.exported.frame(()=>w(null,f))}class mn{constructor(s,h,g){this.bounds=c.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&4===s.length?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),g=Math.floor(c.mercatorXfromLng(this.bounds.getWest())*h),v=Math.floor(c.mercatorYfromLat(this.bounds.getNorth())*h),w=Math.ceil(c.mercatorXfromLng(this.bounds.getEast())*h),E=Math.ceil(c.mercatorYfromLat(this.bounds.getSouth())*h);return s.x>=g&&s.x<w&&s.y>=v&&s.y<E}}class wo{constructor(s,h,g){this.context=s;const v=s.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(g),this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const on={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Zs{constructor(s,h,g,v){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.context=s;const w=s.gl;this.buffer=w.createBuffer(),s.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let g=0;g<this.attributes.length;g++){const v=h.attributes[this.attributes[g].name];void 0!==v&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,h,g){for(let v=0;v<this.attributes.length;v++){const w=this.attributes[v],E=h.attributes[w.name];void 0!==E&&s.vertexAttribPointer(E,w.components,s[on[w.type]],!1,this.itemSize,w.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ti{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Gs extends Ti{getDefault(){return c.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class qo extends Ti{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class bl extends Ti{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Ho extends Ti{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class wl extends Ti{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Vr extends Ti{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Da extends Ti{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class so extends Ti{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class oo extends Ti{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class jr extends Ti{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Pa extends Ti{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class Tl extends Ti{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class $o extends Ti{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class Zr extends Ti{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Gr extends Ti{getDefault(){return c.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class qr extends Ti{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class vs extends Ti{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class Hr extends Ti{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Wo extends Ti{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class bs extends Ti{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class Ia extends Ti{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class $r extends Ti{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Wr extends Ti{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class fr extends Ti{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Xr extends Ti{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class To extends Ti{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class qs extends Ti{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class So extends Ti{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class Sl extends Ti{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Cl extends Ti{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class mr extends Ti{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Co extends Ti{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class Ln extends Co{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Mo extends Co{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class gr extends Mo{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Xo{constructor(s,h,g,v){this.context=s,this.width=h,this.height=g;const w=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new Ln(s,w),v&&(this.depthAttachment=new Mo(s,w))}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const g=this.depthAttachment.get();g&&s.deleteRenderbuffer(g)}s.deleteFramebuffer(this.framebuffer)}}class et{constructor(s,h=!1){if(this.gl=s,this.isWebGL2=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),h){const g=s;this.extVertexArrayObject={createVertexArrayOES:g.createVertexArray.bind(s),deleteVertexArrayOES:g.deleteVertexArray.bind(s),bindVertexArrayOES:g.bindVertexArray.bind(s)}}this.clearColor=new Gs(this),this.clearDepth=new qo(this),this.clearStencil=new bl(this),this.colorMask=new Ho(this),this.depthMask=new wl(this),this.stencilMask=new Vr(this),this.stencilFunc=new Da(this),this.stencilOp=new so(this),this.stencilTest=new oo(this),this.depthRange=new jr(this),this.depthTest=new Pa(this),this.depthFunc=new Tl(this),this.blend=new $o(this),this.blendFunc=new Zr(this),this.blendColor=new Gr(this),this.blendEquation=new qr(this),this.cullFace=new vs(this),this.cullFaceSide=new Hr(this),this.frontFace=new Wo(this),this.program=new bs(this),this.activeTexture=new Ia(this),this.viewport=new $r(this),this.bindFramebuffer=new Wr(this),this.bindRenderbuffer=new fr(this),this.bindTexture=new Xr(this),this.bindVertexBuffer=new To(this),this.bindElementBuffer=new qs(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new So(this),this.pixelStoreUnpack=new Sl(this),this.pixelStoreUnpackPremultiplyAlpha=new Cl(this),this.pixelStoreUnpackFlipY=new mr(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),h||(this.extTextureHalfFloat=s.getExtension("OES_texture_half_float")),(h||this.extTextureHalfFloat&&s.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=h||s.getExtension("OES_standard_derivatives"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new wo(this,s,h)}createVertexBuffer(s,h,g){return new Zs(this,s,h,g)}createRenderbuffer(s,h,g){const v=this.gl,w=v.createRenderbuffer();return this.bindRenderbuffer.set(w),v.renderbufferStorage(v.RENDERBUFFER,s,h,g),this.bindRenderbuffer.set(null),w}createFramebuffer(s,h,g){return new Xo(this,s,h,g)}clear({color:s,depth:h,stencil:g}){const v=this.gl;let w=0;s&&(w|=v.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(w|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==g&&(w|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),v.clear(w)}setCullFace(s){!1===s.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){p(s.blendFunction,c.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class N extends c.Evented{constructor(s,h,g,v){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.extend(this,c.pick(h,["url","scheme","tileSize","promoteId"])),this._options=c.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new c.DedupedRequest}load(s){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=Hi(this._options,this.map._requestManager,h,g,(v,w)=>{this._tileJSONRequest=null,this._loaded=!0,v?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),g&&2!==g.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new c.ErrorEvent(v))):w&&(c.extend(this,w),w.bounds&&(this.tileBounds=new mn(w.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(w.tiles,this.map._requestManager._customAccessToken),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))),s&&s(v)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return c.extend({},this._options)}loadTile(s,h){const g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(g,c.ResourceType.Tile),data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile};if(v.request.collectResourceTiming=this._collectResourceTiming,s.actor&&"expired"!==s.state)"loading"===s.state?s.reloadCallback=h:s.request=s.actor.send("reloadTile",v,w.bind(this));else if(s.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",v,w.bind(this),void 0,!0);else{const E=c.loadVectorTile.call({deduped:this._deduped},v,(A,P)=>{A||!P?w.call(this,A):(v.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},s.actor&&s.actor.send("loadTile",v,w.bind(this),void 0,!0))},!0);s.request={cancel:E}}function w(E,A){return delete s.request,s.aborted?h(null):E&&404!==E.status?h(E):(A&&A.resourceTiming&&(s.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&s.setExpiryData(A),s.loadVectorData(A,this.map.painter),c.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id})}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Z extends c.Evented{constructor(s,h,g,v){super(),this.id=s,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.extend({type:"raster"},h),c.extend(this,c.pick(h,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Hi(this._options,this.map._requestManager,null,null,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new c.ErrorEvent(h)):g&&(c.extend(this,g),g.bounds&&(this.tileBounds=new mn(g.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(g.tiles),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))),s&&s(h)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return c.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const g=c.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);s.request=c.getImage(this.map._requestManager.transformRequest(v,c.ResourceType.Tile),(w,E,A,P)=>(delete s.request,s.aborted?(s.state="unloaded",h(null)):w?(s.state="errored",h(w)):E?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:A,expires:P}),s.setTexture(E,this.map.painter),s.state="loaded",c.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(s,h,g){s.setTexture(h,g)}static unloadTileData(s,h){s.texture&&h.saveTileTexture(s.texture)}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Q;function ot(f,s,h,g,v,w,E,A){const P=[f,h,v,s,g,w,1,1,1],z=[E,A,1],O=c.adjoint([],P),[U,q,W]=c.transformMat3(z,z,c.transpose(O,O));return c.multiply$1(P,[U,0,0,0,q,0,0,0,W],P)}class yt extends c.Evented{constructor(s,h,g,v){super(),this.id=s,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=h,this._dirty=!1}load(s,h){this._loaded=h||!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=c.getImage(this.map._requestManager.transformRequest(this.url,c.ResourceType.Image),(g,v)=>{if(this._imageRequest=null,this._loaded=!0,g)this.fire(new c.ErrorEvent(g));else if(v){const{HTMLImageElement:w}=c.window;this.image=v instanceof w?c.exported.getImageData(v):v,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading()}})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(s){this.coordinates=s,this._boundsArray=void 0;const h=s.map(c.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let v=1/0,w=1/0,E=-1/0,A=-1/0;for(const U of g)v=Math.min(v,U.x),w=Math.min(w,U.y),E=Math.max(E,U.x),A=Math.max(A,U.y);const P=Math.max(E-v,A-w),z=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),O=Math.pow(2,z);return new c.CanonicalTileID(z,Math.floor((v+E)/2*O),Math.floor((w+A)/2*O))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(s){for(const P in this.tiles){const z=this.tiles[P];"loaded"!==z.state&&(z.state="loaded",z.texture=this.texture)}if(this._boundsArray)return;const h=c.tileTransform(this.tileID,this.map.transform.projection),[g,v,w,E]=this.coordinates.map(P=>{const z=h.projection.project(P[0],P[1]);return c.getTilePoint(h,z)._round()});this.perspectiveTransform=function(P,z,O,U,q,W,X,Y,J,G){const st=ot(0,0,P,0,0,z,P,z),it=ot(O,U,q,W,X,Y,J,G);return c.multiply$1(it,c.adjoint(st,st),it),[it[6]/it[8]*P/c.EXTENT,it[7]/it[8]*z/c.EXTENT]}(this.width,this.height,g.x,g.y,v.x,v.y,E.x,E.y,w.x,w.y);const A=this._boundsArray=new c.StructArrayLayout4i8;A.emplaceBack(g.x,g.y,0,0),A.emplaceBack(v.x,v.y,c.EXTENT,0),A.emplaceBack(E.x,E.y,0,c.EXTENT),A.emplaceBack(w.x,w.y,c.EXTENT,c.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=s.createVertexBuffer(A,c.boundsAttributes.members),this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const s=this.map.painter.context,h=s.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new c.Texture(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(s)}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const kt={vector:N,raster:Z,"raster-dem":class extends Z{constructor(f,s,h,g){super(f,s,h,g),this.type="raster-dem",this.maxzoom=22,this._options=c.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(f,s){const h=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,w){v&&(f.state="errored",s(v)),w&&(f.dem=w,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",s(null))}f.request=c.getImage(this.map._requestManager.transformRequest(h,c.ResourceType.Tile),function(v,w,E,A){if(delete f.request,f.aborted)f.state="unloaded",s(null);else if(v)f.state="errored",s(v);else if(w){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:E,expires:A});const P=c.window.ImageBitmap&&w instanceof c.window.ImageBitmap&&(null==Q&&(Q=c.window.OffscreenCanvas&&new c.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof c.window.createImageBitmap),Q),z=1-(w.width-c.prevPowerOfTwo(w.width))/2;z<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const O=P?w:c.exported.getImageData(w,z),U={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:O,encoding:this.encoding,padding:z};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",U,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const s=f.canonical,h=Math.pow(2,s.z),g=(s.x-1+h)%h,v=0===s.x?f.wrap-1:f.wrap,w=(s.x+1+h)%h,E=s.x+1===h?f.wrap+1:f.wrap,A={};return A[new c.OverscaledTileID(f.overscaledZ,v,s.z,g,s.y).key]={backfilled:!1},A[new c.OverscaledTileID(f.overscaledZ,E,s.z,w,s.y).key]={backfilled:!1},s.y>0&&(A[new c.OverscaledTileID(f.overscaledZ,v,s.z,g,s.y-1).key]={backfilled:!1},A[new c.OverscaledTileID(f.overscaledZ,f.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},A[new c.OverscaledTileID(f.overscaledZ,E,s.z,w,s.y-1).key]={backfilled:!1}),s.y+1<h&&(A[new c.OverscaledTileID(f.overscaledZ,v,s.z,g,s.y+1).key]={backfilled:!1},A[new c.OverscaledTileID(f.overscaledZ,f.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},A[new c.OverscaledTileID(f.overscaledZ,E,s.z,w,s.y+1).key]={backfilled:!1}),A}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends c.Evented{constructor(f,s,h,g){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=s.data,this._options=c.extend({},s),this._collectResourceTiming=s.collectResourceTiming,void 0!==s.maxzoom&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const v=c.EXTENT/this.tileSize;this.workerOptions=c.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(void 0!==s.buffer?s.buffer:128)*v,tolerance:(void 0!==s.tolerance?s.tolerance:.375)*v,extent:c.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:void 0!==s.clusterMaxZoom?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:c.EXTENT,radius:(void 0!==s.clusterRadius?s.clusterRadius:50)*v,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},s),this}getClusterChildren(f,s){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},s),this}getClusterLeaves(f,s,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:s,offset:h},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=c.extend({},this.workerOptions),s=this._data;"string"==typeof s?(f.request=this.map._requestManager.transformRequest(c.exported.resolveURL(s),c.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(h,g)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new c.ErrorEvent(h));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),this.fire(new c.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,s){const h=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(h,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,v)=>(delete f.request,f.unloadVectorData(),f.aborted?s(null):g?s(g):(f.loadVectorData(v,this.map.painter,"reloadTile"===h),s(null))),void 0,"loadTile"===h)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return c.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends yt{constructor(f,s,h,g){super(f,s,h,g),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const s of f.urls)this.urls.push(this.map._requestManager.transformRequest(s,c.ResourceType.Source).url);c.getVideo(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new c.ErrorEvent(s)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const s=this.video.seekable;f<s.start(0)||f>s.end(0)?this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,s=f.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new c.Texture(f,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:yt,canvas:class extends yt{constructor(f,s,h,g){super(f,s,h,g),s.coordinates?Array.isArray(s.coordinates)&&4===s.coordinates.length&&!s.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(w=>"number"!=typeof w))||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),s.animate&&"boolean"!=typeof s.animate&&this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),s.canvas?"string"==typeof s.canvas||s.canvas instanceof c.window.HTMLCanvasElement||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=s,this.animate=void 0===s.animate||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof c.window.HTMLCanvasElement?this.options.canvas:c.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const s=this.map.painter.context;this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.Texture(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends c.Evented{constructor(f,s,h,g){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=s,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new c.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new c.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new mn(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),c.extend(this,c.pick(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return c.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:s,y:h,z:g}=f.canonical;return this._implementation.hasTile({x:s,y:h,z:g})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,s){const{x:h,y:g,z:v}=f.tileID.canonical,w=new c.window.AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:h,y:g,z:v},{signal:w.signal})).then(function(E){return delete f.request,f.aborted?(f.state="unloaded",s(null)):void 0===E?(f.state="errored",s(null)):null===E?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",s(null)):(A=E)instanceof c.window.ImageData||A instanceof c.window.HTMLCanvasElement||A instanceof c.window.ImageBitmap||A instanceof c.window.HTMLImageElement?(this.loadTileData(f,E),f.state="loaded",void s(null)):(f.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var A}.bind(this)).catch(E=>{20!==E.code&&(f.state="errored",s(E))}),f.request.cancel=()=>w.abort()}loadTileData(f,s){Z.loadTileData(f,s,this._map.painter)}unloadTileData(f){Z.unloadTileData(f,this._map.painter)}unloadTile(f,s){if(this.unloadTileData(f),this._implementation.unloadTile){const{x:h,y:g,z:v}=f.tileID.canonical;this._implementation.unloadTile({x:h,y:g,z:v})}s()}abortTile(f,s){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}}},At=function(f,s,h,g){const v=new kt[s.type](f,s,h,g);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return c.bindAll(["load","abort","unload","serialize","prepare"],v),v};function vt(f,s){const h=c.identity([]);return c.scale(h,h,[.5*f.width,.5*-f.height,1]),c.translate(h,h,[1,-1,0]),c.multiply(h,h,f.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(h)}function It(f,s,h,g,v,w,E,A=!1){const P=f.tilesIn(g,E,A);P.sort(we);const z=[];for(const U of P)z.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(s,h,f._state,U,v,w,vt(f.transform,U.tile.tileID),A)});const O=function(U){const q={},W={};for(const X of U){const Y=X.queryResults,J=X.wrappedTileID,G=W[J]=W[J]||{};for(const st in Y){const it=Y[st],rt=G[st]=G[st]||{},pt=q[st]=q[st]||[];for(const dt of it)rt[dt.featureIndex]||(rt[dt.featureIndex]=!0,pt.push(dt))}}return q}(z);for(const U in O)O[U].forEach(q=>{const W=q.feature,X=W.layer;X&&"background"!==X.type&&"sky"!==X.type&&(W.source=X.source,X["source-layer"]&&(W.sourceLayer=X["source-layer"]),W.state=void 0!==W.id?f.getFeatureState(X["source-layer"],W.id):{})});return O}function ie(f,s){const h=f.getRenderableIds().map(w=>f.getTileByID(w)),g=[],v={};for(let w=0;w<h.length;w++){const E=h[w],A=E.tileID.canonical.key;v[A]||(v[A]=!0,E.querySourceFeatures(g,s))}return g}function we(f,s){const h=f.tileID,g=s.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}function re(){return null!=Fo.workerClass?new Fo.workerClass:new c.window.Worker(Fo.workerUrl)}const Ze="mapboxgl_preloaded_worker_pool";class Ge{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Ge.workerCount;)this.workers.push(new re);return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ze]}numActive(){return Object.keys(this.active).length}}let Ne;function We(){return Ne||(Ne=new Ge),Ne}function ei(f,s){const h={};for(const g in f)"ref"!==g&&(h[g]=f[g]);return c.refProperties.forEach(g=>{g in s&&(h[g]=s[g])}),h}function bi(f){f=f.slice();const s=Object.create(null);for(let h=0;h<f.length;h++)s[f[h].id]=f[h];for(let h=0;h<f.length;h++)"ref"in f[h]&&(f[h]=ei(f[h],s[f[h].ref]));return f}Ge.workerCount=2;const He={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Pi(f,s,h){h.push({command:He.addSource,args:[f,s[f]]})}function Ii(f,s,h){s.push({command:He.removeSource,args:[f]}),h[f]=!0}function Yo(f,s,h,g){Ii(f,h,g),Pi(f,s,h)}function Jo(f,s,h){let g;for(g in f[h])if(f[h].hasOwnProperty(g)&&"data"!==g&&!p(f[h][g],s[h][g]))return!1;for(g in s[h])if(s[h].hasOwnProperty(g)&&"data"!==g&&!p(f[h][g],s[h][g]))return!1;return!0}function Ht(f,s,h,g,v,w){let E;for(E in s=s||{},f=f||{})f.hasOwnProperty(E)&&(p(f[E],s[E])||h.push({command:w,args:[g,E,s[E],v]}));for(E in s)s.hasOwnProperty(E)&&!f.hasOwnProperty(E)&&(p(f[E],s[E])||h.push({command:w,args:[g,E,s[E],v]}))}function ws(f){return f.id}function gn(f,s){return f[s.id]=s,f}class Eo{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(1===this.points.length)return this.points[0];s=c.clamp(s,0,1);let h=1,g=this._distances[h];const v=s*this.paddedLength+this.padding;for(;g<v&&h<this._distances.length;)g=this._distances[++h];const w=h-1,E=this._distances[w],A=g-E,P=A>0?(v-E)/A:0;return this.points[w].mult(1-P).add(this.points[h].mult(P))}}class Jh{constructor(s,h,g){const v=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(h/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)v.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,g,v,w){this._forEachCell(h,g,v,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(w)}insertCircle(s,h,g,v){this._forEachCell(h-v,g-v,h+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(g),this.circles.push(v)}_insertBoxCell(s,h,g,v,w,E){this.boxCells[w].push(E)}_insertCircleCell(s,h,g,v,w,E){this.circleCells[w].push(E)}_query(s,h,g,v,w,E){if(g<0||s>this.width||v<0||h>this.height)return!w&&[];const A=[];if(s<=0&&h<=0&&this.width<=g&&this.height<=v){if(w)return!0;for(let P=0;P<this.boxKeys.length;P++)A.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const z=this.circles[3*P],O=this.circles[3*P+1],U=this.circles[3*P+2];A.push({key:this.circleKeys[P],x1:z-U,y1:O-U,x2:z+U,y2:O+U})}return E?A.filter(E):A}return this._forEachCell(s,h,g,v,this._queryCell,A,{hitTest:w,seenUids:{box:{},circle:{}}},E),w?A.length>0:A}_queryCircle(s,h,g,v,w){const E=s-g,A=s+g,P=h-g,z=h+g;if(A<0||E>this.width||z<0||P>this.height)return!v&&[];const O=[];return this._forEachCell(E,P,A,z,this._queryCellCircle,O,{hitTest:v,circle:{x:s,y:h,radius:g},seenUids:{box:{},circle:{}}},w),v?O.length>0:O}query(s,h,g,v,w){return this._query(s,h,g,v,!1,w)}hitTest(s,h,g,v,w){return this._query(s,h,g,v,!0,w)}hitTestCircle(s,h,g,v){return this._queryCircle(s,h,g,!0,v)}_queryCell(s,h,g,v,w,E,A,P){const z=A.seenUids,O=this.boxCells[w];if(null!==O){const q=this.bboxes;for(const W of O)if(!z.box[W]){z.box[W]=!0;const X=4*W;if(s<=q[X+2]&&h<=q[X+3]&&g>=q[X+0]&&v>=q[X+1]&&(!P||P(this.boxKeys[W]))){if(A.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[W],x1:q[X],y1:q[X+1],x2:q[X+2],y2:q[X+3]})}}}const U=this.circleCells[w];if(null!==U){const q=this.circles;for(const W of U)if(!z.circle[W]){z.circle[W]=!0;const X=3*W;if(this._circleAndRectCollide(q[X],q[X+1],q[X+2],s,h,g,v)&&(!P||P(this.circleKeys[W]))){if(A.hitTest)return E.push(!0),!0;{const Y=q[X],J=q[X+1],G=q[X+2];E.push({key:this.circleKeys[W],x1:Y-G,y1:J-G,x2:Y+G,y2:J+G})}}}}}_queryCellCircle(s,h,g,v,w,E,A,P){const z=A.circle,O=A.seenUids,U=this.boxCells[w];if(null!==U){const W=this.bboxes;for(const X of U)if(!O.box[X]){O.box[X]=!0;const Y=4*X;if(this._circleAndRectCollide(z.x,z.y,z.radius,W[Y+0],W[Y+1],W[Y+2],W[Y+3])&&(!P||P(this.boxKeys[X])))return E.push(!0),!0}}const q=this.circleCells[w];if(null!==q){const W=this.circles;for(const X of q)if(!O.circle[X]){O.circle[X]=!0;const Y=3*X;if(this._circlesCollide(W[Y],W[Y+1],W[Y+2],z.x,z.y,z.radius)&&(!P||P(this.circleKeys[X])))return E.push(!0),!0}}}_forEachCell(s,h,g,v,w,E,A,P){const z=this._convertToXCellCoord(s),O=this._convertToYCellCoord(h),U=this._convertToXCellCoord(g),q=this._convertToYCellCoord(v);for(let W=z;W<=U;W++)for(let X=O;X<=q;X++)if(w.call(this,s,h,g,v,this.xCellCount*X+W,E,A,P))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,g,v,w,E){const A=v-s,P=w-h,z=g+E;return z*z>A*A+P*P}_circleAndRectCollide(s,h,g,v,w,E,A){const P=(E-v)/2,z=Math.abs(s-(v+P));if(z>P+g)return!1;const O=(A-w)/2,U=Math.abs(h-(w+O));if(U>O+g)return!1;if(z<=P||U<=O)return!0;const q=z-P,W=U-O;return q*q+W*W<=g*g}}const Hs=Math.tan(85*Math.PI/180);function _r(f,s,h,g,v,w,E){const A=c.create();if(h)if("globe"===w.name){const P=c.calculateGlobeLabelMatrix(v,s);c.multiply(A,A,P)}else{const P=Jt([],E);A[0]=P[0],A[1]=P[1],A[4]=P[2],A[5]=P[3],g||c.rotateZ(A,A,v.angle)}else c.multiply(A,v.labelPlaneMatrix,f);return A}function Kh(f,s,h,g,v,w,E){const A=_r(f,s,h,g,v,w,E);return"globe"===w.name&&h||(A[2]=A[6]=A[10]=A[14]=0),A}function Ao(f,s,h,g,v,w,E){if(h){if("globe"===w.name){const A=_r(f,s,h,g,v,w,E);return c.invert(A,A),c.multiply(A,f,A),A}{const A=c.clone(f),P=c.identity([]);return P[0]=E[0],P[1]=E[1],P[4]=E[2],P[5]=E[3],c.multiply(A,A,P),g||c.rotateZ(A,A,-v.angle),A}}return v.glCoordMatrix}function xe(f,s,h,g){const v=[f,s,h,1];h?c.transformMat4$1(v,v,g):Tc(v,v,g);const w=v[3];return v[0]/=w,v[1]/=w,v[2]/=w,v}function hi(f,s){return Math.min(.5+f/s*.5,1.5)}function si(f,s){const h=f[0]/f[3],g=f[1]/f[3];return h>=-s[0]&&h<=s[0]&&g>=-s[1]&&g<=s[1]}function $s(f,s,h,g,v,w,E,A,P,z){const O=h.transform,U=g?f.textSizeData:f.iconSizeData,q=c.evaluateSizeForZoom(U,h.transform.zoom),W="globe"===O.projection.name,X=[256/h.width*2+1,256/h.height*2+1],Y=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Y.clear();let J=null;W&&(J=g?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const G=f.lineVertexArray,st=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,it=h.transform.width/h.transform.height;let rt,pt=!1;for(let dt=0;dt<st.length;dt++){const xt=st.get(dt),{numGlyphs:Et,writingMode:Lt}=xt;if(Lt!==c.WritingMode.vertical||pt||rt===c.WritingMode.horizontal||(pt=!0),rt=Lt,(xt.hidden||Lt===c.WritingMode.vertical)&&!pt){Ui(Et,Y);continue}pt=!1;const Bt=new c.pointGeometry(xt.tileAnchorX,xt.tileAnchorY);let{x:fe,y:Pt,z:Yt}=O.projection.projectTilePoint(Bt.x,Bt.y,z.canonical);if(P){const[ii,Ie,Ee]=P(Bt);fe+=ii,Pt+=Ie,Yt+=Ee}const Vt=[fe,Pt,Yt,1];if(c.transformMat4$1(Vt,Vt,s),!si(Vt,X)){Ui(Et,Y);continue}const ne=hi(h.transform.cameraToCenterDistance,Vt[3]),Ot=c.evaluateSizeForFeature(U,q,xt),wt=E?Ot/ne:Ot*ne,Nt=xe(fe,Pt,Yt,v);if(Nt[3]<=0){Ui(Et,Y);continue}let ee={};const se=E?null:P,Be=Yr(xt,wt,!1,A,s,v,w,f.glyphOffsetArray,G,Y,J,Nt,Bt,ee,it,se,O.projection,z,E);pt=Be.useVertical,se&&Be.needsFlipping&&(ee={}),(Be.notEnoughRoom||pt||Be.needsFlipping&&Yr(xt,wt,!0,A,s,v,w,f.glyphOffsetArray,G,Y,J,Nt,Bt,ee,it,se,O.projection,z,E).notEnoughRoom)&&Ui(Et,Y)}g?(f.text.dynamicLayoutVertexBuffer.updateData(Y),J&&f.text.globeExtVertexBuffer.updateData(J)):(f.icon.dynamicLayoutVertexBuffer.updateData(Y),J&&f.icon.globeExtVertexBuffer.updateData(J))}function Ko(f,s,h,g,v,w,E,A,P,z,O,U,q,W,X,Y){const{lineStartIndex:J,glyphStartIndex:G,segment:st}=A,it=G+A.numGlyphs,rt=J+A.lineLength,pt=s.getoffsetX(G),dt=s.getoffsetX(it-1),xt=qn(f*pt,h,g,v,w,E,st,J,rt,P,z,O,U,q,!0,W,X,Y);if(!xt)return null;const Et=qn(f*dt,h,g,v,w,E,st,J,rt,P,z,O,U,q,!0,W,X,Y);return Et?{first:xt,last:Et}:null}function ai(f,s,h,g){return f===c.WritingMode.horizontal&&Math.abs(g)>Math.abs(h)?{useVertical:!0}:f===c.WritingMode.vertical?g>0?{needsFlipping:!0}:null:0!==s&&(0===(v=h)||Math.abs(g/v)>Hs)?1===s?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null;var v}function Yr(f,s,h,g,v,w,E,A,P,z,O,U,q,W,X,Y,J,G,st){const it=s/24,rt=f.lineOffsetX*it,pt=f.lineOffsetY*it,{lineStartIndex:dt,glyphStartIndex:xt,numGlyphs:Et,segment:Lt,writingMode:Bt,flipState:fe}=f,Pt=dt+f.lineLength,Yt=Vt=>{if(O){const[Nt,ee,se]=Vt.up,Be=z.length;c.updateGlobeVertexNormal(O,Be+0,Nt,ee,se),c.updateGlobeVertexNormal(O,Be+1,Nt,ee,se),c.updateGlobeVertexNormal(O,Be+2,Nt,ee,se),c.updateGlobeVertexNormal(O,Be+3,Nt,ee,se)}const[ne,Ot,wt]=Vt.point;c.addDynamicAttributes(z,ne,Ot,wt,Vt.angle)};if(Et>1){const Vt=Ko(it,A,rt,pt,h,U,q,f,P,w,W,Y,!1,J,G,st);if(!Vt)return{notEnoughRoom:!0};if(g&&!h){let[ne,Ot,wt]=Vt.first.point,[Nt,ee,se]=Vt.last.point;[ne,Ot]=xe(ne,Ot,wt,E),[Nt,ee]=xe(Nt,ee,se,E);const Be=ai(Bt,fe,(Nt-ne)*X,ee-Ot);if(f.flipState=Be&&Be.needsFlipping?1:2,Be)return Be}Yt(Vt.first);for(let ne=xt+1;ne<xt+Et-1;ne++){const Ot=qn(it*A.getoffsetX(ne),rt,pt,h,U,q,Lt,dt,Pt,P,w,W,Y,!1,!1,J,G,st);if(!Ot)return z.length-=4*(ne-xt),{notEnoughRoom:!0};Yt(Ot)}Yt(Vt.last)}else{if(g&&!h){const ne=xe(q.x,q.y,0,v),Ot=dt+Lt+1,wt=new c.pointGeometry(P.getx(Ot),P.gety(Ot)),Nt=xe(wt.x,wt.y,0,v),ee=Nt[3]>0?Nt:Jr(q,wt,ne,1,v,void 0,J,G.canonical),se=ai(Bt,fe,(ee[0]-ne[0])*X,ee[1]-ne[1]);if(f.flipState=se&&se.needsFlipping?1:2,se)return se}const Vt=qn(it*A.getoffsetX(xt),rt,pt,h,U,q,Lt,dt,Pt,P,w,W,Y,!1,!1,J,G,st);if(!Vt)return{notEnoughRoom:!0};Yt(Vt)}return{}}function La(f,s,h,g,v){const{x:w,y:E,z:A}=g.projectTilePoint(f.x,f.y,s);if(!v)return xe(w,E,A,h);const[P,z,O]=v(f);return xe(w+P,E+z,A+O,h)}function Jr(f,s,h,g,v,w,E,A){const P=La(f.sub(s)._unit()._add(f),A,v,E,w);return c.sub(P,h,P),c.normalize(P,P),c.scaleAndAdd(P,h,P,g)}function qn(f,s,h,g,v,w,E,A,P,z,O,U,q,W,X,Y,J,G){const st=g?f-s:f+s;let it=st>0?1:-1,rt=0;g&&(it*=-1,rt=Math.PI),it<0&&(rt+=Math.PI);let pt=A+E+(it>0?0:1)|0,dt=v,xt=v,Et=0,Lt=0;const Bt=Math.abs(st),fe=[],Pt=[];let Yt=w,Vt=Yt;const ne=()=>Jr(Vt,Yt,xt,Bt-Et+1,O,q,Y,J.canonical);for(;Et+Lt<=Bt;){if(pt+=it,pt<A||pt>=P)return null;if(xt=dt,Vt=Yt,fe.push(xt),W&&Pt.push(Vt),Yt=new c.pointGeometry(z.getx(pt),z.gety(pt)),dt=U[pt],!dt){const Ee=La(Yt,J.canonical,O,Y,q);dt=Ee[3]>0?U[pt]=Ee:ne()}Et+=Lt,Lt=c.distance(xt,dt)}X&&q&&(U[pt]&&(dt=ne(),Lt=c.distance(xt,dt)),U[pt]=dt);const Ot=(Bt-Et)/Lt,wt=Yt.sub(Vt)._mult(Ot)._add(Vt),Nt=c.sub([],dt,xt),ee=c.scaleAndAdd([],xt,Nt,Ot);let se=[0,0,1],Be=Nt[0],ii=Nt[1];if(G&&(se=Y.upVector(J.canonical,wt.x,wt.y),0!==se[0]||0!==se[1]||1!==se[2])){const Ee=[se[2],0,-se[0]],Ue=c.cross([],se,Ee);c.normalize(Ee,Ee),c.normalize(Ue,Ue),Be=c.dot(Nt,Ee),ii=c.dot(Nt,Ue)}if(h){const Ee=c.cross([],se,Nt);c.normalize(Ee,Ee),c.scaleAndAdd(ee,ee,Ee,h*it)}const Ie=rt+Math.atan2(ii,Be);return fe.push(ee),W&&Pt.push(wt),{point:ee,angle:Ie,path:fe,tilePath:Pt,up:se}}function Ui(f,s){const h=s.length,g=h+4*f;s.resize(g),s.float32.fill(-1/0,4*h,4*g)}function Tc(f,s,h){const g=s[0],v=s[1];return f[0]=h[0]*g+h[4]*v+h[12],f[1]=h[1]*g+h[5]*v+h[13],f[3]=h[3]*g+h[7]*v+h[15],f}const Ts=100;class Sc{constructor(s,h,g=new Jh(s.width+200,s.height+200,25),v=new Jh(s.width+200,s.height+200,25)){this.transform=s,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Ts,this.screenBottomBoundary=s.height+Ts,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=h}placeCollisionBox(s,h,g,v,w,E,A,P){let z=g.projectedAnchorX,O=g.projectedAnchorY,U=g.projectedAnchorZ;const q=g.elevation,W=g.tileID,X=s.getProjection();if(q&&W){const[dt,xt,Et]=X.upVector(W.canonical,g.tileAnchorX,g.tileAnchorY),Lt=X.upVectorScale(W.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=dt*q*Lt,O+=xt*q*Lt,U+=Et*q*Lt}const Y=this.projectAndGetPerspectiveRatio(A,z,O,U,g.tileID,"globe"===X.name||!!q||this.transform.pitch>0,X),J=E*Y.perspectiveRatio,G=(g.x1*h+v.x-g.padding)*J+Y.point.x,st=(g.y1*h+v.y-g.padding)*J+Y.point.y,it=(g.x2*h+v.x+g.padding)*J+Y.point.x,rt=(g.y2*h+v.y+g.padding)*J+Y.point.y,pt=Y.perspectiveRatio<=.55||Y.occluded;return!this.isInsideGrid(G,st,it,rt)||!w&&this.grid.hitTest(G,st,it,rt,P)||pt?{box:[],offscreen:!1,occluded:Y.occluded}:{box:[G,st,it,rt],offscreen:this.isOffscreen(G,st,it,rt),occluded:!1}}placeCollisionCircles(s,h,g,v,w,E,A,P,z,O,U,q,W,X,Y){const J=[],G=this.transform.elevation,st=s.getProjection(),it=G?G.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,st):null,rt=new c.pointGeometry(g.tileAnchorX,g.tileAnchorY);let{x:pt,y:dt,z:xt}=st.projectTilePoint(rt.x,rt.y,Y.canonical);if(it){const[wt,Nt,ee]=it(rt);pt+=wt,dt+=Nt,xt+=ee}const Et="globe"===st.name,Lt=this.projectAndGetPerspectiveRatio(A,pt,dt,xt,Y,Et||!!G||this.transform.pitch>0,st),{perspectiveRatio:Bt}=Lt,fe=(U?E/Bt:E*Bt)/c.ONE_EM,Pt=xe(pt,dt,xt,P),Yt=Lt.signedDistanceFromCamera>0?Ko(fe,w,g.lineOffsetX*fe,g.lineOffsetY*fe,!1,Pt,rt,g,v,P,{},G&&!U?it:null,U&&!!G,st,Y,U):null;let Vt=!1,ne=!1,Ot=!0;if(Yt&&!Lt.occluded){const wt=.5*W*Bt+X,Nt=new c.pointGeometry(-100,-100),ee=new c.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),se=new Eo,{first:Be,last:ii}=Yt,Ie=Be.path.length;let Ee=[];for(let je=Ie-1;je>=1;je--)Ee.push(Be.path[je]);for(let je=1;je<ii.path.length;je++)Ee.push(ii.path[je]);const Ue=2.5*wt;z&&(Ee=Ee.map(([je,xi,Ei],Ni)=>(it&&!Et&&(Ei=it(Ni<Ie-1?Be.tilePath[Ie-1-Ni]:ii.tilePath[Ni-Ie+2])[2]),xe(je,xi,Ei,z))),Ee.some(je=>je[3]<=0)&&(Ee=[]));let ri=[];if(Ee.length>0){let je=1/0,xi=-1/0,Ei=1/0,Ni=-1/0;for(const zi of Ee)je=Math.min(je,zi[0]),Ei=Math.min(Ei,zi[1]),xi=Math.max(xi,zi[0]),Ni=Math.max(Ni,zi[1]);xi>=Nt.x&&je<=ee.x&&Ni>=Nt.y&&Ei<=ee.y&&(ri=[Ee.map(zi=>new c.pointGeometry(zi[0],zi[1]))],(je<Nt.x||xi>ee.x||Ei<Nt.y||Ni>ee.y)&&(ri=c.clipLine(ri,Nt.x,Nt.y,ee.x,ee.y)))}for(const je of ri){se.reset(je,.25*wt);let xi=0;xi=se.length<=.5*wt?1:Math.ceil(se.paddedLength/Ue)+1;for(let Ei=0;Ei<xi;Ei++){const Ni=Ei/Math.max(xi-1,1),zi=se.lerp(Ni),Wi=zi.x+Ts,ds=zi.y+Ts;J.push(Wi,ds,wt,0);const Js=Wi-wt,ts=ds-wt,Xi=Wi+wt,Di=ds+wt;if(Ot=Ot&&this.isOffscreen(Js,ts,Xi,Di),ne=ne||this.isInsideGrid(Js,ts,Xi,Di),!h&&this.grid.hitTestCircle(Wi,ds,wt,q)&&(Vt=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Vt,occluded:!1}}}}return{circles:!O&&Vt||!ne?[]:J,offscreen:Ot,collisionDetected:Vt,occluded:Lt.occluded}}queryRenderedSymbols(s){if(0===s.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let g=1/0,v=1/0,w=-1/0,E=-1/0;for(const O of s){const U=new c.pointGeometry(O.x+Ts,O.y+Ts);g=Math.min(g,U.x),v=Math.min(v,U.y),w=Math.max(w,U.x),E=Math.max(E,U.y),h.push(U)}const A=this.grid.query(g,v,w,E).concat(this.ignoredGrid.query(g,v,w,E)),P={},z={};for(const O of A){const U=O.key;if(void 0===P[U.bucketInstanceId]&&(P[U.bucketInstanceId]={}),P[U.bucketInstanceId][U.featureIndex])continue;const q=[new c.pointGeometry(O.x1,O.y1),new c.pointGeometry(O.x2,O.y1),new c.pointGeometry(O.x2,O.y2),new c.pointGeometry(O.x1,O.y2)];c.polygonIntersectsPolygon(h,q)&&(P[U.bucketInstanceId][U.featureIndex]=!0,void 0===z[U.bucketInstanceId]&&(z[U.bucketInstanceId]=[]),z[U.bucketInstanceId].push(U.featureIndex))}return z}insertCollisionBox(s,h,g,v,w){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:w},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,g,v,w){const E=h?this.ignoredGrid:this.grid,A={bucketInstanceId:g,featureIndex:v,collisionGroupID:w};for(let P=0;P<s.length;P+=4)E.insertCircle(A,s[P],s[P+1],s[P+2])}projectAndGetPerspectiveRatio(s,h,g,v,w,E,A){const P=[h,g,v,1];let z=!1;v||this.transform.pitch>0?(c.transformMat4$1(P,P,s),this.fogState&&w&&"globe"!==A.name&&(z=function(W,X,Y,J,G,st){const it=st.calculateFogTileMatrix(G),rt=[X,Y,J];return c.transformMat4(rt,rt,it),vn(W,rt,st.pitch,st._fov)}(this.fogState,h,g,v,w.toUnwrapped(),this.transform)>.9)):Tc(P,P,s);const O=P[3];return{point:new c.pointGeometry((P[0]/O+1)/2*this.transform.width+Ts,(-P[1]/O+1)/2*this.transform.height+Ts),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/O*.5,1.5),signedDistanceFromCamera:O,occluded:E&&P[2]>O||z}}isOffscreen(s,h,g,v){return g<Ts||s>=this.screenRightBoundary||v<Ts||h>this.screenBottomBoundary}isInsideGrid(s,h,g,v){return g>=0&&s<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=c.identity([]);return c.translate(s,s,[-100,-100,0]),s}}function Kr(f,s,h){const g=s.createTileMatrix(f,f.worldSize,h.toUnwrapped());return c.multiply(new Float32Array(16),f.projMatrix,g)}function Cc(f,s,h){if(s.projection.name===h.projection.name)return f.projMatrix;const g=h.clone();return g.setProjection(s.projection),Kr(g,s.getProjection(),f)}function Mc(f,s,h){return s.name===h.projection.name?f.projMatrix:Kr(h,s,f)}class Ra{constructor(s,h,g,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):v&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class yr{constructor(s,h,g,v,w,E=!1){this.text=new Ra(s?s.text:null,h,g,w),this.icon=new Ra(s?s.icon:null,h,v,w),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qr{constructor(s,h,g,v=!1){this.text=s,this.icon=h,this.skipFade=g,this.clipped=v}}class ls{constructor(){this.invProjMatrix=c.create(),this.viewportMatrix=c.create(),this.circles=[]}}class cs{constructor(s,h,g,v,w){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=w}}class pn{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[s]}}function Ec(f,s,h,g,v){const{horizontalAlign:w,verticalAlign:E}=c.getAnchorAlignment(f),A=-(w-.5)*s,P=-(E-.5)*h,z=c.evaluateVariableOffset(f,g);return new c.pointGeometry(A+z[0]*v,P+z[1]*v)}function ta(f,s,h,g,v){const w=new c.pointGeometry(f,s);return h&&w._rotate(g?v:-v),w}class Ss{constructor(s,h,g,v,w){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new Sc(this.transform,w),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new pn(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,g,v){const w=g.getBucket(h),E=g.latestFeatureIndex;if(!w||!E||h.id!==w.layerIds[0])return;const A=w.layers[0].layout,P=g.collisionBoxArray,z=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),O=g.tileSize/c.EXTENT,U=g.tileID.toUnwrapped();this.transform.setProjection(w.projection);const q=(W=g.tileID,X=w.getProjection(),Y=this.transform,X.name===this.projection?Y.calculateProjMatrix(W.toUnwrapped()):Kr(Y,X,W));var W,X,Y;const J="map"===A.get("text-pitch-alignment"),G="map"===A.get("text-rotation-alignment");h.compileFilter();const st=h.dynamicFilter(),it=h.dynamicFilterNeedsFeature(),rt=this.transform.calculatePixelsToTileUnitsMatrix(g),pt=Kh(q,g.tileID.canonical,J,G,this.transform,w.getProjection(),rt);let dt=null;if(J){const Lt=Ao(q,g.tileID.canonical,J,G,this.transform,w.getProjection(),rt);dt=c.multiply([],this.transform.labelPlaneMatrix,Lt)}let xt=null;st&&g.latestFeatureIndex&&(xt={unwrappedTileID:U,dynamicFilter:st,dynamicFilterNeedsFeature:it,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new cs(w.bucketInstanceId,E,w.sourceLayerIndex,w.index,g.tileID);const Et={bucket:w,layout:A,posMatrix:q,textLabelPlaneMatrix:pt,labelToScreenMatrix:dt,clippingData:xt,scale:z,textPixelRatio:O,holdingForFade:g.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:c.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:c.evaluateSizeForZoom(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(v)for(const Lt of w.sortKeyRanges){const{sortKey:Bt,symbolInstanceStart:fe,symbolInstanceEnd:Pt}=Lt;s.push({sortKey:Bt,symbolInstanceStart:fe,symbolInstanceEnd:Pt,parameters:Et})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Et})}attemptAnchorPlacement(s,h,g,v,w,E,A,P,z,O,U,q,W,X,Y,J,G,st){const{textOffset0:it,textOffset1:rt,crossTileID:pt}=q,dt=[it,rt],xt=Ec(s,g,v,dt,w),Et=this.collisionIndex.placeCollisionBox(X,w,h,ta(xt.x,xt.y,E,A,this.transform.angle),U,P,z,O.predicate);if(J){const Lt=X.getSymbolInstanceIconSize(st,this.transform.zoom,q.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(X,Lt,J,ta(xt.x,xt.y,E,A,this.transform.angle),U,P,z,O.predicate).box.length)return}if(Et.box.length>0){let Lt;return this.prevPlacement&&this.prevPlacement.variableOffsets[pt]&&this.prevPlacement.placements[pt]&&this.prevPlacement.placements[pt].text&&(Lt=this.prevPlacement.variableOffsets[pt].anchor),this.variableOffsets[pt]={textOffset:dt,width:g,height:v,anchor:s,textScale:w,prevAnchor:Lt},this.markUsedJustification(X,s,q,Y),X.allowVerticalPlacement&&(this.markUsedOrientation(X,Y,q),this.placedOrientations[pt]=Y),{shift:xt,placedGlyphBoxes:Et}}}placeLayerBucketPart(s,h,g,v){const{bucket:w,layout:E,posMatrix:A,textLabelPlaneMatrix:P,labelToScreenMatrix:z,clippingData:O,textPixelRatio:U,holdingForFade:q,collisionBoxArray:W,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:Y,collisionGroup:J}=s.parameters,G=E.get("text-optional"),st=E.get("icon-optional"),it=E.get("text-allow-overlap"),rt=E.get("icon-allow-overlap"),pt="map"===E.get("text-rotation-alignment"),dt="map"===E.get("text-pitch-alignment"),xt="none"!==E.get("icon-text-fit"),Et="viewport-y"===E.get("symbol-z-order");this.transform.setProjection(w.projection);let Lt=it&&(rt||!w.hasIconData()||st),Bt=rt&&(it||!w.hasTextData()||G);!w.collisionArrays&&W&&w.deserializeCollisionBoxes(W),g&&v&&w.updateCollisionDebugBuffers(this.transform.zoom,W);const fe=(Pt,Yt,Vt)=>{const{crossTileID:ne,numVerticalGlyphVertices:Ot}=Pt;if(O){const Xi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Di=null;if(O.dynamicFilterNeedsFeature){const wi=this.retainedQueryData[w.bucketInstanceId];Di=O.featureIndex.loadFeature({featureIndex:Pt.featureIndex,bucketIndex:wi.bucketIndex,sourceLayerIndex:wi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(Xi,Di,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new c.pointGeometry(Pt.tileAnchorX,Pt.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[ne]=new Qr(!1,!1,!1,!0),void(h[ne]=!0)}if(h[ne])return;if(q)return void(this.placements[ne]=new Qr(!1,!1,!1));let wt=!1,Nt=!1,ee=!0,se=!1,Be=!1,ii=null,Ie={box:null,offscreen:null,occluded:null},Ee={box:null,offscreen:null,occluded:null},Ue=null,ri=null,je=null,xi=0,Ei=0,Ni=0;Vt.textFeatureIndex?xi=Vt.textFeatureIndex:Pt.useRuntimeCollisionCircles&&(xi=Pt.featureIndex),Vt.verticalTextFeatureIndex&&(Ei=Vt.verticalTextFeatureIndex);const zi=Xi=>{Xi.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Di=this.transform.elevation;(Di||Xi.elevation)&&(Xi.elevation=Di?Di.getAtTileOffset(Xi.tileID,Xi.tileAnchorX,Xi.tileAnchorY):0)},Wi=Vt.textBox;if(Wi){zi(Wi);const Xi=wi=>{let un=c.WritingMode.horizontal;if(w.allowVerticalPlacement&&!wi&&this.prevPlacement){const $n=this.prevPlacement.placedOrientations[ne];$n&&(this.placedOrientations[ne]=$n,un=$n,this.markUsedOrientation(w,un,Pt))}return un},Di=(wi,un)=>{if(w.allowVerticalPlacement&&Ot>0&&Vt.verticalTextBox){for(const $n of w.writingModes)if($n===c.WritingMode.vertical?(Ie=un(),Ee=Ie):Ie=wi(),Ie&&Ie.box&&Ie.box.length)break}else Ie=wi()};if(E.get("text-variable-anchor")){let wi=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ne]){const Vi=this.prevPlacement.variableOffsets[ne];wi.indexOf(Vi.anchor)>0&&(wi=wi.filter(xn=>xn!==Vi.anchor),wi.unshift(Vi.anchor))}const un=(Vi,xn,Wn)=>{const cr=w.getSymbolInstanceTextSize(X,Pt,this.transform.zoom,Yt),ya=(Vi.x2-Vi.x1)*cr+2*Vi.padding,Es=(Vi.y2-Vi.y1)*cr+2*Vi.padding,Vn=xt&&!rt?xn:null;Vn&&zi(Vn);let fo={box:[],offscreen:!1,occluded:!1};const Uo=it?2*wi.length:wi.length;for(let No=0;No<Uo;++No){const Mr=this.attemptAnchorPlacement(wi[No%wi.length],Vi,ya,Es,cr,pt,dt,U,A,J,No>=wi.length,Pt,Yt,w,Wn,Vn,X,Y);if(Mr&&(fo=Mr.placedGlyphBoxes,fo&&fo.box&&fo.box.length)){wt=!0,ii=Mr.shift;break}}return fo};Di(()=>un(Wi,Vt.iconBox,c.WritingMode.horizontal),()=>{const Vi=Vt.verticalTextBox;return Vi&&zi(Vi),w.allowVerticalPlacement&&!(Ie&&Ie.box&&Ie.box.length)&&Ot>0&&Vi?un(Vi,Vt.verticalIconBox,c.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Ie&&(wt=Ie.box,ee=Ie.offscreen,se=Ie.occluded);const $n=Xi(Ie&&Ie.box);if(!wt&&this.prevPlacement){const Vi=this.prevPlacement.variableOffsets[ne];Vi&&(this.variableOffsets[ne]=Vi,this.markUsedJustification(w,Vi.anchor,Pt,$n))}}else{const wi=(un,$n)=>{const Vi=w.getSymbolInstanceTextSize(X,Pt,this.transform.zoom,Yt),xn=this.collisionIndex.placeCollisionBox(w,Vi,un,new c.pointGeometry(0,0),it,U,A,J.predicate);return xn&&xn.box&&xn.box.length&&(this.markUsedOrientation(w,$n,Pt),this.placedOrientations[ne]=$n),xn};Di(()=>wi(Wi,c.WritingMode.horizontal),()=>{const un=Vt.verticalTextBox;return w.allowVerticalPlacement&&Ot>0&&un?(zi(un),wi(un,c.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Xi(Ie&&Ie.box&&Ie.box.length)}}if(Ue=Ie,wt=Ue&&Ue.box&&Ue.box.length>0,ee=Ue&&Ue.offscreen,se=Ue&&Ue.occluded,Pt.useRuntimeCollisionCircles){const Xi=w.text.placedSymbolArray.get(Pt.centerJustifiedTextSymbolIndex>=0?Pt.centerJustifiedTextSymbolIndex:Pt.verticalPlacedTextSymbolIndex),Di=c.evaluateSizeForFeature(w.textSizeData,X,Xi),wi=E.get("text-padding");ri=this.collisionIndex.placeCollisionCircles(w,it,Xi,w.lineVertexArray,w.glyphOffsetArray,Di,A,P,z,g,dt,J.predicate,Pt.collisionCircleDiameter*Di/c.ONE_EM,wi,this.retainedQueryData[w.bucketInstanceId].tileID),wt=it||ri.circles.length>0&&!ri.collisionDetected,ee=ee&&ri.offscreen,se=ri.occluded}if(Vt.iconFeatureIndex&&(Ni=Vt.iconFeatureIndex),Vt.iconBox){const Xi=Di=>{zi(Di);const wi=xt&&ii?ta(ii.x,ii.y,pt,dt,this.transform.angle):new c.pointGeometry(0,0),un=w.getSymbolInstanceIconSize(Y,this.transform.zoom,Pt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,un,Di,wi,rt,U,A,J.predicate)};Ee&&Ee.box&&Ee.box.length&&Vt.verticalIconBox?(je=Xi(Vt.verticalIconBox),Nt=je.box.length>0):(je=Xi(Vt.iconBox),Nt=je.box.length>0),ee=ee&&je.offscreen,Be=je.occluded}const ds=G||0===Pt.numHorizontalGlyphVertices&&0===Ot,Js=st||0===Pt.numIconVertices;if(ds||Js?Js?ds||(Nt=Nt&&wt):wt=Nt&&wt:Nt=wt=Nt&&wt,wt&&Ue&&Ue.box&&this.collisionIndex.insertCollisionBox(Ue.box,E.get("text-ignore-placement"),w.bucketInstanceId,Ee&&Ee.box&&Ei?Ei:xi,J.ID),Nt&&je&&this.collisionIndex.insertCollisionBox(je.box,E.get("icon-ignore-placement"),w.bucketInstanceId,Ni,J.ID),ri&&(wt&&this.collisionIndex.insertCollisionCircles(ri.circles,E.get("text-ignore-placement"),w.bucketInstanceId,xi,J.ID),g)){const Xi=w.bucketInstanceId;let Di=this.collisionCircleArrays[Xi];void 0===Di&&(Di=this.collisionCircleArrays[Xi]=new ls);for(let wi=0;wi<ri.circles.length;wi+=4)Di.circles.push(ri.circles[wi+0]),Di.circles.push(ri.circles[wi+1]),Di.circles.push(ri.circles[wi+2]),Di.circles.push(ri.collisionDetected?1:0)}const ts="globe"!==w.projection.name;Lt=Lt&&(ts||!se),Bt=Bt&&(ts||!Be),this.placements[ne]=new Qr(wt||Lt,Nt||Bt,ee||w.justReloaded),h[ne]=!0};if(Et){const Pt=w.getSortedSymbolIndexes(this.transform.angle);for(let Yt=Pt.length-1;Yt>=0;--Yt){const Vt=Pt[Yt];fe(w.symbolInstances.get(Vt),Vt,w.collisionArrays[Vt])}}else for(let Pt=s.symbolInstanceStart;Pt<s.symbolInstanceEnd;Pt++)fe(w.symbolInstances.get(Pt),Pt,w.collisionArrays[Pt]);if(g&&w.bucketInstanceId in this.collisionCircleArrays){const Pt=this.collisionCircleArrays[w.bucketInstanceId];c.invert(Pt.invProjMatrix,A),Pt.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(s,h,g,v){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:P,crossTileID:z}=g,O=c.getAnchorJustification(h),U=v===c.WritingMode.vertical?P:"left"===O?w:"center"===O?E:"right"===O?A:-1;w>=0&&(s.text.placedSymbolArray.get(w).crossTileID=U>=0&&w!==U?0:z),E>=0&&(s.text.placedSymbolArray.get(E).crossTileID=U>=0&&E!==U?0:z),A>=0&&(s.text.placedSymbolArray.get(A).crossTileID=U>=0&&A!==U?0:z),P>=0&&(s.text.placedSymbolArray.get(P).crossTileID=U>=0&&P!==U?0:z)}markUsedOrientation(s,h,g){const v=h===c.WritingMode.horizontal||h===c.WritingMode.horizontalOnly?h:0,w=h===c.WritingMode.vertical?h:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:z}=g,O=s.text.placedSymbolArray;E>=0&&(O.get(E).placedOrientation=v),A>=0&&(O.get(A).placedOrientation=v),P>=0&&(O.get(P).placedOrientation=v),z>=0&&(O.get(z).placedOrientation=w)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const v=h?h.symbolFadeChange(s):1,w=h?h.opacities:{},E=h?h.variableOffsets:{},A=h?h.placedOrientations:{};for(const P in this.placements){const z=this.placements[P],O=w[P];O?(this.opacities[P]=new yr(O,v,z.text,z.icon,null,z.clipped),g=g||z.text!==O.text.placed||z.icon!==O.icon.placed):(this.opacities[P]=new yr(null,v,z.text,z.icon,z.skipFade,z.clipped),g=g||z.text||z.icon)}for(const P in w){const z=w[P];if(!this.opacities[P]){const O=new yr(z,v,!1,!1);O.isHidden()||(this.opacities[P]=O,g=g||z.text.placed||z.icon.placed)}}for(const P in E)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=E[P]);for(const P in A)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=A[P]);g?this.lastPlacementChangeTime=s:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const g={};for(const v of h){const w=v.getBucket(s);w&&v.latestFeatureIndex&&s.id===w.layerIds[0]&&this.updateBucketOpacities(w,g,v.collisionBoxArray)}}updateBucketOpacities(s,h,g){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const v=s.layers[0].layout,w=!!s.layers[0].dynamicFilter(),E=new yr(null,0,!1,!1,!0),A=v.get("text-allow-overlap"),P=v.get("icon-allow-overlap"),z=v.get("text-variable-anchor"),O="map"===v.get("text-rotation-alignment"),U="map"===v.get("text-pitch-alignment"),q="none"!==v.get("icon-text-fit"),W=new yr(null,0,A&&(P||!s.hasIconData()||v.get("icon-optional")),P&&(A||!s.hasTextData()||v.get("text-optional")),!0);!s.collisionArrays&&g&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(g);const X=(J,G,st)=>{for(let it=0;it<G/4;it++)J.opacityVertexArray.emplaceBack(st)};let Y=0;for(let J=0;J<s.symbolInstances.length;J++){const G=s.symbolInstances.get(J),{numHorizontalGlyphVertices:st,numVerticalGlyphVertices:it,crossTileID:rt,numIconVertices:pt}=G;let dt=this.opacities[rt];h[rt]?dt=E:dt||(dt=W,this.opacities[rt]=dt),h[rt]=!0;const xt=st>0||it>0,Et=pt>0,Lt=this.placedOrientations[rt],Bt=Lt===c.WritingMode.vertical,fe=Lt===c.WritingMode.horizontal||Lt===c.WritingMode.horizontalOnly;if(!xt&&!Et||dt.isHidden()||Y++,xt){const Pt=El(dt.text);X(s.text,st,Bt?ia:Pt),X(s.text,it,fe?ia:Pt);const Yt=dt.text.isHidden(),{leftJustifiedTextSymbolIndex:Vt,centerJustifiedTextSymbolIndex:ne,rightJustifiedTextSymbolIndex:Ot,verticalPlacedTextSymbolIndex:wt}=G,Nt=s.text.placedSymbolArray,ee=Yt||Bt?1:0;Vt>=0&&(Nt.get(Vt).hidden=ee),ne>=0&&(Nt.get(ne).hidden=ee),Ot>=0&&(Nt.get(Ot).hidden=ee),wt>=0&&(Nt.get(wt).hidden=Yt||fe?1:0);const se=this.variableOffsets[rt];se&&this.markUsedJustification(s,se.anchor,G,Lt);const Be=this.placedOrientations[rt];Be&&(this.markUsedJustification(s,"left",G,Be),this.markUsedOrientation(s,Be,G))}if(Et){const Pt=El(dt.icon),{placedIconSymbolIndex:Yt,verticalPlacedIconSymbolIndex:Vt}=G,ne=s.icon.placedSymbolArray,Ot=dt.icon.isHidden()?1:0;Yt>=0&&(X(s.icon,pt,Bt?ia:Pt),ne.get(Yt).hidden=Ot),Vt>=0&&(X(s.icon,G.numVerticalIconVertices,fe?ia:Pt),ne.get(Vt).hidden=Ot)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Pt=s.collisionArrays[J];if(Pt){let Yt=new c.pointGeometry(0,0),Vt=!0;if(Pt.textBox||Pt.verticalTextBox){if(z){const Ot=this.variableOffsets[rt];Ot?(Yt=Ec(Ot.anchor,Ot.width,Ot.height,Ot.textOffset,Ot.textScale),O&&Yt._rotate(U?this.transform.angle:-this.transform.angle)):Vt=!1}w&&(Vt=!dt.clipped),Pt.textBox&&Jn(s.textCollisionBox.collisionVertexArray,dt.text.placed,!Vt||Bt,Yt.x,Yt.y),Pt.verticalTextBox&&Jn(s.textCollisionBox.collisionVertexArray,dt.text.placed,!Vt||fe,Yt.x,Yt.y)}const ne=Vt&&Boolean(!fe&&Pt.verticalIconBox);Pt.iconBox&&Jn(s.iconCollisionBox.collisionVertexArray,dt.icon.placed,ne,q?Yt.x:0,q?Yt.y:0),Pt.verticalIconBox&&Jn(s.iconCollisionBox.collisionVertexArray,dt.icon.placed,!ne,q?Yt.x:0,q?Yt.y:0)}}}if(s.fullyClipped=0===Y,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=J.invProjMatrix,s.placementViewportMatrix=J.viewportMatrix,s.collisionCircleArray=J.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return 0===this.fadeDuration?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function Jn(f,s,h,g,v){f.emplaceBack(s?1:0,h?1:0,g||0,v||0),f.emplaceBack(s?1:0,h?1:0,g||0,v||0),f.emplaceBack(s?1:0,h?1:0,g||0,v||0),f.emplaceBack(s?1:0,h?1:0,g||0,v||0)}const Qh=Math.pow(2,25),Ml=Math.pow(2,24),_n=Math.pow(2,17),za=Math.pow(2,16),ea=Math.pow(2,9),Oa=Math.pow(2,8),Fn=Math.pow(2,1);function El(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const s=f.placed?1:0,h=Math.floor(127*f.opacity);return h*Qh+s*Ml+h*_n+s*za+h*ea+s*Oa+h*Fn+s}const ia=0;class ko{constructor(s){this._sortAcrossTiles="viewport-y"!==s.layout.get("symbol-z-order")&&void 0!==s.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,g,v,w){const E=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(E,v,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((A,P)=>A.sortKey-P.sortKey));this._currentPartIndex<E.length;){const A=E[this._currentPartIndex];if(h.placeLayerBucketPart(A,this._seenCrossTileIDs,g,0===A.symbolInstanceStart),this._currentPartIndex++,w())return!0}return!1}}class Ba{constructor(s,h,g,v,w,E,A,P){this.placement=new Ss(s,w,E,A,P),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,h,g){const v=c.exported.now(),w=()=>{const E=c.exported.now()-v;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=h[s[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=A)&&(!E.maxzoom||E.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new ko(E)),this._inProgressLayer.continuePlacement(g[E.source],this.placement,this._showCollisionBoxes,E,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Al=512/c.EXTENT/2;class fd{constructor(s,h,g){this.tileID=s,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(let v=0;v<h.length;v++){const w=h.get(v),E=w.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,s)})}}getScaledCoordinates(s,h){const g=Al/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*c.EXTENT+s.tileAnchorX)*g),y:Math.floor((h.canonical.y*c.EXTENT+s.tileAnchorY)*g)}}findMatches(s,h,g){const v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let w=0;w<s.length;w++){const E=s.get(w);if(E.crossTileID)continue;const A=this.indexedSymbolInstances[E.key];if(!A)continue;const P=this.getScaledCoordinates(E,h);for(const z of A)if(Math.abs(z.coord.x-P.x)<=v&&Math.abs(z.coord.y-P.y)<=v&&!g[z.crossTileID]){g[z.crossTileID]=!0,E.crossTileID=z.crossTileID;break}}}}class kl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class xr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(0!==h)for(const g in this.indexes){const v=this.indexes[g],w={};for(const E in v){const A=v[E];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),w[A.tileID.key]=A}this.indexes[g]=w}this.lng=s}addBucket(s,h,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let w=0;w<h.symbolInstances.length;w++)h.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const v=this.usedCrossTileIDs[s.overscaledZ];for(const w in this.indexes){const E=this.indexes[w];if(Number(w)>s.overscaledZ)for(const A in E){const P=E[A];P.tileID.isChildOf(s)&&P.findMatches(h.symbolInstances,s,v)}else{const A=E[s.scaledTo(Number(w)).key];A&&A.findMatches(h.symbolInstances,s,v)}}for(let w=0;w<h.symbolInstances.length;w++){const E=h.symbolInstances.get(w);E.crossTileID||(E.crossTileID=g.generate(),v[E.crossTileID]=!0)}return void 0===this.indexes[s.overscaledZ]&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new fd(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const g in h.indexedSymbolInstances)for(const v of h.indexedSymbolInstances[g])delete this.usedCrossTileIDs[s][v.crossTileID]}removeStaleBuckets(s){let h=!1;for(const g in this.indexes){const v=this.indexes[g];for(const w in v)s[v[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[w]),delete v[w],h=!0)}return h}}class Ac{constructor(){this.layerIndexes={},this.crossTileIDs=new kl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,g,v){let w=this.layerIndexes[s.id];void 0===w&&(w=this.layerIndexes[s.id]=new xr);let E=!1;const A={};"globe"!==v.name&&w.handleWrapJump(g);for(const P of h){const z=P.getBucket(s);z&&s.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(P.tileID,z,this.crossTileIDs)&&(E=!0),A[z.bucketInstanceId]=!0)}return w.removeStaleBuckets(A)&&(E=!0),E}pruneUnusedLayers(s){const h={};s.forEach(g=>{h[g]=!0});for(const g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}const Fa=(f,s)=>c.emitValidationErrors(f,s&&s.filter(h=>"source.canvas"!==h.identifier)),na=c.pick(He,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Do=c.pick(He,["setCenter","setZoom","setBearing","setPitch"]),sa={version:8,layers:[],sources:{}},vr={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ls extends c.Evented{constructor(s,h={}){super(),this.map=s,this.dispatcher=new Bn(We(),this),this.imageManager=new ze,this.imageManager.setEventedParent(this),this.glyphManager=new c.GlyphManager(s._requestManager,h.localFontFamily?c.LocalGlyphMode.all:h.localIdeographFontFamily?c.LocalGlyphMode.ideographs:c.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new Ac,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.getReferrer());const g=this;this._rtlTextPluginCallback=Ls.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(w,E)=>{if(c.triggerPluginCompletionEvent(w),E&&E.every(A=>A))for(const A in g._sourceCaches){const P=g._sourceCaches[A],z=P.getSource().type;"vector"!==z&&"geojson"!==z||P.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const w=this.getSource(v.sourceId);if(w&&w.vectorLayerIds)for(const E in this._layers){const A=this._layers[E];A.source===w.id&&this._validateLayer(A)}})}loadURL(s,h={}){this.fire(new c.Event("dataloading",{dataType:"style"}));const g="boolean"==typeof h.validate?h.validate:!c.isMapboxURL(s);s=this.map._requestManager.normalizeStyleURL(s,h.accessToken);const v=this.map._requestManager.transformRequest(s,c.ResourceType.Style);this._request=c.getJSON(v,(w,E)=>{this._request=null,w?this.fire(new c.ErrorEvent(w)):E&&this._load(E,g)})}loadJSON(s,h={}){this.fire(new c.Event("dataloading",{dataType:"style"})),this._request=c.exported.frame(()=>{this._request=null,this._load(s,!1!==h.validate)})}loadEmpty(){this.fire(new c.Event("dataloading",{dataType:"style"})),this._load(sa,!1)}_updateLayerCount(s,h){const g=h?1:-1;s.is3D()&&(this._num3DLayers+=g),"circle"===s.type&&(this._numCircleLayers+=g),"symbol"===s.type&&(this._numSymbolLayers+=g)}_load(s,h){if(h&&Fa(this,c.validateStyle(s)))return;this._loaded=!0,this.stylesheet=c.clone$1(s),this._updateMapProjection();for(const v in s.sources)this.addSource(v,s.sources[v],{validate:!1});this._changed=!1,s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(s.glyphs);const g=bi(this.stylesheet.layers);this._order=g.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of g)v=c.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ln(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new c.Event("data",{dataType:"style"})),this.fire(new c.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(s){this._spriteRequest=function(h,g,v){let w,E,A;const P=c.exported.devicePixelRatio>1?"@2x":"";let z=c.getJSON(g.transformRequest(g.normalizeSpriteURL(h,P,".json"),c.ResourceType.SpriteJSON),(q,W)=>{z=null,A||(A=q,w=W,U())}),O=c.getImage(g.transformRequest(g.normalizeSpriteURL(h,P,".png"),c.ResourceType.SpriteImage),(q,W)=>{O=null,A||(A=q,E=W,U())});function U(){if(A)v(A);else if(w&&E){const q=c.exported.getImageData(E),W={};for(const X in w){const{width:Y,height:J,x:G,y:st,sdf:it,pixelRatio:rt,stretchX:pt,stretchY:dt,content:xt}=w[X],Et=new c.RGBAImage({width:Y,height:J});c.RGBAImage.copy(q,Et,{x:G,y:st},{x:0,y:0},{width:Y,height:J}),W[X]={data:Et,pixelRatio:rt,sdf:it,stretchX:pt,stretchY:dt,content:xt}}v(null,W)}}return{cancel(){z&&(z.cancel(),z=null),O&&(O.cancel(),O=null)}}}(s,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new c.ErrorEvent(h));else if(g)for(const v in g)this.imageManager.addImage(v,g[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new c.Event("data",{dataType:"style"}))})}_validateLayer(s){const h=this.getSource(s.source);if(!h)return;const g=s.sourceLayer;g&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(g))&&this.fire(new c.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const h=[];for(const g of s){const v=this._layers[g];"custom"!==v.type&&h.push(v.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(s){return!!this.terrain&&("function"==typeof s.isLayerDraped?s.isLayerDraped():vr[s.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(s){if(!this._loaded)return;const h=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(v.length||w.length)&&this._updateWorkerLayers(v,w);for(const E in this._updatedSources){const A=this._updatedSources[E];"reload"===A?this._reloadSource(E):"clear"===A&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(s);this.light.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._resetUpdates()}const g={};for(const v in this._sourceCaches){const w=this._sourceCaches[v];g[v]=w.used,w.used=!1}for(const v of this._order){const w=this._layers[v];if(w.recalculate(s,this._availableImages),!w.isHidden(s.zoom)){const A=this._getLayerSourceCache(w);A&&(A.used=!0)}const E=this.map.painter;if(E){const A=w.getProgramIds();if(!A)continue;const P=w.getProgramConfiguration(s.zoom);for(const z of A)E.useProgram(z,P)}}for(const v in g){const w=this._sourceCaches[v];g[v]!==w.used&&w.getSource().fire(new c.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new c.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(s){if(this._checkLoaded(),Fa(this,c.validateStyle(s)))return!1;(s=c.clone$1(s)).layers=bi(s.layers);const h=function(v,w){if(!v)return[{command:He.setStyle,args:[w]}];let E=[];try{if(!p(v.version,w.version))return[{command:He.setStyle,args:[w]}];p(v.center,w.center)||E.push({command:He.setCenter,args:[w.center]}),p(v.zoom,w.zoom)||E.push({command:He.setZoom,args:[w.zoom]}),p(v.bearing,w.bearing)||E.push({command:He.setBearing,args:[w.bearing]}),p(v.pitch,w.pitch)||E.push({command:He.setPitch,args:[w.pitch]}),p(v.sprite,w.sprite)||E.push({command:He.setSprite,args:[w.sprite]}),p(v.glyphs,w.glyphs)||E.push({command:He.setGlyphs,args:[w.glyphs]}),p(v.transition,w.transition)||E.push({command:He.setTransition,args:[w.transition]}),p(v.light,w.light)||E.push({command:He.setLight,args:[w.light]}),p(v.fog,w.fog)||E.push({command:He.setFog,args:[w.fog]}),p(v.projection,w.projection)||E.push({command:He.setProjection,args:[w.projection]});const A={},P=[];!function(U,q,W,X){let Y;for(Y in q=q||{},U=U||{})U.hasOwnProperty(Y)&&(q.hasOwnProperty(Y)||Ii(Y,W,X));for(Y in q)q.hasOwnProperty(Y)&&(U.hasOwnProperty(Y)?p(U[Y],q[Y])||("geojson"===U[Y].type&&"geojson"===q[Y].type&&Jo(U,q,Y)?W.push({command:He.setGeoJSONSourceData,args:[Y,q[Y].data]}):Yo(Y,q,W,X)):Pi(Y,q,W))}(v.sources,w.sources,P,A);const z=[];v.layers&&v.layers.forEach(U=>{U.source&&A[U.source]?E.push({command:He.removeLayer,args:[U.id]}):z.push(U)});let O=v.terrain;O&&A[O.source]&&(E.push({command:He.setTerrain,args:[void 0]}),O=void 0),E=E.concat(P),p(O,w.terrain)||E.push({command:He.setTerrain,args:[w.terrain]}),function(U,q,W){q=q||[];const X=(U=U||[]).map(ws),Y=q.map(ws),J=U.reduce(gn,{}),G=q.reduce(gn,{}),st=X.slice(),it=Object.create(null);let rt,pt,dt,xt,Et,Lt,Bt;for(rt=0,pt=0;rt<X.length;rt++)dt=X[rt],G.hasOwnProperty(dt)?pt++:(W.push({command:He.removeLayer,args:[dt]}),st.splice(st.indexOf(dt,pt),1));for(rt=0,pt=0;rt<Y.length;rt++)dt=Y[Y.length-1-rt],st[st.length-1-rt]!==dt&&(J.hasOwnProperty(dt)?(W.push({command:He.removeLayer,args:[dt]}),st.splice(st.lastIndexOf(dt,st.length-pt),1)):pt++,Lt=st[st.length-rt],W.push({command:He.addLayer,args:[G[dt],Lt]}),st.splice(st.length-rt,0,dt),it[dt]=!0);for(rt=0;rt<Y.length;rt++)if(dt=Y[rt],xt=J[dt],Et=G[dt],!it[dt]&&!p(xt,Et))if(p(xt.source,Et.source)&&p(xt["source-layer"],Et["source-layer"])&&p(xt.type,Et.type)){for(Bt in Ht(xt.layout,Et.layout,W,dt,null,He.setLayoutProperty),Ht(xt.paint,Et.paint,W,dt,null,He.setPaintProperty),p(xt.filter,Et.filter)||W.push({command:He.setFilter,args:[dt,Et.filter]}),p(xt.minzoom,Et.minzoom)&&p(xt.maxzoom,Et.maxzoom)||W.push({command:He.setLayerZoomRange,args:[dt,Et.minzoom,Et.maxzoom]}),xt)xt.hasOwnProperty(Bt)&&"layout"!==Bt&&"paint"!==Bt&&"filter"!==Bt&&"metadata"!==Bt&&"minzoom"!==Bt&&"maxzoom"!==Bt&&(0===Bt.indexOf("paint.")?Ht(xt[Bt],Et[Bt],W,dt,Bt.slice(6),He.setPaintProperty):p(xt[Bt],Et[Bt])||W.push({command:He.setLayerProperty,args:[dt,Bt,Et[Bt]]}));for(Bt in Et)Et.hasOwnProperty(Bt)&&!xt.hasOwnProperty(Bt)&&"layout"!==Bt&&"paint"!==Bt&&"filter"!==Bt&&"metadata"!==Bt&&"minzoom"!==Bt&&"maxzoom"!==Bt&&(0===Bt.indexOf("paint.")?Ht(xt[Bt],Et[Bt],W,dt,Bt.slice(6),He.setPaintProperty):p(xt[Bt],Et[Bt])||W.push({command:He.setLayerProperty,args:[dt,Bt,Et[Bt]]}))}else W.push({command:He.removeLayer,args:[dt]}),Lt=st[st.lastIndexOf(dt)+1],W.push({command:He.addLayer,args:[Et,Lt]})}(z,w.layers,E)}catch(A){console.warn("Unable to compute style diff:",A),E=[{command:He.setStyle,args:[w]}]}return E}(this.serialize(),s).filter(v=>!(v.command in Do));if(0===h.length)return!1;const g=h.filter(v=>!(v.command in na));if(g.length>0)throw new Error(`Unimplemented: ${g.map(v=>v.command).join(", ")}.`);return h.forEach(v=>{"setTransition"!==v.command&&"setProjection"!==v.command&&this[v.command].apply(this,v.args)}),this.stylesheet=s,this._updateMapProjection(),!0}addImage(s,h){return this.getImage(s)?this.fire(new c.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,h),this._afterImageUpdated(s),this)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s),this._afterImageUpdated(s),this):this.fire(new c.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(s,h,g={}){if(this._checkLoaded(),void 0!==this.getSource(s))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(c.validateSource,`sources.${s}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const v=At(s,h,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(s),source:v.serialize(),sourceId:s}));const w=E=>{const A=(E?"symbol:":"other:")+s,P=this._sourceCaches[A]=new c.SourceCache(A,v,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[s]=P,P.style=this,P.onAdd(this.map)};w(!1),"vector"!==h.type&&"geojson"!==h.type||w(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(s){this._checkLoaded();const h=this.getSource(s);if(!h)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===s)return this.fire(new c.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===s)return this.fire(new c.ErrorEvent(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(s);for(const v of g)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new c.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(s,h){this._checkLoaded(),this.getSource(s).setData(h),this._changed=!0}getSource(s){const h=this._getSourceCache(s);return h&&h.getSource()}_getSources(){const s=[];for(const h in this._otherSourceCaches){const g=this._getSourceCache(h);g&&s.push(g.getSource())}return s}addLayer(s,h,g={}){this._checkLoaded();const v=s.id;if(this.getLayer(v))return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let w;if("custom"===s.type){if(Fa(this,c.validateCustomStyleLayer(s)))return;w=c.createStyleLayer(s)}else{if("object"==typeof s.source&&(this.addSource(v,s.source),s=c.clone$1(s),s=c.extend(s,{source:v})),this._validate(c.validateLayer,`layers.${v}`,s,{arrayIndex:-1},g))return;w=c.createStyleLayer(s),this._validateLayer(w),w.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0)}const E=h?this._order.indexOf(h):this._order.length;if(h&&-1===E)return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(E,0,v),this._layerOrderChanged=!0,this._layers[v]=w;const A=this._getLayerSourceCache(w);if(this._removedLayers[v]&&w.source&&A&&"custom"!==w.type){const P=this._removedLayers[v];delete this._removedLayers[v],P.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",A.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new c.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const g=this._order.indexOf(s);this._order.splice(g,1);const v=h?this._order.indexOf(h):this._order.length;h&&-1===v?this.fire(new c.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(v,0,s),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new c.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const g=this._order.indexOf(s);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}hasLayerType(s){for(const h in this._layers)if(this._layers[h].type===s)return!0;return!1}setLayerZoomRange(s,h,g){this._checkLoaded();const v=this.getLayer(s);v?v.minzoom===h&&v.maxzoom===g||(null!=h&&(v.minzoom=h),null!=g&&(v.maxzoom=g),this._updateLayer(v)):this.fire(new c.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(s,h,g={}){this._checkLoaded();const v=this.getLayer(s);if(v){if(!p(v.filter,h))return null==h?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(c.validateFilter,`layers.${v.id}.filter`,h,{layerType:v.type},g)||(v.filter=c.clone$1(h),this._updateLayer(v)))}else this.fire(new c.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be filtered.`)))}getFilter(s){const h=this.getLayer(s);return h&&c.clone$1(h.filter)}setLayoutProperty(s,h,g,v={}){this._checkLoaded();const w=this.getLayer(s);w?p(w.getLayoutProperty(h),g)||(w.setLayoutProperty(h,g,v),this._updateLayer(w)):this.fire(new c.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(s,h){const g=this.getLayer(s);if(g)return g.getLayoutProperty(h);this.fire(new c.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style.`)))}setPaintProperty(s,h,g,v={}){this._checkLoaded();const w=this.getLayer(s);w?p(w.getPaintProperty(h),g)||(w.setPaintProperty(h,g,v)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new c.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(s,h){const g=this.getLayer(s);return g&&g.getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const g=s.source,v=s.sourceLayer,w=this.getSource(g);if(!w)return void this.fire(new c.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const E=w.type;if("geojson"===E&&v)return void this.fire(new c.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!v)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===s.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(g);for(const P of A)P.setFeatureState(v,s.id,h)}removeFeatureState(s,h){this._checkLoaded();const g=s.source,v=this.getSource(g);if(!v)return void this.fire(new c.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const w=v.type,E="vector"===w?s.sourceLayer:void 0;if("vector"===w&&!E)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof s.id&&"number"!=typeof s.id)return void this.fire(new c.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(g);for(const P of A)P.removeFeatureState(E,s.id,h)}getFeatureState(s){this._checkLoaded();const h=s.source,g=s.sourceLayer,v=this.getSource(h);if(v){if("vector"!==v.type||g)return void 0===s.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(g,s.id);this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new c.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const s={};for(const h in this._sourceCaches){const g=this._sourceCaches[h].getSource();s[g.id]||(s[g.id]=g.serialize())}return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:s,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(s){this._updatedLayers[s.id]=!0;const h=this._getLayerSourceCache(s);s.source&&!this._updatedSources[s.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[s.source]="reload",h.pause()),this._changed=!0,s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const h=E=>"fill-extrusion"===this._layers[E].type,g={},v=[];for(let E=this._order.length-1;E>=0;E--){const A=this._order[E];if(h(A)){g[A]=E;for(const P of s){const z=P[A];if(z)for(const O of z)v.push(O)}}}v.sort((E,A)=>A.intersectionZ-E.intersectionZ);const w=[];for(let E=this._order.length-1;E>=0;E--){const A=this._order[E];if(h(A))for(let P=v.length-1;P>=0;P--){const z=v[P].feature;if(g[z.layer.id]<E)break;w.push(z),v.pop()}else for(const P of s){const z=P[A];if(z)for(const O of z)w.push(O.feature)}}return w}queryRenderedFeatures(s,h,g){h&&h.filter&&this._validate(c.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new c.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of h.layers){const z=this._layers[P];if(!z)return this.fire(new c.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];v[z.source]=!0}}const w=[];h.availableImages=this._availableImages;const E=h&&h.layers?h.layers.some(P=>{const z=this.getLayer(P);return z&&z.is3D()}):this.has3DLayers(),A=In.createFromScreenPoints(s,g);for(const P in this._sourceCaches){const z=this._sourceCaches[P].getSource().id;h.layers&&!v[z]||w.push(It(this._sourceCaches[P],this._layers,this._serializedLayers,A,h,g,E,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(P,z,O,U,q,W,X){const Y={},J=W.queryRenderedSymbols(U),G=[];for(const st of Object.keys(J).map(Number))G.push(X[st]);G.sort(we);for(const st of G){const it=st.featureIndex.lookupSymbolFeatures(J[st.bucketInstanceId],z,st.bucketIndex,st.sourceLayerIndex,q.filter,q.layers,q.availableImages,P);for(const rt in it){const pt=Y[rt]=Y[rt]||[],dt=it[rt];dt.sort((xt,Et)=>{const Lt=st.featureSortOrder;if(Lt){const Bt=Lt.indexOf(xt.featureIndex);return Lt.indexOf(Et.featureIndex)-Bt}return Et.featureIndex-xt.featureIndex});for(const xt of dt)pt.push(xt)}}for(const st in Y)Y[st].forEach(it=>{const rt=it.feature,pt=O(P[st]).getFeatureState(rt.layer["source-layer"],rt.id);rt.source=rt.layer.source,rt.layer["source-layer"]&&(rt.sourceLayer=rt.layer["source-layer"]),rt.state=pt});return Y}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(s,h){h&&h.filter&&this._validate(c.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const g=this._getSourceCaches(s);let v=[];for(const w of g)v=v.concat(ie(w,h));return v}addSourceType(s,h,g){return Ls.getSourceType(s)?g(new Error(`A source type called "${s}" already exists.`)):(Ls.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const E in s)if(!p(s[E],g[E])){v=!0;break}if(!v)return;const w=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(s,h),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(s,h=1){if(this._checkLoaded(),!s)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===h){if("object"==typeof s.source){const g="terrain-dem-src";this.addSource(g,s.source),s=c.clone$1(s),s=c.extend(s,{source:g})}if(this._validate(c.validateTerrain,"terrain",s))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode)this._createTerrain(s,h);else{const g=this.terrain,v=g.get();for(const w of Object.keys(c.spec.terrain))!s.hasOwnProperty(w)&&c.spec.terrain[w].default&&(s[w]=c.spec.terrain[w].default);for(const w in s)if(!p(s[w],v[w])){g.set(s),this.stylesheet.terrain=s;const E=this._setTransitionParameters({duration:0});g.updateTransitions(E);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const h=this.fog=new Is(s,this.map.transform);this.stylesheet.fog=s;const g=this._setTransitionParameters({duration:0});h.updateTransitions(g)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,g=h.get();0===Object.keys(s).length&&h.set(s);for(const v in s)if(!p(s[v],g[v])){h.set(s),this.stylesheet.fog=s;const w=this._setTransitionParameters({duration:0});h.updateTransitions(w);break}}else this._createFog(s);this._markersNeedUpdate=!0}_setTransitionParameters(s){return{now:c.exported.now(),transition:c.extend(s,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const s=this._order.filter(g=>this.isLayerDraped(this._layers[g])),h=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...h)}_createTerrain(s,h){const g=this.terrain=new cn(s,h);this.stylesheet.terrain=s,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const v=this._setTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(const s in this._layers){const h=this._layers[s];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const h=this._layers[s];"symbol"===h.type&&this._updateLayer(h)}}_validate(s,h,g,v,w={}){return(!w||!1!==w.validate)&&Fa(this,s.call(c.validateStyle,c.extend({key:h,style:this.serialize(),value:g,styleSpec:c.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this._sourceCaches)this._sourceCaches[s].clearTiles(),this._sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){const h=this._getSourceCaches(s);for(const g of h)g.clearTiles()}_reloadSource(s){const h=this._getSourceCaches(s);for(const g of h)g.resume(),g.reload()}_reloadSources(){for(const s of this._getSources())s.reload&&s.reload()}_updateSources(s){for(const h in this._sourceCaches)this._sourceCaches[h].update(s)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const h=this._sourceCaches[s];h.resume(),h.reload()}}_updatePlacement(s,h,g,v,w=!1){let E=!1,A=!1;const P={};for(const z of this._order){const O=this._layers[z];if("symbol"!==O.type)continue;if(!P[O.source]){const q=this._getLayerSourceCache(O);if(!q)continue;P[O.source]=q.getRenderableIds(!0).map(W=>q.getTileByID(W)).sort((W,X)=>X.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan(X.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(O,P[O.source],s.center.lng,s.projection);E=E||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),w=w||this._layerOrderChanged||0===g,this._layerOrderChanged&&this.fire(new c.Event("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.exported.now(),s.zoom))&&(this.pauseablePlacement=new Ba(s,this._order,w,h,g,v,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.exported.now()),A=!0),E&&this.pauseablePlacement.placement.setStale()),A||E)for(const z of this._order){const O=this._layers[z];"symbol"===O.type&&this.placement.updateLayerOpacities(O,P[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.exported.now())}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();const v=w=>{w&&w.setDependencies(h.tileID.key,h.type,h.icons)};v(this._otherSourceCaches[h.source]),v(this._symbolSourceCaches[h.source])}getGlyphs(s,h,g){this.glyphManager.getGlyphs(h.stacks,g)}getResource(s,h,g){return c.makeRequest(h,g)}_getSourceCache(s){return this._otherSourceCaches[s]}_getLayerSourceCache(s){return"symbol"===s.type?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}_getSourceCaches(s){const h=[];return this._otherSourceCaches[s]&&h.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&h.push(this._symbolSourceCaches[s]),h}_isSourceCacheLoaded(s){const h=this._getSourceCaches(s);return 0===h.length?(this.fire(new c.ErrorEvent(new Error(`There is no source with ID '${s}'`))),!1):h.every(g=>g.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ls.getSourceType=function(f){return kt[f]},Ls.setSourceType=function(f,s){kt[f]=s},Ls.registerForPluginStateChange=c.registerForPluginStateChange;var Ua="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",kc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",md="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Na="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",gd="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Dl={},Po={};const Rn=[];Cs(Ua,Rn),Cs(md,Rn),Cs(Na,Rn),Cs(gd,Rn),Dl=Si("",md),Po=Si(gd,Na);const br=Si("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Pl=Ua,oa="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Qo={background:Si("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Si("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Si("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Si("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Si("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Si("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Si("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Si("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Si("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Si("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Si("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Si("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Si("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Si("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Si("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Si("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Si("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Si("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Si("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Si("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Si("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Si("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Si("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Si("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Si("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Si("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",kc),skyboxGradient:Si("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",kc),skyboxCapture:Si("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Si("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Si("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Cs(f,s){const h=f.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let g of h)if(g=g.trim(),"#"===g[0]&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=g.split(" ");for(const w of v)s.includes(w)||s.push(w)}}function Si(f,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=s.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),v={},w=[...Rn];return Cs(f,w),Cs(s,w),{fragmentSource:f=f.replace(h,(E,A,P,z,O)=>(v[O]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${O}\nvarying ${P} ${z} ${O};\n#else\nuniform ${P} ${z} u_${O};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${O}\n    ${P} ${z} ${O} = u_${O};\n#endif\n`)),vertexSource:s=s.replace(h,(E,A,P,z,O)=>{const U="float"===z?"vec2":"vec4",q=O.match(/color/)?"color":U;return v[O]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${O}\nuniform lowp float u_${O}_t;\nattribute ${P} ${U} a_${O};\nvarying ${P} ${z} ${O};\n#else\nuniform ${P} ${z} u_${O};\n#endif\n`:"vec4"===q?`\n#ifndef HAS_UNIFORM_u_${O}\n    ${O} = a_${O};\n#else\n    ${P} ${z} ${O} = u_${O};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${O}\n    ${O} = unpack_mix_${q}(a_${O}, u_${O}_t);\n#else\n    ${P} ${z} ${O} = u_${O};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${O}\nuniform lowp float u_${O}_t;\nattribute ${P} ${U} a_${O};\n#else\nuniform ${P} ${z} u_${O};\n#endif\n`:"vec4"===q?`\n#ifndef HAS_UNIFORM_u_${O}\n    ${P} ${z} ${O} = a_${O};\n#else\n    ${P} ${z} ${O} = u_${O};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${O}\n    ${P} ${z} ${O} = unpack_mix_${q}(a_${O}, u_${O}_t);\n#else\n    ${P} ${z} ${O} = u_${O};\n#endif\n`}),staticAttributes:g,usedDefines:w}}class ro{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,h,g,v,w,E,A){this.context=s;let P=this.boundPaintVertexBuffers.length!==v.length;for(let O=0;!P&&O<v.length;O++)this.boundPaintVertexBuffers[O]!==v[O]&&(P=!0);let z=this.boundDynamicVertexBuffers.length!==A.length;for(let O=0;!z&&O<A.length;O++)this.boundDynamicVertexBuffers[O]!==A[O]&&(z=!0);if(!s.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||P||z||this.boundIndexBuffer!==w||this.boundVertexOffset!==E)this.freshBind(h,g,v,w,E,A);else{s.bindVertexArrayOES.set(this.vao);for(const O of A)O&&O.bind();w&&w.dynamicDraw&&w.bind()}}freshBind(s,h,g,v,w,E){let A;const P=s.numAttributes,z=this.context,O=z.gl;if(z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=z.extVertexArrayObject.createVertexArrayOES(),z.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=E;else{A=z.currentNumAttributes||0;for(let U=P;U<A;U++)O.disableVertexAttribArray(U)}h.enableAttributes(O,s),h.bind(),h.setVertexAttribPointers(O,s,w);for(const U of g)U.enableAttributes(O,s),U.bind(),U.setVertexAttribPointers(O,s,w);for(const U of E)U&&(U.enableAttributes(O,s),U.bind(),U.setVertexAttribPointers(O,s,w));v&&v.bind(),z.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ke(f,s){const h=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new c.MercatorCoordinate(0,g/h).toLngLat().lat,new c.MercatorCoordinate(0,(g+1)/h).toLngLat().lat]}function ao(f,s,h,g,v,w,E){const A=f.context,P=A.gl,z=h.fbo;if(!z)return;f.prepareDrawTile();const O=f.useProgram("hillshade");A.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,z.colorAttachment.get());const U=((Y,J,G,st)=>{const it=G.paint.get("hillshade-shadow-color"),rt=G.paint.get("hillshade-highlight-color"),pt=G.paint.get("hillshade-accent-color");let dt=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===G.paint.get("hillshade-illumination-anchor")&&(dt-=Y.transform.angle);const xt=!Y.options.moving;return{u_matrix:st||Y.transform.calculateProjMatrix(J.tileID.toUnwrapped(),xt),u_image:0,u_latrange:ke(0,J.tileID),u_light:[G.paint.get("hillshade-exaggeration"),dt],u_shadow:it,u_highlight:rt,u_accent:pt}})(f,h,g,f.terrain?s.projMatrix:null);f.prepareDrawProgram(A,O,s.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:W,tileBoundsSegments:X}=f.getTileBoundsBuffers(h);O.draw(A,P.TRIANGLES,v,w,E,c.CullFaceMode.disabled,U,g.id,q,W,X)}function Ms(f,s,h){if(!s.needsDEMTextureUpload)return;const g=f.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||f.getTileTexture(h.stride);const w=h.getPixels();s.demTexture?s.demTexture.update(w,{premultiply:!1}):s.demTexture=new c.Texture(g,w,v.RGBA,{premultiply:!1}),s.needsDEMTextureUpload=!1}function tr(f,s,h,g,v,w){const E=f.context,A=E.gl;if(!s.dem)return;const P=s.dem;if(E.activeTexture.set(A.TEXTURE1),Ms(f,s,P),!s.demTexture)return;s.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const z=P.dim;E.activeTexture.set(A.TEXTURE0);let O=s.fbo;if(!O){const X=new c.Texture(E,{width:z,height:z,data:null},A.RGBA);X.bind(A.LINEAR,A.CLAMP_TO_EDGE),O=s.fbo=E.createFramebuffer(z,z,!0),O.colorAttachment.set(X.texture)}E.bindFramebuffer.set(O.framebuffer),E.viewport.set([0,0,z,z]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:q,tileBoundsSegments:W}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(E,A.TRIANGLES,g,v,w,c.CullFaceMode.disabled,((X,Y)=>{const J=Y.stride,G=c.create();return c.ortho(G,0,c.EXTENT,-c.EXTENT,0,0,1),c.translate(G,G,[0,-c.EXTENT,0]),{u_matrix:G,u_image:1,u_dimension:[J,J],u_zoom:X.overscaledZ,u_unpack:Y.unpackVector}})(s.tileID,P),h.id,U,q,W),s.needsHillshadePrepare=!1}const Dc=f=>({u_matrix:new c.UniformMatrix4f(f),u_image0:new c.Uniform1i(f),u_skirt_height:new c.Uniform1f(f)}),lo=(f,s)=>({u_matrix:f,u_image0:0,u_skirt_height:s}),Rs=(f,s,h,g,v,w,E,A,P,z,O,U,q,W,X)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:h,u_zoom_transition:v,u_merc_center:w,u_image0:0,u_frustum_tl:E,u_frustum_tr:A,u_frustum_br:P,u_frustum_bl:z,u_globe_pos:O,u_globe_radius:U,u_viewport:q,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:W});function Il(f,s){return null!=f&&null!=s&&!(!f.hasData()||!s.hasData())&&null!=f.demTexture&&null!=s.demTexture&&f.tileID.key!==s.tileID.key}const An=new class{constructor(){this.operations={}}newMorphing(f,s,h,g,v){if(f in this.operations){const w=this.operations[f];w.to.tileID.key!==h.tileID.key&&(w.queued=h)}else this.operations[f]={startTime:g,phase:0,duration:v,from:s,to:h,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const s=this.operations[f];return{from:s.from,to:s.to,phase:s.phase}}update(f){for(const s in this.operations){const h=this.operations[s];for(h.phase=(f-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,f)){delete this.operations[s];break}}}_nextOp(f,s){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=s,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Io={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ll(f){return 6*Math.pow(1.5,22-f)}function Pc(f,s){const h=1<<f.z;return!s&&(0===f.x||f.x===h-1)||0===f.y||f.y===h-1}const ui=f=>({u_matrix:f});function Va(f,s,h,g,v){if(v>0){const w=c.exported.now(),E=(w-f.timeAdded)/v,A=s?(w-s.timeAdded)/v:-1,P=h.getSource(),z=g.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),O=!s||Math.abs(s.tileID.overscaledZ-z)>Math.abs(f.tileID.overscaledZ-z),U=O&&f.refreshedUponExpiration?1:c.clamp(O?E:1-A,0,1);return f.refreshedUponExpiration&&E>=1&&(f.refreshedUponExpiration=!1),s?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class tu extends c.SourceCache{constructor(s){const h={type:"raster-dem",maxzoom:s.transform.maxZoom},g=new Bn(We(),null),v=At("mock-dem",h,g,s.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,h){s.state="loaded",h(null)}}class eu extends c.SourceCache{constructor(s){const h=At("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new Bn(We(),null),s.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,h,g){if(s.freezeTileCoverage)return;this.transform=s;const v=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,E)=>{if(w[E.key]="",!this._tiles[E.key]){const A=new c.Tile(E,this._source.tileSize*E.overscaleFactor(),s.tileZoom);A.state="loaded",this._tiles[E.key]=A}return w},{});for(const w in this._tiles)w in v||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(s){const h=this.proxyCachedFBO[s];if(void 0!==h){const g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ic extends c.OverscaledTileID{constructor(s,h,g){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class Lc extends c.Elevation{constructor(s,h){super(),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,w]=function(P){const z=new c.StructArrayLayout2i4,O=new c.StructArrayLayout3ui6,U=131;z.reserve(17161),O.reserve(33800);const q=c.EXTENT/128,W=c.EXTENT+q/2,X=W+q;for(let J=-q;J<X;J+=q)for(let G=-q;G<X;G+=q){const st=G<0||G>W||J<0||J>W?24575:0,it=c.clamp(Math.round(G),0,c.EXTENT),rt=c.clamp(Math.round(J),0,c.EXTENT);z.emplaceBack(it+st,rt)}const Y=(J,G)=>{const st=G*U+J;O.emplaceBack(st+1,st,st+U),O.emplaceBack(st+U,st+U+1,st+1)};for(let J=1;J<129;J++)for(let G=1;G<129;G++)Y(G,J);return[0,129].forEach(J=>{for(let G=0;G<130;G++)Y(G,J),Y(J,G)}),[z,O,32768]}(),E=s.context;this.gridBuffer=E.createVertexBuffer(g,c.posAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(v),this.gridSegments=c.SegmentVector.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=c.SegmentVector.simpleSegment(0,0,g.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new eu(h.map),this.orthoMatrix=c.create(),c.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,c.EXTENT,0,c.EXTENT,0,1);const A=E.gl;this._overlapStencilMode=new c.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new tu(h.map)}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),s.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=s,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,h,g){if(s&&s.terrain){this._style!==s&&(this.style=s),this.enabled=!0;const v=s.terrain.properties;this.sourceCache=0===s.terrain.drapeRenderMode?this._mockSourceCache:s._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const w=()=>{this.sourceCache.used&&c.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(h,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,w(),this._initializing=!0),w(),h.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const s=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==s.efficiency&&c.warnOnce(`Terrain render cache efficiency is not optimal (${s.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${s.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(s){s.coord&&"source"===s.dataType?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):"style"===s.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._sourceCaches)this._style._sourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=0===g._centerAltitude&&-1===this.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(g.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=h.getIds().map(P=>{const z=h.getTileByID(P).tileID;return z.projMatrix=g.calculateProjMatrix(z.toUnwrapped()),z});(function(P,z){const O=z.transform.pointCoordinate(z.transform.getCameraPoint()),U=new c.pointGeometry(O.x,O.y);P.sort((q,W)=>{if(W.overscaledZ-q.overscaledZ)return W.overscaledZ-q.overscaledZ;const X=new c.pointGeometry(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),Y=new c.pointGeometry(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),J=U.mult(1<<q.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(X)-J.distSqr(Y)})})(v,this.painter),this._previousZoom=g.zoom;const w=this.proxyToSource||{};this.proxyToSource={},v.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const P in E){const z=E[P];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,s[P],w),z.usedForTerrain))continue;const O=s[P];z.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[h.id]=v.map(P=>new Ic(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1,this._updateTimestamp=c.exported.now();const A={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const z=this.terrainTileForTile[P.key];if(!z)continue;const O=z.tileID.key;O in A||(this._visibleDemTiles.push(z),A[O]=O)}}_assignTerrainTiles(s){this._initializing||s.forEach(h=>{if(this.terrainTileForTile[h.key])return;const g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){const s=this.painter.context,h=s.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],w=v.dem;!w||v.demTexture&&!v.needsDEMTextureUpload||(s.activeTexture.set(h.TEXTURE1),Ms(this.painter,v,w))}}_prepareDemTileUniforms(s,h,g,v){if(!h||null==h.demTexture)return!1;const w=s.tileID.canonical,E=Math.pow(2,h.tileID.canonical.z-w.z),A=v||"";return g[`u_dem_tl${A}`]=[w.x*E%1,w.y*E%1],g[`u_dem_scale${A}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const s=this.painter.context,h=s.gl;if(!this._emptyDepthBufferTexture){const g=new c.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new c.Texture(s,g,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let s=0;const h=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const w=v.dem.tree.minimums[0];return w>0&&s++,g+w},0);return s?h/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,h=s.gl;s.activeTexture.set(h.TEXTURE2);const g=this._getLoadedAreaMinimum(),v=new c.RGBAImage({width:1,height:1},new Uint8Array(c.DEMData.pack(g,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(v,{premultiply:!1}):w=this._emptyDEMTexture=new c.Texture(s,v,h.RGBA,{premultiply:!1}),w}setupElevationDraw(s,h,g){const v=this.painter.context,w=v.gl,E=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:c.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var A;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();let P=null,z=null,O=1;if(g&&g.morphing&&this._useVertexMorphing){const U=g.morphing.srcDemTile,q=g.morphing.dstDemTile;O=g.morphing.phase,U&&q&&(this._prepareDemTileUniforms(s,U,E,"_prev")&&(z=U),this._prepareDemTileUniforms(s,q,E)&&(P=q))}if(z&&P?(v.activeTexture.set(w.TEXTURE2),P.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),v.activeTexture.set(w.TEXTURE4),z.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),E.u_dem_lerp=O):(P=this.terrainTileForTile[s.tileID.key],v.activeTexture.set(w.TEXTURE2),(this._prepareDemTileUniforms(s,P,E)?P.demTexture:this.emptyDEMTexture).bind(w.NEAREST,w.CLAMP_TO_EDGE)),v.activeTexture.set(w.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&P){const U=(1<<P.tileID.canonical.z)*c.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=U}if(g&&g.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(v,E),"globe"===this.painter.transform.projection.name){const U=this.globeUniformValues(this.painter.transform,s.tileID.canonical,g&&g.useDenormalizedUpVectorScale);h.setGlobeUniformValues(v,U)}}globeUniformValues(s,h,g){const v=s.projection;return{u_tile_tl_up:v.upVector(h,0,0),u_tile_tr_up:v.upVector(h,c.EXTENT,0),u_tile_br_up:v.upVector(h,c.EXTENT,c.EXTENT),u_tile_bl_up:v.upVector(h,0,c.EXTENT),u_tile_up_scale:g?c.globeMetersToEcef(1):v.upVectorScale(h,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const h=this.painter,g=this.painter.context;0!==s.length&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,w,E,A,P){if("globe"===v.transform.projection.name)!function(z,O,U,q,W){const X=z.context,Y=X.gl;let J,G;const st=z.options.showTerrainWireframe?2:0,it=z.transform,rt=c.globeUseCustomAntiAliasing(z,X,it),pt=(ne,Ot)=>{if(G===ne)return;const wt=[Io[ne],"PROJECTION_GLOBE_VIEW"];rt&&wt.push("CUSTOM_ANTIALIASING"),Ot&&wt.push(Io[st]),J=z.useProgram("globeRaster",null,wt),G=ne},dt=z.colorModeForRenderPass(),xt=new c.DepthMode(Y.LEQUAL,c.DepthMode.ReadWrite,z.depthRangeFor3D);An.update(W);const Et=c.calculateGlobeMercatorMatrix(it),Lt=[c.mercatorXfromLng(it.center.lng),c.mercatorYfromLat(it.center.lat)],Bt=st?[!1,!0]:[!1],fe=z.globeSharedBuffers,Pt=[it.width*c.exported.devicePixelRatio,it.height*c.exported.devicePixelRatio],Yt=Float32Array.from(it.globeMatrix),Vt={useDenormalizedUpVectorScale:!0};if(Bt.forEach(ne=>{const Ot=z.transform,wt=Ll(Ot.zoom)*O.exaggeration();G=-1;const Nt=ne?Y.LINES:Y.TRIANGLES;for(const ee of q){const se=U.getTile(ee),Be=c.StencilMode.disabled,ii=O.prevTerrainTileForTile[ee.key],Ie=O.terrainTileForTile[ee.key];Il(ii,Ie)&&An.newMorphing(ee.key,ii,Ie,W,250),X.activeTexture.set(Y.TEXTURE0),se.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const Ee=An.getMorphValuesForProxy(ee.key),Ue=Ee?1:0;Ee&&c.extend$1(Vt,{morphing:{srcDemTile:Ee.from,dstDemTile:Ee.to,phase:c.easeCubicInOut(Ee.phase)}});const ri=c.tileCornersToBounds(ee.canonical),je=c.getLatitudinalLod(ri.getCenter().lat),xi=c.getGridMatrix(ee.canonical,ri,je,Ot.worldSize/Ot._pixelsPerMercatorPixel),Ei=c.globeNormalizeECEF(c.globeTileBounds(ee.canonical)),Ni=Rs(Ot.projMatrix,Yt,Et,Ei,c.globeToMercatorTransition(Ot.zoom),Lt,Ot.frustumCorners.TL,Ot.frustumCorners.TR,Ot.frustumCorners.BR,Ot.frustumCorners.BL,Ot.globeCenterInViewSpace,Ot.globeRadius,Pt,wt,xi);if(pt(Ue,ne),O.setupElevationDraw(se,J,Vt),z.prepareDrawProgram(X,J,ee.toUnwrapped()),fe){const[zi,Wi,ds]=ne?fe.getWirefameBuffers(z.context,je):fe.getGridBuffers(je,0!==wt);J.draw(X,Nt,xt,Be,dt,c.CullFaceMode.backCCW,Ni,"globe_raster",zi,Wi,ds)}}}),fe){const ne=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];rt&&ne.push("CUSTOM_ANTIALIASING"),J=z.useProgram("globeRaster",null,ne);for(const Ot of q){const{x:wt,y:Nt,z:ee}=Ot.canonical,se=0===Nt,Be=Nt===(1<<ee)-1,[ii,Ie,Ee,Ue]=fe.getPoleBuffers(ee);if(Ue&&(se||Be)){const ri=U.getTile(Ot);X.activeTexture.set(Y.TEXTURE0),ri.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let je=c.globePoleMatrixForTile(ee,wt,it);const xi=c.globeNormalizeECEF(c.globeTileBounds(Ot.canonical)),Ei=(Ni,zi)=>Ni.draw(X,Y.TRIANGLES,xt,c.StencilMode.disabled,dt,c.CullFaceMode.disabled,Rs(it.projMatrix,je,je,xi,0,Lt,it.frustumCorners.TL,it.frustumCorners.TR,it.frustumCorners.BR,it.frustumCorners.BL,it.globeCenterInViewSpace,it.globeRadius,Pt,0),"globe_pole_raster",zi,Ee,Ue);O.setupElevationDraw(ri,J,Vt),z.prepareDrawProgram(X,J,Ot.toUnwrapped()),se&&Ei(J,ii),Be&&(je=c.scale(c.create(),je,[1,-1,1]),Ei(J,Ie))}}}}(v,w,E,A,P);else{const z=v.context,O=z.gl;let U,q;const W=v.options.showTerrainWireframe?2:0,X=(it,rt)=>{if(q===it)return;const pt=[Io[it]];rt&&pt.push(Io[W]),U=v.useProgram("terrainRaster",null,pt),q=it},Y=v.colorModeForRenderPass(),J=new c.DepthMode(O.LEQUAL,c.DepthMode.ReadWrite,v.depthRangeFor3D);An.update(P);const G=v.transform,st=Ll(G.zoom)*w.exaggeration();(W?[!1,!0]:[!1]).forEach(it=>{q=-1;const rt=it?O.LINES:O.TRIANGLES,[pt,dt]=it?w.getWirefameBuffer():[w.gridIndexBuffer,w.gridSegments];for(const xt of A){const Et=E.getTile(xt),Lt=c.StencilMode.disabled,Bt=w.prevTerrainTileForTile[xt.key],fe=w.terrainTileForTile[xt.key];Il(Bt,fe)&&An.newMorphing(xt.key,Bt,fe,P,250),z.activeTexture.set(O.TEXTURE0),Et.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST);const Pt=An.getMorphValuesForProxy(xt.key),Yt=Pt?1:0;let Vt;Pt&&(Vt={morphing:{srcDemTile:Pt.from,dstDemTile:Pt.to,phase:c.easeCubicInOut(Pt.phase)}});const ne=lo(xt.projMatrix,Pc(xt.canonical,G.renderWorldCopies)?st/10:st);X(Yt,it),w.setupElevationDraw(Et,U,Vt),v.prepareDrawProgram(z,U,xt.toUnwrapped()),U.draw(z,rt,J,Lt,Y,c.CullFaceMode.backCCW,ne,"terrain_raster",w.gridBuffer,pt,dt)}})}}(h,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(0===this._drapedRenderBatches.length)return s+1;this.renderingToTexture=!0;const h=this.painter,g=this.painter.context,v=this.proxySourceCache,w=this.proxiedCoords[v.id],E=this._drapedRenderBatches.shift(),A=[],P=h.style.order;let z=0;for(const O of w){const U=v.getTileByID(O.proxyTileKey),q=v.proxyCachedFBO[O.key]?v.proxyCachedFBO[O.key][s]:void 0,W=void 0!==q?v.renderCache[q]:this.pool[z++],X=void 0!==q;if(U.texture=W.tex,X&&!W.dirty){A.push(U.tileID);continue}let Y;g.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(g.clear({color:c.Color.transparent,stencil:0}),W.dirty=!1);for(let J=E.start;J<=E.end;++J){const G=h.style._layers[P[J]];if(G.isHidden(h.transform.zoom))continue;const st=h.style._getLayerSourceCache(G),it=st?this.proxyToSource[O.key][st.id]:[O];if(!it)continue;const rt=it;g.viewport.set([0,0,W.fb.width,W.fb.height]),Y!==(st?st.id:null)&&(this._setupStencil(W,it,G,st),Y=st?st.id:null),h.renderLayer(h,st,G,rt)}this.renderedToTile?(W.dirty=!0,A.push(U.tileID)):X||--z,5===z&&(z=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),E.end+1}postRender(){}renderCacheEfficiency(s){const h=s.order.length;if(0===h)return{efficiency:100};let g,v=0,w=0,E=!1;for(let A=0;A<h;++A){const P=s._layers[s.order[A]];this._style.isLayerDraped(P)?(E&&++v,++w):E||(E=!0,g=P.id)}return 0===w?{efficiency:100}:{efficiency:100*(1-v/w),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{s=Math.min(s,h.dem.tree.minimums[0])}),0===s?s:(s-30)*this._exaggeration}raycast(s,h,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const E=w.tileID,A=1<<E.overscaledZ,{x:P,y:z}=E.canonical,O=P/A,U=(P+1)/A,q=z/A,W=(z+1)/A;return{minx:O,miny:q,maxx:U,maxy:W,t:w.dem.tree.raycastRoot(O,q,U,W,s,h,g),tile:w}});v.sort((w,E)=>(null!==w.t?w.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const w of v){if(null==w.t)return null;const E=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,s,h,g);if(null!=E)return E}return null}_createFBO(){const s=this.painter.context,h=s.gl,g=this.drapeBufferSize;s.activeTexture.set(h.TEXTURE0);const v=new c.Texture(s,{width:g[0],height:g[1],data:null},h.RGBA);v.bind(h.LINEAR,h.CLAMP_TO_EDGE);const w=s.createFramebuffer(g[0],g[1],!1);return w.colorAttachment.set(v.texture),w.depthAttachment=new gr(s,w.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&!s.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:w,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const h=this._style._layers[s],g=h.isHidden(this.painter.transform.zoom);return"custom"===h.type?!g&&h.shouldRedrape():!g&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const g of this._style._getSources())if(g instanceof N){s=!0;break}if(!s)return;const h={};for(let g=0;g<this._style.order.length;++g){const v=this._style._layers[this._style.order[g]],w=this._style._getLayerSourceCache(v);if(w&&!h[w.id]&&!v.isHidden(this.painter.transform.zoom)&&"line"===v.type&&v.widthExpression()instanceof c.ZoomDependentExpression){h[w.id]=!0;for(const E of this.proxyCoords){const A=this.proxyToSource[E.key][w.id];if(A)for(const P of A)this._clearRenderCacheForTile(w.id,P)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const g in this._style._sourceCaches)if(this._style._sourceCaches[g]._source instanceof Z){s=!0;break}if(!s)return;const h={};for(let g=0;g<this._style.order.length;++g){const v=this._style._layers[this._style.order[g]],w=this._style._getLayerSourceCache(v);if(!w||h[w.id]||v.isHidden(this.painter.transform.zoom)||"raster"!==v.type)continue;const E=v.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const P=this.proxyToSource[A.key][w.id];if(P)for(const z of P){const O=Va(w.getTile(z),w.findLoadedParent(z,0),w,this.painter.transform,E);(1!==O.opacity||0!==O.mix)&&this._clearRenderCacheForTile(w.id,z)}}}}_setupDrapedRenderBatches(){const s=this._style.order,h=s.length;if(0===h)return;const g=[];let v,w=0,E=this._style._layers[s[w]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++w<h;)E=this._style._layers[s[w]];for(;w<h;++w){const A=this._style._layers[s[w]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===v&&(v=w):void 0!==v&&(g.push({start:v,end:w-1}),v=void 0))}void 0!==v&&g.push({start:v,end:w-1}),this._drapedRenderBatches=g}_setupRenderCache(s){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const E=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let A=0;A<E.length;++A){const P=Object.values(E[A]);h.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let E=g.length-1;E>=0;E--){const A=g[E];if(h.getTileByID(A.key),void 0!==h.proxyCachedFBO[A.key]){const P=s[A.key],z=this.proxyToSource[A.key];let O=0;for(const U in z){const q=z[U],W=P[U];if(!W||W.length!==q.length||q.some((X,Y)=>X!==W[Y]||v[U]&&v[U].hasOwnProperty(X.key))){O=-1;break}++O}for(const U in h.proxyCachedFBO[A.key])h.renderCache[h.proxyCachedFBO[A.key][U]].dirty=O<0||O!==Object.values(P).length}}const w=[...this._drapedRenderBatches];w.sort((E,A)=>A.end-A.start-(E.end-E.start));for(const E of w)for(const A of g){if(h.proxyCachedFBO[A.key])continue;let P=h.renderCachePool.pop();void 0===P&&h.renderCache.length<50&&(P=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==P&&(h.proxyCachedFBO[A.key]={},h.proxyCachedFBO[A.key][E.start]=P,h.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(s,h,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,E=w.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let A;if(g.isTileClipped())A=h.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):c.StencilMode.disabled}_renderTileClippingMasks(s,h){const g=this.painter,v=this.painter.context,w=v.gl;g._tileClippingMaskIDs={},v.setColorMode(c.ColorMode.disabled),v.setDepthMode(c.DepthMode.disabled);const E=g.useProgram("clippingMask");for(const A of s){const P=g._tileClippingMaskIDs[A.key]=--h;E.draw(v,w.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:w.ALWAYS,mask:0},P,255,w.KEEP,w.KEEP,w.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,ui(A.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(s){const h=this.painter.transform;if(s.x<0||s.x>h.width||s.y<0||s.y>h.height)return null;const g=[s.x,s.y,1,1];c.transformMat4$1(g,g,h.pixelMatrixInverse),c.scale$1(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;const v=h._camera.position,w=c.mercatorZfromAltitude(1,h.center.lat),E=[v[0],v[1],v[2]/w,0],A=c.subtract([],g.slice(0,3),E);c.normalize(A,A);const P=this.raycast(E,A,this._exaggeration);return null!==P&&P?(c.scaleAndAdd(E,E,A,P),E[3]=E[2],E[2]*=w,E):null}drawDepth(){const s=this.painter,h=s.context,g=this.proxySourceCache,v=Math.ceil(s.width),w=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const E=h.gl,A=h.createFramebuffer(v,w,!0);h.activeTexture.set(E.TEXTURE0);const P=new c.Texture(h,{width:v,height:w,data:null},E.RGBA);P.bind(E.NEAREST,E.CLAMP_TO_EDGE),A.colorAttachment.set(P.texture);const z=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,v,w);A.depthAttachment.set(z),this._depthFBO=A,this._depthTexture=P}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,v,w]),function(E,A,P,z){if("globe"===E.transform.projection.name)return;const O=E.context,U=O.gl;O.clear({depth:1});const q=E.useProgram("terrainDepth"),W=new c.DepthMode(U.LESS,c.DepthMode.ReadWrite,E.depthRangeFor3D);for(const X of z){const Y=P.getTile(X),J=lo(X.projMatrix,0);A.setupElevationDraw(Y,q),q.draw(O,U.TRIANGLES,W,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.backCCW,J,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(s,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,h,g){if(s.getSource()instanceof yt)return this._setupProxiedCoordsForImageSource(s,h,g);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const v=this.proxiedCoords[s.id]=[],w=this.proxyCoords;for(let A=0;A<w.length;A++){const P=w[A],z=this._findTileCoveringTileID(P,s);if(z){const O=this._createProxiedId(P,z,g[P.key]&&g[P.key][s.id]);v.push(O),this.proxyToSource[P.key][s.id]=[O]}}let E=!1;for(let A=0;A<h.length;A++){const P=s.getTile(h[A]);if(!P||!P.hasData())continue;const z=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==P.tileID.canonical.z){const O=this.proxyToSource[z.tileID.key][s.id],U=this._createProxiedId(z.tileID,P,g[z.tileID.key]&&g[z.tileID.key][s.id]);O?O.splice(O.length-1,0,U):this.proxyToSource[z.tileID.key][s.id]=[U],v.push(U),E=!0}}this._sourceTilesOverlap[s.id]=E}_setupProxiedCoordsForImageSource(s,h,g){if(!s.getSource().loaded())return;const v=this.proxiedCoords[s.id]=[],w=this.proxyCoords,E=s.getSource(),A=new c.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),P=E.coordinates.map(c.MercatorCoordinate.fromLngLat).reduce((O,U)=>(O.min.x=Math.min(O.min.x,U.x-A.x),O.min.y=Math.min(O.min.y,U.y-A.y),O.max.x=Math.max(O.max.x,U.x-A.x),O.max.y=Math.max(O.max.y,U.y-A.y),O),{min:new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(O,U)=>{const q=O.wrap+O.canonical.x/(1<<O.canonical.z),W=O.canonical.y/(1<<O.canonical.z),X=c.EXTENT/(1<<O.canonical.z),Y=U.wrap+U.canonical.x/(1<<U.canonical.z),J=U.canonical.y/(1<<U.canonical.z);return q+X<Y+P.min.x||q>Y+P.max.x||W+X<J+P.min.y||W>J+P.max.y};for(let O=0;O<w.length;O++){const U=w[O];for(let q=0;q<h.length;q++){const W=s.getTile(h[q]);if(!W||!W.hasData()||z(U,W.tileID))continue;const X=this._createProxiedId(U,W,g[U.key]&&g[U.key][s.id]),Y=this.proxyToSource[U.key][s.id];Y?Y.push(X):this.proxyToSource[U.key][s.id]=[X],v.push(X)}}}_createProxiedId(s,h,g){let v=this.orthoMatrix;if(g){const w=g.find(E=>E.key===h.tileID.key);if(w)return w}if(h.tileID.key!==s.key){const w=s.canonical.z-h.tileID.canonical.z;let E,A,P;v=c.create();const z=h.tileID.wrap-s.wrap<<s.overscaledZ;w>0?(E=c.EXTENT>>w,A=E*((h.tileID.canonical.x<<w)-s.canonical.x+z),P=E*((h.tileID.canonical.y<<w)-s.canonical.y)):(E=c.EXTENT<<-w,A=c.EXTENT*(h.tileID.canonical.x-(s.canonical.x+z<<-w)),P=c.EXTENT*(h.tileID.canonical.y-(s.canonical.y<<-w))),c.ortho(v,0,E,0,E,0,1),c.translate(v,v,[A,P,0])}return new Ic(h.tileID,s.key,v)}_findTileCoveringTileID(s,h){let g=h.getTile(s);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[h.id],w=v[s.key];if(g=w?h.getTileByID(w):null,g&&g.hasData()||null===w)return g;let E=g?g.tileID:s,A=E.overscaledZ;const P=h.getSource().minzoom,z=[];if(!w){const U=h.getSource().maxzoom;if(s.canonical.z>=U){const q=s.canonical.z-U;h.getSource().reparseOverscaled?(A=Math.max(s.canonical.z+2,h.transform.tileZoom),E=new c.OverscaledTileID(A,s.wrap,U,s.canonical.x>>q,s.canonical.y>>q)):0!==q&&(A=U,E=new c.OverscaledTileID(A,s.wrap,U,s.canonical.x>>q,s.canonical.y>>q))}E.key!==s.key&&(z.push(E.key),g=h.getTile(E))}const O=U=>{z.forEach(q=>{v[q]=U}),z.length=0};for(A-=1;A>=P&&(!g||!g.hasData());A--){g&&O(g.tileID.key);const U=E.calculateScaledKey(A);if(g=h.getTileByID(U),g&&g.hasData())break;const q=v[U];if(null===q)break;void 0===q?z.push(U):g=h.getTileByID(q)}return O(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,h){let g=this._tilesDirty[s];g||(g=this._tilesDirty[s]={}),g[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const s=function(h){let g=0;const v=new c.StructArrayLayout2ui4,w=131;for(let E=1;E<129;E++){for(let A=1;A<129;A++)g=E*w+A,v.emplaceBack(g,g+1),v.emplaceBack(g,g+w),v.emplaceBack(g+1,g+w),128===E&&v.emplaceBack(g+w,g+w+1);v.emplaceBack(g+1,g+1+w)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(s),this.wireframeSegments=c.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Rl{static cacheKey(s,h,g,v){let w=`${h}${v?v.cacheKey:""}`;for(const E of g)s.usedDefines.includes(E)&&(w+=`/${E}`);return w}constructor(s,h,g,v,w,E){const A=s.gl;this.program=A.createProgram();const P=function(G){const st=[];for(let it=0;it<G.length;it++){if(null===G[it])continue;const rt=G[it].split(" ");st.push(rt.pop())}return st}(g.staticAttributes),z=v?v.getBinderAttributes():[],O=P.concat(z);let U=v?v.defines():[];U=U.concat(E.map(G=>`#define ${G}`));const q=s.isWebGL2?"#version 300 es\n":"",W=q+U.concat(s.extStandardDerivatives&&0===q.length?"#extension GL_OES_standard_derivatives : enable\n".concat(oa):oa,oa,Pl,br.fragmentSource,Po.fragmentSource,g.fragmentSource).join("\n"),X=q+U.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Pl,br.vertexSource,Po.vertexSource,Dl.vertexSource,g.vertexSource).join("\n"),Y=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(Y,W),A.compileShader(Y),A.attachShader(this.program,Y);const J=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(J,X),A.compileShader(J),A.attachShader(this.program,J),this.attributes={},this.numAttributes=O.length;for(let G=0;G<this.numAttributes;G++)O[G]&&(A.bindAttribLocation(this.program,G,O[G]),this.attributes[O[G]]=G);A.linkProgram(this.program),A.deleteShader(J),A.deleteShader(Y),this.fixedUniforms=w(s),this.binderUniforms=v?v.getUniforms(s):[],E.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new c.Uniform1i(G=s),u_dem_prev:new c.Uniform1i(G),u_dem_unpack:new c.Uniform4f(G),u_dem_tl:new c.Uniform2f(G),u_dem_scale:new c.Uniform1f(G),u_dem_tl_prev:new c.Uniform2f(G),u_dem_scale_prev:new c.Uniform1f(G),u_dem_size:new c.Uniform1f(G),u_dem_lerp:new c.Uniform1f(G),u_exaggeration:new c.Uniform1f(G),u_depth:new c.Uniform1i(G),u_depth_size_inv:new c.Uniform2f(G),u_meter_to_dem:new c.Uniform1f(G),u_label_plane_matrix_inv:new c.UniformMatrix4f(G)}),E.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new c.Uniform3f(G),u_tile_tr_up:new c.Uniform3f(G),u_tile_br_up:new c.Uniform3f(G),u_tile_bl_up:new c.Uniform3f(G),u_tile_up_scale:new c.Uniform1f(G)}))(s)),E.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new c.UniformMatrix4f(G),u_fog_range:new c.Uniform2f(G),u_fog_color:new c.Uniform4f(G),u_fog_horizon_blend:new c.Uniform1f(G),u_fog_temporal_offset:new c.Uniform1f(G),u_frustum_tl:new c.Uniform3f(G),u_frustum_tr:new c.Uniform3f(G),u_frustum_br:new c.Uniform3f(G),u_frustum_bl:new c.Uniform3f(G),u_globe_pos:new c.Uniform3f(G),u_globe_radius:new c.Uniform1f(G),u_globe_transition:new c.Uniform1f(G),u_is_globe:new c.Uniform1i(G),u_viewport:new c.Uniform2f(G)}))(s))}var G}setTerrainUniformValues(s,h){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in h)g[v]&&g[v].set(this.program,v,h[v])}}setGlobeUniformValues(s,h){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in h)g[v]&&g[v].set(this.program,v,h[v])}}setFogUniformValues(s,h){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in h)g[v].set(this.program,v,h[v])}}draw(s,h,g,v,w,E,A,P,z,O,U,q,W,X,Y){const J=s.gl;if(this.failedToCreate)return;s.program.set(this.program),s.setDepthMode(g),s.setStencilMode(v),s.setColorMode(w),s.setCullFace(E);for(const st of Object.keys(this.fixedUniforms))this.fixedUniforms[st].set(this.program,st,A[st]);X&&X.setUniforms(this.program,s,this.binderUniforms,q,{zoom:W});const G={[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[h];for(const st of U.get()){const it=st.vaos||(st.vaos={});(it[P]||(it[P]=new ro)).bind(s,this,z,X?X.getPaintVertexBuffers():[],O,st.vertexOffset,Y||[]),J.drawElements(h,st.primitiveLength*G,J.UNSIGNED_SHORT,st.primitiveOffset*G*2)}}}function iu(f,s){const h=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,f.transform.tileZoom)/h,v=g*(s.tileID.canonical.x+s.tileID.wrap*h),w=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_tile_units_to_pixels:1/Pn(s,1,f.transform.tileZoom),u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const _d=c.create(),zl=(f,s,h,g,v,w,E,A,P,z,O)=>{const U=s.style.light,q=U.properties.get("position"),W=[q.x,q.y,q.z],X=c.create$1();"viewport"===U.properties.get("anchor")&&(c.fromRotation(X,-s.transform.angle),c.transformMat3(W,W,X));const Y=U.properties.get("color"),J=s.transform,G={u_matrix:f,u_lightpos:W,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+h,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:_d,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:w};return"globe"===J.projection.name&&(G.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],G.u_zoom_transition=P,G.u_inv_rot_matrix=O,G.u_merc_center=z,G.u_up_dir=J.projection.upVector(new c.CanonicalTileID(0,0,0),z[0]*c.EXTENT,z[1]*c.EXTENT),G.u_height_lift=A),G},ja=(f,s,h,g,v,w,E,A,P,z,O,U)=>{const q=zl(f,s,h,g,v,w,E,P,z,O,U),W={u_height_factor:-Math.pow(2,E.overscaledZ)/A.tileSize/8};return c.extend(q,iu(s,A),W)},ra=f=>({u_matrix:f}),aa=(f,s,h)=>c.extend(ra(f),iu(s,h)),nu=(f,s)=>({u_matrix:f,u_world:s}),su=(f,s,h,g)=>c.extend(aa(f,s,h),{u_world:g}),ou=c.create(),Za=(f,s,h,g,v,w)=>{const E=f.transform,A="globe"===E.projection.name;let P;if("map"===w.paint.get("circle-pitch-alignment"))if(A){const O=c.globePixelsToTileUnits(E.zoom,s.canonical)*E._pixelsPerMercatorPixel;P=Float32Array.from([O,0,0,O])}else P=E.calculatePixelsToTileUnitsMatrix(h);else P=new Float32Array([E.pixelsToGLUnits[0],0,0,E.pixelsToGLUnits[1]]);const z={u_camera_to_center_distance:E.cameraToCenterDistance,u_matrix:f.translatePosMatrix(s.projMatrix,h,w.paint.get("circle-translate"),w.paint.get("circle-translate-anchor")),u_device_pixel_ratio:c.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:ou,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){z.u_inv_rot_matrix=g,z.u_merc_center=v,z.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],z.u_zoom_transition=c.globeToMercatorTransition(E.zoom);const O=v[0]*c.EXTENT,U=v[1]*c.EXTENT;z.u_up_dir=E.projection.upVector(new c.CanonicalTileID(0,0,0),O,U)}return z},Ga=f=>{const s=[];return"map"===f.paint.get("circle-pitch-alignment")&&s.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&s.push("SCALE_WITH_MAP"),s},ru=(f,s,h,g)=>{const v=c.EXTENT/h.tileSize;return{u_matrix:f,u_camera_to_center_distance:s.getCameraToCenterDistance(g),u_extrude_scale:[s.pixelsToGLUnits[0]/v,s.pixelsToGLUnits[1]/v]}},la=(f,s,h=1)=>({u_matrix:f,u_color:s,u_overlay:0,u_overlay_scale:h}),Ol=c.create(),co=(f,s,h,g,v,w,E)=>{const A=f.transform,P="globe"===A.projection.name,z=P?c.globePixelsToTileUnits(A.zoom,s.canonical)*A._pixelsPerMercatorPixel:Pn(h,1,w),O={u_matrix:s.projMatrix,u_extrude_scale:z,u_intensity:E,u_inv_rot_matrix:Ol,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){O.u_inv_rot_matrix=g,O.u_merc_center=v,O.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],O.u_zoom_transition=c.globeToMercatorTransition(A.zoom);const U=v[0]*c.EXTENT,q=v[1]*c.EXTENT;O.u_up_dir=A.projection.upVector(new c.CanonicalTileID(0,0,0),U,q)}return O},ca=(f,s,h,g,v,w,E)=>{const A=f.transform,P=A.calculatePixelsToTileUnitsMatrix(s);return{u_matrix:Rc(f,s,h,g),u_pixels_to_tile_units:P,u_device_pixel_ratio:w,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:Fl(h)?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Bl(s,f.transform),u_alpha_discard_threshold:0,u_trim_offset:E}},au=(f,s,h,g,v)=>{const w=f.transform;return{u_matrix:Rc(f,s,h,g),u_texsize:s.imageAtlasTexture.size,u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:v,u_image:0,u_tile_units_to_pixels:Bl(s,w),u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Bl(f,s){return 1/Pn(f,1,s.tileZoom)}function Rc(f,s,h,g){return f.translatePosMatrix(g||s.tileID.projMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function Fl(f){const s=f.paint.get("line-dasharray").value;return s.value||"constant"!==s.kind}const zc=(f,s,h,g,v,w)=>{return{u_matrix:f,u_tl_parent:s,u_scale_parent:h,u_fade_t:g.mix,u_opacity:g.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(A=v.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(E=v.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:er(v.paint.get("raster-hue-rotate")),u_perspective_transform:w};var E,A};function er(f){f*=Math.PI/180;const s=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const lu=c.create(),ir=(f,s,h,g,v,w,E,A,P,z,O,U,q,W,X,Y)=>{const J=v.transform,G={u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:J.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:J.width/J.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:E,u_coord_matrix:A,u_is_text:+P,u_pitch_with_map:+g,u_texsize:z,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:lu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:lu,u_up_vector:[0,-1,0]};return"globe"===Y.name&&(G.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],G.u_zoom_transition=U,G.u_inv_rot_matrix=W,G.u_merc_center=q,G.u_camera_forward=J._camera.forward(),G.u_ecef_origin=c.globeECEFOrigin(J.globeMatrix,O.toUnwrapped()),G.u_tile_matrix=Float32Array.from(J.globeMatrix),G.u_up_vector=X),G},Oc=(f,s,h,g,v,w,E,A,P,z,O,U,q,W,X,Y,J)=>c.extend(ir(f,s,h,g,v,w,E,A,P,z,U,q,W,X,Y,J),{u_gamma_scale:g?v.transform.cameraToCenterDistance*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:c.exported.devicePixelRatio,u_is_halo:+O}),Ul=(f,s,h,g,v,w,E,A,P,z,O,U,q,W,X,Y)=>c.extend(Oc(f,s,h,g,v,w,E,A,!0,P,!0,O,U,q,W,X,Y),{u_texsize_icon:z,u_texture_icon:1}),yd=(f,s,h)=>({u_matrix:f,u_opacity:s,u_color:h}),nr=(f,s,h,g,v)=>c.extend(function(w,E,A){const P=E.imageManager.getPattern(w.toString()),{width:z,height:O}=E.imageManager.getPixelSize(),U=Math.pow(2,A.tileID.overscaledZ),q=A.tileSize*Math.pow(2,E.transform.tileZoom)/U,W=q*(A.tileID.canonical.x+A.tileID.wrap*U),X=q*A.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[z,O],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/Pn(A,1,E.transform.tileZoom),u_pixel_coord_upper:[W>>16,X>>16],u_pixel_coord_lower:[65535&W,65535&X]}}(g,h,v),{u_matrix:f,u_opacity:s}),Sp={fillExtrusion:f=>({u_matrix:new c.UniformMatrix4f(f),u_lightpos:new c.Uniform3f(f),u_lightintensity:new c.Uniform1f(f),u_lightcolor:new c.Uniform3f(f),u_vertical_gradient:new c.Uniform1f(f),u_opacity:new c.Uniform1f(f),u_edge_radius:new c.Uniform1f(f),u_ao:new c.Uniform2f(f),u_tile_id:new c.Uniform3f(f),u_zoom_transition:new c.Uniform1f(f),u_inv_rot_matrix:new c.UniformMatrix4f(f),u_merc_center:new c.Uniform2f(f),u_up_dir:new c.Uniform3f(f),u_height_lift:new c.Uniform1f(f)}),fillExtrusionPattern:f=>({u_matrix:new c.UniformMatrix4f(f),u_lightpos:new c.Uniform3f(f),u_lightintensity:new c.Uniform1f(f),u_lightcolor:new c.Uniform3f(f),u_vertical_gradient:new c.Uniform1f(f),u_height_factor:new c.Uniform1f(f),u_edge_radius:new c.Uniform1f(f),u_ao:new c.Uniform2f(f),u_tile_id:new c.Uniform3f(f),u_zoom_transition:new c.Uniform1f(f),u_inv_rot_matrix:new c.UniformMatrix4f(f),u_merc_center:new c.Uniform2f(f),u_up_dir:new c.Uniform3f(f),u_height_lift:new c.Uniform1f(f),u_image:new c.Uniform1i(f),u_texsize:new c.Uniform2f(f),u_pixel_coord_upper:new c.Uniform2f(f),u_pixel_coord_lower:new c.Uniform2f(f),u_tile_units_to_pixels:new c.Uniform1f(f),u_opacity:new c.Uniform1f(f)}),fill:f=>({u_matrix:new c.UniformMatrix4f(f)}),fillPattern:f=>({u_matrix:new c.UniformMatrix4f(f),u_image:new c.Uniform1i(f),u_texsize:new c.Uniform2f(f),u_pixel_coord_upper:new c.Uniform2f(f),u_pixel_coord_lower:new c.Uniform2f(f),u_tile_units_to_pixels:new c.Uniform1f(f)}),fillOutline:f=>({u_matrix:new c.UniformMatrix4f(f),u_world:new c.Uniform2f(f)}),fillOutlinePattern:f=>({u_matrix:new c.UniformMatrix4f(f),u_world:new c.Uniform2f(f),u_image:new c.Uniform1i(f),u_texsize:new c.Uniform2f(f),u_pixel_coord_upper:new c.Uniform2f(f),u_pixel_coord_lower:new c.Uniform2f(f),u_tile_units_to_pixels:new c.Uniform1f(f)}),circle:f=>({u_camera_to_center_distance:new c.Uniform1f(f),u_extrude_scale:new c.UniformMatrix2f(f),u_device_pixel_ratio:new c.Uniform1f(f),u_matrix:new c.UniformMatrix4f(f),u_inv_rot_matrix:new c.UniformMatrix4f(f),u_merc_center:new c.Uniform2f(f),u_tile_id:new c.Uniform3f(f),u_zoom_transition:new c.Uniform1f(f),u_up_dir:new c.Uniform3f(f)}),collisionBox:f=>({u_matrix:new c.UniformMatrix4f(f),u_camera_to_center_distance:new c.Uniform1f(f),u_extrude_scale:new c.Uniform2f(f)}),collisionCircle:f=>({u_matrix:new c.UniformMatrix4f(f),u_inv_matrix:new c.UniformMatrix4f(f),u_camera_to_center_distance:new c.Uniform1f(f),u_viewport_size:new c.Uniform2f(f)}),debug:f=>({u_color:new c.UniformColor(f),u_matrix:new c.UniformMatrix4f(f),u_overlay:new c.Uniform1i(f),u_overlay_scale:new c.Uniform1f(f)}),clippingMask:f=>({u_matrix:new c.UniformMatrix4f(f)}),heatmap:f=>({u_extrude_scale:new c.Uniform1f(f),u_intensity:new c.Uniform1f(f),u_matrix:new c.UniformMatrix4f(f),u_inv_rot_matrix:new c.UniformMatrix4f(f),u_merc_center:new c.Uniform2f(f),u_tile_id:new c.Uniform3f(f),u_zoom_transition:new c.Uniform1f(f),u_up_dir:new c.Uniform3f(f)}),heatmapTexture:f=>({u_image:new c.Uniform1i(f),u_color_ramp:new c.Uniform1i(f),u_opacity:new c.Uniform1f(f)}),hillshade:f=>({u_matrix:new c.UniformMatrix4f(f),u_image:new c.Uniform1i(f),u_latrange:new c.Uniform2f(f),u_light:new c.Uniform2f(f),u_shadow:new c.UniformColor(f),u_highlight:new c.UniformColor(f),u_accent:new c.UniformColor(f)}),hillshadePrepare:f=>({u_matrix:new c.UniformMatrix4f(f),u_image:new c.Uniform1i(f),u_dimension:new c.Uniform2f(f),u_zoom:new c.Uniform1f(f),u_unpack:new c.Uniform4f(f)}),line:f=>({u_matrix:new c.UniformMatrix4f(f),u_pixels_to_tile_units:new c.UniformMatrix2f(f),u_device_pixel_ratio:new c.Uniform1f(f),u_units_to_pixels:new c.Uniform2f(f),u_dash_image:new c.Uniform1i(f),u_gradient_image:new c.Uniform1i(f),u_image_height:new c.Uniform1f(f),u_texsize:new c.Uniform2f(f),u_tile_units_to_pixels:new c.Uniform1f(f),u_alpha_discard_threshold:new c.Uniform1f(f),u_trim_offset:new c.Uniform2f(f)}),linePattern:f=>({u_matrix:new c.UniformMatrix4f(f),u_texsize:new c.Uniform2f(f),u_pixels_to_tile_units:new c.UniformMatrix2f(f),u_device_pixel_ratio:new c.Uniform1f(f),u_image:new c.Uniform1i(f),u_units_to_pixels:new c.Uniform2f(f),u_tile_units_to_pixels:new c.Uniform1f(f),u_alpha_discard_threshold:new c.Uniform1f(f)}),raster:f=>({u_matrix:new c.UniformMatrix4f(f),u_tl_parent:new c.Uniform2f(f),u_scale_parent:new c.Uniform1f(f),u_fade_t:new c.Uniform1f(f),u_opacity:new c.Uniform1f(f),u_image0:new c.Uniform1i(f),u_image1:new c.Uniform1i(f),u_brightness_low:new c.Uniform1f(f),u_brightness_high:new c.Uniform1f(f),u_saturation_factor:new c.Uniform1f(f),u_contrast_factor:new c.Uniform1f(f),u_spin_weights:new c.Uniform3f(f),u_perspective_transform:new c.Uniform2f(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new c.Uniform1i(f),u_is_size_feature_constant:new c.Uniform1i(f),u_size_t:new c.Uniform1f(f),u_size:new c.Uniform1f(f),u_camera_to_center_distance:new c.Uniform1f(f),u_rotate_symbol:new c.Uniform1i(f),u_aspect_ratio:new c.Uniform1f(f),u_fade_change:new c.Uniform1f(f),u_matrix:new c.UniformMatrix4f(f),u_label_plane_matrix:new c.UniformMatrix4f(f),u_coord_matrix:new c.UniformMatrix4f(f),u_is_text:new c.Uniform1i(f),u_pitch_with_map:new c.Uniform1i(f),u_texsize:new c.Uniform2f(f),u_tile_id:new c.Uniform3f(f),u_zoom_transition:new c.Uniform1f(f),u_inv_rot_matrix:new c.UniformMatrix4f(f),u_merc_center:new c.Uniform2f(f),u_camera_forward:new c.Uniform3f(f),u_tile_matrix:new c.UniformMatrix4f(f),u_up_vector:new c.Uniform3f(f),u_ecef_origin:new c.Uniform3f(f),u_texture:new c.Uniform1i(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new c.Uniform1i(f),u_is_size_feature_constant:new c.Uniform1i(f),u_size_t:new c.Uniform1f(f),u_size:new c.Uniform1f(f),u_camera_to_center_distance:new c.Uniform1f(f),u_rotate_symbol:new c.Uniform1i(f),u_aspect_ratio:new c.Uniform1f(f),u_fade_change:new c.Uniform1f(f),u_matrix:new c.UniformMatrix4f(f),u_label_plane_matrix:new c.UniformMatrix4f(f),u_coord_matrix:new c.UniformMatrix4f(f),u_is_text:new c.Uniform1i(f),u_pitch_with_map:new c.Uniform1i(f),u_texsize:new c.Uniform2f(f),u_texture:new c.Uniform1i(f),u_gamma_scale:new c.Uniform1f(f),u_device_pixel_ratio:new c.Uniform1f(f),u_tile_id:new c.Uniform3f(f),u_zoom_transition:new c.Uniform1f(f),u_inv_rot_matrix:new c.UniformMatrix4f(f),u_merc_center:new c.Uniform2f(f),u_camera_forward:new c.Uniform3f(f),u_tile_matrix:new c.UniformMatrix4f(f),u_up_vector:new c.Uniform3f(f),u_ecef_origin:new c.Uniform3f(f),u_is_halo:new c.Uniform1i(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new c.Uniform1i(f),u_is_size_feature_constant:new c.Uniform1i(f),u_size_t:new c.Uniform1f(f),u_size:new c.Uniform1f(f),u_camera_to_center_distance:new c.Uniform1f(f),u_rotate_symbol:new c.Uniform1i(f),u_aspect_ratio:new c.Uniform1f(f),u_fade_change:new c.Uniform1f(f),u_matrix:new c.UniformMatrix4f(f),u_label_plane_matrix:new c.UniformMatrix4f(f),u_coord_matrix:new c.UniformMatrix4f(f),u_is_text:new c.Uniform1i(f),u_pitch_with_map:new c.Uniform1i(f),u_texsize:new c.Uniform2f(f),u_texsize_icon:new c.Uniform2f(f),u_texture:new c.Uniform1i(f),u_texture_icon:new c.Uniform1i(f),u_gamma_scale:new c.Uniform1f(f),u_device_pixel_ratio:new c.Uniform1f(f),u_is_halo:new c.Uniform1i(f)}),background:f=>({u_matrix:new c.UniformMatrix4f(f),u_opacity:new c.Uniform1f(f),u_color:new c.UniformColor(f)}),backgroundPattern:f=>({u_matrix:new c.UniformMatrix4f(f),u_opacity:new c.Uniform1f(f),u_image:new c.Uniform1i(f),u_pattern_tl:new c.Uniform2f(f),u_pattern_br:new c.Uniform2f(f),u_texsize:new c.Uniform2f(f),u_pattern_size:new c.Uniform2f(f),u_pixel_coord_upper:new c.Uniform2f(f),u_pixel_coord_lower:new c.Uniform2f(f),u_tile_units_to_pixels:new c.Uniform1f(f)}),terrainRaster:Dc,terrainDepth:Dc,skybox:f=>({u_matrix:new c.UniformMatrix4f(f),u_sun_direction:new c.Uniform3f(f),u_cubemap:new c.Uniform1i(f),u_opacity:new c.Uniform1f(f),u_temporal_offset:new c.Uniform1f(f)}),skyboxGradient:f=>({u_matrix:new c.UniformMatrix4f(f),u_color_ramp:new c.Uniform1i(f),u_center_direction:new c.Uniform3f(f),u_radius:new c.Uniform1f(f),u_opacity:new c.Uniform1f(f),u_temporal_offset:new c.Uniform1f(f)}),skyboxCapture:f=>({u_matrix_3f:new c.UniformMatrix3f(f),u_sun_direction:new c.Uniform3f(f),u_sun_intensity:new c.Uniform1f(f),u_color_tint_r:new c.Uniform4f(f),u_color_tint_m:new c.Uniform4f(f),u_luminance:new c.Uniform1f(f)}),globeRaster:f=>({u_proj_matrix:new c.UniformMatrix4f(f),u_globe_matrix:new c.UniformMatrix4f(f),u_normalize_matrix:new c.UniformMatrix4f(f),u_merc_matrix:new c.UniformMatrix4f(f),u_zoom_transition:new c.Uniform1f(f),u_merc_center:new c.Uniform2f(f),u_image0:new c.Uniform1i(f),u_grid_matrix:new c.UniformMatrix3f(f),u_skirt_height:new c.Uniform1f(f),u_frustum_tl:new c.Uniform3f(f),u_frustum_tr:new c.Uniform3f(f),u_frustum_br:new c.Uniform3f(f),u_frustum_bl:new c.Uniform3f(f),u_globe_pos:new c.Uniform3f(f),u_globe_radius:new c.Uniform1f(f),u_viewport:new c.Uniform2f(f)}),globeAtmosphere:f=>({u_frustum_tl:new c.Uniform3f(f),u_frustum_tr:new c.Uniform3f(f),u_frustum_br:new c.Uniform3f(f),u_frustum_bl:new c.Uniform3f(f),u_horizon:new c.Uniform1f(f),u_transition:new c.Uniform1f(f),u_fadeout_range:new c.Uniform1f(f),u_color:new c.Uniform4f(f),u_high_color:new c.Uniform4f(f),u_space_color:new c.Uniform4f(f),u_star_intensity:new c.Uniform1f(f),u_star_density:new c.Uniform1f(f),u_star_size:new c.Uniform1f(f),u_temporal_offset:new c.Uniform1f(f),u_horizon_angle:new c.Uniform1f(f),u_rotation_matrix:new c.UniformMatrix4f(f)})};let Kn;function cu(f,s,h,g,v,w,E){const A=f.context,P=A.gl,z=f.transform,O=f.useProgram("collisionBox"),U=[];let q=0,W=0;for(let rt=0;rt<g.length;rt++){const pt=g[rt],dt=s.getTile(pt),xt=dt.getBucket(h);if(!xt)continue;const Et=Cc(pt,xt,z);let Lt=Et;0===v[0]&&0===v[1]||(Lt=f.translatePosMatrix(Et,dt,v,w));const Bt=E?xt.textCollisionBox:xt.iconCollisionBox,fe=xt.collisionCircleArray;if(fe.length>0){const Pt=c.create(),Yt=Lt;c.mul(Pt,xt.placementInvProjMatrix,z.glCoordMatrix),c.mul(Pt,Pt,xt.placementViewportMatrix),U.push({circleArray:fe,circleOffset:W,transform:Yt,invTransform:Pt,projection:xt.getProjection()}),q+=fe.length/4,W=q}Bt&&(f.terrain&&f.terrain.setupElevationDraw(dt,O),O.draw(A,P.LINES,c.DepthMode.disabled,c.StencilMode.disabled,f.colorModeForRenderPass(),c.CullFaceMode.disabled,ru(Lt,z,dt,xt.getProjection()),h.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,null,z.zoom,null,[Bt.collisionVertexBuffer,Bt.collisionVertexBufferExt]))}if(!E||!U.length)return;const X=f.useProgram("collisionCircle"),Y=new c.StructArrayLayout2f1f2i16;Y.resize(4*q),Y._trim();let J=0;for(const rt of U)for(let pt=0;pt<rt.circleArray.length/4;pt++){const dt=4*pt,xt=rt.circleArray[dt+0],Et=rt.circleArray[dt+1],Lt=rt.circleArray[dt+2],Bt=rt.circleArray[dt+3];Y.emplace(J++,xt,Et,Lt,Bt,0),Y.emplace(J++,xt,Et,Lt,Bt,1),Y.emplace(J++,xt,Et,Lt,Bt,2),Y.emplace(J++,xt,Et,Lt,Bt,3)}(!Kn||Kn.length<2*q)&&(Kn=function(rt){const pt=2*rt,dt=new c.StructArrayLayout3ui6;dt.resize(pt),dt._trim();for(let xt=0;xt<pt;xt++){const Et=6*xt;dt.uint16[Et+0]=4*xt+0,dt.uint16[Et+1]=4*xt+1,dt.uint16[Et+2]=4*xt+2,dt.uint16[Et+3]=4*xt+2,dt.uint16[Et+4]=4*xt+3,dt.uint16[Et+5]=4*xt+0}return dt}(q));const G=A.createIndexBuffer(Kn,!0),st=A.createVertexBuffer(Y,c.collisionCircleLayout.members,!0);for(const rt of U){const pt={u_matrix:rt.transform,u_inv_matrix:rt.invTransform,u_camera_to_center_distance:(it=z).getCameraToCenterDistance(rt.projection),u_viewport_size:[it.width,it.height]};X.draw(A,P.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,f.colorModeForRenderPass(),c.CullFaceMode.disabled,pt,h.id,st,G,c.SegmentVector.simpleSegment(0,2*rt.circleOffset,rt.circleArray.length,rt.circleArray.length/2),null,z.zoom)}var it;st.destroy(),G.destroy()}const Ci=c.create();function Ji({width:f,height:s,anchor:h,textOffset:g,textScale:v},w){const{horizontalAlign:E,verticalAlign:A}=c.getAnchorAlignment(h),P=-(E-.5)*f,z=-(A-.5)*s,O=c.evaluateVariableOffset(h,g);return new c.pointGeometry((P/v+O[0])*w,(z/v+O[1])*w)}function di(f,s,h,g,v,w,E,A,P,z,O){const U=f.text.placedSymbolArray,q=f.text.dynamicLayoutVertexArray,W=f.icon.dynamicLayoutVertexArray,X={},Y=f.getProjection(),J=Mc(A,Y,w),G=w.elevation,st=Y.upVectorScale(A.canonical,w.center.lat,w.worldSize).metersToTile;q.clear();for(let it=0;it<U.length;it++){const rt=U.get(it),{tileAnchorX:pt,tileAnchorY:dt,numGlyphs:xt}=rt,Lt=rt.hidden||!rt.crossTileID||f.allowVerticalPlacement&&!rt.placedOrientation?null:g[rt.crossTileID];if(Lt){let Bt=0,fe=0,Pt=0;if(G){const Be=G?G.getAtTileOffset(A,pt,dt):0,[ii,Ie,Ee]=Y.upVector(A.canonical,pt,dt);Bt=Be*ii*st,fe=Be*Ie*st,Pt=Be*Ee*st}let[Yt,Vt,ne,Ot]=xe(rt.projectedAnchorX+Bt,rt.projectedAnchorY+fe,rt.projectedAnchorZ+Pt,h?J:E);const wt=hi(w.getCameraToCenterDistance(Y),Ot);let Nt=v.evaluateSizeForFeature(f.textSizeData,z,rt)*wt/c.ONE_EM;h&&(Nt*=f.tilePixelRatio/P);const ee=Ji(Lt,Nt);h?(({x:Yt,y:Vt,z:ne}=Y.projectTilePoint(pt+ee.x,dt+ee.y,A.canonical)),[Yt,Vt,ne]=xe(Yt+Bt,Vt+fe,ne+Pt,E)):(s&&ee._rotate(-w.angle),Yt+=ee.x,Vt+=ee.y,ne=0);const se=f.allowVerticalPlacement&&rt.placedOrientation===c.WritingMode.vertical?Math.PI/2:0;for(let Be=0;Be<xt;Be++)c.addDynamicAttributes(q,Yt,Vt,ne,se);O&&rt.associatedIconIndex>=0&&(X[rt.associatedIconIndex]={x:Yt,y:Vt,z:ne,angle:se})}else Ui(xt,q)}if(O){W.clear();const it=f.icon.placedSymbolArray;for(let rt=0;rt<it.length;rt++){const pt=it.get(rt),{numGlyphs:dt}=pt,xt=X[rt];if(pt.hidden||!xt)Ui(dt,W);else{const{x:Et,y:Lt,z:Bt,angle:fe}=xt;for(let Pt=0;Pt<dt;Pt++)c.addDynamicAttributes(W,Et,Lt,Bt,fe)}}f.icon.dynamicLayoutVertexBuffer.updateData(W)}f.text.dynamicLayoutVertexBuffer.updateData(q)}function yn(f,s,h){return h.iconsInText&&s?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function hs(f,s,h,g,v,w,E,A,P,z,O,U){const q=f.context,W=q.gl,X=f.transform,Y="map"===A,J="map"===P,G=Y&&"point"!==h.layout.get("symbol-placement"),st=Y&&!J&&!G,it=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let rt=!1;const pt=f.depthModeForSublayer(0,c.DepthMode.ReadOnly),dt=[c.mercatorXfromLng(X.center.lng),c.mercatorYfromLat(X.center.lat)],xt=h.layout.get("text-variable-anchor"),Et="globe"===X.projection.name,Lt=[],Bt=[0,-1,0];let fe=Bt;!Et&&!X.mercatorFromTransition||Y||(fe=function(Pt){const Yt=Pt._camera.getWorldToCamera(Pt.worldSize,1),Vt=c.multiply([],Yt,Pt.globeMatrix);c.invert(Vt,Vt);const ne=[0,0,0],Ot=[0,1,0,0];return c.transformMat4$1(Ot,Ot,Vt),ne[0]=Ot[0],ne[1]=Ot[1],ne[2]=Ot[2],c.normalize(ne,ne),ne}(X));for(const Pt of g){const Yt=s.getTile(Pt),Vt=Yt.getBucket(h);if(!Vt||"mercator"===Vt.projection.name&&Et)continue;const ne=v?Vt.text:Vt.icon;if(!ne||Vt.fullyClipped||!ne.segments.get().length)continue;const Ot=ne.programConfigurations.get(h.id),wt=v||Vt.sdfIcons,Nt=v?Vt.textSizeData:Vt.iconSizeData,ee=J||0!==X.pitch,se=c.evaluateSizeForZoom(Nt,X.zoom);let Be,ii,Ie,Ee,Ue=[0,0],ri=null;if(v)ii=Yt.glyphAtlasTexture,Ie=W.LINEAR,Be=Yt.glyphAtlasTexture.size,Vt.iconsInText&&(Ue=Yt.imageAtlasTexture.size,ri=Yt.imageAtlasTexture,Ee=ee||f.options.rotating||f.options.zooming||"composite"===Nt.kind||"camera"===Nt.kind?W.LINEAR:W.NEAREST);else{const Es=1!==h.layout.get("icon-size").constantOr(0)||Vt.iconsNeedLinear;ii=Yt.imageAtlasTexture,Ie=wt||f.options.rotating||f.options.zooming||Es||ee?W.LINEAR:W.NEAREST,Be=Yt.imageAtlasTexture.size}const je="globe"===Vt.projection.name,xi=je?fe:Bt,Ei=je?c.globeToMercatorTransition(X.zoom):0,Ni=Mc(Pt,Vt.getProjection(),X),zi=X.calculatePixelsToTileUnitsMatrix(Yt),Wi=_r(Ni,Yt.tileID.canonical,J,Y,X,Vt.getProjection(),zi),ds=f.terrain&&J&&G?c.invert(c.create(),Wi):Ci,Js=Ao(Ni,Yt.tileID.canonical,J,Y,X,Vt.getProjection(),zi),ts=xt&&Vt.hasTextData(),Xi="none"!==h.layout.get("icon-text-fit")&&ts&&Vt.hasIconData();if(G){const Es=X.elevation,Vn=Es?Es.getAtTileOffsetFunc(Pt,X.center.lat,X.worldSize,Vt.getProjection()):null,fo=Kh(Ni,Yt.tileID.canonical,J,Y,X,Vt.getProjection(),zi);$s(Vt,Ni,f,v,fo,Js,J,z,Vn,Pt)}const Di=G||v&&xt||Xi,wi=f.translatePosMatrix(Ni,Yt,w,E),un=Di?Ci:Wi,$n=f.translatePosMatrix(Js,Yt,w,E,!0),Vi=Vt.getProjection().createInversionMatrix(X,Pt.canonical),xn=[];f.terrainRenderModeElevated()&&J&&xn.push("PITCH_WITH_MAP_TERRAIN"),je&&xn.push("PROJECTION_GLOBE_VIEW"),Di&&xn.push("PROJECTED_POS_ON_VIEWPORT");const Wn=wt&&0!==h.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1);let cr;cr=wt?Vt.iconsInText?Ul(Nt.kind,se,st,J,f,wi,un,$n,Be,Ue,Pt,Ei,dt,Vi,xi,Vt.getProjection()):Oc(Nt.kind,se,st,J,f,wi,un,$n,v,Be,!0,Pt,Ei,dt,Vi,xi,Vt.getProjection()):ir(Nt.kind,se,st,J,f,wi,un,$n,v,Be,Pt,Ei,dt,Vi,xi,Vt.getProjection());const ya={program:f.useProgram(yn(wt,v,Vt),Ot,xn),buffers:ne,uniformValues:cr,atlasTexture:ii,atlasTextureIcon:ri,atlasInterpolation:Ie,atlasInterpolationIcon:Ee,isSDF:wt,hasHalo:Wn,tile:Yt,labelPlaneMatrixInv:ds};if(it&&Vt.canOverlap){rt=!0;const Es=ne.segments.get();for(const Vn of Es)Lt.push({segments:new c.SegmentVector([Vn]),sortKey:Vn.sortKey,state:ya})}else Lt.push({segments:ne.segments,sortKey:0,state:ya})}rt&&Lt.sort((Pt,Yt)=>Pt.sortKey-Yt.sortKey);for(const Pt of Lt){const Yt=Pt.state;if(f.terrain&&f.terrain.setupElevationDraw(Yt.tile,Yt.program,{useDepthForOcclusion:!Et,labelPlaneMatrixInv:Yt.labelPlaneMatrixInv}),q.activeTexture.set(W.TEXTURE0),Yt.atlasTexture.bind(Yt.atlasInterpolation,W.CLAMP_TO_EDGE),Yt.atlasTextureIcon&&(q.activeTexture.set(W.TEXTURE1),Yt.atlasTextureIcon&&Yt.atlasTextureIcon.bind(Yt.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),Yt.isSDF){const Vt=Yt.uniformValues;Yt.hasHalo&&(Vt.u_is_halo=1,oi(Yt.buffers,Pt.segments,h,f,Yt.program,pt,O,U,Vt)),Vt.u_is_halo=0}oi(Yt.buffers,Pt.segments,h,f,Yt.program,pt,O,U,Yt.uniformValues)}}function oi(f,s,h,g,v,w,E,A,P){const z=g.context,O=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.globeExtVertexBuffer];v.draw(z,z.gl.TRIANGLES,w,E,A,c.CullFaceMode.disabled,P,h.id,f.layoutVertexBuffer,f.indexBuffer,s,h.paint,g.transform.zoom,f.programConfigurations.get(h.id),O)}function hu(f,s,h,g,v,w,E){const A=f.context.gl,P=h.paint.get("fill-pattern"),z=P&&P.constantOr(1);let O,U,q,W,X;E?(U=z&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=A.LINES):(U=z?"fillPattern":"fill",O=A.TRIANGLES);for(const Y of g){const J=s.getTile(Y);if(z&&!J.patternsLoaded())continue;const G=J.getBucket(h);if(!G)continue;f.prepareDrawTile();const st=G.programConfigurations.get(h.id),it=f.useProgram(U,st);z&&(f.context.activeTexture.set(A.TEXTURE0),J.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),st.updatePaintBuffers());const rt=P.constantOr(null);if(rt&&J.imageAtlas){const dt=J.imageAtlas.patternPositions[rt.toString()];dt&&st.setConstantPatternPositions(dt)}const pt=f.translatePosMatrix(Y.projMatrix,J,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){W=G.indexBuffer2,X=G.segments2;const dt=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];q="fillOutlinePattern"===U&&z?su(pt,f,J,dt):nu(pt,dt)}else W=G.indexBuffer,X=G.segments,q=z?aa(pt,f,J):ra(pt);f.prepareDrawProgram(f.context,it,Y.toUnwrapped()),it.draw(f.context,O,v,f.stencilModeForClipping(Y),w,c.CullFaceMode.disabled,q,h.id,G.layoutVertexBuffer,W,X,h.paint,f.transform.zoom,st)}}function Nl(f,s,h,g,v,w,E){const A=f.context,P=A.gl,z=f.transform,O=h.paint.get("fill-extrusion-pattern"),U=O.constantOr(1),q=h.paint.get("fill-extrusion-opacity"),W=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],X=h.layout.get("fill-extrusion-edge-radius"),Y="globe"===z.projection.name?c.fillExtrusionHeightLift():0,J="globe"===z.projection.name,G=J?c.globeToMercatorTransition(z.zoom):0,st=[c.mercatorXfromLng(z.center.lng),c.mercatorYfromLat(z.center.lat)],it=[];J&&it.push("PROJECTION_GLOBE_VIEW"),W[0]>0&&it.push("FAUX_AO");for(const rt of g){const pt=s.getTile(rt),dt=pt.getBucket(h);if(!dt||dt.projection.name!==z.projection.name)continue;const xt=dt.programConfigurations.get(h.id),Et=f.useProgram(U?"fillExtrusionPattern":"fillExtrusion",xt,it);if(f.terrain){const ne=f.terrain;if(f.style.terrainSetForDrapingOnly())ne.setupElevationDraw(pt,Et,{useMeterToDem:!0});else{if(!dt.enableTerrain)continue;if(ne.setupElevationDraw(pt,Et,{useMeterToDem:!0}),Ki(A,s,rt,dt,h,ne),!dt.centroidVertexBuffer){const Ot=Et.attributes.a_centroid_pos;void 0!==Ot&&P.vertexAttrib2f(Ot,0,0)}}}U&&(f.context.activeTexture.set(P.TEXTURE0),pt.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),xt.updatePaintBuffers());const Lt=O.constantOr(null);if(Lt&&pt.imageAtlas){const ne=pt.imageAtlas.patternPositions[Lt.toString()];ne&&xt.setConstantPatternPositions(ne)}const Bt=f.translatePosMatrix(rt.projMatrix,pt,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),fe=z.projection.createInversionMatrix(z,rt.canonical),Pt=h.paint.get("fill-extrusion-vertical-gradient"),Yt=U?ja(Bt,f,Pt,q,W,X,rt,pt,Y,G,st,fe):zl(Bt,f,Pt,q,W,X,rt,Y,G,st,fe);f.prepareDrawProgram(A,Et,rt.toUnwrapped());const Vt=[];f.terrain&&Vt.push(dt.centroidVertexBuffer),J&&Vt.push(dt.layoutVertexExtBuffer),Et.draw(A,A.gl.TRIANGLES,v,w,E,c.CullFaceMode.backCCW,Yt,h.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,h.paint,f.transform.zoom,xt,Vt)}}function Ki(f,s,h,g,v,w){const E=[G=>{let st=G.canonical.x-1,it=G.wrap;return st<0&&(st=(1<<G.canonical.z)-1,it--),new c.OverscaledTileID(G.overscaledZ,it,G.canonical.z,st,G.canonical.y)},G=>{let st=G.canonical.x+1,it=G.wrap;return st===1<<G.canonical.z&&(st=0,it++),new c.OverscaledTileID(G.overscaledZ,it,G.canonical.z,st,G.canonical.y)},G=>new c.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,(0===G.canonical.y?1<<G.canonical.z:G.canonical.y)-1),G=>new c.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y===(1<<G.canonical.z)-1?0:G.canonical.y+1)],A=G=>{const st=s.getSource().minzoom,it=pt=>{const dt=s.getTileByID(pt);if(dt&&dt.hasData())return dt.getBucket(v)},rt=[0,-1,1];for(const pt of rt){if(G.overscaledZ+pt<st)continue;const dt=it(G.calculateScaledKey(G.overscaledZ+pt));if(dt)return dt}},P=[0,0,0],z=(G,st)=>(P[0]=Math.min(G.min.y,st.min.y),P[1]=Math.max(G.max.y,st.max.y),P[2]=c.EXTENT-st.min.x>G.max.x?st.min.x-c.EXTENT:G.max.x,P),O=(G,st)=>(P[0]=Math.min(G.min.x,st.min.x),P[1]=Math.max(G.max.x,st.max.x),P[2]=c.EXTENT-st.min.y>G.max.y?st.min.y-c.EXTENT:G.max.y,P),U=[(G,st)=>z(G,st),(G,st)=>z(st,G),(G,st)=>O(G,st),(G,st)=>O(st,G)],q=new c.pointGeometry(0,0);let W,X,Y;const J=(G,st,it,rt,pt)=>{const dt=[[rt?it:G,rt?G:it,0],[rt?it:st,rt?st:it,0]],xt=pt<0?c.EXTENT+pt:pt,Et=[rt?xt:(G+st)/2,rt?(G+st)/2:xt,0];return 0===it&&pt<0||0!==it&&pt>0?w.getForTilePoints(Y,[Et],!0,X):dt.push(Et),w.getForTilePoints(h,dt,!0,W),Math.max(dt[0][2],dt[1][2],Et[2])/w.exaggeration()};for(let G=0;G<4;G++){const st=(G<2?1:5)-G,it=g.borders[G];if(0===it.length)continue;const rt=Y=E[G](h),pt=A(rt);if(!(pt&&pt instanceof c.FillExtrusionBucket&&pt.enableTerrain)||g.borderDoneWithNeighborZ[G]===pt.canonical.z&&pt.borderDoneWithNeighborZ[st]===g.canonical.z||(X=w.findDEMTileFor(rt),!X||!X.dem))continue;if(!W){const Lt=w.findDEMTileFor(h);if(!Lt||!Lt.dem)return;W=Lt}const dt=pt.borders[st];let xt=0;const Et=pt.borderDoneWithNeighborZ[st]!==g.canonical.z;if(g.canonical.z===pt.canonical.z){for(let Lt=0;Lt<it.length;Lt++){const Bt=g.featuresOnBorder[it[Lt]],fe=Bt.borders[G];let Pt;for(;xt<dt.length&&(Pt=pt.featuresOnBorder[dt[xt]],!(Pt.borders[st][1]>fe[0]+3));)Et&&pt.encodeCentroid(void 0,Pt,!1),xt++;if(Pt&&xt<dt.length){const Yt=xt;let Vt=0;for(;!(Pt.borders[st][0]>fe[1]-3)&&(Vt++,++xt!==dt.length);)Pt=pt.featuresOnBorder[dt[xt]];if(Pt=pt.featuresOnBorder[dt[Yt]],Bt.intersectsCount()>1||Pt.intersectsCount()>1||1!==Vt){1!==Vt&&(xt=Yt),g.encodeCentroid(void 0,Bt,!1),Et&&pt.encodeCentroid(void 0,Pt,!1);continue}const ne=U[G](Bt,Pt),Ot=G%2?c.EXTENT-1:0;q.x=J(ne[0],Math.min(c.EXTENT-1,ne[1]),Ot,G<2,ne[2]),q.y=0,g.encodeCentroid(q,Bt,!1),Et&&pt.encodeCentroid(q,Pt,!1)}else g.encodeCentroid(void 0,Bt,!1)}g.borderDoneWithNeighborZ[G]=pt.canonical.z,g.needsCentroidUpdate=!0,Et&&(pt.borderDoneWithNeighborZ[st]=g.canonical.z,pt.needsCentroidUpdate=!0)}else{for(const Lt of it)g.encodeCentroid(void 0,g.featuresOnBorder[Lt],!1);if(Et){for(const Lt of dt)pt.encodeCentroid(void 0,pt.featuresOnBorder[Lt],!1);pt.borderDoneWithNeighborZ[st]=g.canonical.z,pt.needsCentroidUpdate=!0}g.borderDoneWithNeighborZ[G]=pt.canonical.z,g.needsCentroidUpdate=!0}}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&0!==g.centroidVertexArray.length)&&g.uploadCentroid(f)}const Li=new c.Color(1,0,0,1),ha=new c.Color(0,1,0,1),qa=new c.Color(0,0,1,1),Bc=new c.Color(1,0,1,1),uu=new c.Color(0,1,1,1);function wr(f,s,h){const g=f.context,v=f.transform,w=g.gl,E="globe"===v.projection.name,A=E?["PROJECTION_GLOBE_VIEW"]:null;let P=h.projMatrix;if(E&&c.globeToMercatorTransition(v.zoom)>0){const Bt=c.transitionTileAABBinECEF(h.canonical,v),fe=c.globeDenormalizeECEF(Bt);P=c.multiply(new Float32Array(16),v.globeMatrix,fe),c.multiply(P,v.projMatrix,P)}const z=f.useProgram("debug",null,A),O=s.getTileByID(h.key);f.terrain&&f.terrain.setupElevationDraw(O,z);const U=c.DepthMode.disabled,q=c.StencilMode.disabled,W=f.colorModeForRenderPass(),X="$debug";g.activeTexture.set(w.TEXTURE0),f.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),E?O._makeGlobeTileDebugBuffers(f.context,v):O._makeDebugTileBoundsBuffers(f.context,v.projection);const Y=O._tileDebugBuffer||f.debugBuffer,J=O._tileDebugIndexBuffer||f.debugIndexBuffer,G=O._tileDebugSegments||f.debugSegments;z.draw(g,w.LINE_STRIP,U,q,W,c.CullFaceMode.disabled,la(P,c.Color.red),X,Y,J,G,null,null,null,[O._globeTileDebugBorderBuffer]);const st=O.latestRawTileData,it=Math.floor((st&&st.byteLength||0)/1024),rt=s.getTile(h).tileSize,pt=512/Math.min(rt,512)*(h.overscaledZ/v.zoom)*.5;let dt=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(dt+=` => ${h.overscaledZ}`),dt+=` ${it}kb`,function(Bt,fe){Bt.initDebugOverlayCanvas();const Pt=Bt.debugOverlayCanvas,Yt=Bt.context.gl,Vt=Bt.debugOverlayCanvas.getContext("2d");Vt.clearRect(0,0,Pt.width,Pt.height),Vt.shadowColor="white",Vt.shadowBlur=2,Vt.lineWidth=1.5,Vt.strokeStyle="white",Vt.textBaseline="top",Vt.font="bold 36px Open Sans, sans-serif",Vt.fillText(fe,5,5),Vt.strokeText(fe,5,5),Bt.debugOverlayTexture.update(Pt),Bt.debugOverlayTexture.bind(Yt.LINEAR,Yt.CLAMP_TO_EDGE)}(f,dt);const xt=O._tileDebugTextBuffer||f.debugBuffer,Et=O._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Lt=O._tileDebugTextSegments||f.debugSegments;z.draw(g,w.TRIANGLES,U,q,c.ColorMode.alphaBlended,c.CullFaceMode.disabled,la(P,c.Color.transparent,pt),X,xt,Et,Lt,null,null,null,[O._globeTileDebugTextBuffer])}function zs(f,s,h,g){Vl(f,0,s+h/2,f.transform.width,h,g)}function ua(f,s,h,g){Vl(f,s-h/2,0,h,f.transform.height,g)}function Vl(f,s,h,g,v,w){const E=f.context,A=E.gl;A.enable(A.SCISSOR_TEST),A.scissor(s*c.exported.devicePixelRatio,h*c.exported.devicePixelRatio,g*c.exported.devicePixelRatio,v*c.exported.devicePixelRatio),E.clear({color:w}),A.disable(A.SCISSOR_TEST)}const Tr=c.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:da}=Tr;function Lo(f,s,h,g){f.emplaceBack(s,h,g)}class Ws{constructor(s){this.vertexArray=new c.StructArrayLayout3f12,this.indices=new c.StructArrayLayout3ui6,Lo(this.vertexArray,-1,-1,1),Lo(this.vertexArray,1,-1,1),Lo(this.vertexArray,-1,1,1),Lo(this.vertexArray,1,1,1),Lo(this.vertexArray,-1,-1,-1),Lo(this.vertexArray,1,-1,-1),Lo(this.vertexArray,-1,1,-1),Lo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,da),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=c.SegmentVector.simpleSegment(0,0,36,12)}}function pi(f,s,h,g,v,w){const E=f.gl,A=s.paint.get("sky-atmosphere-color"),P=s.paint.get("sky-atmosphere-halo-color"),z=s.paint.get("sky-atmosphere-sun-intensity"),O={u_matrix_3f:c.fromMat4(c.create$1(),g),u_sun_direction:v,u_sun_intensity:z,u_color_tint_r:[(X=A).r,X.g,X.b,X.a],u_color_tint_m:[(Y=P).r,Y.g,Y.b,Y.a],u_luminance:5e-5};var X,Y;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+w,s.skyboxTexture,0),h.draw(f,E.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.frontCW,O,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const sr=c.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class or{constructor(s){const h=new c.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const g=new c.StructArrayLayout3ui6;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(h,sr.members),this.indexBuffer=s.createIndexBuffer(g),this.segments=c.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const jl={symbol:function(f,s,h,g,v){if("translucent"!==f.renderPass)return;const w=c.StencilMode.disabled,E=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(A,P,z,O,U,q,W){const X=P.transform,Y="map"===U,J="map"===q;for(const G of A){const st=O.getTile(G),it=st.getBucket(z);if(!it||!it.text||!it.text.segments.get().length)continue;const rt=c.evaluateSizeForZoom(it.textSizeData,X.zoom),pt=Mc(G,it.getProjection(),X),dt=X.calculatePixelsToTileUnitsMatrix(st),xt=_r(pt,st.tileID.canonical,J,Y,X,it.getProjection(),dt),Et="none"!==z.layout.get("icon-text-fit")&&it.hasIconData();if(rt){const Lt=Math.pow(2,X.zoom-st.tileID.overscaledZ);di(it,Y,J,W,c.symbolSize,X,xt,G,Lt,rt,Et)}}}(g,f,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),v),0!==h.paint.get("icon-opacity").constantOr(1)&&hs(f,s,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),w,E),0!==h.paint.get("text-opacity").constantOr(1)&&hs(f,s,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),w,E),s.map.showCollisionBoxes&&(cu(f,s,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),cu(f,s,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(f,s,h,g){if("translucent"!==f.renderPass)return;const v=h.paint.get("circle-opacity"),w=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),A=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===v.constantOr(1)&&(0===w.constantOr(1)||0===E.constantOr(1)))return;const P=f.context,z=P.gl,O=f.transform,U=f.depthModeForSublayer(0,c.DepthMode.ReadOnly),q=c.StencilMode.disabled,W=f.colorModeForRenderPass(),X="globe"===O.projection.name,Y=[c.mercatorXfromLng(O.center.lng),c.mercatorYfromLat(O.center.lat)],J=[];for(let st=0;st<g.length;st++){const it=g[st],rt=s.getTile(it),pt=rt.getBucket(h);if(!pt||pt.projection.name!==O.projection.name)continue;const dt=pt.programConfigurations.get(h.id),xt=Ga(h);X&&xt.push("PROJECTION_GLOBE_VIEW");const Et=f.useProgram("circle",dt,xt),Lt=pt.layoutVertexBuffer,Bt=pt.globeExtVertexBuffer,fe=pt.indexBuffer,Pt=O.projection.createInversionMatrix(O,it.canonical),Yt={programConfiguration:dt,program:Et,layoutVertexBuffer:Lt,globeExtVertexBuffer:Bt,indexBuffer:fe,uniformValues:Za(f,it,rt,Pt,Y,h),tile:rt};if(A){const Vt=pt.segments.get();for(const ne of Vt)J.push({segments:new c.SegmentVector([ne]),sortKey:ne.sortKey,state:Yt})}else J.push({segments:pt.segments,sortKey:0,state:Yt})}A&&J.sort((st,it)=>st.sortKey-it.sortKey);const G={useDepthForOcclusion:!X};for(const st of J){const{programConfiguration:it,program:rt,layoutVertexBuffer:pt,globeExtVertexBuffer:dt,indexBuffer:xt,uniformValues:Et,tile:Lt}=st.state,Bt=st.segments;f.terrain&&f.terrain.setupElevationDraw(Lt,rt,G),f.prepareDrawProgram(P,rt,Lt.tileID.toUnwrapped()),rt.draw(P,z.TRIANGLES,U,q,W,c.CullFaceMode.disabled,Et,h.id,pt,xt,Bt,h.paint,O.zoom,it,[dt])}},heatmap:function(f,s,h,g){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const v=f.context,w=v.gl,E=c.StencilMode.disabled,A=new c.ColorMode([w.ONE,w.ONE],c.Color.transparent,[!0,!0,!0,!0]);(function(W,X,Y,J){const G=W.gl,st=X.width*J,it=X.height*J;W.activeTexture.set(G.TEXTURE1),W.viewport.set([0,0,st,it]);let rt=Y.heatmapFbo;if(!rt||rt&&(rt.width!==st||rt.height!==it)){rt&&rt.destroy();const pt=G.createTexture();G.bindTexture(G.TEXTURE_2D,pt),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),rt=Y.heatmapFbo=W.createFramebuffer(st,it,!1),function(dt,xt,Et,Lt,Bt,fe){const Pt=dt.gl;Pt.texImage2D(Pt.TEXTURE_2D,0,dt.isWebGL2&&dt.extRenderToTextureHalfFloat?Pt.RGBA16F:Pt.RGBA,Bt,fe,0,Pt.RGBA,dt.extRenderToTextureHalfFloat?dt.isWebGL2?Pt.HALF_FLOAT:dt.extTextureHalfFloat.HALF_FLOAT_OES:Pt.UNSIGNED_BYTE,null),Lt.colorAttachment.set(Et)}(W,0,pt,rt,st,it)}else G.bindTexture(G.TEXTURE_2D,rt.colorAttachment.get()),W.bindFramebuffer.set(rt.framebuffer)})(v,f,h,"globe"===f.transform.projection.name?.5:.25),v.clear({color:c.Color.transparent});const P=f.transform,z="globe"===P.projection.name,O=z?["PROJECTION_GLOBE_VIEW"]:null,U=z?c.CullFaceMode.frontCCW:c.CullFaceMode.disabled,q=[c.mercatorXfromLng(P.center.lng),c.mercatorYfromLat(P.center.lat)];for(let W=0;W<g.length;W++){const X=g[W];if(s.hasRenderableParent(X))continue;const Y=s.getTile(X),J=Y.getBucket(h);if(!J||J.projection.name!==P.projection.name)continue;const G=J.programConfigurations.get(h.id),st=f.useProgram("heatmap",G,O),{zoom:it}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Y,st),f.prepareDrawProgram(v,st,X.toUnwrapped());const rt=P.projection.createInversionMatrix(P,X.canonical);st.draw(v,w.TRIANGLES,c.DepthMode.disabled,E,A,U,co(f,X,Y,rt,q,it,h.paint.get("heatmap-intensity")),h.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,h.paint,f.transform.zoom,G,z?[J.globeExtVertexBuffer]:null)}v.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(v,w){const E=v.context,A=E.gl,P=w.heatmapFbo;if(!P)return;E.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,P.colorAttachment.get()),E.activeTexture.set(A.TEXTURE1);let z=w.colorRampTexture;z||(z=w.colorRampTexture=new c.Texture(E,w.colorRamp,A.RGBA)),z.bind(A.LINEAR,A.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(E,A.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,v.colorModeForRenderPass(),c.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:w.paint.get("heatmap-opacity")},w.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,w.paint,v.transform.zoom)}(f,h))},line:function(f,s,h,g){if("translucent"!==f.renderPass)return;const v=h.paint.get("line-opacity"),w=h.paint.get("line-width");if(0===v.constantOr(1)||0===w.constantOr(1))return;const E=f.depthModeForSublayer(0,c.DepthMode.ReadOnly),A=f.colorModeForRenderPass(),P=f.terrain&&f.terrain.renderingToTexture?1:c.exported.devicePixelRatio,z=h.paint.get("line-dasharray"),O=z.constantOr(1),U=h.layout.get("line-cap"),q=h.paint.get("line-pattern"),W=q.constantOr(1),X=h.paint.get("line-gradient"),Y=W?"linePattern":"line",J=f.context,G=J.gl,st=(rt=>{const pt=[];Fl(rt)&&pt.push("RENDER_LINE_DASH"),rt.paint.get("line-gradient")&&pt.push("RENDER_LINE_GRADIENT");const dt=rt.paint.get("line-trim-offset");0===dt[0]&&0===dt[1]||pt.push("RENDER_LINE_TRIM_OFFSET");const xt=rt.paint.get("line-pattern").constantOr(1),Et=1!==rt.paint.get("line-opacity").constantOr(1);return!xt&&Et&&pt.push("RENDER_LINE_ALPHA_DISCARD"),pt})(h);let it=st.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(it=!1);for(const rt of g){const pt=s.getTile(rt);if(W&&!pt.patternsLoaded())continue;const dt=pt.getBucket(h);if(!dt)continue;f.prepareDrawTile();const xt=dt.programConfigurations.get(h.id),Et=f.useProgram(Y,xt,st),Lt=q.constantOr(null);if(Lt&&pt.imageAtlas){const wt=pt.imageAtlas.patternPositions[Lt.toString()];wt&&xt.setConstantPatternPositions(wt)}const Bt=z.constantOr(null),fe=U.constantOr(null);if(!W&&Bt&&fe&&pt.lineAtlas){const wt=pt.lineAtlas.getDash(Bt,fe);wt&&xt.setConstantPatternPositions(wt)}let[Pt,Yt]=h.paint.get("line-trim-offset");("round"===fe||"square"===fe)&&Pt!==Yt&&(0===Pt&&(Pt-=1),1===Yt&&(Yt+=1));const Vt=f.terrain?rt.projMatrix:null,ne=W?au(f,pt,h,Vt,P):ca(f,pt,h,Vt,dt.lineClipsArray.length,P,[Pt,Yt]);if(X){const wt=dt.gradients[h.id];let Nt=wt.texture;if(h.gradientVersion!==wt.version){let ee=256;if(h.stepInterpolant){const se=s.getSource().maxzoom,Be=rt.canonical.z===se?Math.ceil(1<<f.transform.maxZoom-rt.canonical.z):1;ee=c.clamp(c.nextPowerOfTwo(dt.maxLineLength/c.EXTENT*1024*Be),256,J.maxTextureSize)}wt.gradient=c.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:ee,image:wt.gradient||void 0,clips:dt.lineClipsArray}),wt.texture?wt.texture.update(wt.gradient):wt.texture=new c.Texture(J,wt.gradient,G.RGBA),wt.version=h.gradientVersion,Nt=wt.texture}J.activeTexture.set(G.TEXTURE1),Nt.bind(h.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}O&&(J.activeTexture.set(G.TEXTURE0),pt.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),xt.updatePaintBuffers()),W&&(J.activeTexture.set(G.TEXTURE0),pt.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),xt.updatePaintBuffers()),f.prepareDrawProgram(J,Et,rt.toUnwrapped());const Ot=wt=>{Et.draw(J,G.TRIANGLES,E,wt,A,c.CullFaceMode.disabled,ne,h.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,h.paint,f.transform.zoom,xt,[dt.layoutVertexBuffer2])};if(it){const wt=f.stencilModeForClipping(rt).ref;0===wt&&f.terrain&&J.clear({stencil:0});const Nt={func:G.EQUAL,mask:255};ne.u_alpha_discard_threshold=.8,Ot(new c.StencilMode(Nt,wt,255,G.KEEP,G.KEEP,G.INVERT)),ne.u_alpha_discard_threshold=0,Ot(new c.StencilMode(Nt,wt,255,G.KEEP,G.KEEP,G.KEEP))}else Ot(f.stencilModeForClipping(rt))}it&&(f.resetStencilClippingMasks(),f.terrain&&J.clear({stencil:0}))},fill:function(f,s,h,g){const v=h.paint.get("fill-color"),w=h.paint.get("fill-opacity");if(0===w.constantOr(1))return;const E=f.colorModeForRenderPass(),A=h.paint.get("fill-pattern"),P=f.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===v.constantOr(c.Color.transparent).a&&1===w.constantOr(0)?"opaque":"translucent";if(f.renderPass===P){const z=f.depthModeForSublayer(1,"opaque"===f.renderPass?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly);hu(f,s,h,g,z,E,!1)}if("translucent"===f.renderPass&&h.paint.get("fill-antialias")){const z=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,c.DepthMode.ReadOnly);hu(f,s,h,g,z,E,!0)}},"fill-extrusion":function(f,s,h,g){const v=h.paint.get("fill-extrusion-opacity");if(0!==v&&"translucent"===f.renderPass){const w=new c.DepthMode(f.context.gl.LEQUAL,c.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==v||h.paint.get("fill-extrusion-pattern").constantOr(1))Nl(f,s,h,g,w,c.StencilMode.disabled,c.ColorMode.disabled),Nl(f,s,h,g,w,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const E=f.colorModeForRenderPass();Nl(f,s,h,g,w,c.StencilMode.disabled,E)}}},hillshade:function(f,s,h,g){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const v=f.context,w=f.depthModeForSublayer(0,c.DepthMode.ReadOnly),E=f.colorModeForRenderPass(),A=f.terrain&&f.terrain.renderingToTexture,[P,z]="translucent"!==f.renderPass||A?[{},g]:f.stencilConfigForOverlap(g);for(const O of z){const U=s.getTile(O);if(U.needsHillshadePrepare&&"offscreen"===f.renderPass)tr(f,U,h,w,c.StencilMode.disabled,E);else if("translucent"===f.renderPass){const q=A&&f.terrain?f.terrain.stencilModeForRTTOverlap(O):P[O.overscaledZ];ao(f,O,U,h,w,q,E)}}v.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,s,h,g,v,w){if("translucent"!==f.renderPass||0===h.paint.get("raster-opacity")||!g.length)return;const E=f.context,A=E.gl,P=s.getSource(),z=f.useProgram("raster"),O=f.colorModeForRenderPass(),U=f.terrain&&f.terrain.renderingToTexture,[q,W]=P instanceof yt||U?[{},g]:f.stencilConfigForOverlap(g),X=W[W.length-1].overscaledZ,Y=!f.options.moving;for(const J of W){const G=U?c.DepthMode.disabled:f.depthModeForSublayer(J.overscaledZ-X,1===h.paint.get("raster-opacity")?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly,A.LESS),st=J.toUnwrapped(),it=s.getTile(J);if(U&&(!it||!it.hasData()))continue;const rt=U?J.projMatrix:f.transform.calculateProjMatrix(st,Y),pt=f.terrain&&U?f.terrain.stencilModeForRTTOverlap(J):q[J.overscaledZ],dt=w?0:h.paint.get("raster-fade-duration");it.registerFadeDuration(dt);const xt=s.findLoadedParent(J,0),Et=Va(it,xt,s,f.transform,dt);let Lt,Bt;f.terrain&&f.terrain.prepareDrawTile();const fe="nearest"===h.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;E.activeTexture.set(A.TEXTURE0),it.texture.bind(fe,A.CLAMP_TO_EDGE),E.activeTexture.set(A.TEXTURE1),xt?(xt.texture.bind(fe,A.CLAMP_TO_EDGE),Lt=Math.pow(2,xt.tileID.overscaledZ-it.tileID.overscaledZ),Bt=[it.tileID.canonical.x*Lt%1,it.tileID.canonical.y*Lt%1]):it.texture.bind(fe,A.CLAMP_TO_EDGE);const Pt=zc(rt,Bt||[0,0],Lt||1,Et,h,P instanceof yt?P.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(E,z,st),P instanceof yt)P.boundsBuffer&&P.boundsSegments&&z.draw(E,A.TRIANGLES,G,c.StencilMode.disabled,O,c.CullFaceMode.disabled,Pt,h.id,P.boundsBuffer,f.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:Yt,tileBoundsIndexBuffer:Vt,tileBoundsSegments:ne}=f.getTileBoundsBuffers(it);z.draw(E,A.TRIANGLES,G,pt,O,c.CullFaceMode.disabled,Pt,h.id,Yt,Vt,ne)}}f.resetStencilClippingMasks()},background:function(f,s,h,g){const v=h.paint.get("background-color"),w=h.paint.get("background-opacity");if(0===w)return;const E=f.context,A=E.gl,P=f.transform,z=P.tileSize,O=h.paint.get("background-pattern");if(f.isPatternMissing(O))return;const U=!O&&1===v.a&&1===w&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==U)return;const q=c.StencilMode.disabled,W=f.depthModeForSublayer(0,"opaque"===U?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly),X=f.colorModeForRenderPass(),Y=f.useProgram(O?"backgroundPattern":"background");let J,G=g;G||(J=f.getBackgroundTiles(),G=Object.values(J).map(st=>st.tileID)),O&&(E.activeTexture.set(A.TEXTURE0),f.imageManager.bind(f.context));for(const st of G){const it=st.toUnwrapped(),rt=g?st.projMatrix:f.transform.calculateProjMatrix(it);f.prepareDrawTile();const pt=s?s.getTile(st):J?J[st.key]:new c.Tile(st,z,P.zoom,f),dt=O?nr(rt,w,f,O,{tileID:st,tileSize:z}):yd(rt,w,v);f.prepareDrawProgram(E,Y,it);const{tileBoundsBuffer:xt,tileBoundsIndexBuffer:Et,tileBoundsSegments:Lt}=f.getTileBoundsBuffers(pt);Y.draw(E,A.TRIANGLES,W,q,X,c.CullFaceMode.disabled,dt,h.id,xt,Et,Lt)}},sky:function(f,s,h){const g=f.transform,v="mercator"===g.projection.name||"globe"===g.projection.name?1:c.smoothstep(7,8,g.zoom),w=h.paint.get("sky-opacity")*v;if(0===w)return;const E=f.context,A=h.paint.get("sky-type"),P=new c.DepthMode(E.gl.LEQUAL,c.DepthMode.ReadOnly,[0,1]),z=f.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===f.renderPass?h.needsSkyboxCapture(f)&&(function(O,U,q,W){const X=O.context,Y=X.gl;let J=U.skyboxFbo;if(!J){J=U.skyboxFbo=X.createFramebuffer(32,32,!1),U.skyboxGeometry=new Ws(X),U.skyboxTexture=X.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,U.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let rt=0;rt<6;++rt)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+rt,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(J.framebuffer),X.viewport.set([0,0,32,32]);const G=U.getCenter(O,!0),st=O.useProgram("skyboxCapture"),it=new Float64Array(16);c.identity(it),c.rotateY(it,it,.5*-Math.PI),pi(X,U,st,it,G,0),c.identity(it),c.rotateY(it,it,.5*Math.PI),pi(X,U,st,it,G,1),c.identity(it),c.rotateX(it,it,.5*-Math.PI),pi(X,U,st,it,G,2),c.identity(it),c.rotateX(it,it,.5*Math.PI),pi(X,U,st,it,G,3),c.identity(it),pi(X,U,st,it,G,4),c.identity(it),c.rotateY(it,it,Math.PI),pi(X,U,st,it,G,5),X.viewport.set([0,0,O.width,O.height])}(f,h),h.markSkyboxValid(f)):"sky"===f.renderPass&&function(O,U,q,W,X){const Y=O.context,J=Y.gl,G=O.transform,st=O.useProgram("skybox");Y.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,U.skyboxTexture);const it={u_matrix:G.skyboxMatrix,u_sun_direction:U.getCenter(O,!1),u_cubemap:0,u_opacity:W,u_temporal_offset:X};O.prepareDrawProgram(Y,st),st.draw(Y,J.TRIANGLES,q,c.StencilMode.disabled,O.colorModeForRenderPass(),c.CullFaceMode.backCW,it,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(f,h,P,w,z):"gradient"===A&&"sky"===f.renderPass&&function(O,U,q,W,X){const Y=O.context,J=Y.gl,G=O.transform,st=O.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new Ws(Y)),Y.activeTexture.set(J.TEXTURE0);let it=U.colorRampTexture;it||(it=U.colorRampTexture=new c.Texture(Y,U.colorRamp,J.RGBA)),it.bind(J.LINEAR,J.CLAMP_TO_EDGE);const rt=(pt=G.skyboxMatrix,dt=U.getCenter(O,!1),xt=U.paint.get("sky-gradient-radius"),Et=W,Lt=X,{u_matrix:pt,u_color_ramp:0,u_center_direction:dt,u_radius:c.degToRad(xt),u_opacity:Et,u_temporal_offset:Lt});var pt,dt,xt,Et,Lt;O.prepareDrawProgram(Y,st),st.draw(Y,J.TRIANGLES,q,c.StencilMode.disabled,O.colorModeForRenderPass(),c.CullFaceMode.backCW,rt,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(f,h,P,w,z)},debug:function(f,s,h){for(let g=0;g<h.length;g++)wr(f,s,h[g])},custom:function(f,s,h,g){const v=f.context,w=h.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||"offscreen"===f.renderPass)&&h.isLayerDraped()){if("offscreen"===f.renderPass){const E=w.prerender;if(E){if(f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),"globe"===f.transform.projection.name){const A=f.transform.pointMerc;E.call(w,v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),c.globeToMercatorTransition(f.transform.zoom),[A.x,A.y],f.transform.pixelsPerMeterRatio)}else E.call(w,v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState()}}else if("translucent"===f.renderPass){if(f.terrain&&f.terrain.renderingToTexture){const A=w.renderToTile;if(A){const P=g[0].canonical,z=new c.MercatorCoordinate(P.x+g[0].wrap*(1<<P.z),P.y,P.z);v.setDepthMode(c.DepthMode.disabled),v.setStencilMode(c.StencilMode.disabled),v.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),A.call(w,v.gl,z),v.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),v.setStencilMode(c.StencilMode.disabled);const E="3d"===w.renderingMode?new c.DepthMode(f.context.gl.LEQUAL,c.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,c.DepthMode.ReadOnly);if(v.setDepthMode(E),"globe"===f.transform.projection.name){const A=f.transform.pointMerc;w.render(v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),c.globeToMercatorTransition(f.transform.zoom),[A.x,A.y],f.transform.pixelsPerMeterRatio)}else w.render(v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState(),v.bindFramebuffer.set(null)}}else c.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ha{constructor(s,h,g=!1){this.context=new et(s,g),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=c.SourceCache.maxUnderzooming+c.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ac,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(s,h){const g=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Lc(this,s));const v=this._terrain;this.transform.elevation=g?v:null,v.update(s,this.transform,h)}_updateFog(s){const h=s.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=h.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const w=g+.78*(v-g);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(s,h){if(this.width=s*c.exported.devicePixelRatio,this.height=h*c.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const s=this.context,h=new c.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(c.EXTENT,0),h.emplaceBack(0,c.EXTENT),h.emplaceBack(c.EXTENT,c.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(h,c.posAttributes.members),this.tileExtentSegments=c.SegmentVector.simpleSegment(0,0,4,2);const g=new c.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(c.EXTENT,0),g.emplaceBack(0,c.EXTENT),g.emplaceBack(c.EXTENT,c.EXTENT),this.debugBuffer=s.createVertexBuffer(g,c.posAttributes.members),this.debugSegments=c.SegmentVector.simpleSegment(0,0,4,5);const v=new c.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,c.posAttributes.members),this.viewportSegments=c.SegmentVector.simpleSegment(0,0,4,2);const w=new c.StructArrayLayout4i8;w.emplaceBack(0,0,0,0),w.emplaceBack(c.EXTENT,0,c.EXTENT,0),w.emplaceBack(0,c.EXTENT,0,c.EXTENT),w.emplaceBack(c.EXTENT,c.EXTENT,c.EXTENT,c.EXTENT),this.mercatorBoundsBuffer=s.createVertexBuffer(w,c.boundsAttributes.members),this.mercatorBoundsSegments=c.SegmentVector.simpleSegment(0,0,4,2);const E=new c.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(E);const A=new c.StructArrayLayout1ui2;for(const z of[0,1,3,2,0])A.emplaceBack(z);this.debugIndexBuffer=s.createIndexBuffer(A),this.emptyTexture=new c.Texture(s,new c.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=c.create();const P=this.context.gl;this.stencilClearMode=new c.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(c.window.performance.now()),this.atmosphereBuffer=new or(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(s,h.TRIANGLES,c.DepthMode.disabled,this.stencilClearMode,c.ColorMode.disabled,c.CullFaceMode.disabled,ui(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,h,g){if(!h||this.currentStencilSource===h.id||!s.isTileClipped()||!g||0===g.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const P of g)if(void 0===this._tileClippingMaskIDs[P.key]){A=!0;break}if(!A)return}this.currentStencilSource=h.id;const v=this.context,w=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(c.ColorMode.disabled),v.setDepthMode(c.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of g){const P=h.getTile(A),z=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:U,tileBoundsSegments:q}=this.getTileBoundsBuffers(P);E.draw(v,w.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:w.ALWAYS,mask:0},z,255,w.KEEP,w.KEEP,w.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,ui(A.projMatrix),"$clipping",O,U,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new c.StencilMode({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const h=this.context.gl;return new c.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,g=s.sort((E,A)=>A.overscaledZ-E.overscaledZ),v=g[g.length-1].overscaledZ,w=g[0].overscaledZ-v+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const E={};for(let A=0;A<w;A++)E[A+v]=new c.StencilMode({func:h.GEQUAL,mask:255},A+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=w,[E,g]}return[{[v]:c.StencilMode.disabled},g]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new c.ColorMode([s.CONSTANT_COLOR,s.ONE],new c.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?c.ColorMode.unblended:c.ColorMode.alphaBlended}depthModeForSublayer(s,h,g){if(!this.opaquePassEnabledForLayer())return c.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new c.DepthMode(g||this.context.gl.LEQUAL,h,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(c.exported.now()),this.imageManager.beginFrame();const g=this.style.order,v=this.style._sourceCaches;for(const P in v){const z=v[P];z.used&&z.prepare(this.context)}const w={},E={},A={};for(const P in v){const z=v[P];w[P]=z.getVisibleCoordinates(),E[P]=w[P].slice().reverse(),A[P]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<g.length;P++)if(this.style._layers[g[P]].is3D()){this.opaquePassCutoff=P;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new c.GlobeSharedBuffers(this.context)),c.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const P of g){const z=this.style._layers[P],O=s._getLayerSourceCache(z);if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const U=O?E[O.id]:void 0;("custom"===z.type||z.isSky()||U&&U.length)&&this.renderLayer(this,O,z,U)}if(this.depthRangeFor3D=[0,1-(s.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?c.Color.black:c.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[g[this.currentLayer]],z=s._getLayerSourceCache(P);if(P.isSky())continue;const O=z?E[z.id]:void 0;this._renderTileClippingMasks(P,z,O),this.renderLayer(this,z,P,O)}if(this.style.fog&&this.transform.projection.supportsFog&&function(P,z){const O=P.context,U=O.gl,q=P.transform,W=new c.DepthMode(U.LEQUAL,c.DepthMode.ReadOnly,[0,1]),X=P.useProgram("globeAtmosphere",null,"globe"===q.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Y=c.globeToMercatorTransition(q.zoom),J=z.properties.get("color").toArray01(),G=z.properties.get("high-color").toArray01(),st=z.properties.get("space-color").toArray01PremultipliedAlpha(),it=c.identity$1([]);c.rotateY$1(it,it,-c.degToRad(q._center.lng)),c.rotateX$1(it,it,c.degToRad(q._center.lat)),c.rotateZ$1(it,it,q.angle),c.rotateX$1(it,it,-q._pitch);const rt=c.fromQuat(new Float32Array(16),it),pt=c.mapValue(z.properties.get("star-intensity"),0,1,0,.25),xt=c.mapValue(z.properties.get("horizon-blend"),0,1,5e-4,.25),Et=c.globeUseCustomAntiAliasing(P,O,q)&&5e-4===xt?q.worldSize/(2*Math.PI*1.025)-1:q.globeRadius,Lt=P.frameCounter/1e3%1,Bt=c.length(q.globeCenterInViewSpace),fe=Math.sqrt(Math.pow(Bt,2)-Math.pow(Et,2)),Pt=Math.acos(fe/Bt),Yt={u_frustum_tl:q.frustumCorners.TL,u_frustum_tr:q.frustumCorners.TR,u_frustum_br:q.frustumCorners.BR,u_frustum_bl:q.frustumCorners.BL,u_horizon:q.frustumCorners.horizon,u_transition:Y,u_fadeout_range:xt,u_color:J,u_high_color:G,u_space_color:st,u_star_intensity:pt,u_star_size:5*c.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Lt,u_horizon_angle:Pt,u_rotation_matrix:rt};P.prepareDrawProgram(O,X);const Vt=P.atmosphereBuffer;Vt&&X.draw(O,U.TRIANGLES,W,c.StencilMode.disabled,c.ColorMode.alphaBlended,c.CullFaceMode.backCW,Yt,"skybox",Vt.vertexBuffer,Vt.indexBuffer,Vt.segments)}(this,this.style.fog),this.renderPass="sky",(c.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const P=this.style._layers[g[this.currentLayer]],z=s._getLayerSourceCache(P);P.isSky()&&this.renderLayer(this,z,P,z?E[z.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const P=this.style._layers[g[this.currentLayer]],z=s._getLayerSourceCache(P);if(P.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(P)){if(P.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const O=z?("symbol"===P.type?A:E)[z.id]:void 0;this._renderTileClippingMasks(P,z,z?w[z.id]:void 0),this.renderLayer(this,z,P,O),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let P=null;c.values(this.style._layers).forEach(z=>{const O=s._getLayerSourceCache(z);O&&!z.isHidden(this.transform.zoom)&&(!P||P.getSource().maxzoom<O.getSource().maxzoom)&&(P=O)}),P&&this.options.showTileBoundaries&&jl.debug(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const z=P.transform.padding;zs(P,P.transform.height-(z.top||0),3,Li),zs(P,z.bottom||0,3,ha),ua(P,z.left||0,3,qa),ua(P,P.transform.width-(z.right||0),3,Bc);const O=P.transform.centerPoint;var U,q,W,X;Vl(U=P,(q=O.x)-1,(W=P.transform.height-O.y)-10,2,20,X=uu),Vl(U,q-10,W-1,20,2,X)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(c.window.performance.now()),this.saveCanvasCopy())}}renderLayer(s,h,g,v){g.isHidden(this.transform.zoom)||("background"===g.type||"sky"===g.type||"custom"===g.type||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),(!s.transform.projection.unsupportedLayers||!s.transform.projection.unsupportedLayers.includes(g.type)||s.terrain&&"custom"===g.type)&&jl[g.type](s,h,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let g=this.gpuTimers[s.id];g||(g=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),g.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,h=s.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),s.beginQueryEXT(s.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const h={};for(const g in s){const v=s[g],w=this.context.extTimerQuery,E=w.getQueryObjectEXT(v.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(v.query),h[g]=E}return h}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let g=0;for(const v of s)g+=h.getQueryObjectEXT(v,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(v);return g}translatePosMatrix(s,h,g,v,w){if(!g[0]&&!g[1])return s;const E=w?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(E){const z=Math.sin(E),O=Math.cos(E);g=[g[0]*O-g[1]*z,g[0]*z+g[1]*O]}const A=[w?g[0]:Pn(h,g[0],this.transform.zoom),w?g[1]:Pn(h,g[1],this.transform.zoom),0],P=new Float32Array(16);return c.translate(P,s,A),P}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){return null===s||void 0!==s&&!this.imageManager.getPattern(s.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const s=this.terrain&&this.terrain.renderingToTexture,h=this.terrain&&0===this.terrain.exaggeration(),g=this.style&&this.style.fog,v=[];return this.terrainRenderModeElevated()&&v.push("TERRAIN"),"globe"===this.transform.projection.name&&v.push("GLOBE"),h&&v.push("ZERO_EXAGGERATION"),g&&!s&&0!==g.getOpacity(this.transform.pitch)&&v.push("FOG"),s&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}useProgram(s,h,g){this.cache=this.cache||{};const v=g||[],w=this.currentGlobalDefines().concat(v),E=Rl.cacheKey(Qo[s],s,w,h);return this.cache[E]||(this.cache[E]=new Rl(this.context,s,Qo[s],h,Sp[s],w)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=c.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(s,h,g){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const w=v.getOpacity(this.transform.pitch),E=((A,P,z,O,U,q,W,X,Y,J,G)=>{const st=A.transform,it=P.properties.get("color").toArray01();it[3]=O;const rt=A.frameCounter/1e3%1;return{u_fog_matrix:z?st.calculateFogTileMatrix(z):A.identityMat,u_fog_range:P.getFovAdjustedRange(st._fov),u_fog_color:it,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_temporal_offset:rt,u_frustum_tl:U,u_frustum_tr:q,u_frustum_br:W,u_frustum_bl:X,u_globe_pos:Y,u_globe_radius:J,u_viewport:G,u_globe_transition:c.globeToMercatorTransition(st.zoom),u_is_globe:+("globe"===st.projection.name)}})(this,v,g,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*c.exported.devicePixelRatio,this.transform.height*c.exported.devicePixelRatio]);h.setFogUniformValues(s,E)}}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,h=s.createTexture();return s.bindTexture(s.TEXTURE_2D,h),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&0!==s.getOpacity(this.transform.pitch)}getBackgroundTiles(){const s=this._backgroundTiles,h=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)h[v.key]=s[v.key]||new c.Tile(v,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class Qi{constructor(s=0,h=0,g=0,v=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=g,this.right=v}interpolate(s,h,g){return null!=h.top&&null!=s.top&&(this.top=c.number(s.top,h.top,g)),null!=h.bottom&&null!=s.bottom&&(this.bottom=c.number(s.bottom,h.bottom,g)),null!=h.left&&null!=s.left&&(this.left=c.number(s.left,h.left,g)),null!=h.right&&null!=s.right&&(this.right=c.number(s.right,h.right,g)),this}getCenter(s,h){const g=c.clamp((this.left+s-this.right)/2,0,s),v=c.clamp((this.top+h-this.bottom)/2,0,h);return new c.pointGeometry(g,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Qi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function tn(f,s){const h=c.getColumn(f,3);c.fromQuat(f,s),c.setColumn(f,3,h)}function Zl(f,s){const h=c.identity$1([]);return c.rotateZ$1(h,h,-s),c.rotateX$1(h,h,-f),h}function $a(f,s){const h=[f[0],f[1],0],g=[s[0],s[1],0];if(c.length(h)>=1e-15){const E=c.normalize([],h);c.scale$2(g,E,c.dot(g,E)),s[0]=g[0],s[1]=g[1]}const v=c.cross([],s,f);if(c.len(v)<1e-15)return null;const w=Math.atan2(-v[1],v[0]);return Zl(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),w)}class Gl{constructor(s,h){this.position=s,this.orientation=h}get position(){return this._position}set position(s){if(s){const h=s instanceof c.MercatorCoordinate?s:new c.MercatorCoordinate(s[0],s[1],s[2]);this._renderWorldCopies&&(h.x=c.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(s,h){if(this.orientation=null,!this.position)return;const g=this._elevation?this._elevation.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(s)):0,v=this.position,w=c.MercatorCoordinate.fromLngLat(s,g),E=[w.x-v.x,w.y-v.y,w.z-v.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=$a(E,h)}setPitchBearing(s,h){this.orientation=Zl(c.degToRad(s),c.degToRad(-h))}}class $i{constructor(s,h){this._transform=c.identity([]),this.orientation=h,this.position=s}get mercatorPosition(){const s=this.position;return new c.MercatorCoordinate(s[0],s[1],s[2])}get position(){const s=c.getColumn(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var h;s&&c.setColumn(this._transform,3,[(h=s)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||c.identity$1([]),s&&tn(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,h){this._orientation=Zl(s,h),tn(this._transform,this._orientation)}forward(){const s=c.getColumn(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=c.getColumn(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=c.getColumn(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,h){const g=new Float64Array(16);return c.invert(g,this.getWorldToCamera(s,h)),g}getWorldToCameraPosition(s,h,g){const v=this.position;c.scale$2(v,v,-s);const w=new Float64Array(16);return c.fromScaling(w,[g,g,g]),c.translate(w,w,v),w[10]*=h,w}getWorldToCamera(s,h){const g=new Float64Array(16),v=new Float64Array(4),w=this.position;return c.conjugate(v,this._orientation),c.scale$2(w,w,-s),c.fromQuat(g,v),c.translate(g,g,w),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(s,h,g,v){const w=new Float64Array(16);return c.perspective(w,s,h,g,v),w}getDistanceToElevation(s,h=!1){const g=0===s?0:c.mercatorZfromAltitude(s,h?c.latFromMercatorY(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new $i([...this.position],[...this.orientation])}}function Os(f,s){const h=us(f.projection,f.zoom,f.width,f.height),g=function(w,E,A,P,z){const O=new c.LngLat(A.lng-180*Hn,A.lat),U=new c.LngLat(A.lng+180*Hn,A.lat),q=w.project(O.lng,O.lat),W=w.project(U.lng,U.lat),X=-Math.atan2(W.y-q.y,W.x-q.x),Y=c.MercatorCoordinate.fromLngLat(A);Y.y=c.clamp(Y.y,-.999975,.999975);const J=Y.toLngLat(),G=w.project(J.lng,J.lat),st=c.MercatorCoordinate.fromLngLat(J);st.x+=Hn;const it=st.toLngLat(),rt=w.project(it.lng,it.lat),pt=pa(rt.x-G.x,rt.y-G.y,X),dt=c.MercatorCoordinate.fromLngLat(J);dt.y+=Hn;const xt=dt.toLngLat(),Et=w.project(xt.lng,xt.lat),Lt=pa(Et.x-G.x,Et.y-G.y,X),Bt=Math.abs(pt.x)/Math.abs(Lt.y),fe=c.identity([]);c.rotateZ(fe,fe,-X*(1-(z?0:P)));const Pt=c.identity([]);return c.scale(Pt,Pt,[1,1-(1-Bt)*P,1]),Pt[4]=-Lt.x/Lt.y*P,c.rotateZ(Pt,Pt,X),c.multiply(Pt,fe,Pt),Pt}(f.projection,0,f.center,h,s),v=Wa(f);return c.scale(g,g,[v,v,1]),g}function Wa(f){const s=f.projection,h=us(f.projection,f.zoom,f.width,f.height),g=Ro(s,f.center),v=Ro(s,c.LngLat.convert(s.center));return Math.pow(2,g*h+(1-h)*v)}function us(f,s,h,g,v=1/0){const w=f.range;if(!w)return 0;const E=Math.min(v,Math.max(h,g)),A=Math.log(E/1024)/Math.LN2;return c.smoothstep(w[0]+A,w[1]+A,s)}const Hn=1/4e4;function Ro(f,s){const h=c.clamp(s.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),g=new c.LngLat(s.lng-180*Hn,h),v=new c.LngLat(s.lng+180*Hn,h),w=f.project(g.lng,h),E=f.project(v.lng,h),A=c.MercatorCoordinate.fromLngLat(g),P=c.MercatorCoordinate.fromLngLat(v),z=E.x-w.x,O=E.y-w.y,U=P.x-A.x,q=P.y-A.y,W=Math.sqrt((U*U+q*q)/(z*z+O*O));return Math.log(W)/Math.LN2}function pa(f,s,h){const g=Math.cos(h),v=Math.sin(h);return{x:f*g-s*v,y:f*v+s*g}}class Te{constructor(s,h,g,v,w,E,A){this.tileSize=512,this._renderWorldCopies=void 0===w||w,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(E),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new c.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Qi,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new $i,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const s=new Te(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(s,h=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||g)&&this._updateCameraOnTerrain(),(s||g)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return c.pick(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=c.getProjection(this.projectionOptions);const g=!p(h,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=c.getProjection({name:"mercator"});const h=s!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(s){void 0===s?s=!0:null===s&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return c.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.pointGeometry(this.width,this.height)}get bearing(){return c.wrap(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const h=-s*Math.PI/180;var g,v,w,E,A,P,z,O,U,q;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(g=new c.ARRAY_TYPE(4),c.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),v=this.rotationMatrix,E=this.angle,A=(w=this.rotationMatrix)[0],P=w[1],z=w[2],O=w[3],U=Math.sin(E),q=Math.cos(E),v[0]=A*q+z*U,v[1]=P*q+O*U,v[2]=A*-U+z*q,v[3]=P*-U+O*q)}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=c.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=c.degToRad(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const s=this._elevation;this._centerAltitude=s.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=s.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,w=0;for(let E=0;E<h.length;E++){const A=new c.pointGeometry(h[E][0]*this.width,g+h[E][1]*(this.height-g)),P=s.pointCoordinate(A);if(!P)continue;const z=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);v+=P[3]*z,w+=z}return 0===w?NaN:v/w}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const s=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*h,v=this._mercatorZfromZoom(s),w=this._mercatorZfromZoom(this._maxZoom),E=Math.max(v-g,w);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let g;g=s.z<this._camera.position[2]?[h.x,h.y,h.z]:[s.x,s.y,s.z];const v=c.length(c.sub([],this._camera.position,g));return c.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let h=!1;if(s.orientation&&!c.exactEquals(s.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(s.orientation)),s.position){const g=[s.position.x,s.position.y,s.position.z];c.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,h=new Gl;return h.position=new c.MercatorCoordinate(s[0],s[1],s[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(s){if(!c.length$1(s))return!1;c.normalize$1(s,s);const h=c.transformQuat([],[0,0,-1],s),g=c.transformQuat([],[0,-1,0],s);if(g[2]<0)return!1;const v=$a(h,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(s){const h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;s[2]=c.clamp(s[2],v/g,v/h),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,g){this._unmodified=!1,this._edgeInsets.interpolate(s,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new c.UnwrappedTileID(0,s)];if(this.renderWorldCopies){const g=this.pointCoordinate(new c.pointGeometry(0,0)),v=this.pointCoordinate(new c.pointGeometry(this.width,0)),w=this.pointCoordinate(new c.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new c.pointGeometry(0,this.height)),A=Math.floor(Math.min(g.x,v.x,w.x,E.x)),P=Math.floor(Math.max(g.x,v.x,w.x,E.x)),z=1;for(let O=A-z;O<=P+z;O++)0!==O&&h.push(new c.UnwrappedTileID(O,s))}return h}coveringTiles(s){let h=this.coveringZoomLevel(s);const g=h,v=this.elevation&&!s.isTerrainDEM,w="mercator"===this.projection.name;if(void 0!==s.minzoom&&h<s.minzoom)return[];void 0!==s.maxzoom&&h>s.maxzoom&&(h=s.maxzoom);const E=this.locationCoordinate(this.center),A=this.center.lat,P=1<<h,z=[P*E.x,P*E.y,0],O="globe"===this.projection.name,U=!O,q=c.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,U),W=O?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=P*c.mercatorZfromAltitude(1,this.center.lat),Y=this._camera.position[2]/c.mercatorZfromAltitude(1,this.center.lat),J=[P*W.x,P*W.y,Y*(U?1:X)],G=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),st=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,it=s.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,rt=s.isTerrainDEM?-it:this._elevation?this._elevation.getMinElevationBelowMSL():0,pt=this.projection.isReprojectedInTileSpace?Wa(this):1,dt=Ot=>{const Nt=new c.MercatorCoordinate(Ot.x+25e-6,Ot.y,Ot.z),ee=new c.MercatorCoordinate(Ot.x,Ot.y+25e-6,Ot.z),se=Ot.toLngLat(),Be=Nt.toLngLat(),ii=ee.toLngLat(),Ie=this.locationCoordinate(se),Ee=this.locationCoordinate(Be),Ue=this.locationCoordinate(ii),ri=Math.hypot(Ee.x-Ie.x,Ee.y-Ie.y),je=Math.hypot(Ue.x-Ie.x,Ue.y-Ie.y);return Math.sqrt(ri*je)*pt/25e-6},xt=Ot=>{const wt=it,Nt=rt;return{aabb:c.tileAABB(this,P,0,0,0,Ot,Nt,wt,this.projection),zoom:0,x:0,y:0,minZ:Nt,maxZ:wt,wrap:Ot,fullyVisible:!1}},Et=[];let Lt=[];const Bt=h,fe=s.reparseOverscaled?g:h,Pt=Ot=>Ot*Ot,Yt=Pt((Y-this._centerAltitude)*X),Vt=Ot=>{if(!this._elevation||!Ot.tileID||!w)return;const wt=this._elevation.getMinMaxForTile(Ot.tileID),Nt=Ot.aabb;wt?(Nt.min[2]=wt.min,Nt.max[2]=wt.max,Nt.center[2]=(Nt.min[2]+Nt.max[2])/2):(Ot.shouldSplit=ne(Ot),Ot.shouldSplit||(Nt.min[2]=Nt.max[2]=Nt.center[2]=this._centerAltitude))},ne=Ot=>{if(Ot.zoom<st)return!0;if(Ot.zoom===Bt)return!1;if(null!=Ot.shouldSplit)return Ot.shouldSplit;const wt=Ot.aabb.distanceX(J),Nt=Ot.aabb.distanceY(J);let ee=Yt,se=1;if(O){ee=Pt(Ot.aabb.distanceZ(J));const Ie=Math.pow(2,Ot.zoom),Ee=c.latFromMercatorY((Ot.y+1)/Ie),Ue=c.latFromMercatorY(Ot.y/Ie),ri=Math.min(Math.max(A,Ee),Ue),je=c.circumferenceAtLatitude(ri)/c.circumferenceAtLatitude(A);if(se=ri===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,je/this._mercatorScaleRatio),this.zoom<=c.GLOBE_ZOOM_THRESHOLD_MIN&&Ot.zoom===Bt-1&&je>=.9)return!0}else if(v&&(ee=Pt(Ot.aabb.distanceZ(J)*X)),this.projection.isReprojectedInTileSpace&&g<=5){const Ie=Math.pow(2,Ot.zoom),Ee=dt(new c.MercatorCoordinate((Ot.x+.5)/Ie,(Ot.y+.5)/Ie));se=Ee>.85?1:Ee}const Be=wt*wt+Nt*Nt+ee;return Be<Pt((1<<Bt-Ot.zoom)*G*se*((Ie,Ee)=>{if(Ee*Pt(.707)<Ie)return 1;const Ue=Math.sqrt(Ee/Ie);return Ue/(1.4144271570014144+(Math.pow(1.1,Ue-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ee,Yt),Be))};if(this.renderWorldCopies)for(let Ot=1;Ot<=3;Ot++)Et.push(xt(-Ot)),Et.push(xt(Ot));for(Et.push(xt(0));Et.length>0;){const Ot=Et.pop(),wt=Ot.x,Nt=Ot.y;let ee=Ot.fullyVisible;if(!ee){const se=Ot.aabb.intersects(q);if(0===se)continue;ee=2===se}if(Ot.zoom!==Bt&&ne(Ot))for(let se=0;se<4;se++){const Be=(wt<<1)+se%2,ii=(Nt<<1)+(se>>1),Ie={aabb:w?Ot.aabb.quadrant(se):c.tileAABB(this,P,Ot.zoom+1,Be,ii,Ot.wrap,Ot.minZ,Ot.maxZ,this.projection),zoom:Ot.zoom+1,x:Be,y:ii,wrap:Ot.wrap,fullyVisible:ee,tileID:void 0,shouldSplit:void 0,minZ:Ot.minZ,maxZ:Ot.maxZ};v&&!O&&(Ie.tileID=new c.OverscaledTileID(Ot.zoom+1===Bt?fe:Ot.zoom+1,Ot.wrap,Ot.zoom+1,Be,ii),Vt(Ie)),Et.push(Ie)}else{const se=Ot.zoom===Bt?fe:Ot.zoom;if(s.minzoom&&s.minzoom>se)continue;const Be=z[0]-(.5+wt+(Ot.wrap<<Ot.zoom))*(1<<h-Ot.zoom),ii=z[1]-.5-Nt,Ie=Ot.tileID?Ot.tileID:new c.OverscaledTileID(se,Ot.wrap,Ot.zoom,wt,Nt);Lt.push({tileID:Ie,distanceSq:Be*Be+ii*ii})}}if(this.fogCullDistSq){const Ot=this.fogCullDistSq,wt=this.horizonLineFromTop();Lt=Lt.filter(Nt=>{const ee=[0,0,0,1],se=[c.EXTENT,c.EXTENT,0,1],Be=this.calculateFogTileMatrix(Nt.tileID.toUnwrapped());c.transformMat4$1(ee,ee,Be),c.transformMat4$1(se,se,Be);const ii=c.getAABBPointSquareDist(ee,se);if(0===ii)return!0;let Ie=!1;const Ee=this._elevation;if(Ee&&ii>Ot&&0!==wt){const Ue=this.calculateProjMatrix(Nt.tileID.toUnwrapped());let ri;s.isTerrainDEM||(ri=Ee.getMinMaxForTile(Nt.tileID)),ri||(ri={min:rt,max:it});const je=c.furthestTileCorner(this.rotation),xi=[je[0]*c.EXTENT,je[1]*c.EXTENT,ri.max];c.transformMat4(xi,xi,Ue),Ie=(1-xi[1])*this.height*.5<wt}return ii<Ot||Ie})}return Lt.sort((Ot,wt)=>Ot.distanceSq-wt.distanceSq).map(Ot=>Ot.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=c.clamp(s.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),g=this.projection.project(s.lng,h);return new c.pointGeometry(g.x*this.worldSize,g.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/c.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,h){let g,v;const w=this.centerPoint;if("globe"===this.projection.name){const A=this.worldSize;g=(h.x-w.x)/A,v=(h.y-w.y)/A}else{const A=this.pointCoordinate(h),P=this.pointCoordinate(w);g=A.x-P.x,v=A.y-P.y}const E=this.locationCoordinate(s);this.setLocation(new c.MercatorCoordinate(E.x-g,E.y-v))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,h){const g=h?c.mercatorZfromAltitude(h,s.lat):void 0,v=this.projection.project(s.lng,s.lat);return new c.MercatorCoordinate(v.x,v.y,g)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,h){const g=h??this._centerAltitude,v=[s.x,s.y,0,1],w=[s.x,s.y,1,1];c.transformMat4$1(v,v,this.pixelMatrixInverse),c.transformMat4$1(w,w,this.pixelMatrixInverse);const E=w[3];c.scale$1(v,v,1/v[3]),c.scale$1(w,w,1/E);const A=v[2],P=w[2];return{p0:v,p1:w,t:A===P?0:(g-A)/(P-A)}}screenPointToMercatorRay(s){const h=[s.x,s.y,0,1],g=[s.x,s.y,1,1];return c.transformMat4$1(h,h,this.pixelMatrixInverse),c.transformMat4$1(g,g,this.pixelMatrixInverse),c.scale$1(h,h,1/h[3]),c.scale$1(g,g,1/g[3]),h[2]=c.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,g[2]=c.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,c.scale$1(h,h,1/this.worldSize),c.scale$1(g,g,1/this.worldSize),new c.Ray([h[0],h[1],h[2]],c.normalize([],c.sub([],g,h)))}rayIntersectionCoordinate(s){const{p0:h,p1:g,t:v}=s,w=c.mercatorZfromAltitude(h[2],this._center.lat),E=c.mercatorZfromAltitude(g[2],this._center.lat);return new c.MercatorCoordinate(c.number(h[0],g[0],v)/this.worldSize,c.number(h[1],g[1],v)/this.worldSize,c.number(w,E,v))}pointCoordinate(s,h=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,h)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let h=this.projection.pointCoordinate3D(this,s.x,s.y);if(h)return new c.MercatorCoordinate(h[0],h[1],h[2]);let g=0,v=this.horizonLineFromTop();if(s.y>v)return this.pointCoordinate(s);const w=.02*v,E=s.clone();for(let A=0;A<10&&v-g>w;A++){E.y=c.number(g,v,.66);const P=this.projection.pointCoordinate3D(this,E.x,E.y);P?(v=E.y,h=P):g=E.y}return h?new c.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}_coordinatePoint(s,h){const g=h&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,v=[s.x*this.worldSize,s.y*this.worldSize,g+s.toAltitude(),1];return c.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new c.pointGeometry(v[0]/v[3],v[1]/v[3]):new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:h}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,w=this.pointLocation3D(new c.pointGeometry(h,s)),E=this.pointLocation3D(new c.pointGeometry(v,s)),A=this.pointLocation3D(new c.pointGeometry(v,g)),P=this.pointLocation3D(new c.pointGeometry(h,g));let z=Math.min(w.lng,E.lng,A.lng,P.lng),O=Math.max(w.lng,E.lng,A.lng,P.lng),U=Math.min(w.lat,E.lat,A.lat,P.lat),q=Math.max(w.lat,E.lat,A.lat,P.lat);const W=Math.pow(2,-this.zoom)/16*270,X="globe"===this.projection.name?1:4,Y=(J,G,st,it,rt)=>{const pt=(J+st)/2,dt=(G+it)/2,xt=new c.pointGeometry(pt,dt),{lng:Et,lat:Lt}=this.pointLocation3D(xt),Bt=Math.max(0,z-Et,U-Lt,Et-O,Lt-q);z=Math.min(z,Et),O=Math.max(O,Et),U=Math.min(U,Lt),q=Math.max(q,Lt),(rt<X||Bt>W)&&(Y(J,G,pt,dt,rt+1),Y(pt,dt,st,it,rt+1))};if(Y(h,s,v,s,1),Y(v,s,v,g,1),Y(v,g,h,g,1),Y(h,g,h,s,1),"globe"===this.projection.name){const[J,G]=c.polesInViewport(this);J?(q=90,O=180,z=-180):G&&(U=-90,O=180,z=-180)}return new c.LngLatBounds(new c.LngLat(z,U),new c.LngLat(O,q))}_getBoundsRectangular(s,h){const{top:g,left:v}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,A=new c.pointGeometry(v,g),P=new c.pointGeometry(E,g),z=new c.pointGeometry(E,w),O=new c.pointGeometry(v,w);let U=this.pointCoordinate(A,s),q=this.pointCoordinate(P,s);const W=this.pointCoordinate(z,h),X=this.pointCoordinate(O,h),Y=(J,G)=>(G.y-J.y)/(G.x-J.x);return U.y>1&&q.y>=0?U=new c.MercatorCoordinate((1-X.y)/Y(X,U)+X.x,1):U.y<0&&q.y<=1&&(U=new c.MercatorCoordinate(-X.y/Y(X,U)+X.x,0)),q.y>1&&U.y>=0?q=new c.MercatorCoordinate((1-W.y)/Y(W,q)+W.x,1):q.y<0&&U.y<=1&&(q=new c.MercatorCoordinate(-W.y/Y(W,q)+W.x,0)),(new c.LngLatBounds).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(W))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=s.visibleDemTiles.reduce((g,v)=>{if(v.dem){const w=v.dem.tree;g.min=Math.min(g.min,w.minimums[0]),g.max=Math.max(g.max,w.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*s.exaggeration(),h.max*s.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return s?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-c.MAX_MERCATOR_LATITUDE,this.maxLat=c.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=c.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=c.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=c.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,h){return this.projection.createTileMatrix(this,h,s)}calculateDistanceTileData(s){const h=s.key,g=this._distanceTileDataCache;if(g[h])return g[h];const v=s.canonical,w=1/this.height,E=this.cameraWorldSize,A=E/this.zoomScale(v.z),P=(v.x+Math.pow(2,v.z)*s.wrap)*A,z=v.y*A,O=this.point;O.x*=E/this.worldSize,O.y*=E/this.worldSize;const U=this.angle,q=Math.sin(-U),W=-Math.cos(-U);return g[h]={bearing:[q,W],center:[(O.x-P)*w,(O.y-z)*w],scale:A/c.EXTENT*w},g[h]}calculateFogTileMatrix(s){const h=s.key,g=this._fogTileMatrixCache;if(g[h])return g[h];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return c.multiply(v,this.worldToFogMatrix,v),g[h]=new Float32Array(v),g[h]}calculateProjMatrix(s,h=!1){const g=s.key,v=h?this._alignedProjMatrixCache:this._projMatrixCache;if(v[g])return v[g];const w=this.calculatePosMatrix(s,this.worldSize);return c.multiply(w,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,w),v[g]=new Float32Array(w),v[g]}calculatePixelsToTileUnitsMatrix(s){const h=s.tileID.key,g=this._pixelsToTileUnitsCache;if(g[h])return g[h];const v=function(w,E){const{scale:A}=w.tileTransform,P=A*c.EXTENT/(w.tileSize*Math.pow(2,E.zoom-w.tileID.overscaledZ+w.tileID.canonical.z));return z=new Float32Array(4),q=(O=E.inverseAdjustmentMatrix)[1],W=O[2],X=O[3],J=(U=[P,P])[1],z[0]=O[0]*(Y=U[0]),z[1]=q*Y,z[2]=W*J,z[3]=X*J,z;var z,O,U,q,W,X,Y,J}(s,this);return g[h]=v,g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const s=1/this.worldSize,h=c.fromScaling([],[s,s,s]);return c.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const s=this._elevation;this._updateCameraState();const h=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),v=this._camera.forward(),w=c.mercatorZfromAltitude(1,this._center.lat);g[2]/=w,v[2]/=w,c.normalize(v,v);const E=s.raycast(g,v,s.exaggeration());if(E){const A=c.scaleAndAdd([],g,v,E),P=new c.MercatorCoordinate(A[0],A[1],c.mercatorZfromAltitude(A[2],c.latFromMercatorY(A[1]))),z=(P.z+c.length([P.x-g[0],P.y-g[1],P.z-g[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const h=this._elevation,g=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),w=h.getAtPointOrZero(new c.MercatorCoordinate(...v)),E=this.pixelsPerMeter/this.worldSize*w,A=this._minimumHeightOverTerrain(),P=v[2]-E;if(P<=A)if(P<0||s){const z=this.locationCoordinate(this._center,this._centerAltitude),O=[v[0],v[1],z.z-v[2]],U=c.length(O);O[2]-=(A-P)/this._pixelsPerMercatorPixel;const q=c.length(O);if(0===q)return;c.scale$2(O,O,U/q*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],z.z*this._pixelsPerMercatorPixel-O[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const q=this.center;return q.lat=c.clamp(q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(q.lng=c.clamp(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const h=this._unmodified,{x:g,y:v}=this.point;let w=0,E=g,A=v;const P=this.width/2,z=this.height/2,O=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(v-z<O&&(A=O+z),v+z>U&&(A=U-z),U-O<this.height&&(w=Math.max(w,this.height/(U-O)),A=(U+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,X=this.worldSize/2-(q+W)/2;E=(g+X+this.worldSize)%this.worldSize-X,E-P<q&&(E=q+P),E+P>W&&(E=W-P),W-q<this.width&&(w=Math.max(w,this.width/(W-q)),E=(W+q)/2)}E===g&&A===v||(this.center=this.unproject(new c.pointGeometry(E,A))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=c.mercatorZfromAltitude(1,this.center.lat)/c.mercatorZfromAltitude(1,c.GLOBE_SCALE_MATCH_LATITUDE));const g=us(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v="meters"===this.projection.zAxisUnit?h:1,w=this._camera.getWorldToCamera(this.worldSize,v),E=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);E[8]=2*-s.x/this.width,E[9]=2*s.y/this.height;let A=c.mul([],E,w);if(this.projection.isReprojectedInTileSpace){const dt=this.locationCoordinate(this.center),xt=c.identity([]);c.translate(xt,xt,[dt.x*this.worldSize,dt.y*this.worldSize,0]),c.multiply(xt,xt,Os(this)),c.translate(xt,xt,[-dt.x*this.worldSize,-dt.y*this.worldSize,0]),c.multiply(A,A,xt),this.inverseAdjustmentMatrix=function(Et){const Lt=Os(Et,!0);return Jt([],[Lt[0],Lt[1],Lt[4],Lt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=c.scale([],A,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=A,this.invProjMatrix=c.invert(new Float64Array(16),this.projMatrix);const P=c.invert([],E);this.frustumCorners=c.FrustumCorners.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height);const z=new Float32Array(16);c.identity(z),c.scale(z,z,[1,-1,1]),c.rotateX(z,z,this._pitch),c.rotateZ(z,z,this.angle);const O=c.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;O[8]=2*-s.x/this.width,O[9]=2*(s.y+U)/this.height,this.skyboxMatrix=c.multiply(z,O,z);const q=this.point,W=q.x,X=q.y,Y=this.width%2/2,J=this.height%2/2,G=Math.cos(this.angle),st=Math.sin(this.angle),it=W-Math.round(W)+G*Y+st*J,rt=X-Math.round(X)+G*J+st*Y,pt=new Float64Array(A);if(c.translate(pt,pt,[it>.5?it-1:it,rt>.5?rt-1:rt,0]),this.alignedProjMatrix=pt,A=c.create(),c.scale(A,A,[this.width/2,-this.height/2,1]),c.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=c.create(),c.scale(A,A,[1,-1,1]),c.translate(A,A,[-1,-1,0]),c.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=c.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},A=c.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=c.calculateGlobeMatrix(this);const dt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=c.transformMat4(dt,dt,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,w=[s,s,h];c.scale$2(w,w,v),c.scale$2(g,g,-1),c.multiply$2(g,g,w);const E=c.create();c.translate(E,E,g),c.scale(E,E,w),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,h,v)}_computeCameraPosition(s){const h=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-s/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*w,v.y/this.worldSize-g[1]*w,s/this.worldSize*this._centerAltitude-g[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=s[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(w=Math.min((h-g)/v,1)),this._camera.position=c.scaleAndAdd([],this._camera.position,s,w),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),w=c.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.degToRad(this._maxPitch)),A=Math.max((s[2]-w)/Math.cos(g),E),P=this._zoomFromMercatorZ(A);c.scaleAndAdd(s,s,h,A),this._pitch=c.clamp(g,c.degToRad(this.minPitch),c.degToRad(this.maxPitch)),this.angle=c.wrap(v,-Math.PI,Math.PI),this._setZoom(c.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new c.MercatorCoordinate(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let h=0,g=c.GLOBE_ZOOM_THRESHOLD_MAX,v=0,w=1/0;for(;g-h>1e-6&&g>h;){const E=h+.5*(g-h),A=this.tileSize*Math.pow(2,E),P=this.getCameraToCenterDistance(this.projection,E,A),z=this.scaleZoom(P/(s*this.tileSize)),O=Math.abs(E-z);O<w&&(w=O,v=E),E<z?h=E:g=E}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(c.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,h){const g=Math.min(s.x,h.x),v=Math.max(s.x,h.x),w=Math.min(s.y,h.y),E=Math.max(s.y,h.y);if(w<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new c.pointGeometry(g,w),new c.pointGeometry(v,E),new c.pointGeometry(g,E),new c.pointGeometry(v,w)],P=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const O of A){const U=this.pointRayIntersection(O);if(U.t<0)return!0;const q=this.rayIntersectionCoordinate(U);if(q.x<P||q.y<0||q.x>z||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.pointGeometry(0,0),new c.pointGeometry(this.width,this.height))}zoomDeltaToMovement(s,h){const g=c.length(c.sub([],this._camera.position,s)),v=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if("globe"===this.projection.name){const s=function([h,g,v],w){const E=[h,g,v,1];c.transformMat4$1(E,E,w);const A=E[3]=Math.max(E[3],1e-6);return E[0]/=A,E[1]/=A,E[2]/=A,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new c.pointGeometry(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.pointGeometry(0,s))}}getCameraToCenterDistance(s,h=this.zoom,g=this.worldSize){const v=us(s,h,this.width,this.height,1024),w=s.pixelSpaceConversion(this.center.lat,g,v);return.5/Math.tan(.5*this._fov)*this.height*w}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&c.multiply(s,s,this.globeMatrix),s}}function Un(f,s){let h=!1,g=null;const v=()=>{g=null,h&&(f(),g=setTimeout(v,s),h=!1)};return()=>(h=!0,g||v(),g)}class du{constructor(s){this._hashName=s&&encodeURIComponent(s),c.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Un(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,c.window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),c.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const h=ql(s);if(this._hashName){const g=this._hashName;let v=!1;const w=c.window.location.hash.slice(1).split("&").map(E=>{const A=E.split("=")[0];return A===g?(v=!0,`${A}=${h}`):E}).filter(E=>E);return v||w.push(`${g}=${h}`),`#${w.join("&")}`}return`#${h}`}_getCurrentHash(){const s=c.window.location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(g))){const g=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(h[3]||0):s.getBearing();return s.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=c.window.location.href.replace(/(#.+)?$/,this.getHashString());c.window.history.replaceState(c.window.history.state,null,s)}}function ql(f,s){const h=f.getCenter(),g=Math.round(100*f.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,v),E=Math.round(h.lng*w)/w,A=Math.round(h.lat*w)/w,P=f.getBearing(),z=f.getPitch();let O=s?`/${E}/${A}/${g}`:`${g}/${A}/${E}`;return(P||z)&&(O+="/"+Math.round(10*P)/10),z&&(O+=`/${Math.round(z)}`),O}const Qn={linearity:.3,easing:c.bezier(0,0,.3,1)},rr=c.extend({deceleration:2500,maxSpeed:1400},Qn),Fc=c.extend({deceleration:20,maxSpeed:1400},Qn),Xa=c.extend({deceleration:1e3,maxSpeed:360},Qn),Ya=c.extend({deceleration:1e3,maxSpeed:90},Qn);class Hl{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=c.exported.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new c.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)h.zoom+=w.zoomDelta||0,h.bearing+=w.bearingDelta||0,h.pitch+=w.pitchDelta||0,w.panDelta&&h.pan._add(w.panDelta),w.around&&(h.around=w.around),w.pinchAround&&(h.pinchAround=w.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){const w=zo(h.pan.mag(),g,c.extend({},rr,s||{}));v.offset=h.pan.mult(w.amount/h.pan.mag()),v.center=this._map.transform.center,Nn(v,w)}if(h.zoom){const w=zo(h.zoom,g,Fc);v.zoom=this._map.transform.zoom+w.amount,Nn(v,w)}if(h.bearing){const w=zo(h.bearing,g,Xa);v.bearing=this._map.transform.bearing+c.clamp(w.amount,-179,179),Nn(v,w)}if(h.pitch){const w=zo(h.pitch,g,Ya);v.pitch=this._map.transform.pitch+w.amount,Nn(v,w)}if(v.zoom||v.bearing){const w=void 0===h.pinchAround?h.around:h.pinchAround;v.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Nn(f,s){(!f.duration||f.duration<s.duration)&&(f.duration=s.duration,f.easing=s.easing)}function zo(f,s,h){const{maxSpeed:g,linearity:v,deceleration:w}=h,E=c.clamp(f*v/(s/1e3),-g,g),A=Math.abs(E)/(w*v);return{easing:h.easing,duration:1e3*A,amount:E*(A/2)}}class Mi extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g,v={}){const w=Mt(h.getCanvasContainer(),g),E=h.unproject(w);super(s,c.extend({point:w,lngLat:E,originalEvent:g},v)),this._defaultPrevented=!1,this.target=h}}class $l extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){const v="touchend"===s?g.changedTouches:g.touches,w=Ut(h.getCanvasContainer(),v),E=w.map(P=>h.unproject(P)),A=w.reduce((P,z,O,U)=>P.add(z.div(U.length)),new c.pointGeometry(0,0));super(s,{points:w,point:A,lngLats:E,lngLat:h.unproject(A),originalEvent:g}),this._defaultPrevented=!1}}class Oo extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){super(s,{originalEvent:g}),this._defaultPrevented=!1}}class Wl{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new Oo(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new Mi(s.type,this._map,s))}mouseup(s){this._map.fire(new Mi(s.type,this._map,s))}preclick(s){const h=c.extend({},s);h.type="preclick",this._map.fire(new Mi(h.type,this._map,h))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(s),this._map.fire(new Mi(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new Mi(s.type,this._map,s))}mouseover(s){this._map.fire(new Mi(s.type,this._map,s))}mouseout(s){this._map.fire(new Mi(s.type,this._map,s))}touchstart(s){return this._firePreventable(new $l(s.type,this._map,s))}touchmove(s){this._map.fire(new $l(s.type,this._map,s))}touchend(s){this._map.fire(new $l(s.type,this._map,s))}touchcancel(s){this._map.fire(new $l(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bs{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new Mi(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Mi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Mi(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uc{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&0===s.button&&(ye(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const g=h,v=this._startPos,w=this._lastPos;if(!v||!w||w.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=zt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const E=Math.min(v.x,g.x),A=Math.max(v.x,g.x),P=Math.min(v.y,g.y),z=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${P}px)`,this._box.style.width=A-E+"px",this._box.style.height=z-P+"px")})}mouseupWindow(s,h){if(!this._active)return;const g=this._startPos,v=h;if(g&&0===s.button){if(this.reset(),qt(),g.x!==v.x||g.y!==v.y)return this._map.fire(new c.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:w=>w.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&27===s.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),pe(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new c.Event(s,{originalEvent:h}))}}function Xl(f,s){const h={};for(let g=0;g<f.length;g++)h[f[g].identifier]=s[g];return h}class Nc{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const w=new c.pointGeometry(0,0);for(const E of v)w._add(E);return w.div(v.length)}(h),this.touches=Xl(g,h)))}touchmove(s,h,g){if(this.aborted||!this.centroid)return;const v=Xl(g,h);for(const w in this.touches){const A=v[w];(!A||A.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(s,h,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class fa{constructor(s){this.singleTap=new Nc(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,h,g){this.singleTap.touchstart(s,h,g)}touchmove(s,h,g){this.singleTap.touchmove(s,h,g)}touchend(s,h,g){const v=this.singleTap.touchend(s,h,g);if(v){const w=s.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(v)<30;if(w&&E||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Yl{constructor(){this._zoomIn=new fa({numTouches:1,numTaps:2}),this._zoomOut=new fa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,g){this._zoomIn.touchstart(s,h,g),this._zoomOut.touchstart(s,h,g)}touchmove(s,h,g){this._zoomIn.touchmove(s,h,g),this._zoomOut.touchmove(s,h,g)}touchend(s,h,g){const v=this._zoomIn.touchend(s,h,g),w=this._zoomOut.touchend(s,h,g);return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(v)},{originalEvent:s})}):w?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(w)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Vc={0:1,2:2};class jc{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;const g=Dt(s);this._correctButton(s,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(s,h){const g=this._lastPoint;if(g)if(s.preventDefault(),null!=this._eventButton&&function(v,w){const E=Vc[w];return void 0===v.buttons||(v.buttons&E)!==E}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}mouseupWindow(s){this._lastPoint&&Dt(s)===this._eventButton&&(this._moved&&qt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zc extends jc{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return 0===h&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class Jl extends jc{_correctButton(s,h){return 0===h&&s.ctrlKey||2===h}_move(s,h){const g=.8*(h.x-s.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(s){s.preventDefault()}}class Gc extends jc{_correctButton(s,h){return 0===h&&s.ctrlKey||2===h}_move(s,h){const g=-.5*(h.y-s.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(s){s.preventDefault()}}class ar{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),c.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.pointGeometry(0,0)}touchstart(s,h,g){return this._calculateTransform(s,h,g)}touchmove(s,h,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===g.length&&!c.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,h,g)}}touchend(s,h,g){this._calculateTransform(s,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,g){g.length>0&&(this._active=!0);const v=Xl(g,h),w=new c.pointGeometry(0,0),E=new c.pointGeometry(0,0);let A=0;for(const z in v){const O=v[z],U=this._touches[z];U&&(w._add(O),E._add(O.sub(U)),A++,v[z]=O)}if(this._touches=v,A<this._minTouches||!E.mag())return;const P=E.div(A);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(A),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=zt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class kn{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,h,g){return{}}touchstart(s,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,g){const v=this._firstTwoTouches;if(!v)return;s.preventDefault();const[w,E]=v,A=Ja(g,h,w),P=Ja(g,h,E);if(!A||!P)return;const z=this._aroundCenter?null:A.add(P).div(2);return this._move([A,P],z,s)}touchend(s,h,g){if(!this._firstTwoTouches)return;const[v,w]=this._firstTwoTouches,E=Ja(g,h,v),A=Ja(g,h,w);E&&A||(this._active&&qt(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ja(f,s,h){for(let g=0;g<f.length;g++)if(f[g].identifier===h)return s[g]}function qc(f,s){return Math.log(f/s)/Math.LN2}class Hc extends kn{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(qc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qc(this._distance,g),pinchAround:h}}}function ma(f,s){return 180*f.angleWith(s)/Math.PI}class $c extends kn{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const g=this._vector;if(this._vector=s[0].sub(s[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ma(this._vector,g),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const v=ma(s,g);return Math.abs(v)<h}}function Ka(f){return Math.abs(f.y)>Math.abs(f.x)}class Cn extends kn{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,Ka(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,g){const v=this._lastPoints;if(!v)return;const w=s[0].sub(v[0]),E=s[1].sub(v[1]);return this._map._cooperativeGestures&&!c.isFullscreen()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(w,E,g.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(w.y+E.y)/2*-.5})}gestureBeginsVertically(s,h,g){if(void 0!==this._valid)return this._valid;const v=s.mag()>=2,w=h.mag()>=2;if(!v&&!w)return;if(!v||!w)return null==this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const E=s.y>0==h.y>0;return Ka(s)&&Ka(h)&&E}}const Wc={panStep:100,bearingStep:15,pitchStep:10};class Xc{constructor(){const s=Wc;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,g=0,v=0,w=0,E=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),w=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),w=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),E=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:A=>{const P=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:Yc,zoom:h?Math.round(P)+h*(s.shiftKey?2:1):P,bearing:A.getBearing()+g*this._bearingStep,pitch:A.getPitch()+v*this._pitchStep,offset:[-w*this._panStep,-E*this._panStep],center:A.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Yc(f){return f*(2-f)}const pu=4.000244140625;class Bo{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,c.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||c.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=s.deltaMode===c.window.WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const g=c.exported.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==h&&h%pu==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=Mt(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;"wheel"===this._type&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(0!==this._delta){const P="wheel"===this._type&&Math.abs(this._delta)>pu?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&0!==z&&(z=1/z);const O=h(),U=Math.pow(2,O),q="number"==typeof this._targetZoom?s.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(q*z))),"wheel"===this._type&&(this._startZoom=O,this._easing=this._smoothOutEasing(200)),this._delta=0}const g="number"==typeof this._targetZoom?this._targetZoom:h(),v=this._startZoom,w=this._easing;let E,A=!1;if("wheel"===this._type&&v&&w){const P=Math.min((c.exported.now()-this._lastWheelEventTime)/200,1),z=w(P);E=c.number(v,g,z),P<1?this._frameId||(this._frameId=!0):A=!0}else E=g,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:E-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=c.ease;if(this._prevEase){const g=this._prevEase,v=(c.exported.now()-g.start)/g.duration,w=g.easing(v+.01)-g.easing(v),E=.27/Math.sqrt(w*w+1e-4)*.01,A=Math.sqrt(.0729-E*E);h=c.bezier(E,A,.25,1)}return this._prevEase={start:c.exported.now(),duration:s,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=zt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(c.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class fu{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ga{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,h){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(s.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xs{constructor(){this._tap=new fa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,h,g){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(s,h,g))}touchmove(s,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=h[0],w=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(s,h,g)}touchend(s,h,g){this._tapTime?this._swipePoint&&0===g.length&&this.reset():this._tap.touchend(s,h,g)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kl{constructor(s,h,g){this._el=s,this._mousePan=h,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class De{constructor(s,h,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Jc{constructor(s,h,g,v){this._el=s,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Qa=f=>f.zoom||f.drag||f.pitch||f.rotate;class lr extends c.Event{}class tl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,h){const g=c.sub([],h,s);this.radius=c.length(g[2]<0?c.div([],g,this.constants):[g[0],g[1],0])}projectRay(s){c.div(s,s,this.constants),c.normalize(s,s),c.mul$1(s,s,this.constants);const h=c.scale$2([],s,this.radius);if(h[2]>0){const g=c.scale$2([],[0,0,1],c.dot(h,[0,0,1])),v=c.scale$2([],c.normalize([],[h[0],h[1],0]),this.radius),w=c.add([],h,c.scale$2([],c.sub([],c.add([],v,g),h),2));h[0]=w[0],h[1]=w[1]}return h}}function Ys(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Ql{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Hl(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new tl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),c.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[c.window.document,"mousemove",{capture:!0}],[c.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[c.window,"blur",void 0]];for(const[v,w,E]of this._listeners)v.addEventListener(w,v===c.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[s,h,g]of this._listeners)s.removeEventListener(h,s===c.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(s){const h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new Wl(h,s));const v=h.boxZoom=new Uc(h,s);this._add("boxZoom",v);const w=new Yl,E=new ga;h.doubleClickZoom=new fu(E,w),this._add("tapZoom",w),this._add("clickZoom",E);const A=new Xs;this._add("tapDragZoom",A);const P=h.touchPitch=new Cn(h);this._add("touchPitch",P);const z=new Jl(s),O=new Gc(s);h.dragRotate=new De(s,z,O),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const U=new Zc(s),q=new ar(h,s);h.dragPan=new Kl(g,U,q),this._add("mousePan",U),this._add("touchPan",q,["touchZoom","touchRotate"]);const W=new $c,X=new Hc;h.touchZoomRotate=new Jc(g,X,W,A),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Bs(h));const Y=h.scrollZoom=new Bo(h,this);this._add("scrollZoom",Y,["mousePan"]);const J=h.keyboard=new Xc;this._add("keyboard",J);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[G]&&h[G].enable(s[G])}_add(s,h,g){this._handlers.push({handlerName:s,handler:h,allowed:g}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Qa(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,h,g){for(const v in s)if(v!==g&&(!h||h.indexOf(v)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const h=[];for(const g of s)this._el.contains(g.target)&&h.push(g);return h}handleEvent(s,h){this._updatingCamera=!0;const g="renderFrame"===s.type,v=g?void 0:s,w={needsRenderFrame:!1},E={},A={},P=s.touches?this._getMapTouches(s.touches):void 0,z=P?Ut(this._el,P):g?void 0:Mt(this._el,s);for(const{handlerName:q,handler:W,allowed:X}of this._handlers){if(!W.isEnabled())continue;let Y;this._blockedByActive(A,X,q)?W.reset():W[h||s.type]&&(Y=W[h||s.type](s,z,P),this.mergeHandlerResult(w,E,Y,q,v),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||W.isActive())&&(A[q]=W)}const O={};for(const q in this._previousActiveHandlers)A[q]||(O[q]=v);this._previousActiveHandlers=A,(Object.keys(O).length||Ys(w))&&(this._changes.push([w,E,O]),this._triggerRenderFrame()),(Object.keys(A).length||Ys(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=w;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(s,h,g,v,w){if(!g)return;c.extend(s,g);const E={handlerName:v,originalEvent:g.originalEvent||w};void 0!==g.zoomDelta&&(h.zoom=E),void 0!==g.panDelta&&(h.drag=E),void 0!==g.pitchDelta&&(h.pitch=E),void 0!==g.bearingDelta&&(h.rotate=E)}_applyChanges(){const s={},h={},g={};for(const[v,w,E]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new c.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(s.around=v.around),void 0!==v.aroundCoord&&(s.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),c.extend(h,w),c.extend(g,E);this._updateMapTransform(s,h,g),this._changes=[]}_updateMapTransform(s,h,g){const v=this._map,w=v.transform,E=st=>[st.x,st.y,st.z];if((st=>{const it=this._eventsInProgress.drag;return it&&!this._handlersById[it.handlerName].isActive()})()&&!Ys(s)){const st=w.zoom;w.cameraElevationReference="sea",w.recenterOnTerrain(),w.cameraElevationReference="ground",st!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&v._stop(!0),!Ys(s))return void this._fireEvents(h,g,!0);let{panDelta:A,zoomDelta:P,bearingDelta:z,pitchDelta:O,around:U,aroundCoord:q,pinchAround:W}=s;w._isCameraConstrained&&(P>0&&(P=0),w._isCameraConstrained=!1),void 0!==W&&(U=W),(P||(st=>h.drag&&!this._eventsInProgress.drag)())&&U&&(this._dragOrigin=E(w.pointCoordinate3D(U)),this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",v._stop(!0),U=U||v.transform.centerPoint,z&&(w.bearing+=z),O&&(w.pitch+=O),w._updateCameraState();const X=[0,0,0];if(A)if("mercator"===w.projection.name){const st=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(U).dir),it=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(U.sub(A)).dir);X[0]=it[0]-st[0],X[1]=it[1]-st[1]}else{const st=w.pointCoordinate(U);if("globe"===w.projection.name){A=A.rotate(-w.angle);const it=w._pixelsPerMercatorPixel/w.worldSize;X[0]=-A.x*c.mercatorScale(c.latFromMercatorY(st.y))*it,X[1]=-A.y*c.mercatorScale(w.center.lat)*it}else{const it=w.pointCoordinate(U.sub(A));st&&it&&(X[0]=it.x-st.x,X[1]=it.y-st.y)}}const Y=w.zoom,J=[0,0,0];if(P){const st=E(q||w.pointCoordinate3D(U)),it={dir:c.normalize([],c.sub([],st,w._camera.position))};if(it.dir[2]<0){const rt=w.zoomDeltaToMovement(st,P);c.scale$2(J,it.dir,rt)}}const G=c.add(X,X,J);w._translateCameraConstrained(G),P&&Math.abs(w.zoom-Y)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,g,!0)}_fireEvents(s,h,g){const v=Qa(this._eventsInProgress),w=Qa(s),E={};for(const O in s){const{originalEvent:U}=s[O];this._eventsInProgress[O]||(E[`${O}start`]=U),this._eventsInProgress[O]=s[O]}!v&&w&&this._fireEvent("movestart",w.originalEvent);for(const O in E)this._fireEvent(O,E[O]);w&&this._fireEvent("move",w.originalEvent);for(const O in s){const{originalEvent:U}=s[O];this._fireEvent(O,U)}const A={};let P;for(const O in this._eventsInProgress){const{handlerName:U,originalEvent:q}=this._eventsInProgress[O];this._handlersById[U].isActive()||(delete this._eventsInProgress[O],P=h[U]||q,A[`${O}end`]=P)}for(const O in A)this._fireEvent(O,A[O]);const z=Qa(this._eventsInProgress);if(g&&(v||w)&&!z){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=q=>0!==q&&-this._bearingSnap<q&&q<this._bearingSnap;O?(U(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:P})):(this._map.fire(new c.Event("moveend",{originalEvent:P})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new c.Event(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new lr("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Sr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class tc extends c.Evented{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,c.bindAll(["_renderFrameCallback"],this)}getCenter(){return new c.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,g){return s=c.pointGeometry.convert(s).mult(-1),this.panTo(this.transform.center,c.extend({offset:s},h),g)}panTo(s,h,g){return this.easeTo(c.extend({center:s},h),g)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,g){return this.easeTo(c.extend({zoom:s},h),g)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,g){return this.easeTo(c.extend({bearing:s},h),g)}resetNorth(s,h){return this.rotateTo(0,c.extend({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(c.extend({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=c.LngLatBounds.convert(s);const g=h&&h.bearing||0,v=h&&h.pitch||0,w=s.getNorthWest(),E=s.getSouthEast();return this._cameraForBounds(this.transform,w,E,g,v,h)}_extendCameraOptions(s){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(s=c.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding){const g=s.padding;s.padding={top:g,bottom:g,right:g,left:g}}return s.padding=c.extend(h,s.padding),s}_minimumAABBFrustumDistance(s,h){const g=h.max[0]-h.min[0],v=h.max[1]-h.min[1];return g/v>s.aspect?g/(2*Math.tan(.5*s.fovX)*s.aspect):v/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,h,g,v,w,E){const A=s.clone(),P=this._extendCameraOptions(E);A.bearing=v,A.pitch=w;const z=c.LngLat.convert(h),O=c.LngLat.convert(g),U=.5*(z.lat+O.lat),q=.5*(z.lng+O.lng),W=c.latLngToECEF(U,q),X=c.normalize([],W),Y=c.normalize([],c.cross([],X,[0,1,0])),J=c.cross([],Y,X),G=[Y[0],Y[1],Y[2],0,J[0],J[1],J[2],0,X[0],X[1],X[2],0,0,0,0,1],st=[W,c.latLngToECEF(z.lat,z.lng),c.latLngToECEF(O.lat,z.lng),c.latLngToECEF(O.lat,O.lng),c.latLngToECEF(z.lat,O.lng),c.latLngToECEF(U,z.lng),c.latLngToECEF(U,O.lng),c.latLngToECEF(z.lat,q),c.latLngToECEF(O.lat,q)];let it=c.Aabb.fromPoints(st.map(ee=>[c.dot(Y,ee),c.dot(J,ee),c.dot(X,ee)]));const rt=c.transformMat4([],it.center,G);0===c.squaredLength(rt)&&c.set(rt,0,0,1),c.normalize(rt,rt),c.scale$2(rt,rt,c.GLOBE_RADIUS),A.center=c.ecefToLatLng(rt);const pt=A.getWorldToCameraMatrix(),dt=c.invert(new Float64Array(16),pt);it=c.Aabb.applyTransform(it,c.multiply([],pt,G)),c.transformMat4(rt,rt,pt);const xt=.5*(it.max[2]-it.min[2]),Et=this._minimumAABBFrustumDistance(A,it),Lt=c.scale$2([],[0,0,1],xt),Bt=c.add(Lt,rt,Lt),fe=Et+(0===A.pitch?0:c.distance(rt,Bt)),Pt=A.globeCenterInViewSpace,Yt=c.sub([],rt,[Pt[0],Pt[1],Pt[2]]);c.normalize(Yt,Yt),c.scale$2(Yt,Yt,fe);const Vt=c.add([],rt,Yt);c.transformMat4(Vt,Vt,dt);const ne=c.earthRadius/c.GLOBE_RADIUS,Ot=c.length(Vt),wt=c.mercatorZfromAltitude(Math.max(Ot*ne-c.earthRadius,Number.EPSILON),0),Nt=Math.min(A.zoomFromMercatorZAdjusted(wt),P.maxZoom);return Nt>.5*(c.GLOBE_ZOOM_THRESHOLD_MIN+c.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"mercator"}),A.zoom=Nt,this._cameraForBounds(A,h,g,v,w,E)):{center:A.center,zoom:Nt,bearing:v,pitch:w}}queryTerrainElevation(s,h){const g=this.transform.elevation;return g?(h=c.extend({},{exaggerated:!0},h),g.getAtPoint(c.MercatorCoordinate.fromLngLat(s),null,h.exaggerated)):null}_cameraForBounds(s,h,g,v,w,E){if("globe"===s.projection.name)return this._cameraForBoundsOnGlobe(s,h,g,v,w,E);const A=s.clone(),P=this._extendCameraOptions(E),z=A.padding;A.bearing=v,A.pitch=w;const O=c.LngLat.convert(h),U=c.LngLat.convert(g),q=new c.LngLat(O.lng,U.lat),W=new c.LngLat(U.lng,O.lat),X=A.project(O),Y=A.project(U),J=this.queryTerrainElevation(O),G=this.queryTerrainElevation(U),st=this.queryTerrainElevation(q),it=this.queryTerrainElevation(W),rt=[[X.x,X.y,Math.min(J||0,G||0,st||0,it||0)],[Y.x,Y.y,Math.max(J||0,G||0,st||0,it||0)]];let pt=c.Aabb.fromPoints(rt);const dt=A.getWorldToCameraMatrix(),xt=c.invert(new Float64Array(16),dt);pt=c.Aabb.applyTransform(pt,dt);const Et=c.sub([],pt.max,pt.min),Lt=z.left||0,Bt=z.right||0,fe=z.bottom||0,Pt=z.top||0,{left:Yt,right:Vt,top:ne,bottom:Ot}=P.padding,wt=.5*(Lt+Bt),Nt=.5*(Pt+fe),ee=Math.min(A.scaleZoom(A.scale*Math.min((A.width-(Lt+Bt+Yt+Vt))/Et[0],(A.height-(fe+Pt+Ot+ne))/Et[1])),P.maxZoom),se=A.scale/A.zoomScale(ee);pt=new c.Aabb([pt.min[0]-(Yt+wt)*se,pt.min[1]-(Ot+Nt)*se,pt.min[2]],[pt.max[0]+(Vt+wt)*se,pt.max[1]+(ne+Nt)*se,pt.max[2]]);const Be=.5*Et[2],ii=this._minimumAABBFrustumDistance(A,pt),Ie=[0,0,1,0];c.transformMat4$1(Ie,Ie,dt),c.normalize$2(Ie,Ie);const Ee=c.scale$2([],Ie,ii+Be),Ue=c.add([],pt.center,Ee),ri=("number"==typeof P.offset.x&&"number"==typeof P.offset.y?new c.pointGeometry(P.offset.x,P.offset.y):c.pointGeometry.convert(P.offset)).rotate(-c.degToRad(v));pt.center[0]-=ri.x*se,pt.center[1]+=ri.y*se,c.transformMat4(pt.center,pt.center,xt),c.transformMat4(Ue,Ue,xt);const je=[pt.center[0],pt.center[1],Ue[2]*A.pixelsPerMeter];c.scale$2(je,je,1/A.worldSize);const xi=c.lngFromMercatorX(je[0]),Ei=c.latFromMercatorY(je[1]),Ni=Math.min(A._zoomFromMercatorZ(je[2]),P.maxZoom),zi=new c.LngLat(xi,Ei);return A.mercatorFromTransition&&Ni<.5*(c.GLOBE_ZOOM_THRESHOLD_MIN+c.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"globe"}),A.zoom=Ni,this._cameraForBounds(A,h,g,v,w,E)):{center:zi,zoom:Ni,bearing:v,pitch:w}}fitBounds(s,h,g){const v=this.cameraForBounds(s,h);return this._fitInternal(v,h,g)}fitScreenCoordinates(s,h,g,v,w){const E=c.pointGeometry.convert(s),A=c.pointGeometry.convert(h),P=new c.pointGeometry(Math.min(E.x,A.x),Math.min(E.y,A.y)),z=new c.pointGeometry(Math.max(E.x,A.x),Math.max(E.y,A.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(E,A))return this;const O=this.transform.pointLocation3D(P),U=this.transform.pointLocation3D(z),q=this.transform.pointLocation3D(new c.pointGeometry(P.x,z.y)),W=this.transform.pointLocation3D(new c.pointGeometry(z.x,P.y)),X=[Math.min(O.lng,U.lng,q.lng,W.lng),Math.min(O.lat,U.lat,q.lat,W.lat)],Y=[Math.max(O.lng,U.lng,q.lng,W.lng),Math.max(O.lat,U.lat,q.lat,W.lat)],J=v&&v.pitch?v.pitch:this.getPitch(),G=this._cameraForBounds(this.transform,X,Y,g,J,v);return this._fitInternal(G,v,w)}_fitInternal(s,h,g){return s?(delete(h=c.extend(s,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this}jumpTo(s,h){this.stop();const g=s.preloadOnly?this.transform.clone():this.transform;let v=!1,w=!1,E=!1;return"zoom"in s&&g.zoom!==+s.zoom&&(v=!0,g.zoom=+s.zoom),void 0!==s.center&&(g.center=c.LngLat.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(w=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(E=!0,g.pitch=+s.pitch),null==s.padding||g.isPaddingEqual(s.padding)||(g.padding=s.padding),s.preloadOnly?(this._preloadTiles(g),this):(this.fire(new c.Event("movestart",h)).fire(new c.Event("move",h)),v&&this.fire(new c.Event("zoomstart",h)).fire(new c.Event("zoom",h)).fire(new c.Event("zoomend",h)),w&&this.fire(new c.Event("rotatestart",h)).fire(new c.Event("rotate",h)).fire(new c.Event("rotateend",h)),E&&this.fire(new c.Event("pitchstart",h)).fire(new c.Event("pitch",h)).fire(new c.Event("pitchend",h)),this.fire(new c.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||c.warnOnce(Sr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,h){const g=this.transform;if(!g.projection.supportsFreeCamera)return c.warnOnce(Sr),this;this.stop();const v=g.zoom,w=g.pitch,E=g.bearing;g.setFreeCameraOptions(s);const A=v!==g.zoom,P=w!==g.pitch,z=E!==g.bearing;return this.fire(new c.Event("movestart",h)).fire(new c.Event("move",h)),A&&this.fire(new c.Event("zoomstart",h)).fire(new c.Event("zoom",h)).fire(new c.Event("zoomend",h)),z&&this.fire(new c.Event("rotatestart",h)).fire(new c.Event("rotate",h)).fire(new c.Event("rotateend",h)),P&&this.fire(new c.Event("pitchstart",h)).fire(new c.Event("pitch",h)).fire(new c.Event("pitchend",h)),this.fire(new c.Event("moveend",h)),this}easeTo(s,h){this._stop(!1,s.easeId),(!1===(s=c.extend({offset:[0,0],duration:500,easing:c.ease},s)).animate||!s.essential&&c.exported.prefersReducedMotion)&&(s.duration=0);const g=this.transform,v=this.getZoom(),w=this.getBearing(),E=this.getPitch(),A=this.getPadding(),P="zoom"in s?+s.zoom:v,z="bearing"in s?this._normalizeBearing(s.bearing,w):w,O="pitch"in s?+s.pitch:E,U="padding"in s?s.padding:g.padding,q=c.pointGeometry.convert(s.offset);let W,X,Y;if("globe"===g.projection.name){const Lt=c.MercatorCoordinate.fromLngLat(g.center),Bt=q.rotate(-g.angle);Lt.x+=Bt.x/g.worldSize,Lt.y+=Bt.y/g.worldSize;const fe=Lt.toLngLat(),Pt=c.LngLat.convert(s.center||fe);this._normalizeCenter(Pt),W=g.centerPoint.add(Bt),X=new c.pointGeometry(Lt.x,Lt.y).mult(g.worldSize),Y=new c.pointGeometry(c.mercatorXfromLng(Pt.lng),c.mercatorYfromLat(Pt.lat)).mult(g.worldSize).sub(X)}else{W=g.centerPoint.add(q);const Lt=g.pointLocation(W),Bt=c.LngLat.convert(s.center||Lt);this._normalizeCenter(Bt),X=g.project(Lt),Y=g.project(Bt).sub(X)}const J=g.zoomScale(P-v);let G,st;s.around&&(G=c.LngLat.convert(s.around),st=g.locationPoint(G));const it=this._zooming||P!==v,rt=this._rotating||w!==z,pt=this._pitching||O!==E,dt=!g.isPaddingEqual(U),xt=Lt=>Bt=>{if(it&&(Lt.zoom=c.number(v,P,Bt)),rt&&(Lt.bearing=c.number(w,z,Bt)),pt&&(Lt.pitch=c.number(E,O,Bt)),dt&&(Lt.interpolatePadding(A,U,Bt),W=Lt.centerPoint.add(q)),G)Lt.setLocationAtPoint(G,st);else{const fe=Lt.zoomScale(Lt.zoom-v),Pt=P>v?Math.min(2,J):Math.max(.5,J),Yt=Math.pow(Pt,1-Bt),Vt=Lt.unproject(X.add(Y.mult(Bt*Yt)).mult(fe));Lt.setLocationAtPoint(Lt.renderWorldCopies?Vt.wrap():Vt,W)}return s.preloadOnly||this._fireMoveEvents(h),Lt};if(s.preloadOnly){const Lt=this._emulate(xt,s.duration,g);return this._preloadTiles(Lt),this}const Et={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=it,this._rotating=rt,this._pitching=pt,this._padding=dt,this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,Et),this._ease(xt(g),Lt=>{g.recenterOnTerrain(),this._afterEase(h,Lt)},s),this}_prepareEase(s,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||g.moving||this.fire(new c.Event("movestart",s)),this._zooming&&!g.zooming&&this.fire(new c.Event("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new c.Event("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new c.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new c.Event("move",s)),this._zooming&&this.fire(new c.Event("zoom",s)),this._rotating&&this.fire(new c.Event("rotate",s)),this._pitching&&this.fire(new c.Event("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new c.Event("zoomend",s)),v&&this.fire(new c.Event("rotateend",s)),w&&this.fire(new c.Event("pitchend",s)),this.fire(new c.Event("moveend",s))}flyTo(s,h){if(!s.essential&&c.exported.prefersReducedMotion){const ee=c.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ee,h)}this.stop(),s=c.extend({offset:[0,0],speed:1.2,curve:1.42,easing:c.ease},s);const g=this.transform,v=this.getZoom(),w=this.getBearing(),E=this.getPitch(),A=this.getPadding(),P="zoom"in s?c.clamp(+s.zoom,g.minZoom,g.maxZoom):v,z="bearing"in s?this._normalizeBearing(s.bearing,w):w,O="pitch"in s?+s.pitch:E,U="padding"in s?s.padding:g.padding,q=g.zoomScale(P-v),W=c.pointGeometry.convert(s.offset);let X=g.centerPoint.add(W);const Y=g.pointLocation(X),J=c.LngLat.convert(s.center||Y);this._normalizeCenter(J);const G=g.project(Y),st=g.project(J).sub(G);let it=s.curve;const rt=Math.max(g.width,g.height),pt=rt/q,dt=st.mag();if("minZoom"in s){const ee=c.clamp(Math.min(s.minZoom,v,P),g.minZoom,g.maxZoom),se=rt/g.zoomScale(ee-v);it=Math.sqrt(se/dt*2)}const xt=it*it;function Et(ee){const se=(pt*pt-rt*rt+(ee?-1:1)*xt*xt*dt*dt)/(2*(ee?pt:rt)*xt*dt);return Math.log(Math.sqrt(se*se+1)-se)}function Lt(ee){return(Math.exp(ee)-Math.exp(-ee))/2}function Bt(ee){return(Math.exp(ee)+Math.exp(-ee))/2}const fe=Et(0);let Pt=function(ee){return Bt(fe)/Bt(fe+it*ee)},Yt=function(ee){return rt*((Bt(fe)*(Lt(se=fe+it*ee)/Bt(se))-Lt(fe))/xt)/dt;var se},Vt=(Et(1)-fe)/it;if(Math.abs(dt)<1e-6||!isFinite(Vt)){if(Math.abs(rt-pt)<1e-6)return this.easeTo(s,h);const ee=pt<rt?-1:1;Vt=Math.abs(Math.log(pt/rt))/it,Yt=function(){return 0},Pt=function(se){return Math.exp(ee*it*se)}}s.duration="duration"in s?+s.duration:1e3*Vt/("screenSpeed"in s?+s.screenSpeed/it:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const ne=w!==z,Ot=O!==E,wt=!g.isPaddingEqual(U),Nt=ee=>se=>{const Be=se*Vt,ii=1/Pt(Be);ee.zoom=1===se?P:v+ee.scaleZoom(ii),ne&&(ee.bearing=c.number(w,z,se)),Ot&&(ee.pitch=c.number(E,O,se)),wt&&(ee.interpolatePadding(A,U,se),X=ee.centerPoint.add(W));const Ie=1===se?J:ee.unproject(G.add(st.mult(Yt(Be))).mult(ii));return ee.setLocationAtPoint(ee.renderWorldCopies?Ie.wrap():Ie,X),ee._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(h),ee};if(s.preloadOnly){const ee=this._emulate(Nt,s.duration,g);return this._preloadTiles(ee),this}return this._zooming=!0,this._rotating=ne,this._pitching=Ot,this._padding=wt,this._prepareEase(h,!1),this._ease(Nt(g),()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,h)}if(!s){const g=this.handlers;g&&g.stop(!1)}return this}_ease(s,h,g){!1===g.animate||0===g.duration?(s(1),h()):(this._easeStart=c.exported.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((c.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=c.wrap(s,-180,180);const g=Math.abs(s-h);return Math.abs(s-360-h)<g&&(s-=360),Math.abs(s+360-h)<g&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const g=s.lng-h.center.lng;s.lng+=g>180?-360:g<-180?360:0}_emulate(s,h,g){const v=Math.ceil(15*h/1e3),w=[],E=s(g.clone());for(let A=0;A<=v;A++){const P=E(A/v);w.push(P.clone())}return w}}class Kc{constructor(s={}){this.options=s,c.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const h=this.options&&this.options.compact;return this._map=s,this._container=zt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=zt("button","mapboxgl-ctrl-attrib-button",this._container),zt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=zt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const g=this._map._getUIString(`AttributionControl.${h}`);s.setAttribute("aria-label",g),s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.config.ACCESS_TOKEN}];if(s){const g=h.reduce((v,w,E)=>(w.value&&(v+=`${w.key}=${w.value}${E<h.length-1?"&":""}`),v),"?");s.href=`${c.config.FEEDBACK_URL}/${g}#${ql(this._map,!0)}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||"metadata"!==s.sourceDataType&&"visibility"!==s.sourceDataType&&"style"!==s.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const h=this._map.style._sourceCaches;for(const v in h){const w=h[v];if(w.used){const E=w.getSource();E.attribution&&s.indexOf(E.attribution)<0&&s.push(E.attribution)}}s.sort((v,w)=>v.length-w.length),s=s.filter((v,w)=>{for(let E=w+1;E<s.length;E++)if(s[E].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class hn{constructor(){c.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=zt("div","mapboxgl-ctrl");const h=zt("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&"metadata"!==s.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(0===Object.entries(s).length)return!0;for(const h in s){const g=s[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class el{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(const v of g)if(v.id===s)return void(v.cancelled=!0)}run(s=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const g of h)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Cr(f,s,h){if(f=new c.LngLat(f.lng,f.lat),s){const g=new c.LngLat(f.lng-360,f.lat),v=new c.LngLat(f.lng+360,f.lat),w=360*Math.ceil(Math.abs(f.lng-h.center.lng)/360),E=h.locationPoint(f).distSqr(s),A=s.x<0||s.y<0||s.x>h.width||s.y>h.height;h.locationPoint(g).distSqr(s)<E&&(A||Math.abs(g.lng-h.center.lng)<w)?f=g:h.locationPoint(v).distSqr(s)<E&&(A||Math.abs(v.lng-h.center.lng)<w)&&(f=v)}for(;Math.abs(f.lng-h.center.lng)>180;){const g=h.locationPoint(f);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}const _a={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ho extends c.Evented{constructor(s,h){if(super(),(s instanceof c.window.HTMLElement||h)&&(s=c.extend({element:s},h)),c.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=c.pointGeometry.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=zt("div");const v=41,w=27,E=de("svg",{display:"block",height:v*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${v}`},this._element),A=de("radialGradient",{id:"shadowGradient"},de("defs",{},E));de("stop",{offset:"10%","stop-opacity":.4},A),de("stop",{offset:"100%","stop-opacity":.05},A),de("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),de("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),de("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),de("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=c.pointGeometry.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const g=this._element.classList;for(const v in _a)g.remove(`mapboxgl-marker-anchor-${v}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=c.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(24.6+v)],"bottom-right":[-v,-1*(24.6+v)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const h=s.code,g=s.charCode||s.keyCode;"Space"!==h&&"Enter"!==h&&32!==g&&13!==g||this.togglePopup()}_onMapClick(s){const h=s.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,h=this._pos;if(!s||!h)return!1;const g=s.unproject(h),v=s.getFreeCameraOptions();if(!v.position)return!1;const w=v.position.toLngLat();return w.distanceTo(g)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const h=this._pos;if(!h||h.x<0||h.x>s.transform.width||h.y<0||h.y>s.transform.height)return void this._clearFadeTimer();const g=s.unproject(h);let v;s._showingGlobe()&&c.isLngLatBehindGlobe(s.transform,this._lngLat)?v=0:(v=1-s._queryFogOpacity(g),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${s.x}px,${s.y}px)\n            ${_a[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${h.x}px,${h.y}px)\n        `}_calculateXYTransform(){const s=this._pos,h=this._map,g=this.getPitchAlignment();if(!h||!s||"map"!==g)return"";if(!h._showingGlobe()){const P=h.getPitch();return P?`rotateX(${P}deg)`:""}const v=c.radToDeg(c.globeTiltAtLngLat(h.transform,this._lngLat)),w=s.sub(c.globeCenterToScreenPoint(h.transform)),E=Math.abs(w.x)+Math.abs(w.y);if(0===E)return"";const A=v/E;return`rotateX(${-w.y*A}deg) rotateY(${w.x*A}deg)`}_calculateZTransform(){const s=this._pos,h=this._map;if(!h||!s)return"";let g=0;const v=this.getRotationAlignment();if("map"===v)if(h._showingGlobe()){const w=h.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),E=h.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);g=c.radToDeg(Math.atan2(E.y,E.x))-90}else g=-h.getBearing();else if("horizon"===v){const w=c.smoothstep(4,6,h.getZoom()),E=c.globeCenterToScreenPoint(h.transform);E.y+=w*h.transform.height;const A=s.sub(E),P=c.radToDeg(Math.atan2(A.y,A.x));g=(P>90?P-270:P+90)*(1-w)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(s){c.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Cr(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===s?this._updateFrameId=c.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=c.pointGeometry.convert(s),this._update(),this}_onMove(s){const h=this._map;if(!h)return;const g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){const w=this._clickTolerance||h._clickTolerance;if(s.point.dist(g)<w)return;this._isDragging=!0}this._pos=s.point.sub(v),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new c.Event("dragstart"))),this.fire(new c.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new c.Event("dragend")),this._state="inactive"}_addDragHandler(s){const h=this._map,g=this._pos;h&&g&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(g),this._pointerdownPos=s.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const h=this._map;return h&&(s?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Qc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ec=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ic(f=new c.pointGeometry(0,0),s="bottom"){if("number"==typeof f){const h=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(s){case"top":return new c.pointGeometry(0,f);case"top-left":return new c.pointGeometry(h,h);case"top-right":return new c.pointGeometry(-h,h);case"bottom":return new c.pointGeometry(0,-f);case"bottom-left":return new c.pointGeometry(h,-h);case"bottom-right":return new c.pointGeometry(-h,-h);case"left":return new c.pointGeometry(f,0);case"right":return new c.pointGeometry(-f,0)}return new c.pointGeometry(0,0)}return f instanceof c.pointGeometry||Array.isArray(f)?c.pointGeometry.convert(f):c.pointGeometry.convert(f[s]||[0,0])}class uo{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const h=c.easeCubicInOut((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,h,g){this._start=this.getValue(h),this._end=s,this._startTime=h,this._endTime=h+g}}const il={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},nl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},th={showCompass:!0,showZoom:!0,visualizePitch:!1};class mu{constructor(s,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Jl({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,g&&(this.mousePitch=new Gc({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),c.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),ye()}move(s,h){const g=this.map,v=this.mouseRotate.mousemoveWindow(s,h),w=v&&v.bearingDelta;if(w&&g.setBearing(g.getBearing()+w),this.mousePitch){const E=this.mousePitch.mousemoveWindow(s,h),A=E&&E.pitchDelta;A&&g.setPitch(g.getPitch()+A)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){pe(),c.window.removeEventListener("mousemove",this.mousemove),c.window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(c.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),Mt(this.element,s)),c.window.addEventListener("mousemove",this.mousemove),c.window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,Mt(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){1!==s.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ut(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){1!==s.targetTouches.length?this.reset():(this._lastPos=Ut(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){0===s.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const gu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},_u={maxWidth:100,unit:"metric"};function yu(f,s,h){const g=po(s),v=g/s,w={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[h];this._map._requestDomTask(()=>{this._container.style.width=f*v+"px",this._container.innerHTML=`${g}&nbsp;${w}`})}function po(f){const s=Math.pow(10,`${Math.floor(f)}`.length-1);let h=f/s;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:h>=1?1:function(g){const v=Math.pow(10,Math.ceil(-Math.log(g)/Math.LN10));return Math.round(g*v)/v}(h),s*h}const Fo={version:c.version,supported:Tt,setRTLTextPlugin:c.setRTLTextPlugin,getRTLTextPluginStatus:c.getRTLTextPluginStatus,Map:class extends tc{constructor(f){if(c.LivePerformanceUtils.mark(c.PerformanceMarkers.create),null!=(f=c.extend({},nl,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&c.isSafariWithAntialiasingBug(c.window)&&(f.antialias=!1,c.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Te(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._useWebGL2=f.useWebGL2,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new el,this._domRenderTaskQueue=new el,this._controls=[],this._markers=[],this._popups=[],this._mapId=c.uniqueId(),this._locale=c.extend({},il,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new uo(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new c.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=c.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof c.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&c.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),c.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==c.window&&(c.window.addEventListener("online",this._onWindowOnline,!1),c.window.addEventListener("resize",this._onWindowResize,!1),c.window.addEventListener("orientationchange",this._onWindowResize,!1),c.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Ql(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new du("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,c.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new Kc({customAttribution:f.customAttribution})),this._logoControl=new hn,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update("style"===s.dataType),this.fire(new c.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new c.Event(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(f,s){if(void 0===s&&(s=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=f.onAdd(this);this._controls.push(f);const g=this._controlPositions[s];return-1!==s.indexOf("bottom")?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(f);return s>-1&&this._controls.splice(s,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new c.Event("movestart",f)).fire(new c.Event("move",f)),this.fire(new c.Event("resize",f)),s&&this.fire(new c.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(c.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return"auto"===f?c.window.navigator.language:Array.isArray(f)?0===f.length?void 0:f.map(s=>"auto"===s?c.window.navigator.language:s):f}setLanguage(f){const s=this._parseLanguage(f);if(!this.style||s===this._language)return this;this._language=s,this.style._reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(f){return this._lazyInitEmptyStyle(),f?"string"==typeof f&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const f=this.transform,s=f.projection.name;let h;"globe"===s&&f.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?(f.setMercatorFromTransition(),h=!0):"mercator"===s&&f.zoom<c.GLOBE_ZOOM_THRESHOLD_MAX&&(f.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,s){return this._updateProjection(f||s||{name:"mercator"})}_updateProjection(f){let s;if(s="globe"===f.name&&this.transform.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),s){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(f){return this.transform.locationPoint3D(c.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(c.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,s,h){if("mouseenter"===f||"mouseover"===f){let g=!1;const v=E=>{const A=s.filter(z=>this.getLayer(z)),P=A.length?this.queryRenderedFeatures(E.point,{layers:A}):[];P.length?g||(g=!0,h.call(this,new Mi(f,this,E.originalEvent,{features:P}))):g=!1},w=()=>{g=!1};return{layers:new Set(s),listener:h,delegates:{mousemove:v,mouseout:w}}}if("mouseleave"===f||"mouseout"===f){let g=!1;const v=E=>{const A=s.filter(P=>this.getLayer(P));(A.length?this.queryRenderedFeatures(E.point,{layers:A}):[]).length?g=!0:g&&(g=!1,h.call(this,new Mi(f,this,E.originalEvent)))},w=E=>{g&&(g=!1,h.call(this,new Mi(f,this,E.originalEvent)))};return{layers:new Set(s),listener:h,delegates:{mousemove:v,mouseout:w}}}{const g=v=>{const w=s.filter(A=>this.getLayer(A)),E=w.length?this.queryRenderedFeatures(v.point,{layers:w}):[];E.length&&(v.features=E,h.call(this,v),delete v.features)};return{layers:new Set(s),listener:h,delegates:{[f]:g}}}}on(f,s,h){if(void 0===h)return super.on(f,s);Array.isArray(s)||(s=[s]);const g=this._createDelegatedListener(f,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(f,s,h){if(void 0===h)return super.once(f,s);Array.isArray(s)||(s=[s]);const g=this._createDelegatedListener(f,s,h);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(f,s,h){if(void 0===h)return super.off(f,s);s=new Set(Array.isArray(s)?s:[s]);const g=(w,E)=>{if(w.size!==E.size)return!1;for(const A of w)if(!E.has(A))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[f]:void 0;return v&&(w=>{for(let E=0;E<w.length;E++){const A=w[E];if(A.listener===h&&g(A.layers,s)){for(const P in A.delegates)this.off(P,A.delegates[P]);return w.splice(E,1),this}}})(v),this}queryRenderedFeatures(f,s){return this.style?(void 0!==s||void 0===f||f instanceof c.pointGeometry||Array.isArray(f)||(s=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],s=s||{},this.transform)):[]}querySourceFeatures(f,s){return this.style.querySourceFeatures(f,s)}setStyle(f,s){return!1!==(s=c.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s)).diff&&s.localIdeographFontFamily===this._localIdeographFontFamily&&s.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(f,s))}_getUIString(f){const s=this._locale[f];if(null==s)throw new Error(`Missing UI string '${f}'`);return s}_updateStyle(f,s){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f&&(this.style=new Ls(this,s||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ls(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,s){if("string"==typeof f){const h=this._requestManager.normalizeStyleURL(f),g=this._requestManager.transformRequest(h,c.ResourceType.Style);c.getJSON(g,(v,w)=>{v?this.fire(new c.ErrorEvent(v)):w&&this._updateDiff(w,s)})}else"object"==typeof f&&this._updateDiff(f,s)}_updateDiff(f,s){try{this.style.setState(f)&&this._update(!0)}catch(h){c.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(f,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(c.warnOnce("There is no style added to the map."),!1)}addSource(f,s){return this._lazyInitEmptyStyle(),this.style.addSource(f,s),this._update(!0)}isSourceLoaded(f){return!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const s in f){const h=f[s]._tiles;for(const g in h){const v=h[g];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}addSourceType(f,s,h){this._lazyInitEmptyStyle(),this.style.addSourceType(f,s,h)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,s,{pixelRatio:h=1,sdf:g=!1,stretchX:v,stretchY:w,content:E}={}){if(this._lazyInitEmptyStyle(),s instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&s instanceof c.window.ImageBitmap){const{width:A,height:P,data:z}=c.exported.getImageData(s);this.style.addImage(f,{data:new c.RGBAImage({width:A,height:P},z),pixelRatio:h,stretchX:v,stretchY:w,content:E,sdf:g,version:0})}else if(void 0===s.width||void 0===s.height)this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:P}=s,z=s;this.style.addImage(f,{data:new c.RGBAImage({width:A,height:P},new Uint8Array(z.data)),pixelRatio:h,stretchX:v,stretchY:w,content:E,sdf:g,version:0,userImage:z}),z.onAdd&&z.onAdd(this,f)}}updateImage(f,s){const h=this.style.getImage(f);if(!h)return void this.fire(new c.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=s instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&s instanceof c.window.ImageBitmap?c.exported.getImageData(s):s,{width:v,height:w}=g;void 0!==v&&void 0!==w?v===h.data.width&&w===h.data.height?(h.data.replace(g.data,!(s instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&s instanceof c.window.ImageBitmap)),this.style.updateImage(f,h)):this.fire(new c.ErrorEvent(new Error(`The width and height of the updated image (${v}, ${w})\n                must be that same as the previous version of the image\n                (${h.data.width}, ${h.data.height})`))):this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new c.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,s){c.getImage(this._requestManager.transformRequest(f,c.ResourceType.Image),(h,g)=>{s(h,g instanceof c.window.HTMLImageElement?c.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(f,s){return this._lazyInitEmptyStyle(),this.style.addLayer(f,s),this._update(!0)}moveLayer(f,s){return this.style.moveLayer(f,s),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,s,h){return this.style.setLayerZoomRange(f,s,h),this._update(!0)}setFilter(f,s,h={}){return this.style.setFilter(f,s,h),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,s,h,g={}){return this.style.setPaintProperty(f,s,h,g),this._update(!0)}getPaintProperty(f,s){return this.style.getPaintProperty(f,s)}setLayoutProperty(f,s,h,g={}){return this.style.setLayoutProperty(f,s,h,g),this._update(!0)}getLayoutProperty(f,s){return this.style.getLayoutProperty(f,s)}setLight(f,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,s),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.LngLat.convert(f),this.transform):0}setFeatureState(f,s){return this.style.setFeatureState(f,s),this._update()}removeFeatureState(f,s){return this.style.removeFeatureState(f,s),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let h,g,v,w=this._container;for(;w&&(!g||!v);){const E=c.window.getComputedStyle(w).transform;E&&"none"!==E&&(h=E.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(g=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(v=h[3])),w=w.parentElement}this._containerWidth=g?Math.abs(f/g):f,this._containerHeight=v?Math.abs(s/v):s}_detectMissingCSS(){"rgb(250, 128, 114)"!==c.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&c.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=zt("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=zt("div","mapboxgl-canvas-container",f);this._interactive&&s.classList.add("mapboxgl-interactive"),this._canvas=zt("canvas","mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=zt("div","mapboxgl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=zt("div",`mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,s){const h=c.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(f),this._canvas.height=h*Math.ceil(s),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${s}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const s=this._markers.indexOf(f);-1!==s&&this._markers.splice(s,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const s=this._popups.indexOf(f);-1!==s&&this._popups.splice(s,1)}_setupPainter(){const f=c.extend({},Tt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._useWebGL2&&this._canvas.getContext("webgl2",f),h=s||this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);h?(this._useWebGL2&&!s&&c.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),c.storeAuthState(h,!0),this.painter=new Ha(h,this.transform,!!s),this.on("data",g=>{"source"===g.dataType&&this.painter.setTileLoadedFlag(!0)}),c.exported$1.testSupport(h)):this.fire(new c.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new c.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let s;const h=this.painter.context.extTimerQuery,g=c.exported.now();if(this.listens("gpu-timing-frame")&&(s=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],c.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],c.window.performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,P=this.transform.pitch,z=c.exported.now(),O=new c.EvaluationParameters(A,{now:z,fadeDuration:v,pitch:P,transition:this.style.getTransition()});this.style.update(O)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(g),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new c.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const A=c.exported.now()-g;h.endQueryEXT(h.TIME_ELAPSED_EXT,s),setTimeout(()=>{const P=h.getQueryObjectEXT(s,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(s),this.fire(new c.Event("gpu-timing-frame",{cpuTime:A,gpuTime:P})),c.window.performance.mark("frame-gpu",{startTime:g,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(A);this.fire(new c.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(A);this.fire(new c.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(E||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(w=this._updateAverageElevation(g,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new c.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new c.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,c.LivePerformanceUtils.mark(c.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&c.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const s of this._markers)f&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!f||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(f,s=!1){const h=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((s||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const g=this.transform.averageElevation;let v=this.transform.sampleAverageElevation(),w=!1;this.transform.elevation&&(w=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=f;const E=Math.abs(g-v);if(E>1){if(this._isInitialLoad||w)return this._averageElevation.jumpTo(v),h(v);this._averageElevation.easeTo(v,f,300)}else if(E>1e-4)return this._averageElevation.jumpTo(v),h(v)}return!!this._averageElevation.isEasing(f)&&h(this._averageElevation.getValue(f))}_authenticate(){c.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===c.AUTH_ERR_MSG||401===f.status)){const s=this.painter.context.gl;c.storeAuthState(s,!1),this._logoControl instanceof hn&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),c.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const h=this.painter.context.gl,g=h.createFramebuffer();function v(w){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,w,0);const E=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,E),E}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(v(f),s.canvasCopies.map(v),s.timeStamps)}_canvasPixelComparison(f,s,h){let g=h[1]-h[0];const v=f.length/4;for(let w=0;w<s.length;w++){const E=s[w];let A=0;for(let P=0;P<E.length;P+=4)E[P]===f[P]&&E[P+1]===f[P+1]&&E[P+2]===f[P+2]&&E[P+3]===f[P+3]&&(A+=1);g+=(h[w+2]-h[w+1])*(1-A/v)}return g}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==c.window&&(c.window.removeEventListener("resize",this._onWindowResize,!1),c.window.removeEventListener("orientationchange",this._onWindowResize,!1),c.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.removeEventListener("online",this._onWindowOnline,!1),c.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),c.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new c.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=c.exported.frame(s=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(s)}))}_preloadTiles(f){const s=this.style?Object.values(this.style._sourceCaches):[];return c.asyncAll(s,(h,g)=>h._preloadTiles(f,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){"hidden"===c.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,s){c.setCacheLimits(f,s)}get version(){return c.version}},NavigationControl:class{constructor(f){this.options=c.extend({},th,f),this._container=zt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(c.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),zt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),zt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:s}):h.resetNorth({},{originalEvent:s}))}),this._compassIcon=zt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const s=f.getZoom(),h=s===f.getMaxZoom(),g=s===f.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new mu(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,s){const h=zt("button",f,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(f,s){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${s}`);f.setAttribute("aria-label",h),f.firstElementChild&&f.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends c.Evented{constructor(f){super(),this.options=c.extend({geolocation:c.window.navigator.geolocation},gu,f),c.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Un(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=zt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const s=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,f(h)};void 0!==this._supportsGeolocation?f(this._supportsGeolocation):void 0!==c.window.navigator.permissions?c.window.navigator.permissions.query({name:"geolocation"}).then(h=>s("denied"!==h.state)).catch(()=>s()):s()}_isOutOfMapMaxBounds(f){const s=this._map.getMaxBounds(),h=f.coords;return!!s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new c.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("geolocate",f)),this._finish()}}_updateCamera(f){const s=new c.LngLat(f.coords.longitude,f.coords.latitude),h=f.coords.accuracy,g=this._map.getBearing(),v=c.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),v,{geolocateSource:!0})}_updateMarker(f){if(f){const s=new c.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,s=c.mercatorZfromAltitude(1,f._center.lat)*f.worldSize,h=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=zt("button","mapboxgl-ctrl-geolocate",this._container),zt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===f){c.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=zt("div","mapboxgl-user-location"),this._dotElement.appendChild(zt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(zt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ho({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=zt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ho({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||"ACTIVE_LOCK"!==this._watchState||s.originalEvent&&"resize"===s.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.Event("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{c.window.addEventListener("ondeviceorientationabsolute"in c.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==c.window.DeviceMotionEvent&&"function"==typeof c.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(s=>{"granted"===s&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),c.window.removeEventListener("deviceorientation",this._onDeviceOrientation),c.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Kc,ScaleControl:class{constructor(f){this.options=c.extend({},_u,f),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=yu.bind(this)),c.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,s=this._map,h=s._containerHeight/2,g=s._containerWidth/2-f/2,v=s.unproject([g,h]),w=s.unproject([g+f,h]),E=v.distanceTo(w);if("imperial"===this.options.unit){const A=3.2808*E;A>5280?this._setScale(f,A/5280,"mile"):this._setScale(f,A,"foot")}else"nautical"===this.options.unit?this._setScale(f,E/1852,"nautical-mile"):E>=1e3?this._setScale(f,E/1e3,"kilometer"):this._setScale(f,E,"meter")}_setScale(f,s,h){const g=po(s),v=g/s;this._map._requestDomTask(()=>{this._container.style.width=f*v+"px",this._container.innerHTML="nautical-mile"!==h?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:h}).format(g):`${g}&nbsp;nm`})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=zt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof c.window.HTMLElement?this._container=f.container:c.warnOnce("Full screen control 'container' must be a DOM element.")),c.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in c.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in c.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=zt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,c.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!c.window.document.fullscreenEnabled&&!c.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=zt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);zt("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),c.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(c.window.document.fullscreenElement||c.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?c.window.document.exitFullscreen?c.window.document.exitFullscreen():c.window.document.webkitCancelFullScreen&&c.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends c.Evented{constructor(f){super(),this.options=c.extend(Object.create(Qc),f),c.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new c.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new c.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=c.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(c.window.document.createTextNode(f))}setHTML(f){const s=c.window.document.createDocumentFragment(),h=c.window.document.createElement("body");let g;for(h.innerHTML=f;g=h.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=zt("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(f),this.options.closeButton){const h=this._closeButton=zt("button","mapboxgl-popup-close-button",s);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let s;return this._classList.delete(f)?s=!1:(this._classList.add(f),s=!0),this._updateClassList(),s}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const s=this._map,h=this._container,g=this._pos;if(!s||!h||!g)return"bottom";const v=h.offsetWidth,w=h.offsetHeight,E=g.x<v/2,A=g.x>s.transform.width-v/2;if(g.y+f<w)return E?"top-left":A?"top-right":"top";if(g.y>s.transform.height-w){if(E)return"bottom-left";if(A)return"bottom-right"}return E?"left":A?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),f.className=s.join(" ")}_update(f){const s=this._map,h=this._content;if(!s||!this._lngLat&&!this._trackPointer||!h)return;let g=this._container;if(g||(g=this._container=zt("div","mapboxgl-popup",s.getContainer()),this._tip=zt("div","mapboxgl-popup-tip",g),g.appendChild(h)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Cr(this._lngLat,this._pos,s.transform)),!this._trackPointer||f){const v=this._pos=this._trackPointer&&f?f:s.project(this._lngLat),w=ic(this.options.offset),E=this._anchor=this._getAnchor(w.y),A=ic(this.options.offset,E),P=v.add(A).round();s._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${_a[E]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&s._showingGlobe()){const v=c.isLngLatBehindGlobe(s.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(ec);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:ho,Style:Ls,LngLat:c.LngLat,LngLatBounds:c.LngLatBounds,Point:c.pointGeometry,MercatorCoordinate:c.MercatorCoordinate,FreeCameraOptions:Gl,Evented:c.Evented,config:c.config,prewarm:function(){We().acquire(Ze)},clearPrewarmedResources:function(){const f=Ne;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(Ze),Ne=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return c.config.ACCESS_TOKEN},set accessToken(f){c.config.ACCESS_TOKEN=f},get baseApiUrl(){return c.config.API_URL},set baseApiUrl(f){c.config.API_URL=f},get workerCount(){return Ge.workerCount},set workerCount(f){Ge.workerCount=f},get maxParallelImageRequests(){return c.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){c.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){c.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:c.exported.setNow,restoreNow:c.exported.restoreNow};return Fo}),ae}()},6775:function(Le){var ae;ae=function(){var Ae="",bt=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function ae(Tt){return Tt.match(bt)||[]}function Ct(Tt){return{language:(Tt=ae(Tt))[1]||Ae,extlang:Tt[2]||Ae,script:Tt[3]||Ae,region:Tt[4]||Ae}}function c(Tt,mt,St){Object.defineProperty(Tt,mt,{value:St,enumerable:!0})}function p(Tt,mt,St){function zt(de){return ae(de)[Tt]||Ae}c(zt,"pattern",mt),c(Ct,St,zt)}return p(1,/^[a-zA-Z]{2,3}$/,"language"),p(2,/^[a-zA-Z]{3}$/,"extlang"),p(3,/^[a-zA-Z]{4}$/,"script"),p(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),c(Ct,"split",function Zt(Tt){return ae(Tt).filter(function(mt,St){return mt&&St})}),Ct},Le.exports?Le.exports=ae():this.subtag=ae()},5562:(Le,Ae,bt)=>{"use strict";var ae=bt(8576);Le.exports=ae,typeof window<"u"&&(window.Suggestions=ae)},7554:Le=>{"use strict";var Ae=function(bt){return this.component=bt,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,bt.el.parentNode.insertBefore(this.wrapper,bt.el.nextSibling),this};Ae.prototype.show=function(){this.element.style.display="block"},Ae.prototype.hide=function(){this.element.style.display="none"},Ae.prototype.add=function(bt){this.items.push(bt)},Ae.prototype.clear=function(){this.items=[],this.active=0},Ae.prototype.isEmpty=function(){return!this.items.length},Ae.prototype.isVisible=function(){return"block"===this.element.style.display},Ae.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var bt=0;bt<this.items.length;bt++)this.drawItem(this.items[bt],this.active===bt);this.show()}else this.hide()},Ae.prototype.drawItem=function(bt,ae){var Zt=document.createElement("li"),Ct=document.createElement("a");ae&&(Zt.className+=" active"),Ct.innerHTML=bt.string,Zt.appendChild(Ct),this.element.appendChild(Zt),Zt.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),Zt.addEventListener("mouseup",function(){this.handleMouseUp.call(this,bt)}.bind(this))},Ae.prototype.handleMouseUp=function(bt){this.selectingListItem=!1,this.component.value(bt.original),this.clear(),this.draw()},Ae.prototype.move=function(bt){this.active=bt,this.draw()},Ae.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},Ae.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},Ae.prototype.drawError=function(bt){var ae=document.createElement("li");ae.innerHTML=bt,this.element.appendChild(ae),this.show()},Le.exports=Ae},8576:(Le,Ae,bt)=>{"use strict";var ae=bt(4703),Zt=bt(5780),Ct=bt(7554),c=function(p,Tt,mt){return this.options=ae({minLength:2,limit:5,filter:!0,hideOnBlur:!0},mt=mt||{}),this.el=p,this.data=Tt||[],this.list=new Ct(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(St){this.handleKeyUp(St.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(St){this.handleKeyDown(St)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(St){this.handlePaste(St)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};c.prototype.handleKeyUp=function(p){40===p||38===p||27===p||13===p||9===p||this.handleInputChange(this.el.value)},c.prototype.handleKeyDown=function(p){switch(p.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&p.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},c.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},c.prototype.handlePaste=function(p){if(p.clipboardData)this.handleInputChange(p.clipboardData.getData("Text"));else{var Tt=this;setTimeout(function(){Tt.handleInputChange(p.target.value)},100)}},c.prototype.handleInputChange=function(p){this.query=this.normalize(p),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(Tt){for(var mt=0;mt<Tt.length&&(this.list.add(Tt[mt]),mt!==this.options.limit-1);mt++);this.list.draw()}.bind(this))},c.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},c.prototype.update=function(p){this.data=p,this.handleKeyUp()},c.prototype.clear=function(){this.data=[],this.list.clear()},c.prototype.normalize=function(p){return p.toLowerCase()},c.prototype.match=function(p,Tt){return p.indexOf(Tt)>-1},c.prototype.value=function(p){if(this.selected=p,this.el.value=this.getItemValue(p),document.createEvent){var Tt=document.createEvent("HTMLEvents");Tt.initEvent("change",!0,!1),this.el.dispatchEvent(Tt)}else this.el.fireEvent("onchange")},c.prototype.getCandidates=function(p){var Tt={pre:"<strong>",post:"</strong>",extract:function(St){return this.getItemValue(St)}.bind(this)};p(this.options.filter?Zt.filter(this.query,this.data,Tt).map(function(St){return{original:St.original,string:this.render(St.original,St.string)}}.bind(this)):this.data.map(function(St){return{original:St,string:this.render(St)}}.bind(this)))},c.prototype.getItemValue=function(p){return p},c.prototype.render=function(p,Tt){if(Tt)return Tt;for(var mt=this.getItemValue(p.original?p.original:p),St=this.normalize(mt),zt=St.lastIndexOf(this.query);zt>-1;){var de=zt+this.query.length;mt=mt.slice(0,zt)+"<strong>"+mt.slice(zt,de)+"</strong>"+mt.slice(de),zt=St.slice(0,zt).lastIndexOf(this.query)}return mt},c.prototype.renderError=function(p){this.list.drawError(p)},Le.exports=c},4703:Le=>{Le.exports=function bt(){for(var ae={},Zt=0;Zt<arguments.length;Zt++){var Ct=arguments[Zt];for(var c in Ct)Ae.call(Ct,c)&&(ae[c]=Ct[c])}return ae};var Ae=Object.prototype.hasOwnProperty},9652:(Le,Ae,bt)=>{"use strict";bt.d(Ae,{x0:()=>c});let c=(p=21)=>crypto.getRandomValues(new Uint8Array(p)).reduce((Tt,mt)=>Tt+((mt&=63)<36?mt.toString(36):mt<62?(mt-26).toString(36).toUpperCase():mt>62?"-":"_"),"")}}]);